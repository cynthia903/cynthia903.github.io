<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content="1EB8XoOl0C"><meta name="google-site-verification" content="K7thEgdLm0UfRWJ5MGdF7sCcjClSzAlxFLPv2Oz5CGM"><title> Qida's Blog</title><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="学习笔记 知识总结 思考感悟"><meta name="keywords"><meta name="author" content="Qida's Blog"><link rel="short icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/bubuzou.css"><link rel="search" type="application/opensearchdescription+xml" href="https://qidawu.github.io/atom.xml" title="Qida's Blog"><meta name="generator" content="Hexo 4.2.1"></head><body><header><div class="header row"> <a href="/" class="logo-link"><img src="/images/logo.png"></a><a href="/" class="title-link">Qida's Blog</a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" data-hover="博文" class="nav-list-link">博文</a></li><li class="nav-list-item"><a href="/archives/" target="_self" data-hover="归档" class="nav-list-link">归档</a></li></ul><div class="search"><a id="search_btn" href="#search"></a></div></div></header><div class="row scroll-con"><section class="container"><!-- for archive page--><ul class="home post-list"><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2018/04/21/java-collections-framework-concurrent-impl/" class="post-title-link">Java 集合框架系列（三）并发实现总结</a></h2><div class="post-info">2018-04-21<a href="/tags/Java/" title="Java" class="post-demo">Java</a></div><div class="post-content"><p>并发编程时，集合操作必须小心谨慎。Java SE 提供了两种并发编程方法：</p>
<ul>
<li>方案一：为集合通用实现添加线程同步功能。<code>Collections</code> 工具类提供了称为<a href="https://docs.oracle.com/javase/8/docs/api/java/util/Collections.html#synchronizedCollection-java.util.Collection-" target="_blank" rel="noopener"><em>同步包装器（synchronization wrappers）</em></a>的静态工厂方法可用于向许多非线程同步的集合添加同步行为。</li>
<li>方案二：使用并发集合。Java SE 提供了各种并发友好的集合接口和实现类。这些接口和类性能优于<em>同步包装器（synchronization wrappers）</em>，提供了并发编程中经常需要的各种功能。</li>
</ul>
<h1 id="同步包装器"><a href="#同步包装器" class="headerlink" title="同步包装器"></a>同步包装器</h1><p><code>Collections</code> 工具类提供如下静态工厂方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">synchronizedCollection</span><br><span class="line">synchronizedSet</span><br><span class="line">synchronizedSortedSet</span><br><span class="line">synchronizedNavigableSet</span><br><span class="line">synchronizedList</span><br><span class="line">synchronizedMap</span><br><span class="line">synchronizedSortedMap</span><br><span class="line">synchronizedNavigableMap</span><br></pre></td></tr></table></figure>

<p>以 <code>synchronizedCollection</code> 静态方法为例，源码实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns a synchronized (thread-safe) collection backed by the specified</span></span><br><span class="line"><span class="comment"> * collection.  In order to guarantee serial access, it is critical that</span></span><br><span class="line"><span class="comment"> * &lt;strong&gt;all&lt;/strong&gt; access to the backing collection is accomplished</span></span><br><span class="line"><span class="comment"> * through the returned collection.&lt;p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * It is imperative that the user manually synchronize on the returned</span></span><br><span class="line"><span class="comment"> * collection when traversing it via &#123;<span class="doctag">@link</span> Iterator&#125;, &#123;<span class="doctag">@link</span> Spliterator&#125;</span></span><br><span class="line"><span class="comment"> * or &#123;<span class="doctag">@link</span> Stream&#125;:</span></span><br><span class="line"><span class="comment"> * &lt;pre&gt;</span></span><br><span class="line"><span class="comment"> *  Collection c = Collections.synchronizedCollection(myCollection);</span></span><br><span class="line"><span class="comment"> *     ...</span></span><br><span class="line"><span class="comment"> *  synchronized (c) &#123;</span></span><br><span class="line"><span class="comment"> *      Iterator i = c.iterator(); // Must be in the synchronized block</span></span><br><span class="line"><span class="comment"> *      while (i.hasNext())</span></span><br><span class="line"><span class="comment"> *         foo(i.next());</span></span><br><span class="line"><span class="comment"> *  &#125;</span></span><br><span class="line"><span class="comment"> * &lt;/pre&gt;</span></span><br><span class="line"><span class="comment"> * Failure to follow this advice may result in non-deterministic behavior.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;The returned collection does &lt;i&gt;not&lt;/i&gt; pass the &#123;<span class="doctag">@code</span> hashCode&#125;</span></span><br><span class="line"><span class="comment"> * and &#123;<span class="doctag">@code</span> equals&#125; operations through to the backing collection, but</span></span><br><span class="line"><span class="comment"> * relies on &#123;<span class="doctag">@code</span> Object&#125;'s equals and hashCode methods.  This is</span></span><br><span class="line"><span class="comment"> * necessary to preserve the contracts of these operations in the case</span></span><br><span class="line"><span class="comment"> * that the backing collection is a set or a list.&lt;p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The returned collection will be serializable if the specified collection</span></span><br><span class="line"><span class="comment"> * is serializable.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &lt;T&gt; the class of the objects in the collection</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  c the collection to be "wrapped" in a synchronized collection.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> a synchronized view of the specified collection.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Collection&lt;T&gt; <span class="title">synchronizedCollection</span><span class="params">(Collection&lt;T&gt; c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SynchronizedCollection&lt;&gt;(c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现就是一行代码，返回一个静态内部类 <code>SynchronizedCollection</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SynchronizedCollection</span>&lt;<span class="title">E</span>&gt; <span class="keyword">implements</span> <span class="title">Collection</span>&lt;<span class="title">E</span>&gt;, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">3053995032091335093L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> Collection&lt;E&gt; c;  <span class="comment">// Backing Collection</span></span><br><span class="line">    <span class="keyword">final</span> Object mutex;     <span class="comment">// Object on which to synchronize</span></span><br><span class="line"></span><br><span class="line">    SynchronizedCollection(Collection&lt;E&gt; c) &#123;</span><br><span class="line">        <span class="keyword">this</span>.c = Objects.requireNonNull(c);</span><br><span class="line">        mutex = <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    SynchronizedCollection(Collection&lt;E&gt; c, Object mutex) &#123;</span><br><span class="line">        <span class="keyword">this</span>.c = Objects.requireNonNull(c);</span><br><span class="line">        <span class="keyword">this</span>.mutex = Objects.requireNonNull(mutex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (mutex) &#123;<span class="keyword">return</span> c.size();&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (mutex) &#123;<span class="keyword">return</span> c.isEmpty();&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (mutex) &#123;<span class="keyword">return</span> c.contains(o);&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Object[] toArray() &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (mutex) &#123;<span class="keyword">return</span> c.toArray();&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; T[] toArray(T[] a) &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (mutex) &#123;<span class="keyword">return</span> c.toArray(a);&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator&lt;E&gt; <span class="title">iterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> c.iterator(); <span class="comment">// Must be manually synched by user!</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (mutex) &#123;<span class="keyword">return</span> c.add(e);&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (mutex) &#123;<span class="keyword">return</span> c.remove(o);&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">containsAll</span><span class="params">(Collection&lt;?&gt; coll)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (mutex) &#123;<span class="keyword">return</span> c.containsAll(coll);&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addAll</span><span class="params">(Collection&lt;? extends E&gt; coll)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (mutex) &#123;<span class="keyword">return</span> c.addAll(coll);&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">removeAll</span><span class="params">(Collection&lt;?&gt; coll)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (mutex) &#123;<span class="keyword">return</span> c.removeAll(coll);&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">retainAll</span><span class="params">(Collection&lt;?&gt; coll)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (mutex) &#123;<span class="keyword">return</span> c.retainAll(coll);&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (mutex) &#123;c.clear();&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (mutex) &#123;<span class="keyword">return</span> c.toString();&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Override default methods in Collection</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">forEach</span><span class="params">(Consumer&lt;? <span class="keyword">super</span> E&gt; consumer)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (mutex) &#123;c.forEach(consumer);&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">removeIf</span><span class="params">(Predicate&lt;? <span class="keyword">super</span> E&gt; filter)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (mutex) &#123;<span class="keyword">return</span> c.removeIf(filter);&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Spliterator&lt;E&gt; <span class="title">spliterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> c.spliterator(); <span class="comment">// Must be manually synched by user!</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Stream&lt;E&gt; <span class="title">stream</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> c.stream(); <span class="comment">// Must be manually synched by user!</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Stream&lt;E&gt; <span class="title">parallelStream</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> c.parallelStream(); <span class="comment">// Must be manually synched by user!</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeObject</span><span class="params">(ObjectOutputStream s)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (mutex) &#123;s.defaultWriteObject();&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从源码可见，其实就是返回一个包装类，内部实现使用了 <code>synchronized</code> 关键字加 <code>mutex</code> 对象作为互斥锁，对被包装集合的所有增删改查方法加锁，相当暴力。</p>
<h1 id="并发集合"><a href="#并发集合" class="headerlink" title="并发集合"></a>并发集合</h1><p>并发集合作为 <code>java.util.concurrent</code> 包的一部分，提供的并发集合类如下：</p>
<p><img src="/img/java/collection/concurrent_collections.png" alt="concurrent_collections"></p>
<h2 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h2><p><code>Queue</code> 的常用方法差别如下：</p>
<table>
<thead>
<tr>
<th></th>
<th><em>Throws exception</em></th>
<th><em>Returns special value</em></th>
</tr>
</thead>
<tbody><tr>
<td><strong>Insert</strong></td>
<td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Queue.html#add-E-" target="_blank" rel="noopener"><code>add(e)</code></a></td>
<td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Queue.html#offer-E-" target="_blank" rel="noopener"><code>offer(e)</code></a></td>
</tr>
<tr>
<td><strong>Remove</strong></td>
<td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Queue.html#remove--" target="_blank" rel="noopener"><code>remove()</code></a></td>
<td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Queue.html#poll--" target="_blank" rel="noopener"><code>poll()</code></a></td>
</tr>
<tr>
<td><strong>Examine</strong></td>
<td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Queue.html#element--" target="_blank" rel="noopener"><code>element()</code></a></td>
<td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Queue.html#peek--" target="_blank" rel="noopener"><code>peek()</code></a></td>
</tr>
</tbody></table>
<p>有两种并发队列实现，阻塞队列、并发队列（非阻塞式）：</p>
<p><img src="/img/java/collection/queue_impl.png" alt="Queue_implementations"></p>
<h3 id="阻塞队列"><a href="#阻塞队列" class="headerlink" title="阻塞队列"></a>阻塞队列</h3><p><code>BlockingQueue</code> 扩展自 <code>Queue</code> 接口，主要新增了两组接口（下表后两列），其常用方法差别如下：</p>
<table>
<thead>
<tr>
<th></th>
<th><em>Throws exception</em></th>
<th><em>Returns Special value</em></th>
<th><em>Times out</em></th>
<th><em>Blocks</em></th>
</tr>
</thead>
<tbody><tr>
<td><strong>Insert</strong></td>
<td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/BlockingQueue.html#add-E-" target="_blank" rel="noopener"><code>add(e)</code></a></td>
<td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/BlockingQueue.html#offer-E-" target="_blank" rel="noopener"><code>offer(e)</code></a></td>
<td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/BlockingQueue.html#offer-E-long-java.util.concurrent.TimeUnit-" target="_blank" rel="noopener"><code>offer(e, time, unit)</code></a></td>
<td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/BlockingQueue.html#put-E-" target="_blank" rel="noopener"><code>put(e)</code></a></td>
</tr>
<tr>
<td><strong>Remove</strong></td>
<td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/BlockingQueue.html#remove-java.lang.Object-" target="_blank" rel="noopener"><code>remove()</code></a></td>
<td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/BlockingQueue.html#poll-long-java.util.concurrent.TimeUnit-" target="_blank" rel="noopener"><code>poll()</code></a></td>
<td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/BlockingQueue.html#poll-long-java.util.concurrent.TimeUnit-" target="_blank" rel="noopener"><code>poll(time, unit)</code></a></td>
<td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/BlockingQueue.html#take--" target="_blank" rel="noopener"><code>take()</code></a></td>
</tr>
<tr>
<td><strong>Examine</strong></td>
<td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Queue.html#element--" target="_blank" rel="noopener"><code>element()</code></a></td>
<td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Queue.html#peek--" target="_blank" rel="noopener"><code>peek()</code></a></td>
<td><em>not applicable</em></td>
<td><em>not applicable</em></td>
</tr>
</tbody></table>
<p><code>ThreadPoolExecutor</code> 目前使用了 <code>BlockingQueue</code> 的这些方法：</p>
<ul>
<li>入队 <code>offer(e)</code></li>
<li>出队 <code>poll(time, unit)</code> 或 <code>take()</code></li>
</ul>
<p>阻塞队列 <code>BlockingQueue</code> 的实现如下：</p>
<ul>
<li><p>有界队列（数组实现）：</p>
<ul>
<li><code>ArrayBlockingQueue</code>，基于数组实现的有界阻塞队列。</li>
</ul>
</li>
<li><p>无界队列（链表实现）：</p>
<ul>
<li><code>LinkedBlockingQueue</code>，基于链表实现的可选无界阻塞队列。默认用于 <code>Executors.newFixedThreadPool(...)</code> 和 <code>newSingleThreadExecutor(...)</code>。</li>
<li><code>LinkedTransferQueue</code></li>
<li><code>PriorityBlockingQueue</code>，基于堆实现（底层是数组）的具有优先级的无界阻塞队列。</li>
<li><code>DelayedQueue</code></li>
</ul>
</li>
<li><p>无容量队列：</p>
<ul>
<li><code>SynchronousQueue</code>，无容量阻塞队列，每个插入操作都必须等待另一个线程的移除操作，反之亦然。默认用于 <code>Executors.newCachedThreadPool(...)</code>。</li>
</ul>
</li>
</ul>
<p><img src="/img/java/collection/BlockingQueue_implementations.png" alt="BlockingQueue"></p>
<p>阻塞双端队列 <code>BlockingDeque</code> 的实现如下：</p>
<p><img src="/img/java/collection/BlockingDeque_implementations.png" alt="BlockingDeque_implementations"></p>
<h3 id="并发队列（非阻塞）"><a href="#并发队列（非阻塞）" class="headerlink" title="并发队列（非阻塞）"></a>并发队列（非阻塞）</h3><p><code>ConcurrentLinkedQueue</code></p>
<p><code>ConcurrentLinkedDeque</code></p>
<h2 id="并发散列表"><a href="#并发散列表" class="headerlink" title="并发散列表"></a>并发散列表</h2><p><code>ConcurrentMap</code></p>
<ul>
<li><code>ConcurrentHashMap</code></li>
</ul>
<p><img src="/img/java/collection/ConcurrentHashMap.png" alt="ConcurrentHashMap"></p>
<h2 id="并发跳表"><a href="#并发跳表" class="headerlink" title="并发跳表"></a>并发跳表</h2><p><code>ConcurrentSkipListSet</code></p>
<p><code>ConcurrentNavigableMap</code></p>
<ul>
<li><code>ConcurrentSkipListMap</code></li>
</ul>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://blog.csdn.net/way2016/article/details/93380850" target="_blank" rel="noopener">https://blog.csdn.net/way2016/article/details/93380850</a></p>
<p><a href="https://www.cnblogs.com/gujiande/p/9485493.html" target="_blank" rel="noopener">https://www.cnblogs.com/gujiande/p/9485493.html</a></p>
</div></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2018/04/14/java-collections-framework-features/" class="post-title-link">Java 集合框架系列（二）集合特性总结</a></h2><div class="post-info">2018-04-14<a href="/tags/Java/" title="Java" class="post-demo">Java</a></div><div class="post-content"><p>集合接口中的许多修改方法都被标记为<em>可选（optional）</em>。实现类允许按需实现，未实现的方法需抛出运行时异常 <code>UnsupportedOperationException</code>。每个实现类的文档必须指明支持哪些可选操作。集合框架引入下列术语来帮助阐述本规范：</p>
<h1 id="定长-变长"><a href="#定长-变长" class="headerlink" title="定长/变长"></a>定长/变长</h1><p>长度保证不变（即使元素可以更改）的列表称为 <strong><em>fixed-size</em></strong> 定长列表。反之则称为 <strong><em>variable-size</em></strong> 变长列表。</p>
<p>开发中接触最多的定长集合是通过 <code>Arrays.asList()</code> 创建的，该方法是一个适配器接口，将数组适配为定长列表，返回的对象是一个 <code>Arrays</code> 内部类，源码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns a fixed-size list backed by the specified array.  (Changes to</span></span><br><span class="line"><span class="comment"> * the returned list "write through" to the array.)  This method acts</span></span><br><span class="line"><span class="comment"> * as bridge between array-based and collection-based APIs, in</span></span><br><span class="line"><span class="comment"> * combination with &#123;<span class="doctag">@link</span> Collection#toArray&#125;.  The returned list is</span></span><br><span class="line"><span class="comment"> * serializable and implements &#123;<span class="doctag">@link</span> RandomAccess&#125;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;This method also provides a convenient way to create a fixed-size</span></span><br><span class="line"><span class="comment"> * list initialized to contain several elements:</span></span><br><span class="line"><span class="comment"> * &lt;pre&gt;</span></span><br><span class="line"><span class="comment"> *     List&lt;String&gt; stooges = Arrays.asList("Larry", "Moe", "Curly");</span></span><br><span class="line"><span class="comment"> * &lt;/pre&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt; the class of the objects in the array</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> a the array by which the list will be backed</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> a list view of the specified array</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SafeVarargs</span></span><br><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"varargs"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">List&lt;T&gt; <span class="title">asList</span><span class="params">(T... a)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ArrayList&lt;&gt;(a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayList</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractList</span>&lt;<span class="title">E</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">RandomAccess</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">2764017481108945198L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> E[] a;</span><br><span class="line"></span><br><span class="line">    ArrayList(E[] array) &#123;</span><br><span class="line">        a = Objects.requireNonNull(array);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>分析发现，涉及元素增删的操作（如 <code>add()、remove()、clear()</code>）该内部类并没有实现，而是使用了父类 <code>AbstractList</code> 的方法，默认抛出 <code>UnsupportedOperationException</code> 异常：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractList</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractCollection</span>&lt;<span class="title">E</span>&gt; <span class="keyword">implements</span> <span class="title">List</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, E element)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>参考手册：</p>
<p><img src="/img/java/collection/arrays_aslist.png" alt="arrays_aslist"></p>
<h1 id="可改-不可改"><a href="#可改-不可改" class="headerlink" title="可改/不可改"></a>可改/不可改</h1><p>不支持修改操作（例如 <code>add</code>、<code>remove</code> 和 <code>clear</code>）的集合称为 <strong><em>unmodifiable</em></strong> 不可修改集合。反之则称为 <strong><em>modifiable</em></strong> 可修改集合。<code>Collections</code> 工具类提供了一组静态工厂方法，用于包装并返回指定集合的不可修改视图（<em>unmodifiable view</em>），如果尝试修改，则会抛出<code>UnsupportedOperationException</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Collections.unmodifiableCollection</span><br><span class="line">Collections.unmodifiableSet</span><br><span class="line">Collections.unmodifiableSortedSet</span><br><span class="line">Collections.unmodifiableNavigableSet</span><br><span class="line">Collections.unmodifiableList</span><br><span class="line">Collections.unmodifiableMap</span><br><span class="line">Collections.unmodifiableSortedMap</span><br><span class="line">Collections.unmodifiableNavigableMap</span><br></pre></td></tr></table></figure>

<p>从源码分析，该包装类覆盖了所有修改方法并抛出异常 <code>UnsupportedOperationException</code>，实现非常简单：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">UnmodifiableCollection</span>&lt;<span class="title">E</span>&gt; <span class="keyword">implements</span> <span class="title">Collection</span>&lt;<span class="title">E</span>&gt;, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1820017752578914078L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> Collection&lt;? extends E&gt; c;</span><br><span class="line"></span><br><span class="line">    UnmodifiableCollection(Collection&lt;? extends E&gt; c) &#123;</span><br><span class="line">        <span class="keyword">if</span> (c==<span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">        <span class="keyword">this</span>.c = c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addAll</span><span class="params">(Collection&lt;? extends E&gt; coll)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">removeAll</span><span class="params">(Collection&lt;?&gt; coll)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">retainAll</span><span class="params">(Collection&lt;?&gt; coll)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="可变-不可变"><a href="#可变-不可变" class="headerlink" title="可变/不可变"></a>可变/不可变</h1><p>在 <em>unmodifiable</em> 的基础上，加之保证 <code>Collection</code> 实现类的底层数据为 <code>final</code> 的集合称为 <strong><em>immutable</em></strong> 不可变集合。反之则称为 <strong><em>mutable</em></strong> 可变集合。</p>
<p>Java 9 为 <code>List</code>、<code>Set</code> 和 <code>Map</code> 接口提供了新的静态工厂方法，可以创建这些集合的不可变实例，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = List.of(<span class="string">"apple"</span>, <span class="string">"orange"</span>, <span class="string">"banana"</span>);</span><br><span class="line">Set&lt;String&gt; set = Set.of(<span class="string">"aggie"</span>, <span class="string">"alley"</span>, <span class="string">"steely"</span>);</span><br><span class="line">Map&lt;String, String&gt; map = Map.of(<span class="string">"A"</span>, <span class="string">"Apple"</span>, <span class="string">"B"</span>, <span class="string">"Boy"</span>, <span class="string">"C"</span>, <span class="string">"Cat"</span>);</span><br></pre></td></tr></table></figure>

<p>而 Java 9 之前，要实现不可变集合只能通过第三方库，例如用 Guava 实现相同效果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = ImmutableList.of(<span class="string">"apple"</span>, <span class="string">"orange"</span>, <span class="string">"banana"</span>);</span><br><span class="line">Set&lt;String&gt; set = ImmutableSet.of(<span class="string">"aggie"</span>, <span class="string">"alley"</span>, <span class="string">"steely"</span>);</span><br><span class="line">Map&lt;String, String&gt; map = ImmutableMap.of(<span class="string">"A"</span>, <span class="string">"Apple"</span>, <span class="string">"B"</span>, <span class="string">"Boy"</span>, <span class="string">"C"</span>, <span class="string">"Cat"</span>);</span><br></pre></td></tr></table></figure>

<p>Guava 提供的不可变集合 API 如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">ImmutableAsList</span><br><span class="line">ImmutableBiMap</span><br><span class="line">ImmutableClassToInstanceMap</span><br><span class="line">ImmutableCollection</span><br><span class="line">ImmutableEntry</span><br><span class="line">ImmutableEnumMap</span><br><span class="line">ImmutableEnumSet</span><br><span class="line">ImmutableList</span><br><span class="line">ImmutableListMultimap</span><br><span class="line">ImmutableMap</span><br><span class="line">ImmutableMapEntry</span><br><span class="line">ImmutableMapEntrySet</span><br><span class="line">ImmutableMapKeySet</span><br><span class="line">ImmutableMapValues</span><br><span class="line">ImmutableMultimap</span><br><span class="line">ImmutableMultiset</span><br><span class="line">ImmutableRangeMap</span><br><span class="line">ImmutableRangeSet</span><br><span class="line">ImmutableSet</span><br><span class="line">ImmutableSetMultimap</span><br><span class="line">ImmutableSortedAsList</span><br><span class="line">ImmutableSortedMap</span><br><span class="line">ImmutableSortedMapFauxverideShim</span><br><span class="line">ImmutableSortedMultiset</span><br><span class="line">ImmutableSortedMultisetFauxverideShim</span><br><span class="line">ImmutableSortedSet</span><br><span class="line">ImmutableSortedSetFauxverideShim</span><br><span class="line">ImmutableTable</span><br></pre></td></tr></table></figure>

<p><img src="/img/java/collection/immutable_collections.PNG" alt="immutable_collections"></p>
<p>使用如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = ImmutableList.of(<span class="string">"apple"</span>, <span class="string">"orange"</span>, <span class="string">"banana"</span>);</span><br><span class="line">Set&lt;String&gt; set = ImmutableSet.of(<span class="string">"aggie"</span>, <span class="string">"alley"</span>, <span class="string">"steely"</span>);</span><br><span class="line">Map&lt;String, String&gt; map = ImmutableMap.of(<span class="string">"A"</span>, <span class="string">"Apple"</span>, <span class="string">"B"</span>, <span class="string">"Boy"</span>, <span class="string">"C"</span>, <span class="string">"Cat"</span>);</span><br><span class="line"></span><br><span class="line">log.info(<span class="string">"list=&#123;&#125;, set=&#123;&#125;, map=&#123;&#125;"</span>, fruits, marbles, map);  <span class="comment">// list=[apple, orange, banana], set=[aggie, alley, steely], map=&#123;A=Apple, B=Boy, C=Cat&#125;</span></span><br></pre></td></tr></table></figure>

<p>除此之外，Apache Commons Lang 也提供了两个好用的类 <code>Pair</code> 和 <code>Triple</code>，可用于存放指定个数的临时数据：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Triple.of(<span class="string">"left"</span>, <span class="string">"middle"</span>, <span class="string">"right"</span>)</span><br><span class="line">Pair.of(<span class="string">"left"</span>, <span class="string">"right"</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/img/java/collection/methods_of_Pair_and_Triple.png" alt="methods_of_Pair_and_Triple"></p>
<h1 id="随机-顺序访问"><a href="#随机-顺序访问" class="headerlink" title="随机/顺序访问"></a>随机/顺序访问</h1><p>支持根据下标索引快速（时间复杂度 <code>0(1)</code>）访问元素的列表称为 <strong><em>random access</em></strong> 随机访问列表。反之则称为 <strong><em>sequential access</em></strong> 顺序访问列表。</p>
<p>标记接口 <code>java.util.RandomAccess</code> 用于标记列表类支持随机访问，其实现类如下：</p>
<p><img src="/img/java/collection/RandomAccess.png" alt="RandomAccess"></p>
<p>该标记接口使得 <code>Collections</code> 工具类中的通用算法实现能够据此更改其行为以提升性能：</p>
<ul>
<li><code>binarySearch</code></li>
<li><code>reverse</code></li>
<li><code>shuffle</code></li>
<li><code>fill</code></li>
<li><code>copy</code></li>
<li><code>rotate</code></li>
<li><code>replaceAll</code></li>
<li><code>indexOfSubList</code></li>
<li><code>lastIndexOfSubList</code></li>
<li><code>checkedList</code></li>
</ul>
<p>以 <code>binarySearch</code> 为例，源码判断如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function"><span class="keyword">int</span> <span class="title">binarySearch</span><span class="params">(List&lt;? extends Comparable&lt;? <span class="keyword">super</span> T&gt;&gt; list, T key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (list <span class="keyword">instanceof</span> RandomAccess || list.size()&lt;BINARYSEARCH_THRESHOLD)</span><br><span class="line">        <span class="keyword">return</span> Collections.indexedBinarySearch(list, key);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> Collections.iteratorBinarySearch(list, key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="元素限制"><a href="#元素限制" class="headerlink" title="元素限制"></a>元素限制</h1><p>某些集合实现限制了可以存储哪些元素。可能的限制包括：</p>
<ul>
<li>元素不能为 <code>null</code>。</li>
<li>元素必须属于特定类型。</li>
<li>元素必须匹配某些断言。</li>
</ul>
<p>尝试添加违反集合实现限制的元素将导致运行时异常，如 <code>ClassCastException</code>、<code>IllegalArgumentException</code> 或 <code>NullPointerException</code>。</p>
<h2 id="能否为-null"><a href="#能否为-null" class="headerlink" title="能否为 null"></a>能否为 null</h2><p>参考手册：</p>
<p><img src="/img/java/collection/map_element_of_null.png" alt="map_element_of_null"></p>
<h2 id="类型限制"><a href="#类型限制" class="headerlink" title="类型限制"></a>类型限制</h2><p>泛型机制虽然为集合提供了编译期类型检查，但仍然可以在运行期绕过此机制（通过反射也能绕过编译期类型检查）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;Integer&gt; intList = Lists.newArrayList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">    add(intList);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 循环到第四个元素时，报错：java.lang.ClassCastException: java.lang.String cannot be cast to java.lang.Integer</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> item : intList) &#123;</span><br><span class="line">        log.info(<span class="string">"result is &#123;&#125;"</span>, item);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(List list)</span> </span>&#123;</span><br><span class="line">    list.add(<span class="string">"4"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>集合框架提供了一组包装器实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Collections.checkedCollection</span><br><span class="line">Collections.checkedQueue</span><br><span class="line">Collections.checkedSet</span><br><span class="line">Collections.checkedSortedSet</span><br><span class="line">Collections.checkedNavigableSet</span><br><span class="line">Collections.checkedList</span><br><span class="line">Collections.checkedMap</span><br><span class="line">Collections.checkedSortedMap</span><br><span class="line">Collections.checkedNavigableMap</span><br></pre></td></tr></table></figure>

<p>这些包装器实现用于返回指定集合的动态类型安全视图（<em>dynamically type-safe view</em>），核心源码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CheckedCollection</span>&lt;<span class="title">E</span>&gt; <span class="keyword">implements</span> <span class="title">Collection</span>&lt;<span class="title">E</span>&gt;, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1578914078182001775L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> Collection&lt;E&gt; c;</span><br><span class="line">    <span class="keyword">final</span> Class&lt;E&gt; type;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function">E <span class="title">typeCheck</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (o != <span class="keyword">null</span> &amp;&amp; !type.isInstance(o))</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ClassCastException(badElementMsg(o));</span><br><span class="line">        <span class="keyword">return</span> (E) o;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">badElementMsg</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Attempt to insert "</span> + o.getClass() +</span><br><span class="line">            <span class="string">" element into collection with element type "</span> + type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    CheckedCollection(Collection&lt;E&gt; c, Class&lt;E&gt; type) &#123;</span><br><span class="line">        <span class="keyword">this</span>.c = Objects.requireNonNull(c, <span class="string">"c"</span>);</span><br><span class="line">        <span class="keyword">this</span>.type = Objects.requireNonNull(type, <span class="string">"type"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123; </span><br><span class="line">        <span class="keyword">return</span> c.add(typeCheck(e));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以 <code>add</code> 方法为例，每次添加元素时，都会调用 <code>typeCheck</code> 私有方法进行类型检查，如果尝试添加错误类型的元素，则会抛出 <code>ClassCastException</code>，通过 fail fast 防止后续出错：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;Integer&gt; intList = Collections.checkedList(Lists.newArrayList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>), Integer<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    add(intList);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> item : intList) &#123;</span><br><span class="line">        log.info(<span class="string">"result is &#123;&#125;"</span>, item);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(List list)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// java.lang.ClassCastException: Attempt to insert class java.lang.String element into collection with element type class java.lang.Integer</span></span><br><span class="line">    list.add(<span class="string">"4"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="数组转-List-方法"><a href="#数组转-List-方法" class="headerlink" title="数组转 List 方法"></a>数组转 List 方法</h1><p>方法一：转两次</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;(Arrays.asList(<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>))  <span class="comment">// from varargs</span></span><br></pre></td></tr></table></figure>

<p>方法二：Java 8 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 包装类型</span></span><br><span class="line">Integer [] myArray = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> &#125;;</span><br><span class="line">List&lt;Integer&gt; myList = Arrays.stream(myArray).collect(Collectors.toList());</span><br><span class="line"><span class="comment">// 基本类型也可以实现转换（依赖 boxed 的装箱操作）</span></span><br><span class="line"><span class="keyword">int</span> [] myArray2 = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> &#125;;</span><br><span class="line">List&lt;Integer&gt; myList2 = Arrays.stream(myArray2).boxed().collect(Collectors.toList());</span><br></pre></td></tr></table></figure>

<p>方法三：Guava</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不可变集合</span></span><br><span class="line">List&lt;String&gt; il = ImmutableList.of(<span class="string">"string"</span>, <span class="string">"elements"</span>);  <span class="comment">// from varargs</span></span><br><span class="line">List&lt;String&gt; i2 = ImmutableList.copyOf(<span class="keyword">new</span> String[]&#123;<span class="string">"string"</span>, <span class="string">"elements"</span>&#125;);  <span class="comment">// from array</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 可变集合</span></span><br><span class="line">List&lt;String&gt; l0 = Lists.newLinkedList(Arrays.asList(<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>));  <span class="comment">// from collection</span></span><br><span class="line">List&lt;String&gt; l1 = Lists.newArrayList(Arrays.asList(<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>));  <span class="comment">// from collection</span></span><br><span class="line">List&lt;String&gt; l2 = Lists.newArrayList(<span class="keyword">new</span> String[]&#123;<span class="string">"string"</span>, <span class="string">"elements"</span>&#125;);  <span class="comment">// from array</span></span><br><span class="line">List&lt;String&gt; l3 = Lists.newArrayList(<span class="string">"or"</span>, <span class="string">"string"</span>, <span class="string">"elements"</span>); <span class="comment">// from varargs</span></span><br></pre></td></tr></table></figure>

<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>《<a href="https://mp.weixin.qq.com/s/-jWmAqAbc-vLV9w541NhxQ" target="_blank" rel="noopener">Arrays.asList()原来是这样用的</a>》</p>
<p>《<a href="https://mp.weixin.qq.com/s/7ILvz9UreVco0sq9s-zJNg" target="_blank" rel="noopener">千万不要这样使用Arrays.asList !</a>》</p>
<p>《<a href="https://www.cnblogs.com/peida/p/Guava_ImmutableCollections.html" target="_blank" rel="noopener">Guava学习笔记：Immutable(不可变)集合</a>》</p>
<p>《<a href="https://blog.csdn.net/Seriousplus/article/details/79750581" target="_blank" rel="noopener">Java 中的 Mutable 和 Immutable</a>》（<a href="http://web.mit.edu/6.031/www/sp17/classes/09-immutability/" target="_blank" rel="noopener">en_US</a>）</p>
<p><a href="https://stackoverflow.com/questions/7713274/java-immutable-collections" target="_blank" rel="noopener">https://stackoverflow.com/questions/7713274/java-immutable-collections</a></p>
<ul>
<li>Unmodifiable collections are usually read-only views (wrappers) of other collections. You can’t add, remove or clear them, but <strong>the underlying collection can change</strong>.</li>
<li>Immutable collections can’t be changed at all - they don’t wrap another collection - they have their own <code>final</code> elements.</li>
</ul>
</div></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2018/04/10/java-collections-framework/" class="post-title-link">Java 集合框架系列（一）框架总结</a></h2><div class="post-info">2018-04-10<a href="/tags/Java/" title="Java" class="post-demo">Java</a></div><div class="post-content"><p>集合（<em>collection</em>）表示一组对象。Java SE 提供了集合框架（<em>collections framework</em>），是一个用于表示和操作集合的统一框架，使集合可以独立于实现细节进行操作。集合框架的主要优点如下：</p>
<ul>
<li>通过提供数据结构和算法实现，使用户无需自行编写，<strong>减少编程工作</strong>。</li>
<li>通过提供数据结构和算法的高性能实现来<strong>提高性能</strong>。由于每个接口的各种实现是可互换的，因此可以通过切换实现来调整和优化程序。</li>
<li>通过提供一套标准接口来<strong>促进软件重用</strong>。</li>
<li>通过建立一种通用语言，<strong>为无关联的集合 API 之间提供互操作性</strong>。</li>
<li><strong>减少学习成本</strong>，只须学习一些特设的集合 API。</li>
</ul>
<p>集合框架的整体组成如下：</p>
<p><img src="/img/java/collection/overview.png" alt="overview"></p>
<p>下面分别来看下各组成部分。</p>
<h1 id="集合接口"><a href="#集合接口" class="headerlink" title="集合接口"></a>集合接口</h1><p>集合接口分为下面两组，这些接口构成了集合框架的基础：</p>
<ul>
<li><p><code>java.util.Collection</code>，表示一组对象集合</p>
<blockquote>
<p>A collection represents a group of objects, known as its <em>elements</em>. </p>
<ul>
<li><p>Some collections allow duplicate elements and others do not. </p>
</li>
<li><p>Some are ordered and others unordered. </p>
</li>
</ul>
<p>The JDK does not provide any <em>direct</em> implementations of this interface: it provides implementations of more specific subinterfaces like <code>Set</code> and <code>List</code>. </p>
<p>This interface is typically used to pass collections around and manipulate them where maximum generality is desired.</p>
</blockquote>
</li>
<li><p><code>java.util.Map</code>，用于存储键值对</p>
<blockquote>
<p>An object that maps keys to values.</p>
<ul>
<li><p>A map cannot contain duplicate keys; </p>
</li>
<li><p>each key can map to at most one value.</p>
</li>
</ul>
</blockquote>
</li>
</ul>
<h2 id="Collection"><a href="#Collection" class="headerlink" title="Collection"></a>Collection</h2><p>最基础的集合接口 <code>java.util.Collection</code> 及其子接口如下：</p>
<p><img src="/img/java/collection/Collection.png" alt="Collection"></p>
<p>其中，常用的五个重点接口的方法及使用要点如下：</p>
<p><img src="/img/java/collection/methods_of_collection.png" alt="methods_of_collection"></p>
<h2 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h2><p>其它集合接口基于 <code>java.util.Map</code>，不是真正的集合。但是，这些接口包含集合视图（<em>collection-view</em>）操作，使得它们可以作为集合进行操作。</p>
<p><img src="/img/java/collection/Map.png" alt="Map"></p>
<p><code>java.util.Map</code> 接口的方法如下:</p>
<p><img src="/img/java/collection/Map_methods.png" alt="Map methods"></p>
<h1 id="集合实现类"><a href="#集合实现类" class="headerlink" title="集合实现类"></a>集合实现类</h1><h2 id="抽象类实现"><a href="#抽象类实现" class="headerlink" title="抽象类实现"></a>抽象类实现</h2><p>下列抽象类为核心集合接口提供了基本功能实现，以最小化用户自定义实现的成本。这些抽象类的 API 文档精确地描述了各个方法的实现方式，实现者能够参阅并了解哪些方法需要覆盖：</p>
<p><img src="/img/java/collection/Collection_abstract_class.png" alt="Collection_abstract_class"></p>
<h2 id="通用实现"><a href="#通用实现" class="headerlink" title="通用实现"></a>通用实现</h2><p><code>java.util.Collection</code> 的通用实现如下：</p>
<p><img src="/img/java/collection/collection_impl.png" alt="collection_impl"></p>
<p><code>java.util.Map</code> 的通用实现如下：</p>
<p><img src="/img/java/collection/map_impl.JPG" alt="map_impl"></p>
<p>集合接口的主要实现，命名通常形如 &lt;<em>Implementation-style</em>&gt;&lt;<em>Interface</em>&gt;。通用实现类汇总如下（左列为接口，表头为数据结构）：</p>
<table>
<thead>
<tr>
<th></th>
<th><strong>Resizable Array</strong></th>
<th><strong>Linked List</strong></th>
<th><strong>Hash Table</strong></th>
<th><strong>Hash Table + Linked List</strong></th>
<th><strong>Balanced Tree</strong></th>
<th><strong>Heap</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>List</code></td>
<td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/ArrayList.html" target="_blank" rel="noopener"><code>ArrayList</code></a></td>
<td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/LinkedList.html" target="_blank" rel="noopener"><code>LinkedList</code></a></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>Queue</code></td>
<td><code>ArrayBlockingQueue</code></td>
<td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/LinkedList.html" target="_blank" rel="noopener"><code>LinkedList</code></a><br/><code>LinkedBlockingQueue</code><br/><code>LinkedTransferQueue</code><br/><code>ConcurrentLinkedQueue</code></td>
<td></td>
<td></td>
<td></td>
<td><code>PriorityBlockingQueue</code><br/><a href="https://docs.oracle.com/javase/8/docs/api/java/util/PriorityQueue.html" target="_blank" rel="noopener"><code>PriorityQueue</code></a></td>
</tr>
<tr>
<td><code>Deque</code></td>
<td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/ArrayDeque.html" target="_blank" rel="noopener"><code>ArrayDeque</code></a></td>
<td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/LinkedList.html" target="_blank" rel="noopener"><code>LinkedList</code></a><br/><code>LinkedBlockingDeque</code><br/><code>ConcurrentLinkedDeque</code></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>Set</code></td>
<td></td>
<td></td>
<td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/HashSet.html" target="_blank" rel="noopener"><code>HashSet</code></a></td>
<td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/LinkedHashSet.html" target="_blank" rel="noopener"><code>LinkedHashSet</code></a></td>
<td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/TreeSet.html" target="_blank" rel="noopener"><code>TreeSet</code></a></td>
<td></td>
</tr>
<tr>
<td><code>Map</code></td>
<td></td>
<td></td>
<td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/HashMap.html" target="_blank" rel="noopener"><code>HashMap</code></a></td>
<td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/LinkedHashMap.html" target="_blank" rel="noopener"><code>LinkedHashMap</code></a></td>
<td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/TreeMap.html" target="_blank" rel="noopener"><code>TreeMap</code></a></td>
<td></td>
</tr>
</tbody></table>
<p>通用实现的特性如下：</p>
<ul>
<li>通用实现类支持集合接口中的所有可选操作，并且对包含的元素没有限制。</li>
<li>都是非线程同步的。<code>Collections</code> 工具类提供了称为<a href="https://docs.oracle.com/javase/8/docs/api/java/util/Collections.html#synchronizedCollection-java.util.Collection-" target="_blank" rel="noopener"><em>同步包装器（synchronization wrappers）</em></a>的静态工厂方法可用于添加同步行为。</li>
<li>所有集合实现都具有<em>快速失败的迭代器（fail-fast iterators）</em>，可以检测到无效的并发修改，然后快速失败，而不是表现异常。</li>
</ul>
<h2 id="遗留实现"><a href="#遗留实现" class="headerlink" title="遗留实现"></a>遗留实现</h2><p>早期版本的集合类，已被改进以实现新的集合接口：</p>
<ul>
<li><code>java.util.Vector</code> - <code>List</code> 接口的可变长数组实现，线程同步，包含其它遗留方法。</li>
<li><code>java.util.Hashtable</code> -  <code>Map</code> 接口的散列表实现，线程同步，键和值都不允许为 <code>null</code>，包含其它遗留方法。继承自抽象类 <code>java.util.Dictionary</code>。</li>
</ul>
<h2 id="并发实现"><a href="#并发实现" class="headerlink" title="并发实现"></a>并发实现</h2><p>为高并发使用而设计的实现。详见另一篇《Java 并发集合总结》。</p>
<h2 id="特殊实现"><a href="#特殊实现" class="headerlink" title="特殊实现"></a>特殊实现</h2><p>用于特殊情况的实现：</p>
<ul>
<li><code>CopyOnWriteArrayList</code> 写时复制列表</li>
<li><code>CopyOnWriteArraySet</code> 写时复制列表</li>
<li><code>WeakHashMap</code></li>
<li><code>IdentityHashMap</code></li>
<li><code>EnumSet</code></li>
<li><code>EnumMap</code></li>
</ul>
<h2 id="适配器实现"><a href="#适配器实现" class="headerlink" title="适配器实现"></a>适配器实现</h2><p>将某个集合接口适配成另一个：</p>
<ul>
<li><p>根据 <code>Map</code> 的通用实现创建一个 <code>Set</code> 的通用实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Collections.newSetFromMap(Map)</span><br></pre></td></tr></table></figure>
</li>
<li><p>以后进先出（Lifo）队列的形式返回 <code>Deque</code> 的视图：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Collections.asLifoQueue(Deque)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>将数组转换为 <code>List</code> 集合：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Arrays.asList(...)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="包装器实现"><a href="#包装器实现" class="headerlink" title="包装器实现"></a>包装器实现</h2><p>用于其它集合实现的功能增强：</p>
<ul>
<li><p>返回指定集合的不可修改视图（<em>unmodifiable view</em>），如果尝试修改，则会抛出<code>UnsupportedOperationException</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Collections.unmodifiableCollection</span><br><span class="line">Collections.unmodifiableSet</span><br><span class="line">Collections.unmodifiableSortedSet</span><br><span class="line">Collections.unmodifiableNavigableSet</span><br><span class="line">Collections.unmodifiableList</span><br><span class="line">Collections.unmodifiableMap</span><br><span class="line">Collections.unmodifiableSortedMap</span><br><span class="line">Collections.unmodifiableNavigableMap</span><br></pre></td></tr></table></figure>
</li>
<li><p>返回由指定集合支持的 <code>synchronized</code> 线程同步集合：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Collections.synchronizedCollection</span><br><span class="line">Collections.synchronizedSet</span><br><span class="line">Collections.synchronizedSortedSet</span><br><span class="line">Collections.synchronizedNavigableSet</span><br><span class="line">Collections.synchronizedList</span><br><span class="line">Collections.synchronizedMap</span><br><span class="line">Collections.synchronizedSortedMap</span><br><span class="line">Collections.synchronizedNavigableMap</span><br></pre></td></tr></table></figure>
</li>
<li><p>返回指定集合的动态类型安全视图（<em>dynamically type-safe view</em>），如果尝试添加错误类型的元素，则会抛出 <code>ClassCastException</code>。泛型机制虽然提供了编译期类型检查，但可以绕过此机制。动态类型安全试图消除了这种可能性：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Collections.checkedCollection</span><br><span class="line">Collections.checkedQueue</span><br><span class="line">Collections.checkedSet</span><br><span class="line">Collections.checkedSortedSet</span><br><span class="line">Collections.checkedNavigableSet</span><br><span class="line">Collections.checkedList</span><br><span class="line">Collections.checkedMap</span><br><span class="line">Collections.checkedSortedMap</span><br><span class="line">Collections.checkedNavigableMap</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="便利实现"><a href="#便利实现" class="headerlink" title="便利实现"></a>便利实现</h2><p>集合接口的高性能版“迷你实现”：</p>
<ul>
<li><p>返回一个不可变集合（<em>immutable</em>），不包含任何元素：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Collections.emptySet</span><br><span class="line">Collections.emptySortedSet</span><br><span class="line">Collections.emptyNavigableSet</span><br><span class="line">Collections.emptyList</span><br><span class="line">Collections.emptyMap</span><br><span class="line">Collections.emptySortedMap</span><br><span class="line">Collections.emptyNavigableMap</span><br></pre></td></tr></table></figure>
</li>
<li><p>返回一个不可变集合（<em>immutable</em>），仅包含一个元素：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Collections.singleton</span><br><span class="line">Collections.singletonList</span><br><span class="line">Collections.singletonMap</span><br></pre></td></tr></table></figure>
</li>
<li><p>返回一个不可变集合（<em>immutable</em>），包含指定元素的 N 个拷贝：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Collections.nCopies</span><br></pre></td></tr></table></figure>
</li>
<li><p>返回一个由指定数组支持的定长集合（<em>fixed-size</em>）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Arrays.asList</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="基础设施"><a href="#基础设施" class="headerlink" title="基础设施"></a>基础设施</h1><p>为集合接口提供必要支持的接口。例如：</p>
<ul>
<li>迭代器 <code>Iterator</code>、<code>ListIterator</code></li>
<li>排序接口 <code>Comparable</code>、<code>Comparator</code></li>
<li>运行时异常 <code>UnsupportedOperationException</code>、<code>ConcurrentModificationException</code></li>
<li>标记接口 <code>RandomAccess</code></li>
</ul>
<h1 id="算法和工具实现"><a href="#算法和工具实现" class="headerlink" title="算法和工具实现"></a>算法和工具实现</h1><p><strong>算法实现</strong>。由工具类 <code>Collections</code> 提供，用于集合，提供了很多静态方法例如 <code>sort</code> 排序、<code>binarySearch</code> 查找、<code>replaceAll</code> 替换等。这些算法体现了多态性，因为相同的方法可以在相似的接口上有着不同的实现。</p>
<p><strong>数组工具</strong>。由工具类 <code>Arrays</code> 提供，用于基本类型和引用类型数组，提供了很多静态方法例如 <code>sort</code> 排序、<code>binarySearch</code> 查找等。严格来说，这些工具不是集合框架的一部分，此功能在集合框架引入的同时被添加到 Java 平台，并依赖于一些相同的基础设施。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://docs.oracle.com/javase/8/docs/technotes/guides/collections/index.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/technotes/guides/collections/index.html</a></p>
<p><a href="https://stackoverflow.com/questions/4978487/why-java-collection-framework-doesnt-contain-tree-and-graph" target="_blank" rel="noopener">Why Java Collection Framework doesn’t contain Tree and Graph ?</a></p>
</div></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2018/04/08/java-enum/" class="post-title-link">Java 常用类型系列（六）枚举类型总结</a></h2><div class="post-info">2018-04-08<a href="/tags/Java/" title="Java" class="post-demo">Java</a></div><div class="post-content"><h1 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.google.common.collect.Maps;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> PayMethodEnum &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 卡支付</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    CARDS(<span class="number">0</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 借记支付</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    BANK_DEBITS(<span class="number">1</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 网银支付</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    BANK_REDIRECTS(<span class="number">2</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 银行转账</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    BANK_TRANSFERS(<span class="number">3</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分期付款</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    PAY_LATER(<span class="number">4</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 现金支付</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    VOUCHERS(<span class="number">5</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 电子钱包</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    WALLETS(<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 支付方式编码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> code;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;Integer, PayMethodEnum&gt; MAP = Maps.newHashMapWithExpectedSize(PayMethodEnum.values().length);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        Arrays.stream(PayMethodEnum.values()).forEach(aEnum -&gt;</span><br><span class="line">                MAP.put(aEnum.getCode(), aEnum)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> PayMethodEnum <span class="title">valueOfCode</span><span class="params">(<span class="keyword">int</span> code)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> MAP.get(code);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</div></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2018/04/06/java8-time-zone/" class="post-title-link">Java 常用类型系列（五）Java 8 时区处理总结</a></h2><div class="post-info">2018-04-06<a href="/tags/Java/" title="Java" class="post-demo">Java</a></div><div class="post-content"><p>本文介绍时区处理的两种方式。时区涉及的接口及实现类如下：</p>
<p><img src="/img/java/time/classes_of_time_zone.png" alt="classes_of_time_zone"></p>
<p>（上图简化掉了 <code>Serializable</code> 接口、<code>Comparable</code> 接口及 <code>FunctionalInterface</code> 注解）</p>
<h1 id="推荐方式"><a href="#推荐方式" class="headerlink" title="推荐方式"></a>推荐方式</h1><h2 id="ZoneId"><a href="#ZoneId" class="headerlink" title="ZoneId"></a>ZoneId</h2><p>时区的处理是新版日期与时间 API 新增的重要功能，且 API 被极大简化。新的 <code>java.time.ZoneId</code> 类是老版本 <code>java.util.TimeZone</code> 类的替代品。它的设计目标就是要让用户无需为时区处理的复杂和繁琐而操心，比如处理夏令时（DST）问题。</p>
<p>每个特定的 <code>ZoneId</code> 对象都有一个地区 ID 标识。地区 ID 格式为“<code>{区域}/{城市}</code>”，这些地区集合的设定都由 <a href="https://www.iana.org/time-zones" target="_blank" rel="noopener">IANA  的时区数据库</a>提供。静态工厂方法构造如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取服务器所在时区的 ZoneId，例如 Asia/Shanghai 为 UTC+8</span></span><br><span class="line">ZoneId currentZone = ZoneId.systemDefault();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取指定城市的 ZoneId，即 UTC+1</span></span><br><span class="line">ZoneId zoneId = ZoneId.of(<span class="string">"Europe/Paris"</span>);</span><br></pre></td></tr></table></figure>

<p>一旦得到一个 <code>ZoneId</code> 对象，就可以与 <code>LocalDate</code>、<code>LocalDateTime</code>、<code>Instant</code> 对象整合起来，构造一个 <code>ZonedDateTime</code> 实例，它代表了<strong>相对于指定时区的时间点</strong>。</p>
<h2 id="ZonedDateTime"><a href="#ZonedDateTime" class="headerlink" title="ZonedDateTime"></a>ZonedDateTime</h2><h3 id="底层实现"><a href="#底层实现" class="headerlink" title="底层实现"></a>底层实现</h3><p><code>ZonedDateTime</code> 的底层实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ZonedDateTime</span></span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">Temporal</span>, <span class="title">ChronoZonedDateTime</span>&lt;<span class="title">LocalDate</span>&gt;, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The local date-time.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LocalDateTime dateTime;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The offset from UTC/Greenwich.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ZoneOffset offset;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The time-zone.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ZoneId zone;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ZonedDateTime</code> 的实例如下图：</p>
<p><img src="/img/java/time/instance_of_ZonedDateTime.png" alt="instance_of_ZonedDateTime"></p>
<p>图中可见，原本 <code>LocalDateTime</code> 对象作为一个<strong>本地</strong>日期与时间，是不包含时区信息的，即没有时区概念。而在结合了 <code>ZoneId</code> 构造成一个 <code>ZonedDateTime</code> 实例之后，才有了时区概念。它代表了<strong>相对于指定时区的时间点</strong>。</p>
<h3 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1970-01-01</span></span><br><span class="line">LocalDate date = LocalDate.ofEpochDay(<span class="number">0</span>);</span><br><span class="line"><span class="comment">// 1970-01-01T00:00</span></span><br><span class="line">LocalDateTime dateTime = date.atStartOfDay();</span><br><span class="line"><span class="comment">// 1970-01-01T00:00:00Z</span></span><br><span class="line">Instant instant = Instant.ofEpochSecond(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1970-01-01T00:00+01:00[Europe/Paris]，底层调用 ZonedDateTime.of(this, zoneId)</span></span><br><span class="line">ZonedDateTime zonedDateTime = date.atStartOfDay(zoneId);</span><br><span class="line"><span class="comment">// 1970-01-01T00:00+01:00[Europe/Paris]，底层调用 ZonedDateTime.of(this, zoneId)</span></span><br><span class="line">ZonedDateTime zonedDateTime1 = dateTime.atZone(zoneId);</span><br><span class="line"><span class="comment">// 1970-01-01T01:00+01:00[Europe/Paris]，底层调用 ZonedDateTime.ofInstant(this, zoneId)</span></span><br><span class="line">ZonedDateTime zonedDateTime2 = instant.atZone(zoneId);</span><br><span class="line"><span class="comment">// 2015-12-03T10:15:30+08:00[Asia/Shanghai]</span></span><br><span class="line">ZonedDateTime zonedDateTime3 = ZonedDateTime.parse(<span class="string">"2015-12-03T10:15:30+05:30[Asia/Shanghai]"</span>);</span><br></pre></td></tr></table></figure>

<h3 id="LocalDateTime-与-Instant-互转"><a href="#LocalDateTime-与-Instant-互转" class="headerlink" title="LocalDateTime 与 Instant 互转"></a>LocalDateTime 与 Instant 互转</h3><p>通过 <code>ZoneId</code> 可以将 <code>LocalDateTime</code> 和 <code>Instant</code> 进行互转，公式为 UTC + 时区差（东正西负）= 本地时间。</p>
<p><code>LocalDateTime</code> &gt; <code>Instant</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 东八区的 1970-01-01T00:00，等于 UTC+0 的 1969-12-31T16:00:00Z</span></span><br><span class="line">Instant instant2 = dateTime.atZone(ZoneId.systemDefault()).toInstant();</span><br></pre></td></tr></table></figure>

<p><code>Instant</code> &gt; <code>LocalDateTime</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1970-01-01T00:00</span></span><br><span class="line">LocalDateTime dateTime2 = LocalDateTime.ofInstant(instant2, ZoneId.systemDefault());</span><br><span class="line"><span class="comment">// 1970-01-01T08:00</span></span><br><span class="line">LocalDateTime dateTime3 = instant.atZone(ZoneId.systemDefault()).toLocalDateTime();</span><br></pre></td></tr></table></figure>

<h1 id="不推荐方式"><a href="#不推荐方式" class="headerlink" title="不推荐方式"></a>不推荐方式</h1><h2 id="ZoneOffset"><a href="#ZoneOffset" class="headerlink" title="ZoneOffset"></a>ZoneOffset</h2><p>另一种比较通用的表达时区的方式是利用当前时区和 UTC/格林尼治的固定偏差。可以使用 <code>ZoneOffset</code> 类，它是 <code>ZoneId</code> 的一个子类，表示的是当前时间和 UTC 的偏差：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZoneOffset newYorkOffset = ZoneOffset.of(<span class="string">"-05:00"</span>);</span><br></pre></td></tr></table></figure>

<h2 id="OffsetDateTime"><a href="#OffsetDateTime" class="headerlink" title="OffsetDateTime"></a>OffsetDateTime</h2><h3 id="底层实现-1"><a href="#底层实现-1" class="headerlink" title="底层实现"></a>底层实现</h3><p><code>ZoneOffset</code> 类可用于构造 <code>OffsetDateTime</code> 实例。<code>OffsetDateTime</code> 的底层实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">OffsetDateTime</span></span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">Temporal</span>, <span class="title">TemporalAdjuster</span>, <span class="title">Comparable</span>&lt;<span class="title">OffsetDateTime</span>&gt;, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The local date-time.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LocalDateTime dateTime;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The offset from UTC/Greenwich.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ZoneOffset offset;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用方式-1"><a href="#使用方式-1" class="headerlink" title="使用方式"></a>使用方式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1970-01-01T00:00-05:00</span></span><br><span class="line">OffsetDateTime dateTimeInNewYork = OffsetDateTime.of(dateTime1, newYorkOffset); </span><br><span class="line"><span class="comment">// 1970-01-01T00:00-05:00</span></span><br><span class="line">OffsetDateTime dateTimeInNewYork2 = dateTime1.atOffset(newYorkOffset);</span><br></pre></td></tr></table></figure>

<p>“-05:00” 的偏差实际上对应的是美国东部标准时间。注意，使用这种方式定义的 <code>ZoneOffset</code> 并未考虑任何夏令时的影响，所以在大多数情况下，不推荐使用。</p>
<h1 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h1><h2 id="java-sql-Timestamp"><a href="#java-sql-Timestamp" class="headerlink" title="java.sql.Timestamp"></a>java.sql.Timestamp</h2><p>有时开发会使用 <code>java.sql.Timestamp</code> 作为 PO 实体类的时间字段，<code>java.sql.Timestamp</code> 底层实现使用<strong>格里历（公历）</strong>，并使用<strong>本地时区</strong>（即服务器默认时区），并受该时区影响。</p>
<p>这里看一段代码，以 2021-01-04 00:00:00 为例演示转换过程：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">LocalDateTime localDateTime = LocalDateTime.parse(</span><br><span class="line">  <span class="string">"2021-01-04 00:00:00"</span>, </span><br><span class="line">  DateTimeFormatter.ofPattern(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>)</span><br><span class="line">);</span><br><span class="line">ZonedDateTime zonedDateTime = ZonedDateTime.of(localDateTime, ZoneId.of(<span class="string">"Asia/Jakarta"</span>));</span><br><span class="line"></span><br><span class="line">Timestamp.from(zonedDateTime.toInstant());</span><br><span class="line">Timestamp.valueOf(localDateTime);</span><br></pre></td></tr></table></figure>

<p>这里试验两个时区：</p>
<table>
<thead>
<tr>
<th></th>
<th>Europe/London (UTC)</th>
<th>Asia/Shanghai (UTC+8)</th>
</tr>
</thead>
<tbody><tr>
<td><code>ZoneId.systemDefault()</code></td>
<td>Europe/London (UTC)</td>
<td>Asia/Shanghai (UTC+8)</td>
</tr>
<tr>
<td><code>TimeZone.getDefaultRef()</code></td>
<td>Europe/London (UTC)</td>
<td>Asia/Shanghai (UTC+8)</td>
</tr>
</tbody></table>
<p>下面分别看下 <code>java.sql.Timestamp</code> 两个 API 会有什么问题：</p>
<h3 id="valueOf-LocalDateTime"><a href="#valueOf-LocalDateTime" class="headerlink" title="#valueOf(LocalDateTime)"></a>#valueOf(LocalDateTime)</h3><p>转换过程：本地时间 &gt; 系统时区的时间 &gt; UTC-0 时区的时间戳</p>
<table>
<thead>
<tr>
<th>Europe/London (UTC)</th>
<th>Asia/Shanghai (UTC+8)</th>
</tr>
</thead>
<tbody><tr>
<td>2021-01-04T00:00 (<code>LocalDateTime</code>) → <br/>2021-01-04T00:00:00.000Z / 1609718400000 (<code>Timestamp</code>)</td>
<td>2021-01-04T00:00 (<code>LocalDateTime</code>) → <br/>2021-01-04T00:00:00.000+0800 / 1609689600000 (<code>Timestamp</code>)</td>
</tr>
</tbody></table>
<p>可见，由于 <code>LocalDateTime</code> 本身不含时区信息，在经由 <code>Timestamp#valueOf(LocalDateTime)</code> 转换时，源码中使用了 <code>TimeZone.getDefaultRef()</code> 并<strong>受系统默认时区的影响，导致结果前后不一致</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns the reference to the default TimeZone object. This</span></span><br><span class="line"><span class="comment"> * method doesn't create a clone.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> TimeZone <span class="title">getDefaultRef</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    TimeZone defaultZone = defaultTimeZone;</span><br><span class="line">    <span class="keyword">if</span> (defaultZone == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// Need to initialize the default time zone.</span></span><br><span class="line">        defaultZone = setDefaultZone();</span><br><span class="line">        <span class="keyword">assert</span> defaultZone != <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Don't clone here.</span></span><br><span class="line">    <span class="keyword">return</span> defaultZone;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="from-Instant"><a href="#from-Instant" class="headerlink" title="#from(Instant)"></a>#from(Instant)</h3><p>转换过程：本地时间 &gt; 指定时区的时间 &gt; UTC-0 时区的时间戳</p>
<table>
<thead>
<tr>
<th>Europe/London (UTC)</th>
<th>Asia/Shanghai (UTC+8)</th>
</tr>
</thead>
<tbody><tr>
<td>2021-01-04T00:00 (<code>LocalDateTime</code>) → <br/>2021-01-04T00:00+07:00[Asia/Jakarta] (<code>ZonedDateTime</code>) → <br/>2021-01-03T17:00:00Z / 1609693200 (<code>Instant</code>) →<br/>2021-01-03T17:00:00.000Z / 1609693200000(<code>Timestamp</code>)</td>
<td>2021-01-04T00:00 (<code>LocalDateTime</code>) → <br/>2021-01-04T00:00+07:00[Asia/Jakarta] (<code>ZonedDateTime</code>) → <br/>2021-01-03T17:00:00Z / 1609693200 (<code>Instant</code>) →<br/>2021-01-04T01:00:00.000+0800 / 1609693200000 (<code>Timestamp</code>)</td>
</tr>
</tbody></table>
<p>这里看似结果没有问题，<code>Instant</code> 和 <code>Timestamp</code> 对象在不同时区下都是相同时间戳。</p>
<p>但有一种场景，就是<strong>应用服务器与数据库的时区不一致导致的问题</strong>。假如应用服务器时区为 <code>Asia/Shanghai (UTC+8)</code>，数据库时区为 <code>Europe/London (UTC)</code>，当把上表 <code>Timestamp</code> 对象保存到 MySQL 数据库的 <code>datetime</code> 字段时，如果未经时区转换，会导致错误结果。</p>
<p>这里参考 <a href="https://mvnrepository.com/artifact/mysql/mysql-connector-java" target="_blank" rel="noopener">mysql-connector-java-5.1.42.jar</a> 源码如下，重点看 <code>java.sql.PreparedStatement#setTimestamp</code> 的方法实现，其使用了 <code>SimpleDateFormat</code> 将 <code>Timestamp</code> 对象格式化成字符串，<strong>如果未经时区转换，结果如下表，导致前后不一致</strong>：</p>
<table>
<thead>
<tr>
<th>格式化前</th>
<th>格式化后</th>
</tr>
</thead>
<tbody><tr>
<td>2021-01-03T17:00:00.000Z</td>
<td>2021-01-03 17:00:00</td>
</tr>
<tr>
<td>2021-01-04T01:00:00.000+0800</td>
<td>2021-01-04 01:00:00</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Set a parameter to a java.sql.Timestamp value. The driver converts this</span></span><br><span class="line"><span class="comment"> * to a SQL TIMESTAMP value when it sends it to the database.</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> parameterIndex</span></span><br><span class="line"><span class="comment"> *            the first parameter is 1, the second is 2, ...</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> x</span></span><br><span class="line"><span class="comment"> *            the parameter value</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> tz</span></span><br><span class="line"><span class="comment"> *            the timezone to use</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> SQLException</span></span><br><span class="line"><span class="comment"> *             if a database-access error occurs.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setTimestampInternal</span><span class="params">(<span class="keyword">int</span> parameterIndex, Timestamp x, Calendar targetCalendar, TimeZone tz, <span class="keyword">boolean</span> rollForward)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    x = TimeUtil.changeTimezone(<span class="keyword">this</span>.connection, sessionCalendar, targetCalendar, x, tz, <span class="keyword">this</span>.connection.getServerTimezoneTZ(), rollForward);</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">                <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">this</span>.tsdf == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">this</span>.tsdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"''yyyy-MM-dd HH:mm:ss"</span>, Locale.US);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    StringBuffer buf = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">                    buf.append(<span class="keyword">this</span>.tsdf.format(x));</span><br><span class="line">                    </span><br><span class="line">                    ...</span><br><span class="line">                    </span><br><span class="line">                    setInternal(parameterIndex, buf.toString());</span><br><span class="line">                &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述方法内部调用了 <code>com.mysql.jdbc.TimeUtil#changeTimezone</code> 方法，源码如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Change the given timestamp from one timezone to another</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> conn</span></span><br><span class="line"><span class="comment"> *            the current connection to the MySQL server</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> tstamp</span></span><br><span class="line"><span class="comment"> *            the timestamp to change</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> fromTz</span></span><br><span class="line"><span class="comment"> *            the timezone to change from</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> toTz</span></span><br><span class="line"><span class="comment"> *            the timezone to change to</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the timestamp changed to the timezone 'toTz'</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Timestamp <span class="title">changeTimezone</span><span class="params">(MySQLConnection conn, Calendar sessionCalendar, Calendar targetCalendar, Timestamp tstamp, TimeZone fromTz,</span></span></span><br><span class="line"><span class="function"><span class="params">        TimeZone toTz, <span class="keyword">boolean</span> rollForward)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ((conn != <span class="keyword">null</span>)) &#123;</span><br><span class="line">        <span class="comment">// 开启 useTimezone=true，才能进入下面的时区转换逻辑</span></span><br><span class="line">        <span class="keyword">if</span> (conn.getUseTimezone()) &#123;</span><br><span class="line">            <span class="comment">// Convert the timestamp from GMT to the server's timezone</span></span><br><span class="line">            Calendar fromCal = Calendar.getInstance(fromTz);</span><br><span class="line">            fromCal.setTime(tstamp);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> fromOffset = fromCal.get(Calendar.ZONE_OFFSET) + fromCal.get(Calendar.DST_OFFSET);</span><br><span class="line">            Calendar toCal = Calendar.getInstance(toTz);</span><br><span class="line">            toCal.setTime(tstamp);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> toOffset = toCal.get(Calendar.ZONE_OFFSET) + toCal.get(Calendar.DST_OFFSET);</span><br><span class="line">            <span class="keyword">int</span> offsetDiff = fromOffset - toOffset;</span><br><span class="line">            <span class="keyword">long</span> toTime = toCal.getTime().getTime();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (rollForward) &#123;</span><br><span class="line">                toTime += offsetDiff;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                toTime -= offsetDiff;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Timestamp changedTimestamp = <span class="keyword">new</span> Timestamp(toTime);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> changedTimestamp;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (conn.getUseJDBCCompliantTimezoneShift()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (targetCalendar != <span class="keyword">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">                Timestamp adjustedTimestamp = <span class="keyword">new</span> Timestamp(jdbcCompliantZoneShift(sessionCalendar, targetCalendar, tstamp));</span><br><span class="line"></span><br><span class="line">                adjustedTimestamp.setNanos(tstamp.getNanos());</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> adjustedTimestamp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> tstamp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果 JDBC 连接参数未配置 <code>useTimezone=true</code>（默认值 <code>false</code>），会导致目标时区转换失效，从而产生上述问题。<strong>而如果开启之后，不管应用服务器设置什么时区，都能保证正确转换为数据库目标时区的时间值，反之亦然（数据库 -&gt; 应用服务器）。</strong>这里给两个例子，如下表：</p>
<table>
<thead>
<tr>
<th></th>
<th>时区转换前</th>
<th>时区转换后</th>
</tr>
</thead>
<tbody><tr>
<td>UTC+2</td>
<td>2021-01-03T19:00:00.000+0200 / 1609693200</td>
<td>2021-01-03T17:00:00.000Z / 1609693200</td>
</tr>
<tr>
<td>UTC+8</td>
<td>2021-01-04T01:00:00.000+0800 / 1609693200</td>
<td>2021-01-03T17:00:00.000Z / 1609693200</td>
</tr>
</tbody></table>
<p><img src="/img/java/time/after_convert_time_zone+2.png" alt="after_convert_time_zone+2"></p>
<p><img src="/img/java/time/after_convert_time_zone+8.png" alt="after_convert_time_zone+8"></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li>《Java 8 实战》</li>
<li>Java SE Docs</li>
<li><a href="https://zh.wikipedia.org/wiki/%E5%8D%8F%E8%B0%83%E4%B8%96%E7%95%8C%E6%97%B6" target="_blank" rel="noopener">协调世界时（UTC） - 维基百科</a></li>
<li><a href="https://www.zeitverschiebung.net/cn/" target="_blank" rel="noopener">时区转换器：计算世界各个时区的时差</a></li>
<li><a href="https://time.is/UTC" target="_blank" rel="noopener">https://time.is/UTC</a></li>
<li><a href="http://www.timezoneconverter.com/cgi-bin/zoneinfo" target="_blank" rel="noopener">Time Zone Converter</a></li>
<li><a href="https://www.coder.work/article/6269420" target="_blank" rel="noopener">《Java时区数据库与IANA数据》</a></li>
<li><a href="https://segmentfault.com/q/1010000000262788" target="_blank" rel="noopener">《Mysql JDBC里的useTimezone参数是做什么用的？》</a></li>
</ul>
</div></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2018/04/05/java8-time/" class="post-title-link">Java 常用类型系列（四）Java 8 日期与时间总结</a></h2><div class="post-info">2018-04-05<a href="/tags/Java/" title="Java" class="post-demo">Java</a></div><div class="post-content"><h1 id="现有问题"><a href="#现有问题" class="headerlink" title="现有问题"></a>现有问题</h1><p><code>java.util.Date</code> 存在的问题：</p>
<ul>
<li>正如类名所表达的，这个类无法表示“日期”（替代方案是 <code>LocalDate</code>），只能以毫秒的精度表示“时间”（替代方案是 <code>LocalDateTime</code>）。</li>
<li>更糟糕的是它的易用性，比如：年份的起始选择是 1900 年，月份的起始从 0 开始。如果要表达 2014 年 3 月 18 日，需要创建以下 <code>Date</code> 实例：<code>Date date = new Date(144，2，18)</code></li>
<li>非线程安全，且所有的日期类都是可变的，这表示在运行期其值可以任意修改，这是 Java 日期类最大的问题之一。</li>
</ul>
<p><code>java.util.Date</code> 及 <code>java.sql.Timestamp</code> API 如下：</p>
<p><img src="/img/java/time/java_time_old_api.png" alt="java time old api"></p>
<h1 id="Java-8-日期与时间"><a href="#Java-8-日期与时间" class="headerlink" title="Java 8 日期与时间"></a>Java 8 日期与时间</h1><p>Java 8 引入了新的 <code>java.time</code> 类库，用于加强对日期与时间的操作，本文主要总结其 API 结构、具体实现和使用方式。</p>
<p>先看下涉及的包结构简介：</p>
<table>
<thead>
<tr>
<th>Package</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><a href="https://docs.oracle.com/javase/8/docs/api/java/time/package-summary.html" target="_blank" rel="noopener">java.time</a></td>
<td>The main API for dates, times, instants, and durations.</td>
</tr>
<tr>
<td><a href="https://docs.oracle.com/javase/8/docs/api/java/time/temporal/package-summary.html" target="_blank" rel="noopener">java.time.temporal</a></td>
<td>Access to date and time using fields and units, and date time adjusters.</td>
</tr>
<tr>
<td><a href="https://docs.oracle.com/javase/8/docs/api/java/time/chrono/package-summary.html" target="_blank" rel="noopener">java.time.chrono</a></td>
<td>Generic API for calendar systems other than the default ISO.</td>
</tr>
<tr>
<td><a href="https://docs.oracle.com/javase/8/docs/api/java/time/zone/package-summary.html" target="_blank" rel="noopener">java.time.zone</a></td>
<td>Support for time-zones and their rules.</td>
</tr>
<tr>
<td><a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/package-summary.html" target="_blank" rel="noopener">java.time.format</a></td>
<td>Provides classes to print and parse dates and times.</td>
</tr>
</tbody></table>
<h2 id="java-time"><a href="#java-time" class="headerlink" title="java.time"></a>java.time</h2><p><code>java.time</code> 包的核心接口：</p>
<p><img src="/img/java/time/java-time%E6%A0%B8%E5%BF%83%E6%8E%A5%E5%8F%A3.png" alt="java-time核心接口"></p>
<p><code>java.time</code> 包的常用类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Year              <span class="comment">// 2007</span></span><br><span class="line">YearMonth         <span class="comment">// 2007-12</span></span><br><span class="line">MonthDay          <span class="comment">// --12-03</span></span><br><span class="line"></span><br><span class="line">LocalDate         <span class="comment">// 2007-12-03</span></span><br><span class="line">LocalTime         <span class="comment">// 10:15:30</span></span><br><span class="line">LocalDateTime     <span class="comment">// 2007-12-03T10:15:30</span></span><br><span class="line"></span><br><span class="line">OffsetTime        <span class="comment">// 10:15:30+01:00</span></span><br><span class="line">OffsetDateTime    <span class="comment">// 2007-12-03T10:15:30+01:00</span></span><br><span class="line">ZonedDateTime     <span class="comment">// 2007-12-03T10:15:30+01:00 Europe/Paris</span></span><br><span class="line"></span><br><span class="line">Instant           <span class="comment">// 以 Unix 元年时间（UTC 时区 1970-01-01T00:00:00Z，“Z” 代表 UTC 时区）开始所经历的秒数</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/java/time/java.time%E6%A0%B8%E5%BF%83%E7%B1%BB.png" alt="java.time核心类"></p>
<h2 id="java-time-temporal"><a href="#java-time-temporal" class="headerlink" title="java.time.temporal"></a>java.time.temporal</h2><p><code>java.time.temporal</code> 包的核心接口：</p>
<table>
<thead>
<tr>
<th>Interface</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>TemporalAccessor</code></td>
<td>框架级别的根接口，定义了对 temporal 对象的只读访问。</td>
</tr>
<tr>
<td><code>Temporal</code></td>
<td>框架级别的接口，定义了对 temporal 对象的读写访问。实现类有 <code>LocalDate</code>、<code>OffsetDateTime</code>、<code>Instant</code> 等等。继承自 <code>TemporalAccessor</code>。</td>
</tr>
<tr>
<td><code>TemporalAmount</code></td>
<td>框架级别的接口，定义了一个时间段，例如”6 小时“、”8 天“、”3 个月“。实现类有 <code>Duration</code>、<code>Period</code>。可传入 temporal 对象的 <code>plus</code> 或 <code>minus</code> 方法进行时间调整。</td>
</tr>
<tr>
<td><code>TemporalUnit</code></td>
<td>日期和时间的单元，<code>ChronoUnit</code> 枚举实现了该接口。可传入 temporal 对象的 <code>plus</code> 或 <code>minus</code> 方法进行时间调整。</td>
</tr>
<tr>
<td><code>TemporalField</code></td>
<td>日期和时间的字段。<code>ChronoField</code> 枚举实现了该接口，可传入 temporal 对象的 <code>get</code> 或 <code>with</code> 方法获取或修改枚举对应的值。</td>
</tr>
<tr>
<td><code>TemporalAdjuster</code></td>
<td>函数式接口，定义了对 temporal 对象的调整策略。可以使用 <code>TemporalAdjusters</code> 工具类的静态工厂方法生成对象实例，并传入temporal 对象的 <code>with</code> 方法进行时间调整。</td>
</tr>
</tbody></table>
<p><img src="/img/java/time/temporal%E6%A0%B8%E5%BF%83%E6%8E%A5%E5%8F%A3.png" alt="ChronoLocalDate核心接口方法"></p>
<h1 id="LocalDate、LocalTime"><a href="#LocalDate、LocalTime" class="headerlink" title="LocalDate、LocalTime"></a>LocalDate、LocalTime</h1><p><code>LocalDate</code>、<code>LocalTime</code> 是人类易读的日期和时间格式，表示一个本地时间点，<strong>无时区信息</strong>。</p>
<h2 id="历法系统介绍"><a href="#历法系统介绍" class="headerlink" title="历法系统介绍"></a>历法系统介绍</h2><p>首先了解几个概念：</p>
<h3 id="历法"><a href="#历法" class="headerlink" title="历法"></a>历法</h3><p><a href="https://zh.wikipedia.org/wiki/历法" target="_blank" rel="noopener">历法</a>，或称日历，是用<a href="https://zh.wikipedia.org/wiki/年" target="_blank" rel="noopener">年</a>、<a href="https://zh.wikipedia.org/wiki/月" target="_blank" rel="noopener">月</a>、<a href="https://zh.wikipedia.org/wiki/日" target="_blank" rel="noopener">日</a>等时间单位计算时间的方法。Java 8 提供的历法实现如下：</p>
<table>
<thead>
<tr>
<th>历法</th>
<th>Java 8 实现</th>
</tr>
</thead>
<tbody><tr>
<td><a href="https://zh.wikipedia.org/wiki/格里曆" target="_blank" rel="noopener">格里历（公历）</a>，即 <a href="https://en.wikipedia.org/wiki/Gregorian_calendar" target="_blank" rel="noopener">Gregorian calendar</a></td>
<td><code>LocalDate</code></td>
</tr>
<tr>
<td><a href="https://zh.wikipedia.org/wiki/和历" target="_blank" rel="noopener">和历</a></td>
<td><code>JapaneseDate</code></td>
</tr>
<tr>
<td><a href="https://zh.wikipedia.org/wiki/民國紀年" target="_blank" rel="noopener">中华民国历</a></td>
<td><code>MinguoDate</code></td>
</tr>
<tr>
<td><a href="https://zh.wikipedia.org/wiki/泰國曆" target="_blank" rel="noopener">泰国历</a></td>
<td><code>ThaiBuddhistDate</code></td>
</tr>
<tr>
<td><a href="https://zh.wikipedia.org/zh/伊斯兰历" target="_blank" rel="noopener">伊斯兰历（回历）</a></td>
<td><code>HijrahDate</code></td>
</tr>
</tbody></table>
<p><a href="https://zh.wikipedia.org/wiki/ISO_8601" target="_blank" rel="noopener">ISO-8601</a> 日历系统是世界文明日历系统的事实标准，其<strong>日期表示法</strong>为：</p>
<blockquote>
<p>年由4位数字组成YYYY，或者带正负号的四或五位数字表示±YYYYY。以<strong><a href="https://zh.wikipedia.org/wiki/公历" target="_blank" rel="noopener">公历</a>公元</strong>1年为0001年，以公元前1年为0000年，公元前2年为-0001年，其他以此类推。</p>
<p>月、日用两位数字表示：MM、DD。</p>
</blockquote>
<p>Java 8 中 <code>LocalDate</code> 基于 ISO-8601 实现。另外还提供了四种其它的日历系统。这些日历系统中的每一个都有一个对应的类，如下图。所有这些类都实现了 <code>java.time.chrono.ChronoLocalDate</code> 接口，能够对公历的日期进行建模。</p>
<p><img src="/img/java/time/ChronoLocalDate%E5%AE%9E%E7%8E%B0%E7%B1%BB.png" alt="ChronoLocalDate实现类"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 格里历（公历）</span></span><br><span class="line">LocalDate date = LocalDate.now();</span><br><span class="line"><span class="comment">// 和历</span></span><br><span class="line">JapaneseDate japaneseDate = JapaneseDate.from(date);</span><br><span class="line"><span class="comment">// 中华民国历</span></span><br><span class="line">MinguoDate minguoDate = MinguoDate.from(date);</span><br><span class="line"><span class="comment">// 泰国历</span></span><br><span class="line">ThaiBuddhistDate thaiBuddhistDate = ThaiBuddhistDate.from(date);</span><br><span class="line"><span class="comment">// 伊斯兰历（回历）</span></span><br><span class="line">HijrahDate hijrahDate = HijrahDate.from(date);</span><br></pre></td></tr></table></figure>

<p>还有一些常见的历法，例如：</p>
<ul>
<li><a href="https://zh.wikipedia.org/wiki/%E4%B8%AD%E5%9B%BD%E4%BC%A0%E7%BB%9F%E5%8E%86%E6%B3%95" target="_blank" rel="noopener">中国传统历法</a></li>
<li><a href="https://zh.wikipedia.org/wiki/會計年度" target="_blank" rel="noopener">会计年度</a>：</li>
</ul>
<blockquote>
<p>财政年度，又称会计年度，是指公司或国家每年制定预算或计算收入的统计时间。但每个国家或其法例所辖的组织各有不同，大抵分成两类：</p>
<ul>
<li>历年制，即是由1月1日起，使用历年制有中国、德国、法国、等等。</li>
<li>跨年制，使用跨年制有美国、日本、香港、澳大利亚、等等。</li>
</ul>
<p>在会计上常会用 <a href="https://en.wikipedia.org/wiki/4-4-5_Calendar" target="_blank" rel="noopener">4/4/5 日历</a>，每一个月会有固定的周数，以便各月之间和各年之间的比较。</p>
</blockquote>
<h3 id="纪年"><a href="#纪年" class="headerlink" title="纪年"></a>纪年</h3><blockquote>
<p><a href="https://zh.wikipedia.org/wiki/纪年" target="_blank" rel="noopener">纪年</a>，或称<strong>纪元</strong>，是指<a href="https://zh.wikipedia.org/wiki/历法" target="_blank" rel="noopener">历法</a>中的<strong>年份</strong>命名体系，例如<a href="https://zh.wikipedia.org/wiki/格里曆" target="_blank" rel="noopener">格里历</a>（公历）所使用的<a href="https://zh.wikipedia.org/wiki/基督纪年" target="_blank" rel="noopener">基督纪年</a>（<a href="https://zh.wikipedia.org/wiki/公元" target="_blank" rel="noopener">公元</a>），中国<a href="https://zh.wikipedia.org/wiki/农历" target="_blank" rel="noopener">农历</a>使用的<a href="https://zh.wikipedia.org/wiki/干支纪年" target="_blank" rel="noopener">干支纪年</a>等。世界各地曾存在过各种不同的纪年方法，其中一些至今仍在使用，例如日本现在仍在使用<a href="https://zh.wikipedia.org/wiki/年号纪年" target="_blank" rel="noopener">年号纪年</a>。</p>
<p>这里提供了一个常见的<a href="https://zh.wikipedia.org/wiki/%E6%B0%91%E5%9C%8B%E7%B4%80%E5%B9%B4#%E7%B4%80%E5%B9%B4%E5%B0%8D%E7%85%A7" target="_blank" rel="noopener">纪年对照表</a>，可供参考。 </p>
</blockquote>
<p>-</p>
<blockquote>
<p><a href="https://zh.wikipedia.org/wiki/%E5%B9%B4%E5%8F%B7" target="_blank" rel="noopener">年号</a>是中国历史君主时代帝王纪年所立的名号，缘起于西汉汉武帝时期，后来朝鲜新罗在6世纪、日本在7世纪后期、越南在10世纪都因为中国的影响，开始使用年号；台湾岛的郑氏王朝与台湾民主国、朝鲜半岛大韩帝国与高丽、蒙古国建国初年受到中国影响，都还使用过年号，目前唯一使用年号的是仍保持君主制的日本。</p>
<p>值得一提，<a href="https://zh.wikipedia.org/wiki/中華民國" target="_blank" rel="noopener">中华民国</a>所用的<a href="https://zh.wikipedia.org/wiki/民國紀年" target="_blank" rel="noopener">民国纪年</a>、以及<a href="https://zh.wikipedia.org/wiki/朝鮮民主主義人民共和國" target="_blank" rel="noopener">朝鲜民主主义人民共和国</a>使用的<a href="https://zh.wikipedia.org/wiki/主体纪年" target="_blank" rel="noopener">主体纪年</a>，常被误认为是年号，实际上仅是单纯的纪年<a href="https://zh.wikipedia.org/wiki/曆法" target="_blank" rel="noopener">历法</a>。</p>
</blockquote>
<p>-</p>
<blockquote>
<p><a href="https://zh.wikipedia.org/wiki/%E4%B8%80%E4%B8%96%E4%B8%80%E5%85%83%E5%88%B6" target="_blank" rel="noopener">一世一元制</a>，指<a href="https://zh.wikipedia.org/wiki/君主" target="_blank" rel="noopener">君主</a>(国王、大君主、可汗、天皇、皇帝)在其在位期间只使用同一个<a href="https://zh.wikipedia.org/wiki/年號" target="_blank" rel="noopener">年号</a>，不进行改元的制度。例外：如果君主后来另行称帝或是重祚，会另建新年号，以示区别。</p>
</blockquote>
<h2 id="底层实现"><a href="#底层实现" class="headerlink" title="底层实现"></a>底层实现</h2><p><code>LocalDate</code> 的底层实现包含不可变的年、月、日：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">LocalDate</span></span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">Temporal</span>, <span class="title">TemporalAdjuster</span>, <span class="title">ChronoLocalDate</span>, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The year.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> year;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The month-of-year.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">short</span> month;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The day-of-month.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">short</span> day;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>LocalTime</code> 的底层实现包含不可变的时、分、秒、纳秒：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">LocalTime</span></span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">Temporal</span>, <span class="title">TemporalAdjuster</span>, <span class="title">Comparable</span>&lt;<span class="title">LocalTime</span>&gt;, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The hour.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">byte</span> hour;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The minute.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">byte</span> minute;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The second.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">byte</span> second;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The nanosecond.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> nano;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>LocalDateTime</code> 的底层实现包含不可变的 <code>LocalDate</code> 和 <code>LocalTime</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">LocalDateTime</span></span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">Temporal</span>, <span class="title">TemporalAdjuster</span>, <span class="title">ChronoLocalDateTime</span>&lt;<span class="title">LocalDate</span>&gt;, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The date part.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LocalDate date;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The time part.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LocalTime time;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h2><table>
<thead>
<tr>
<th>方法名</th>
<th>是否静态方法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>of</code></td>
<td>是</td>
<td>由 <code>Temporal</code> 对象的某个部分创建该对象。</td>
</tr>
<tr>
<td><code>now</code></td>
<td>是</td>
<td>依据系统时钟创建 <code>Temporal</code> 对象。</td>
</tr>
<tr>
<td><code>from</code></td>
<td>是</td>
<td>依据传入的 <code>Temporal</code> 对象创建对象。</td>
</tr>
<tr>
<td><code>parse</code></td>
<td>是</td>
<td>由字符串创建 <code>Temporal</code> 对象。</td>
</tr>
<tr>
<td><code>format</code></td>
<td>否</td>
<td>使用某个指定的 <code>DateTimeFormatter</code> 将 <code>Temporal</code> 对象转换为字符串。</td>
</tr>
<tr>
<td><code>atOffset</code></td>
<td>否</td>
<td>将 <code>Temporal</code> 对象和某个时区偏移相结合。</td>
</tr>
<tr>
<td><code>atZone</code></td>
<td>否</td>
<td>将 <code>Temporal</code> 对象和某个时区相结合。</td>
</tr>
<tr>
<td><code>get</code></td>
<td>否</td>
<td>读取 <code>Temporal</code> 对象的某一部分值。</td>
</tr>
<tr>
<td><code>minus</code></td>
<td>否</td>
<td>创建 <code>Temporal</code> 对象的副本，通过将当前 <code>Temporal</code> 对象的值减去一定的时长创建该副本。</td>
</tr>
<tr>
<td><code>plus</code></td>
<td>否</td>
<td>创建 <code>Temporal</code> 对象的副本，通过将当前 <code>Temporal</code> 对象的值加上一定的时长创建该副本。</td>
</tr>
<tr>
<td><code>with</code></td>
<td>否</td>
<td>以该 <code>Temporal</code> 对象为模板，对某些状态进行修改创建该对象的副本。</td>
</tr>
</tbody></table>
<p>例子：</p>
<h3 id="创建实例"><a href="#创建实例" class="headerlink" title="创建实例"></a>创建实例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过静态工厂方法创建实例</span></span><br><span class="line">LocalTime time = LocalTime.of(<span class="number">12</span>, <span class="number">0</span>);</span><br><span class="line">LocalDate date = LocalDate.of(<span class="number">2007</span>, <span class="number">12</span>, <span class="number">3</span>);</span><br><span class="line"><span class="comment">// 1970-01-01。epoch day（历元日）是一个简单的天数递增计数，其中第 0 天表示 1970-01-01。负数代表更早的日期。</span></span><br><span class="line">LocalDate date1 = LocalDate.ofEpochDay(<span class="number">0</span>);</span><br><span class="line"><span class="comment">// 通过静态方法创建实例</span></span><br><span class="line">LocalDate date2 = LocalDate.parse(<span class="string">"2007-12-03"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 合并日期和时间</span></span><br><span class="line">LocalDateTime dateTime = date.atTime(time);</span><br><span class="line">LocalDateTime dateTime1 = time.atDate(date);</span><br><span class="line">LocalDateTime dateTime2 = date.atStartOfDay();</span><br><span class="line">LocalDateTime dateTime3 = LocalDateTime.of(date, time);</span><br><span class="line"></span><br><span class="line"><span class="comment">// java.time.LocalDateTime 转 java.sql.Timestamp</span></span><br><span class="line">Timestamp timestamp = Timestamp.valueOf(localDateTime);</span><br></pre></td></tr></table></figure>

<h3 id="读取字段信息"><a href="#读取字段信息" class="headerlink" title="读取字段信息"></a>读取字段信息</h3><p>读取信息使用 <code>TemporalAccessor</code> 接口，通过传递一个 <code>ChronoField</code> 枚举给 <code>get</code> 方法读取相关信息：</p>
<p><img src="/img/java/time/temporal%E6%A0%B8%E5%BF%83%E6%8E%A5%E5%8F%A3.png" alt="ChronoLocalDate核心接口方法"></p>
<p><code>ChronoField</code> 枚举提供的值如下图：</p>
<p><img src="/img/java/time/ChronoField%E6%9E%9A%E4%B8%BE.png" alt="ChronoField枚举">：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 TemporalAccessor#get(TemporalField)，传入 TemporalField 接口的实现类 ChronoField</span></span><br><span class="line"><span class="keyword">int</span> year = date.get(ChronoField.YEAR);</span><br><span class="line"><span class="keyword">int</span> month = date.get(ChronoField.MONTH_OF_YEAR);</span><br><span class="line"><span class="keyword">int</span> dayOfMonth = date.get(ChronoField.DAY_OF_MONTH);</span><br><span class="line"></span><br><span class="line"><span class="comment">// LocalTime/LocalDate/LocalDateTime 各自也提供了一组 getter 快捷方法</span></span><br><span class="line"><span class="keyword">int</span> year1 = date.getYear();</span><br><span class="line"><span class="keyword">int</span> month1 = date.getMonthValue();</span><br><span class="line"><span class="keyword">int</span> dayOfMonth1 = date.getDayOfMonth();</span><br><span class="line"><span class="keyword">boolean</span> leapYear = date.isLeapYear();</span><br></pre></td></tr></table></figure>

<h3 id="创建副本并修改"><a href="#创建副本并修改" class="headerlink" title="创建副本并修改"></a>创建副本并修改</h3><p>创建副本使用 <code>Temporal</code> 接口，其提供了一组 <code>with</code>/<code>plus</code>/<code>minus</code> 方法：</p>
<p><img src="/img/java/time/temporal%E6%A0%B8%E5%BF%83%E6%8E%A5%E5%8F%A3.png" alt="ChronoLocalDate核心接口方法"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 Temporal#with(TemporalField, long)，传入 TemporalField 接口的实现类 ChronoField</span></span><br><span class="line">LocalDate newDate = date.with(ChronoField.YEAR, <span class="number">2019</span>);</span><br><span class="line">LocalDate newDate2 = date.with(ChronoField.MONTH_OF_YEAR, <span class="number">1</span>);</span><br><span class="line">LocalDate newDate3 = date.with(ChronoField.DAY_OF_MONTH, <span class="number">30</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// LocalTime/LocalDate/LocalDateTime 各自也提供了一组 with 快捷方法</span></span><br><span class="line">LocalDate newDate4 = date.withYear(<span class="number">2019</span>);</span><br><span class="line">LocalDate newDate5 = date.withMonth(<span class="number">1</span>);</span><br><span class="line">LocalDate newDate6 = date.withDayOfMonth(<span class="number">30</span>);</span><br></pre></td></tr></table></figure>

<p>如果 <code>with(TemporalField, long)</code> 方法不满足需求，可以使用更灵活的 <code>with(TemporalAdjuster)</code> 方法，配合 <code>TemporalAdjusters</code> 工具类提供的静态工厂方法，方法名非常直观：</p>
<p><img src="/img/java/time/TemporalAdjusters%E9%9D%99%E6%80%81%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95.png" alt="TemporalAdjusters静态工厂方法"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 Temporal#with(TemporalAdjuster)</span></span><br><span class="line">LocalDate newDate7 = date.with(TemporalAdjusters.nextOrSame(DayOfWeek.SUNDAY));</span><br><span class="line">LocalDate newDate8 = date.with(TemporalAdjusters.lastDayOfMonth());</span><br></pre></td></tr></table></figure>

<p>如果在 <code>TemporalAdjusters</code> 工具类中没有找到符合要求的预定义静态工厂方法，可以自己实现 <code>TemporalAdjuster</code> 函数式接口，以定制一些更复杂的时间修改操作：</p>
<p><img src="/img/java/time/TemporalAdjuster.png" alt="TemporalAdjuster"></p>
<h1 id="Instant"><a href="#Instant" class="headerlink" title="Instant"></a>Instant</h1><p>作为人，我们习惯于以星期几、几号、几点、几分这样的方式理解日期和时间。毫无疑问，这种方式对于计算机而言并不容易理解。从计算机的角度来看，建模时间最自然的格式是表示一个持续时间段上某个点的单一大整型数。这也是新的 <code>java.time.Instant</code> 类对时间建模的方式，它是以 <strong>Unix 元年时间</strong>（UTC 时区 1970-01-01T00:00:00Z，“Z” 代表 UTC 时区）开始所经历的秒数进行计算。</p>
<blockquote>
<p>1 秒(s) =<br>1,000 毫秒(ms) =<br>1,000,000 微秒(μs) =<br>1,000,000,000 纳秒(ns) =<br>1,000,000,000,000 皮秒(ps) =<br>1,000,000,000,000,000 飞秒(fs) =<br>1,000,000,000,000,000,000 仄秒(zs) =<br>1,000,000,000,000,000,000,000 幺秒(ys) =<br>1,000,000,000,000,000,000,000,000 渺秒(as)</p>
</blockquote>
<blockquote>
<p>1 纳秒(ns) = 10^-9 秒（0.000,000,001，十亿分之一秒）<br>1 微秒(μs) = 10^-6 秒（0.000,001，百万分之一秒）<br>1 毫秒(ms) = 10^-3 秒（0.001，千分之一秒）</p>
</blockquote>
<h2 id="底层实现-1"><a href="#底层实现-1" class="headerlink" title="底层实现"></a>底层实现</h2><p>从底层实现可见，<code>Instant</code> 仅包含不可变的秒、纳秒。即支持的最高存储精度为<strong>纳秒</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Instant</span></span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">Temporal</span>, <span class="title">TemporalAdjuster</span>, <span class="title">Comparable</span>&lt;<span class="title">Instant</span>&gt;, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The number of seconds from the epoch of 1970-01-01T00:00:00Z.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> seconds;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The number of nanoseconds, later along the time-line, from the seconds field.</span></span><br><span class="line"><span class="comment">     * This is always positive, and never exceeds 999,999,999.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> nanos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用方式-1"><a href="#使用方式-1" class="headerlink" title="使用方式"></a>使用方式</h2><p>通过静态工厂方法创建实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自 1970-01-01T00:00:00Z 之后经过的毫秒数</span></span><br><span class="line"><span class="comment">// 1970-01-01T00:00:01.000Z</span></span><br><span class="line">Instant instant = Instant.ofEpochMilli(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// // 自 1970-01-01T00:00:00Z 之后经过的秒数</span></span><br><span class="line"><span class="comment">// 1970-01-01T00:00:01Z</span></span><br><span class="line">Instant instant1 = Instant.ofEpochSecond(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">Instant instant2 = Instant.now();</span><br></pre></td></tr></table></figure>

<p><code>Instant</code> 与 <code>java.util.Date</code> 互转：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Date date = Date.from(instant);</span><br><span class="line">Instant instant = date.toInstant();</span><br></pre></td></tr></table></figure>

<p><code>Instant</code> 与时间戳互转：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Instant instant = Instant.now(); <span class="comment">// 2019-07-07T11:07:42.814Z</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Instant 的设计初衷是为了便于机器使用，底层实现仅包含由秒和纳秒所构成的数字。</span></span><br><span class="line"><span class="keyword">long</span> seconds = instant.getEpochSecond();  <span class="comment">// 1562497662</span></span><br><span class="line"><span class="keyword">int</span> nanoSeconds = instant.getNano();  <span class="comment">// 814000000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Instant 无法处理那些我们非常容易理解的时间单位，例如下述操作将抛出异常：</span></span><br><span class="line"><span class="comment">// java.time.temporal.UnsupportedTemporalTypeException: Unsupported field: DayOfMonth</span></span><br><span class="line"><span class="comment">// instant.get(ChronoField.DAY_OF_MONTH);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Instant 与时间戳互转</span></span><br><span class="line"><span class="keyword">long</span> timestamp = instant.toEpochMilli();  <span class="comment">// 1562497662814</span></span><br><span class="line">assertEquals(System.currentTimeMillis(), timestamp); <span class="comment">// true</span></span><br><span class="line">Instant instant2 = Instant.ofEpochMilli(timestamp); <span class="comment">// 2019-07-07T11:07:42.814Z</span></span><br></pre></td></tr></table></figure>

<p>创建副本并修改：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Instant newInstant = instant.with(ChronoField.INSTANT_SECONDS, <span class="number">30</span>);</span><br><span class="line">Instant newInstant2 = instant.with(ChronoField.MILLI_OF_SECOND, <span class="number">300</span>);</span><br><span class="line">Instant newInstant3 = instant.plus(<span class="number">30</span>, ChronoUnit.SECONDS);</span><br><span class="line">Instant newInstant4 = instant.plusSeconds(<span class="number">30</span>);</span><br><span class="line">Instant newInstant5 = instant.minusSeconds(<span class="number">30</span>);</span><br></pre></td></tr></table></figure>

<h1 id="Duration、Period"><a href="#Duration、Period" class="headerlink" title="Duration、Period"></a>Duration、Period</h1><p><code>Duration</code> 和 <code>Period</code> 类用于保存两个 <code>Temporal</code> 对象之间的时间段。</p>
<p><img src="/img/java/time/TemporalAmount%E5%AE%9E%E7%8E%B0%E7%B1%BB.png" alt="TemporalAmount实现类"></p>
<h2 id="底层实现-2"><a href="#底层实现-2" class="headerlink" title="底层实现"></a>底层实现</h2><p><code>Duration</code> 的底层实现仅包含不可变的秒、纳秒：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Duration</span></span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">TemporalAmount</span>, <span class="title">Comparable</span>&lt;<span class="title">Duration</span>&gt;, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The number of seconds in the duration.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> seconds;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The number of nanoseconds in the duration, expressed as a fraction of the</span></span><br><span class="line"><span class="comment">     * number of seconds. This is always positive, and never exceeds 999,999,999.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> nanos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Period</code> 的底层实现包含不可变的年、月、日：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Period</span></span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">ChronoPeriod</span>, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The number of years.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> years;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The number of months.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> months;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The number of days.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> days;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用方式-2"><a href="#使用方式-2" class="headerlink" title="使用方式"></a>使用方式</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Duration 类的静态工厂方法 between 仅支持两个 LocalTime 或两个 LocalDateTime、或两个 Instant 对象之间的 duration</span></span><br><span class="line">Duration duration = Duration.between(dateTime1, dateTime);</span><br><span class="line">Duration.between(time, time);</span><br><span class="line">Duration.between(instant, instant1);</span><br><span class="line"><span class="comment">// 由于 Duration 类主要用于以秒和纳秒衡量时间的长短，如果传 LocalDate 对象会抛异常：java.time.temporal.UnsupportedTemporalTypeException</span></span><br><span class="line"><span class="comment">// Duration.between(date1, date);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Period 类的静态工厂方法 between 仅支持两个 LocalDates</span></span><br><span class="line">Period period = Period.between(date1, date);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Duration 和 Period 类都提供了很多非常方便的静态工厂方法，用于直接创建对应的实例</span></span><br><span class="line">Duration threeDays = Duration.ofDays(<span class="number">3</span>);</span><br><span class="line">Duration threeHours = Duration.ofHours(<span class="number">3</span>);</span><br><span class="line">Duration threeMinutes = Duration.ofMinutes(<span class="number">3</span>);</span><br><span class="line">Duration threeMinutes2 = Duration.of(<span class="number">3</span>, ChronoUnit.MINUTES);</span><br><span class="line">Duration threeSeconds = Duration.ofSeconds(<span class="number">3</span>);</span><br><span class="line">Duration threeMillis = Duration.ofMillis(<span class="number">3</span>);</span><br><span class="line">Duration twoDaysThreeHoursFourMinutes = Duration.parse(<span class="string">"P2DT3H4M"</span>);</span><br><span class="line"></span><br><span class="line">Period tenYears = Period.ofYears(<span class="number">10</span>);</span><br><span class="line">Period tenMonths = Period.ofMonths(<span class="number">10</span>);</span><br><span class="line">Period tenWeeks = Period.ofWeeks(<span class="number">10</span>);</span><br><span class="line">Period tenDays = Period.ofDays(<span class="number">10</span>);</span><br><span class="line">Period twoYearsSixMonthsOneDay = Period.of(<span class="number">2</span>, <span class="number">6</span>, <span class="number">1</span>);</span><br><span class="line">Period oneYearTwoMonthsThreeDays = Period.parse(<span class="string">"P1Y2M3D"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 准确获取该时段的差值：日、时、分、秒、毫秒、纳秒</span></span><br><span class="line"><span class="keyword">long</span> days = duration.toDays();</span><br><span class="line"><span class="keyword">long</span> hours = duration.toHours();</span><br><span class="line"><span class="keyword">long</span> minutes = duration.toMinutes();</span><br><span class="line"><span class="keyword">long</span> seconds = duration.getSeconds();</span><br><span class="line"><span class="keyword">long</span> seconds2 = duration.get(ChronoUnit.SECONDS);</span><br><span class="line"><span class="keyword">long</span> millis = duration.toMillis();</span><br><span class="line"><span class="keyword">long</span> nanos2 = duration.toNanos();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取指定部分的差值</span></span><br><span class="line"><span class="keyword">int</span> years = period.getYears();</span><br><span class="line"><span class="keyword">int</span> months = period.getMonths();</span><br><span class="line"><span class="keyword">int</span> days1 = period.getDays();</span><br><span class="line"><span class="keyword">long</span> days2 = period.get(ChronoUnit.DAYS);</span><br></pre></td></tr></table></figure>

<p><code>ChronoUnit</code> 枚举提供的值：</p>
<p><img src="/img/java/time/TemporalUnit%E6%9E%9A%E4%B8%BE.png" alt="TemporalUnit枚举"></p>
<h1 id="日期格式化"><a href="#日期格式化" class="headerlink" title="日期格式化"></a>日期格式化</h1><p><code>DateTimeFormatter</code> 用于日期格式化。和老的 <code>java.util.DateFormat</code> 相比，所有的 <code>DateTimeFormatter</code> 实例都是线程安全的。所以，你能够以单例模式创建格式器实例，并在多个线程间共享。</p>
<p>下面介绍创建格式器的三种方式：</p>
<h2 id="预定义的格式器"><a href="#预定义的格式器" class="headerlink" title="预定义的格式器"></a>预定义的格式器</h2><p>创建格式器最简单的方法是通过它<a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#predefined" target="_blank" rel="noopener">预定义的格式器</a>常量，定义如下：</p>
<table>
<thead>
<tr>
<th align="left">Formatter</th>
<th align="left">Description</th>
<th align="left">Example</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ofLocalizedDate-java.time.format.FormatStyle-" target="_blank" rel="noopener"><code>ofLocalizedDate(dateStyle)</code></a></td>
<td align="left">Formatter with date style from the locale</td>
<td align="left">‘2011-12-03’</td>
</tr>
<tr>
<td align="left"><a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ofLocalizedTime-java.time.format.FormatStyle-" target="_blank" rel="noopener"><code>ofLocalizedTime(timeStyle)</code></a></td>
<td align="left">Formatter with time style from the locale</td>
<td align="left">‘10:15:30’</td>
</tr>
<tr>
<td align="left"><a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ofLocalizedDateTime-java.time.format.FormatStyle-" target="_blank" rel="noopener"><code>ofLocalizedDateTime(dateTimeStyle)</code></a></td>
<td align="left">Formatter with a style for date and time from the locale</td>
<td align="left">‘3 Jun 2008 11:05:30’</td>
</tr>
<tr>
<td align="left"><a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ofLocalizedDateTime-java.time.format.FormatStyle-" target="_blank" rel="noopener"><code>ofLocalizedDateTime(dateStyle,timeStyle)</code></a></td>
<td align="left">Formatter with date and time styles from the locale</td>
<td align="left">‘3 Jun 2008 11:05’</td>
</tr>
<tr>
<td align="left"><a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#BASIC_ISO_DATE" target="_blank" rel="noopener"><code>BASIC_ISO_DATE</code></a></td>
<td align="left">Basic ISO date</td>
<td align="left">‘20111203’</td>
</tr>
<tr>
<td align="left"><a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ISO_LOCAL_DATE" target="_blank" rel="noopener"><code>ISO_LOCAL_DATE</code></a></td>
<td align="left">ISO Local Date</td>
<td align="left">‘2011-12-03’</td>
</tr>
<tr>
<td align="left"><a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ISO_OFFSET_DATE" target="_blank" rel="noopener"><code>ISO_OFFSET_DATE</code></a></td>
<td align="left">ISO Date with offset</td>
<td align="left">‘2011-12-03+01:00’</td>
</tr>
<tr>
<td align="left"><a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ISO_DATE" target="_blank" rel="noopener"><code>ISO_DATE</code></a></td>
<td align="left">ISO Date with or without offset</td>
<td align="left">‘2011-12-03+01:00’; ‘2011-12-03’</td>
</tr>
<tr>
<td align="left"><a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ISO_LOCAL_TIME" target="_blank" rel="noopener"><code>ISO_LOCAL_TIME</code></a></td>
<td align="left">Time without offset</td>
<td align="left">‘10:15:30’</td>
</tr>
<tr>
<td align="left"><a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ISO_OFFSET_TIME" target="_blank" rel="noopener"><code>ISO_OFFSET_TIME</code></a></td>
<td align="left">Time with offset</td>
<td align="left">‘10:15:30+01:00’</td>
</tr>
<tr>
<td align="left"><a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ISO_TIME" target="_blank" rel="noopener"><code>ISO_TIME</code></a></td>
<td align="left">Time with or without offset</td>
<td align="left">‘10:15:30+01:00’; ‘10:15:30’</td>
</tr>
<tr>
<td align="left"><a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ISO_LOCAL_DATE_TIME" target="_blank" rel="noopener"><code>ISO_LOCAL_DATE_TIME</code></a></td>
<td align="left">ISO Local Date and Time</td>
<td align="left">‘2011-12-03T10:15:30’</td>
</tr>
<tr>
<td align="left"><a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ISO_OFFSET_DATE_TIME" target="_blank" rel="noopener"><code>ISO_OFFSET_DATE_TIME</code></a></td>
<td align="left">Date Time with Offset</td>
<td align="left">2011-12-03T10:15:30+01:00’</td>
</tr>
<tr>
<td align="left"><a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ISO_ZONED_DATE_TIME" target="_blank" rel="noopener"><code>ISO_ZONED_DATE_TIME</code></a></td>
<td align="left">Zoned Date Time</td>
<td align="left">‘2011-12-03T10:15:30+01:00[Europe/Paris]’</td>
</tr>
<tr>
<td align="left"><a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ISO_DATE_TIME" target="_blank" rel="noopener"><code>ISO_DATE_TIME</code></a></td>
<td align="left">Date and time with ZoneId</td>
<td align="left">‘2011-12-03T10:15:30+01:00[Europe/Paris]’</td>
</tr>
<tr>
<td align="left"><a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ISO_ORDINAL_DATE" target="_blank" rel="noopener"><code>ISO_ORDINAL_DATE</code></a></td>
<td align="left">Year and day of year</td>
<td align="left">‘2012-337’</td>
</tr>
<tr>
<td align="left"><a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ISO_WEEK_DATE" target="_blank" rel="noopener"><code>ISO_WEEK_DATE</code></a></td>
<td align="left">Year and Week</td>
<td align="left">2012-W48-6’</td>
</tr>
<tr>
<td align="left"><a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ISO_INSTANT" target="_blank" rel="noopener"><code>ISO_INSTANT</code></a></td>
<td align="left">Date and Time of an Instant</td>
<td align="left">‘2011-12-03T10:15:30Z’</td>
</tr>
<tr>
<td align="left"><a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#RFC_1123_DATE_TIME" target="_blank" rel="noopener"><code>RFC_1123_DATE_TIME</code></a></td>
<td align="left">RFC 1123 / RFC 822</td>
<td align="left">‘Tue, 3 Jun 2008 11:05:30 GMT’</td>
</tr>
</tbody></table>
<p><img src="/img/java/time/DateTimeFormatter%E5%B8%B8%E9%87%8F.png" alt="DateTimeFormatter常量"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2021-02-01</span></span><br><span class="line">LocalDateTime.now().format(DateTimeFormatter.ISO_DATE);</span><br></pre></td></tr></table></figure>

<h2 id="自定义-Pattern"><a href="#自定义-Pattern" class="headerlink" title="自定义 Pattern"></a>自定义 Pattern</h2><p><a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#patterns" target="_blank" rel="noopener">Patterns for Formatting and Parsing</a>:</p>
<blockquote>
<p>Patterns are based on a simple sequence of letters and symbols. A pattern is used to create a Formatter using the <a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ofPattern-java.lang.String-" target="_blank" rel="noopener"><code>ofPattern(String)</code></a> and <a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ofPattern-java.lang.String-java.util.Locale-" target="_blank" rel="noopener"><code>ofPattern(String, Locale)</code></a> methods.</p>
<p>A formatter created from a pattern can be used as many times as necessary, it is immutable and is thread-safe.</p>
</blockquote>
<p><code>DateTimeFormatter#ofPattern(String)</code> 静态工厂方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 01/02/2021</span></span><br><span class="line">LocalDateTime.now().format(DateTimeFormatter.ofPattern(<span class="string">"dd/MM/yyyy"</span>));</span><br></pre></td></tr></table></figure>

<p><code>DateTimeFormatter#ofPattern(String, Locale)</code> 静态工厂方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2021 2 1</span></span><br><span class="line">LocalDateTime.now().format(DateTimeFormatter.ofPattern(<span class="string">"yyyy M d"</span>, Locale.US));</span><br><span class="line"><span class="comment">// 2021 02 1</span></span><br><span class="line">LocalDateTime.now().format(DateTimeFormatter.ofPattern(<span class="string">"yyyy MM d"</span>, Locale.US));</span><br><span class="line"><span class="comment">// 2021 Feb 1</span></span><br><span class="line">LocalDateTime.now().format(DateTimeFormatter.ofPattern(<span class="string">"yyyy MMM d"</span>, Locale.US));</span><br><span class="line"><span class="comment">// 2021 February 1</span></span><br><span class="line">LocalDateTime.now().format(DateTimeFormatter.ofPattern(<span class="string">"yyyy MMMM d"</span>, Locale.US));</span><br><span class="line"><span class="comment">// 2021 F 1</span></span><br><span class="line">LocalDateTime.now().format(DateTimeFormatter.ofPattern(<span class="string">"yyyy MMMMM d"</span>, Locale.US));</span><br></pre></td></tr></table></figure>

<p>Pattern 的字母数量决定格式，以月份为例：</p>
<ul>
<li>Exactly 1 pattern letter will use the minimum number of digits and without padding.</li>
<li>Exactly 2 pattern letters, the count of digits is used as the width of the output field, with the value zero-padded as necessary.</li>
<li>Exactly 3 pattern letters will use the <a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/TextStyle.html#SHORT" target="_blank" rel="noopener"><code>short form</code></a>.</li>
<li>Exactly 4 pattern letters will use the <a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/TextStyle.html#FULL" target="_blank" rel="noopener"><code>full form</code></a>. </li>
<li>Exactly 5 pattern letters will use the <a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/TextStyle.html#NARROW" target="_blank" rel="noopener"><code>narrow form</code></a>.</li>
</ul>
<h2 id="更灵活的构建器"><a href="#更灵活的构建器" class="headerlink" title="更灵活的构建器"></a>更灵活的构建器</h2><p>如果还需要更加细粒度的控制，<code>DateTimeFormatterBuilder</code> 类还提供了更复杂的格式器构建，你可以选择恰当的方法，一步一步地构造自己的格式器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DateTimeFormatter dtf = <span class="keyword">new</span> DateTimeFormatterBuilder().appendPattern(<span class="string">"dd/MM/yyyy[ [HH][:mm][:ss][.SSS]]"</span>)</span><br><span class="line">  .parseDefaulting(ChronoField.HOUR_OF_DAY, <span class="number">0</span>)</span><br><span class="line">  .parseDefaulting(ChronoField.MINUTE_OF_HOUR, <span class="number">0</span>)</span><br><span class="line">  .parseDefaulting(ChronoField.SECOND_OF_MINUTE, <span class="number">0</span>)</span><br><span class="line">  .toFormatter(Locale.US);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1999-01-01T02:04:06</span></span><br><span class="line">LocalDateTime.parse(<span class="string">"01/01/1999 02:04:06"</span>, dtf);</span><br><span class="line"><span class="comment">// 1999-01-01T00:00</span></span><br><span class="line">LocalDateTime.parse(<span class="string">"01/01/1999"</span>, dtf);</span><br></pre></td></tr></table></figure>

<p>另外，<code>DateTimeFormatterBuilder</code> 类还提供了非常强大的解析功能，比如区分大小写的解析、柔性解析（允许解析器使用启发式的机制去解析输入，不精确地匹配指定的模式）、填充，以及在格式器中指定可选节。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li>《Java 8 实战》</li>
<li>Java SE Docs</li>
<li>《<a href="https://www.jianshu.com/p/b4629857fc6f" target="_blank" rel="noopener">LocalDate、LocalDateTime与timestamp、Date的转换</a>》</li>
<li>《<a href="https://docs.oracle.com/javase/tutorial/datetime/iso/format.html" target="_blank" rel="noopener">Parsing and Formatting (The Java™ Tutorials &gt; Date Time &gt; Standard Calendar)</a>》</li>
<li>《<a href="https://stackoverflow.com/questions/41177442/uuuu-versus-yyyy-in-datetimeformatter-formatting-pattern-codes-in-java" target="_blank" rel="noopener"><code>uuuu</code> versus <code>yyyy</code> in <code>DateTimeFormatter</code> formatting pattern codes in Java?</a>》</li>
</ul>
</div></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2018/04/04/java-string/" class="post-title-link">Java 常用类型系列（三）字符串类型总结</a></h2><div class="post-info">2018-04-04<a href="/tags/Java/" title="Java" class="post-demo">Java</a></div><div class="post-content"><h1 id="继承结构"><a href="#继承结构" class="headerlink" title="继承结构"></a>继承结构</h1><p><img src="/img/java/string/methods_of_CharSequence.png" alt="methods_of_CharSequence"></p>
<p><img src="/img/java/string/Appendable.png" alt="Appendable"></p>
<p><img src="/img/java/string/CharSequence.png" alt="CharSequence"></p>
<h1 id="字符串的实现"><a href="#字符串的实现" class="headerlink" title="字符串的实现"></a>字符串的实现</h1><p><img src="/img/java/string/history_of_String.jpg" alt="history_of_String"></p>
<h1 id="字符串的创建方式"><a href="#字符串的创建方式" class="headerlink" title="字符串的创建方式"></a>字符串的创建方式</h1><h2 id="通过字符串常量创建"><a href="#通过字符串常量创建" class="headerlink" title="通过字符串常量创建"></a>通过字符串常量创建</h2><h2 id="通过构造方法创建"><a href="#通过构造方法创建" class="headerlink" title="通过构造方法创建"></a>通过构造方法创建</h2><h2 id="intern-方法"><a href="#intern-方法" class="headerlink" title="intern() 方法"></a><code>intern()</code> 方法</h2><h1 id="字符串的特性"><a href="#字符串的特性" class="headerlink" title="字符串的特性"></a>字符串的特性</h1><p>三种常用字符串类的区别如下：</p>
<table>
<thead>
<tr>
<th></th>
<th>since</th>
<th>immutable ?</th>
<th>thread-safe ?</th>
</tr>
</thead>
<tbody><tr>
<td><code>java.lang.String</code></td>
<td>Java SE 1.0</td>
<td>immutable</td>
<td>no thread-safe</td>
</tr>
<tr>
<td><code>java.lang.StringBuffer</code></td>
<td>Java SE 1.0</td>
<td>mutable</td>
<td>thread-safe</td>
</tr>
<tr>
<td><code>java.lang.StringBuilder</code></td>
<td>Java SE 1.5</td>
<td>mutable</td>
<td>no thread-safe</td>
</tr>
</tbody></table>
<h2 id="字符串拼接-字节码分析"><a href="#字符串拼接-字节码分析" class="headerlink" title="字符串拼接-字节码分析"></a>字符串拼接-字节码分析</h2><p><a href="https://lingcoder.github.io/OnJava8/#/book/18-Strings?id=-%e7%9a%84%e9%87%8d%e8%bd%bd%e4%b8%8e-stringbuilder" target="_blank" rel="noopener">+ 的重载与 StringBuilder</a></p>
<h1 id="工具类"><a href="#工具类" class="headerlink" title="工具类"></a>工具类</h1><h2 id="java-util-Formatter"><a href="#java-util-Formatter" class="headerlink" title="java.util.Formatter"></a>java.util.Formatter</h2><p>C 语言 <code>printf</code> 风格的字符串格式化解释器。用法参考<a href="https://blog.csdn.net/quinnnorris/article/details/54614446" target="_blank" rel="noopener">这里</a>。</p>
<p><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Formatter.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/api/java/util/Formatter.html</a></p>
<p><img src="/img/java/string/Formatter.png" alt="Formatter"></p>
<h2 id="java-util-StringJoiner"><a href="#java-util-StringJoiner" class="headerlink" title="java.util.StringJoiner"></a>java.util.StringJoiner</h2><p>对于字符串拼接，除了使用 <code>StringBuilder</code> 之外， Java SE 8 还提供了新的 API <code>java.util.StringJoiner</code>，它是<code>String.join</code> 和 <code>java.util.stream.Collectors#joining(...)</code> 的底层实现。结合 Stream API 使用如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// [a,b,c,d,e,f,g]</span></span><br><span class="line">Arrays.asList(<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>, <span class="string">"d"</span>, <span class="string">"e"</span>, <span class="string">"f"</span>, <span class="string">"g"</span>).stream()</span><br><span class="line">                .collect(Collectors.joining(<span class="string">","</span>, <span class="string">"["</span>, <span class="string">"]"</span>));</span><br></pre></td></tr></table></figure>

<h2 id="org-apache-commons-lang3-StringUtils"><a href="#org-apache-commons-lang3-StringUtils" class="headerlink" title="org.apache.commons.lang3.StringUtils"></a>org.apache.commons.lang3.StringUtils</h2><p>Apache Commons Lang 为字符串操作提供了 <code>StringUtils</code> 工具类，使用方式参考<a href="/2017/12/25/apache-commons-lang/">这里</a>。</p>
<p><img src="/img/java/commons/commons-lang/StringUtils.png" alt="StringUtils"></p>
<h2 id="org-apache-commons-lang3-StringEscapeUtils"><a href="#org-apache-commons-lang3-StringEscapeUtils" class="headerlink" title="org.apache.commons.lang3.StringEscapeUtils"></a>org.apache.commons.lang3.StringEscapeUtils</h2><p>Apache Commons Lang 提供了字符串转义和反转义工具类 <code>StringEscapeUtils</code>，用于 Java、JavaScript、JSON、HTML、XML、CSV 等字符串：</p>
<p><img src="/img/java/string/StringEscapeUtils.png" alt="StringEscapeUtils"></p>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &amp;lt;span&amp;gt;hello world&amp;lt;/span&amp;gt;</span></span><br><span class="line">StringEscapeUtils.escapeHtml4(<span class="string">"&lt;span&gt;hello world&lt;/span&gt;"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// &#123;hello: "world"&#125;</span></span><br><span class="line">StringEscapeUtils.unescapeJson(<span class="string">"&#123;hello: \"world\"&#125;"</span>);</span><br></pre></td></tr></table></figure>

<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>《<a href="https://lingcoder.github.io/OnJava8/#/book/18-Strings" target="_blank" rel="noopener">On Java 8 - 第十八章 字符串</a>》</p>
<p>《<a href="https://cloud.tencent.com/developer/article/1511298" target="_blank" rel="noopener">Java String 对象，你真的了解了吗？</a>》</p>
<p>《<a href="https://blog.csdn.net/tyyking/article/details/82496901" target="_blank" rel="noopener">几张图轻松理解 <code>String.intern()</code></a>》</p>
<p>《<a href="https://blog.csdn.net/weixin_40304387/article/details/81071816" target="_blank" rel="noopener">字符串常量池深入解析</a>》</p>
<p>《<a href="https://www.cnblogs.com/natian-ws/p/10749164.html" target="_blank" rel="noopener">JVM 常量池、运行时常量池、字符串常量池</a>》</p>
<p>《<a href="https://segmentfault.com/a/1190000007835105" target="_blank" rel="noopener">Java8 对字符串连接的改进</a>》</p>
<p>《<a href="http://www.w3school.com.cn/html/html_entities.asp" target="_blank" rel="noopener">HTML 字符实体</a>》</p>
</div></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2018/04/01/java-wrapper-types/" class="post-title-link">Java 常用类型系列（一）包装类型总结</a></h2><div class="post-info">2018-04-01<a href="/tags/Java/" title="Java" class="post-demo">Java</a></div><div class="post-content"><p>包装类型作为日常开发最常用的数据载体，使用时有一些点需要特别注意，否则容易踩坑，本文总结下。</p>
<h1 id="值、引用比较问题"><a href="#值、引用比较问题" class="headerlink" title="值、引用比较问题"></a>值、引用比较问题</h1><p>首先看一段代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Integer a = <span class="number">1000</span>;</span><br><span class="line">Integer b = <span class="number">1000</span>;</span><br><span class="line">Integer c = <span class="number">100</span>;</span><br><span class="line">Integer d = <span class="number">100</span>;</span><br><span class="line">Integer e = <span class="keyword">new</span> Integer(<span class="number">100</span>);</span><br><span class="line">Integer f = <span class="keyword">new</span> Integer(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 值比较</span></span><br><span class="line">System.out.println((<span class="string">"a equals b is "</span> + (a.equals(b))));  <span class="comment">// a equals b is true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 引用比较，结果为 false</span></span><br><span class="line">System.out.println(<span class="string">"a == b is "</span> + (a == b));  <span class="comment">// a == b is false</span></span><br><span class="line"><span class="comment">// 引用比较，结果意外的为 true。这是由于 Integer 自动装箱时 [-128, 127] 使用了缓存，详见其 valueOf 方法的源码实现。</span></span><br><span class="line">System.out.println((<span class="string">"c == d is "</span> + (c == d)));  <span class="comment">// c == d is true</span></span><br><span class="line"><span class="comment">// 引用比较，结果为 false。因为 new Integer(int) 构造方法没有使用缓存。</span></span><br><span class="line">System.out.println((<span class="string">"e == f is "</span> + (e == f)));  <span class="comment">// e == f is false</span></span><br></pre></td></tr></table></figure>

<p>值的比较务必使用 <code>equals</code> 方法。可以遵循《阿里巴巴 Java 开发规范》这条规范：</p>
<p><img src="/img/java/primitive-type/notes.png" alt="notes"></p>
<h1 id="自动装箱的性能问题"><a href="#自动装箱的性能问题" class="headerlink" title="自动装箱的性能问题"></a>自动装箱的性能问题</h1><p>Java 语言提供了八种基本类型。其中包括：</p>
<ul>
<li>一种布尔类型</li>
<li>一种字符类型</li>
<li>六种数字类型（四种整数型，两种浮点型）</li>
</ul>
<p>这些基本类型（primitive type）都有对应的包装类型（boxed primitive type），具有类的特性。基本类型和包装类型之间的转换通过装箱和拆箱方法：</p>
<table>
<thead>
<tr>
<th>基本数据类型</th>
<th>对应的包装类</th>
<th>拆箱方法</th>
<th>装箱方法</th>
<th>存储空间</th>
<th>取值范围</th>
<th>缓存范围</th>
</tr>
</thead>
<tbody><tr>
<td><code>boolean</code></td>
<td><code>Boolean</code></td>
<td><code>booleanValue()</code></td>
<td><code>valueOf(boolean)</code></td>
<td>1 bit</td>
<td></td>
<td>true &amp; false</td>
</tr>
<tr>
<td><code>char</code></td>
<td><code>Character</code></td>
<td><code>charValue()</code></td>
<td><code>valueOf(char)</code></td>
<td>16 bit</td>
<td></td>
<td>\u005Cu0000~\u005Cu007F</td>
</tr>
<tr>
<td><code>byte</code></td>
<td><code>Byte</code></td>
<td><code>byteValue()</code></td>
<td><code>valueOf(byte)</code></td>
<td>8 bit</td>
<td>-2^7~2^7-1</td>
<td>-2^7~2^7-1</td>
</tr>
<tr>
<td><code>short</code></td>
<td><code>Short</code></td>
<td><code>shortValue()</code></td>
<td><code>valueOf(short)</code></td>
<td>16 bit</td>
<td>-2^15~2^15-1</td>
<td>-2^7~2^7-1</td>
</tr>
<tr>
<td><code>int</code></td>
<td><code>Integer</code></td>
<td><code>intValue()</code></td>
<td><code>valueOf(int)</code></td>
<td>32 bit</td>
<td>-2^31~2^31-1</td>
<td>-2^7~2^7-1</td>
</tr>
<tr>
<td><code>long</code></td>
<td><code>Long</code></td>
<td><code>longValue()</code></td>
<td><code>valueOf(long)</code></td>
<td>64 bit</td>
<td>-2^63~2^63-1</td>
<td>-2^7~2^7-1</td>
</tr>
<tr>
<td><code>float</code></td>
<td><code>Float</code></td>
<td><code>floatValue()</code></td>
<td><code>valueOf(float)</code></td>
<td>32 bit</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>double</code></td>
<td><code>Double</code></td>
<td><code>doubleValue()</code></td>
<td><code>valueOf(double)</code></td>
<td>64 bit</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>其中数字类型的拆箱方法由共同的父类 <code>java.lang.Number</code> 定义：</p>
<p><img src="/img/java/primitive-type/Number%E6%96%B9%E6%B3%95.png" alt="Number方法"></p>
<p><img src="/img/java/primitive-type/Number.png" alt="Number"></p>
<p>自 JDK 1.5 版本后，Java 引入了自动装箱（autoboxing）、拆箱（auto-unboxing）作为语法糖，使基本类型和包装类型可以直接转换，减少使用包装类型的繁琐性。<code>javac</code> 编译会做相应处理，例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Integer i = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">int</span> n = i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>反编译后代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123;</span><br><span class="line">    Integer i = Integer.valueOf(<span class="number">10</span>);  <span class="comment">// 自动装箱</span></span><br><span class="line">    <span class="keyword">int</span> n = i.intValue();  <span class="comment">// 自动拆箱</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但在进行大批量数据操作时，装箱操作会有一定的性能损耗，看一段代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 程序一：包装类型</span></span><br><span class="line">Long sum = <span class="number">0L</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">long</span> i = <span class="number">0</span>; i &lt; Integer.MAX_VALUE; i++) &#123;</span><br><span class="line">    sum += i;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(sum);  <span class="comment">// 耗时 10390 ms</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 程序二：基本类型</span></span><br><span class="line"><span class="keyword">long</span> sum = <span class="number">0L</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">long</span> i = <span class="number">0</span>; i &lt; Integer.MAX_VALUE; i++) &#123;</span><br><span class="line">    sum += i;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(sum);  <span class="comment">// 耗时 1101 ms</span></span><br></pre></td></tr></table></figure>

<p>程序一运行起来比程序二慢了十倍，因为变量 <code>sum</code> 的每次计算结果都被反复装箱，导致不必要的对象创建和较高的资源消耗，从而影响性能。代码反编译如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 程序一：包装类型</span></span><br><span class="line">Long sum = Long.valueOf(<span class="number">0L</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">long</span> i = <span class="number">0L</span>; i &lt; <span class="number">2147483647L</span>; i++) &#123;</span><br><span class="line">    sum = Long.valueOf(sum.longValue() + i);</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(sum);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 程序二：基本类型</span></span><br><span class="line"><span class="keyword">long</span> sum = <span class="number">0L</span>;</span><br><span class="line"><span class="keyword">long</span> i;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0L</span>; i &lt; <span class="number">2147483647L</span>; i++) &#123;</span><br><span class="line">    sum += i;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(sum);</span><br></pre></td></tr></table></figure>

<p>这提醒我们，在进行大批量数据操作时，要优先使用基本类型。为此 Java 8 还专门引入了：</p>
<ul>
<li><p><code>IntStream</code>、<code>LongStream</code>、<code>DoubleStream</code> 作为泛型类 <code>Stream</code> 的补充；</p>
</li>
<li><p><code>OptionalInt</code>、<code>OptionalLong</code>、<code>OptionalDouble</code> 作为泛型类 <code>Optional</code> 的补充；</p>
</li>
<li><p>以及一堆配套的基本类型特化的函数式接口。</p>
</li>
</ul>
<p>部分代码如下：</p>
<p><img src="/img/java/lambda/Stream.png" alt="Stream"></p>
<p><img src="/img/java/lambda/stream_methods.png" alt="stream_methods"></p>
<p>那么什么时候应该使用装箱类型呢？</p>
<ol>
<li>必须使用装箱基本类型作为类型参数，因为 Java 不允许使用基本类型。例如作为泛型集合中的元素、键和值，由于不能将基本类型作为类型参数，因此必须使用装箱基本类型。又例如，不能将变量声明为 <code>ThreadLocal&lt;int&gt;</code> 类型，因此必须使用 <code>ThreadLocal&lt;Integer&gt;</code>。</li>
<li>在进行反射的方法调用时，必须使用装箱基本类型。</li>
</ol>
<h1 id="自动拆箱的-NPE-风险"><a href="#自动拆箱的-NPE-风险" class="headerlink" title="自动拆箱的 NPE 风险"></a>自动拆箱的 NPE 风险</h1><p>要注意，当程序进行涉及装箱和拆箱基本类型的混合类型计算时，它会进行自动拆箱。当程序进行拆箱时，会有 NPE 风险：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Long sum = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">long</span> i = <span class="number">0</span>; i &lt; Integer.MAX_VALUE; i++) &#123;</span><br><span class="line">    sum += i;  <span class="comment">// java.lang.NullPointerException</span></span><br><span class="line">&#125;</span><br><span class="line">System.out.println(sum);</span><br></pre></td></tr></table></figure>

<p>在日常开发中，数据库字段定义、或查询结果都可能为 <code>null</code>，因为自动拆箱，用基本类型接收会有 NPE 风险。可以遵循《阿里巴巴 Java 开发规范》这条规范：</p>
<p><img src="/img/java/primitive-type/notes2.png" alt="notes2"></p>
<h1 id="进制转换"><a href="#进制转换" class="headerlink" title="进制转换"></a>进制转换</h1><table>
<thead>
<tr>
<th></th>
<th>英文简写</th>
<th>字面量前缀</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>十六进制</td>
<td><code>HEX</code></td>
<td><code>0X</code>、<code>0x</code></td>
<td></td>
</tr>
<tr>
<td>十进制</td>
<td><code>DEC</code></td>
<td>无</td>
<td></td>
</tr>
<tr>
<td>八进制</td>
<td><code>OCT</code></td>
<td><code>0</code></td>
<td></td>
</tr>
<tr>
<td>二进制</td>
<td><code>BIN</code></td>
<td><code>0B</code>、<code>0b</code></td>
<td>参考<a href="https://docs.oracle.com/javase/7/docs/technotes/guides/language/binary-literals.html" target="_blank" rel="noopener">官方文档</a></td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 十进制转成二进制：11111111</span></span><br><span class="line">Integer.toBinaryString(<span class="number">255</span>);</span><br><span class="line"><span class="comment">// 二进制转十进制：255</span></span><br><span class="line">Integer.valueOf(<span class="string">"11111111"</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 十进制转成八进制：10</span></span><br><span class="line">Integer.toOctalString(<span class="number">8</span>);</span><br><span class="line"><span class="comment">// 八进制转成十进制：8</span></span><br><span class="line">Integer.valueOf(<span class="string">"10"</span>, <span class="number">8</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 十进制转成十六进制：F</span></span><br><span class="line">Integer.toHexString(<span class="number">15</span>);</span><br><span class="line"><span class="comment">// 十六进制转成十进制：15</span></span><br><span class="line">Integer.valueOf(<span class="string">"F"</span>, <span class="number">16</span>);</span><br></pre></td></tr></table></figure>

<h1 id="源码解析"><a href="#源码解析" class="headerlink" title="源码解析"></a>源码解析</h1><p>最后，来总结下包装类型特点：</p>
<ul>
<li>所有包装类型都为 <code>final</code>，底层被包装的基本类型也都为 <code>final</code>。因此包装类型一旦初始化后，在运行期值是不可变的，非常安全。</li>
<li><code>Byte</code>、<code>Short</code>、<code>Integer</code>、<code>Long</code> 装箱方法的某个数据段使用了缓存，因此 <code>==</code> 引用比较时可能会出现预期外的结果（<code>true</code>），详见源码。</li>
</ul>
<h2 id="java-lang-Byte"><a href="#java-lang-Byte" class="headerlink" title="java.lang.Byte"></a>java.lang.Byte</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Byte</span> <span class="keyword">extends</span> <span class="title">Number</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">Byte</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The value of the &#123;<span class="doctag">@code</span> Byte&#125;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@serial</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">byte</span> value;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns a &#123;<span class="doctag">@code</span> Byte&#125; instance representing the specified</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> byte&#125; value.</span></span><br><span class="line"><span class="comment">     * If a new &#123;<span class="doctag">@code</span> Byte&#125; instance is not required, this method</span></span><br><span class="line"><span class="comment">     * should generally be used in preference to the constructor</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> #Byte(byte)&#125;, as this method is likely to yield</span></span><br><span class="line"><span class="comment">     * significantly better space and time performance since</span></span><br><span class="line"><span class="comment">     * all byte values are cached.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  b a byte value.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> a &#123;<span class="doctag">@code</span> Byte&#125; instance representing &#123;<span class="doctag">@code</span> b&#125;.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span>  1.5</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Byte <span class="title">valueOf</span><span class="params">(<span class="keyword">byte</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> offset = <span class="number">128</span>;</span><br><span class="line">        <span class="keyword">return</span> ByteCache.cache[(<span class="keyword">int</span>)b + offset];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the value of this &#123;<span class="doctag">@code</span> Byte&#125; as a</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> byte&#125;.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">byte</span> <span class="title">byteValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Compares this object to the specified object.  The result is</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> true&#125; if and only if the argument is not</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> null&#125; and is a &#123;<span class="doctag">@code</span> Byte&#125; object that</span></span><br><span class="line"><span class="comment">     * contains the same &#123;<span class="doctag">@code</span> byte&#125; value as this object.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> obj       the object to compare with</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>          &#123;<span class="doctag">@code</span> true&#125; if the objects are the same;</span></span><br><span class="line"><span class="comment">     *                  &#123;<span class="doctag">@code</span> false&#125; otherwise.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Byte) &#123;</span><br><span class="line">            <span class="keyword">return</span> value == ((Byte)obj).byteValue();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="java-lang-Short"><a href="#java-lang-Short" class="headerlink" title="java.lang.Short"></a>java.lang.Short</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Short</span> <span class="keyword">extends</span> <span class="title">Number</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">Short</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The value of the &#123;<span class="doctag">@code</span> Short&#125;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@serial</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">short</span> value;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns a &#123;<span class="doctag">@code</span> Short&#125; instance representing the specified</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> short&#125; value.</span></span><br><span class="line"><span class="comment">     * If a new &#123;<span class="doctag">@code</span> Short&#125; instance is not required, this method</span></span><br><span class="line"><span class="comment">     * should generally be used in preference to the constructor</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> #Short(short)&#125;, as this method is likely to yield</span></span><br><span class="line"><span class="comment">     * significantly better space and time performance by caching</span></span><br><span class="line"><span class="comment">     * frequently requested values.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * This method will always cache values in the range -128 to 127,</span></span><br><span class="line"><span class="comment">     * inclusive, and may cache other values outside of this range.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  s a short value.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> a &#123;<span class="doctag">@code</span> Short&#125; instance representing &#123;<span class="doctag">@code</span> s&#125;.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span>  1.5</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Short <span class="title">valueOf</span><span class="params">(<span class="keyword">short</span> s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> offset = <span class="number">128</span>;</span><br><span class="line">        <span class="keyword">int</span> sAsInt = s;</span><br><span class="line">        <span class="keyword">if</span> (sAsInt &gt;= -<span class="number">128</span> &amp;&amp; sAsInt &lt;= <span class="number">127</span>) &#123; <span class="comment">// must cache</span></span><br><span class="line">            <span class="keyword">return</span> ShortCache.cache[sAsInt + offset];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Short(s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the value of this &#123;<span class="doctag">@code</span> Short&#125; as a</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> short&#125;.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">short</span> <span class="title">shortValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Compares this object to the specified object.  The result is</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> true&#125; if and only if the argument is not</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> null&#125; and is a &#123;<span class="doctag">@code</span> Short&#125; object that</span></span><br><span class="line"><span class="comment">     * contains the same &#123;<span class="doctag">@code</span> short&#125; value as this object.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> obj       the object to compare with</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>          &#123;<span class="doctag">@code</span> true&#125; if the objects are the same;</span></span><br><span class="line"><span class="comment">     *                  &#123;<span class="doctag">@code</span> false&#125; otherwise.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Short) &#123;</span><br><span class="line">            <span class="keyword">return</span> value == ((Short)obj).shortValue();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="java-lang-Integer"><a href="#java-lang-Integer" class="headerlink" title="java.lang.Integer"></a>java.lang.Integer</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Integer</span> <span class="keyword">extends</span> <span class="title">Number</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The value of the &#123;<span class="doctag">@code</span> Integer&#125;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@serial</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> value;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns an &#123;<span class="doctag">@code</span> Integer&#125; instance representing the specified</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> int&#125; value.  If a new &#123;<span class="doctag">@code</span> Integer&#125; instance is not</span></span><br><span class="line"><span class="comment">     * required, this method should generally be used in preference to</span></span><br><span class="line"><span class="comment">     * the constructor &#123;<span class="doctag">@link</span> #Integer(int)&#125;, as this method is likely</span></span><br><span class="line"><span class="comment">     * to yield significantly better space and time performance by</span></span><br><span class="line"><span class="comment">     * caching frequently requested values.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * This method will always cache values in the range -128 to 127,</span></span><br><span class="line"><span class="comment">     * inclusive, and may cache other values outside of this range.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  i an &#123;<span class="doctag">@code</span> int&#125; value.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> an &#123;<span class="doctag">@code</span> Integer&#125; instance representing &#123;<span class="doctag">@code</span> i&#125;.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span>  1.5</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title">valueOf</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high)</span><br><span class="line">            <span class="keyword">return</span> IntegerCache.cache[i + (-IntegerCache.low)];</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Integer(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the value of this &#123;<span class="doctag">@code</span> Integer&#125; as an</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> int&#125;.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">intValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Compares this object to the specified object.  The result is</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> true&#125; if and only if the argument is not</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> null&#125; and is an &#123;<span class="doctag">@code</span> Integer&#125; object that</span></span><br><span class="line"><span class="comment">     * contains the same &#123;<span class="doctag">@code</span> int&#125; value as this object.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>   obj   the object to compare with.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  &#123;<span class="doctag">@code</span> true&#125; if the objects are the same;</span></span><br><span class="line"><span class="comment">     *          &#123;<span class="doctag">@code</span> false&#125; otherwise.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Integer) &#123;</span><br><span class="line">            <span class="keyword">return</span> value == ((Integer)obj).intValue();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="java-lang-Long"><a href="#java-lang-Long" class="headerlink" title="java.lang.Long"></a>java.lang.Long</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Long</span> <span class="keyword">extends</span> <span class="title">Number</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The value of the &#123;<span class="doctag">@code</span> Long&#125;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@serial</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> value;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns a &#123;<span class="doctag">@code</span> Long&#125; instance representing the specified</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> long&#125; value.</span></span><br><span class="line"><span class="comment">     * If a new &#123;<span class="doctag">@code</span> Long&#125; instance is not required, this method</span></span><br><span class="line"><span class="comment">     * should generally be used in preference to the constructor</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> #Long(long)&#125;, as this method is likely to yield</span></span><br><span class="line"><span class="comment">     * significantly better space and time performance by caching</span></span><br><span class="line"><span class="comment">     * frequently requested values.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Note that unlike the &#123;<span class="doctag">@linkplain</span> valueOf(int)</span></span><br><span class="line"><span class="comment">     * corresponding method&#125; in the &#123;<span class="doctag">@code</span> Integer&#125; class, this method</span></span><br><span class="line"><span class="comment">     * is &lt;em&gt;not&lt;/em&gt; required to cache values within a particular</span></span><br><span class="line"><span class="comment">     * range.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  l a long value.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> a &#123;<span class="doctag">@code</span> Long&#125; instance representing &#123;<span class="doctag">@code</span> l&#125;.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span>  1.5</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title">valueOf</span><span class="params">(<span class="keyword">long</span> l)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> offset = <span class="number">128</span>;</span><br><span class="line">        <span class="keyword">if</span> (l &gt;= -<span class="number">128</span> &amp;&amp; l &lt;= <span class="number">127</span>) &#123; <span class="comment">// will cache</span></span><br><span class="line">            <span class="keyword">return</span> LongCache.cache[(<span class="keyword">int</span>)l + offset];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Long(l);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the value of this &#123;<span class="doctag">@code</span> Long&#125; as a</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> long&#125; value.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">longValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Compares this object to the specified object.  The result is</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> true&#125; if and only if the argument is not</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> null&#125; and is a &#123;<span class="doctag">@code</span> Long&#125; object that</span></span><br><span class="line"><span class="comment">     * contains the same &#123;<span class="doctag">@code</span> long&#125; value as this object.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>   obj   the object to compare with.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  &#123;<span class="doctag">@code</span> true&#125; if the objects are the same;</span></span><br><span class="line"><span class="comment">     *          &#123;<span class="doctag">@code</span> false&#125; otherwise.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Long) &#123;</span><br><span class="line">            <span class="keyword">return</span> value == ((Long)obj).longValue();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="java-lang-Float"><a href="#java-lang-Float" class="headerlink" title="java.lang.Float"></a>java.lang.Float</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Float</span> <span class="keyword">extends</span> <span class="title">Number</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">Float</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The value of the Float.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@serial</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">float</span> value;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns a &#123;<span class="doctag">@code</span> Float&#125; instance representing the specified</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> float&#125; value.</span></span><br><span class="line"><span class="comment">     * If a new &#123;<span class="doctag">@code</span> Float&#125; instance is not required, this method</span></span><br><span class="line"><span class="comment">     * should generally be used in preference to the constructor</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> #Float(float)&#125;, as this method is likely to yield</span></span><br><span class="line"><span class="comment">     * significantly better space and time performance by caching</span></span><br><span class="line"><span class="comment">     * frequently requested values.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  f a float value.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> a &#123;<span class="doctag">@code</span> Float&#125; instance representing &#123;<span class="doctag">@code</span> f&#125;.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span>  1.5</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Float <span class="title">valueOf</span><span class="params">(<span class="keyword">float</span> f)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Float(f);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     * Compares this object against the specified object.  The result</span></span><br><span class="line"><span class="comment">     * is &#123;<span class="doctag">@code</span> true&#125; if and only if the argument is not</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> null&#125; and is a &#123;<span class="doctag">@code</span> Float&#125; object that</span></span><br><span class="line"><span class="comment">     * represents a &#123;<span class="doctag">@code</span> float&#125; with the same value as the</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> float&#125; represented by this object. For this</span></span><br><span class="line"><span class="comment">     * purpose, two &#123;<span class="doctag">@code</span> float&#125; values are considered to be the</span></span><br><span class="line"><span class="comment">     * same if and only if the method &#123;<span class="doctag">@link</span> #floatToIntBits(float)&#125;</span></span><br><span class="line"><span class="comment">     * returns the identical &#123;<span class="doctag">@code</span> int&#125; value when applied to</span></span><br><span class="line"><span class="comment">     * each.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;Note that in most cases, for two instances of class</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> Float&#125;, &#123;<span class="doctag">@code</span> f1&#125; and &#123;<span class="doctag">@code</span> f2&#125;, the value</span></span><br><span class="line"><span class="comment">     * of &#123;<span class="doctag">@code</span> f1.equals(f2)&#125; is &#123;<span class="doctag">@code</span> true&#125; if and only if</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;blockquote&gt;&lt;pre&gt;</span></span><br><span class="line"><span class="comment">     *   f1.floatValue() == f2.floatValue()</span></span><br><span class="line"><span class="comment">     * &lt;/pre&gt;&lt;/blockquote&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;also has the value &#123;<span class="doctag">@code</span> true&#125;. However, there are two exceptions:</span></span><br><span class="line"><span class="comment">     * &lt;ul&gt;</span></span><br><span class="line"><span class="comment">     * &lt;li&gt;If &#123;<span class="doctag">@code</span> f1&#125; and &#123;<span class="doctag">@code</span> f2&#125; both represent</span></span><br><span class="line"><span class="comment">     *     &#123;<span class="doctag">@code</span> Float.NaN&#125;, then the &#123;<span class="doctag">@code</span> equals&#125; method returns</span></span><br><span class="line"><span class="comment">     *     &#123;<span class="doctag">@code</span> true&#125;, even though &#123;<span class="doctag">@code</span> Float.NaN==Float.NaN&#125;</span></span><br><span class="line"><span class="comment">     *     has the value &#123;<span class="doctag">@code</span> false&#125;.</span></span><br><span class="line"><span class="comment">     * &lt;li&gt;If &#123;<span class="doctag">@code</span> f1&#125; represents &#123;<span class="doctag">@code</span> +0.0f&#125; while</span></span><br><span class="line"><span class="comment">     *     &#123;<span class="doctag">@code</span> f2&#125; represents &#123;<span class="doctag">@code</span> -0.0f&#125;, or vice</span></span><br><span class="line"><span class="comment">     *     versa, the &#123;<span class="doctag">@code</span> equal&#125; test has the value</span></span><br><span class="line"><span class="comment">     *     &#123;<span class="doctag">@code</span> false&#125;, even though &#123;<span class="doctag">@code</span> 0.0f==-0.0f&#125;</span></span><br><span class="line"><span class="comment">     *     has the value &#123;<span class="doctag">@code</span> true&#125;.</span></span><br><span class="line"><span class="comment">     * &lt;/ul&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * This definition allows hash tables to operate properly.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> obj the object to be compared</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  &#123;<span class="doctag">@code</span> true&#125; if the objects are the same;</span></span><br><span class="line"><span class="comment">     *          &#123;<span class="doctag">@code</span> false&#125; otherwise.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> java.lang.floatToIntBits(float)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (obj <span class="keyword">instanceof</span> Float)</span><br><span class="line">               &amp;&amp; (floatToIntBits(((Float)obj).value) == floatToIntBits(value));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="java-lang-Double"><a href="#java-lang-Double" class="headerlink" title="java.lang.Double"></a>java.lang.Double</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Double</span> <span class="keyword">extends</span> <span class="title">Number</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">Double</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The value of the Double.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@serial</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">double</span> value;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns a &#123;<span class="doctag">@code</span> Double&#125; instance representing the specified</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> double&#125; value.</span></span><br><span class="line"><span class="comment">     * If a new &#123;<span class="doctag">@code</span> Double&#125; instance is not required, this method</span></span><br><span class="line"><span class="comment">     * should generally be used in preference to the constructor</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> #Double(double)&#125;, as this method is likely to yield</span></span><br><span class="line"><span class="comment">     * significantly better space and time performance by caching</span></span><br><span class="line"><span class="comment">     * frequently requested values.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  d a double value.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> a &#123;<span class="doctag">@code</span> Double&#125; instance representing &#123;<span class="doctag">@code</span> d&#125;.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span>  1.5</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Double <span class="title">valueOf</span><span class="params">(<span class="keyword">double</span> d)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Double(d);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Compares this object against the specified object.  The result</span></span><br><span class="line"><span class="comment">     * is &#123;<span class="doctag">@code</span> true&#125; if and only if the argument is not</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> null&#125; and is a &#123;<span class="doctag">@code</span> Double&#125; object that</span></span><br><span class="line"><span class="comment">     * represents a &#123;<span class="doctag">@code</span> double&#125; that has the same value as the</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> double&#125; represented by this object. For this</span></span><br><span class="line"><span class="comment">     * purpose, two &#123;<span class="doctag">@code</span> double&#125; values are considered to be</span></span><br><span class="line"><span class="comment">     * the same if and only if the method &#123;<span class="doctag">@link</span></span></span><br><span class="line"><span class="comment">     * #doubleToLongBits(double)&#125; returns the identical</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> long&#125; value when applied to each.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;Note that in most cases, for two instances of class</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> Double&#125;, &#123;<span class="doctag">@code</span> d1&#125; and &#123;<span class="doctag">@code</span> d2&#125;, the</span></span><br><span class="line"><span class="comment">     * value of &#123;<span class="doctag">@code</span> d1.equals(d2)&#125; is &#123;<span class="doctag">@code</span> true&#125; if and</span></span><br><span class="line"><span class="comment">     * only if</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;blockquote&gt;</span></span><br><span class="line"><span class="comment">     *  &#123;<span class="doctag">@code</span> d1.doubleValue() == d2.doubleValue()&#125;</span></span><br><span class="line"><span class="comment">     * &lt;/blockquote&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;also has the value &#123;<span class="doctag">@code</span> true&#125;. However, there are two</span></span><br><span class="line"><span class="comment">     * exceptions:</span></span><br><span class="line"><span class="comment">     * &lt;ul&gt;</span></span><br><span class="line"><span class="comment">     * &lt;li&gt;If &#123;<span class="doctag">@code</span> d1&#125; and &#123;<span class="doctag">@code</span> d2&#125; both represent</span></span><br><span class="line"><span class="comment">     *     &#123;<span class="doctag">@code</span> Double.NaN&#125;, then the &#123;<span class="doctag">@code</span> equals&#125; method</span></span><br><span class="line"><span class="comment">     *     returns &#123;<span class="doctag">@code</span> true&#125;, even though</span></span><br><span class="line"><span class="comment">     *     &#123;<span class="doctag">@code</span> Double.NaN==Double.NaN&#125; has the value</span></span><br><span class="line"><span class="comment">     *     &#123;<span class="doctag">@code</span> false&#125;.</span></span><br><span class="line"><span class="comment">     * &lt;li&gt;If &#123;<span class="doctag">@code</span> d1&#125; represents &#123;<span class="doctag">@code</span> +0.0&#125; while</span></span><br><span class="line"><span class="comment">     *     &#123;<span class="doctag">@code</span> d2&#125; represents &#123;<span class="doctag">@code</span> -0.0&#125;, or vice versa,</span></span><br><span class="line"><span class="comment">     *     the &#123;<span class="doctag">@code</span> equal&#125; test has the value &#123;<span class="doctag">@code</span> false&#125;,</span></span><br><span class="line"><span class="comment">     *     even though &#123;<span class="doctag">@code</span> +0.0==-0.0&#125; has the value &#123;<span class="doctag">@code</span> true&#125;.</span></span><br><span class="line"><span class="comment">     * &lt;/ul&gt;</span></span><br><span class="line"><span class="comment">     * This definition allows hash tables to operate properly.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>   obj   the object to compare with.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  &#123;<span class="doctag">@code</span> true&#125; if the objects are the same;</span></span><br><span class="line"><span class="comment">     *          &#123;<span class="doctag">@code</span> false&#125; otherwise.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> java.lang.Double#doubleToLongBits(double)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (obj <span class="keyword">instanceof</span> Double)</span><br><span class="line">               &amp;&amp; (doubleToLongBits(((Double)obj).value) ==</span><br><span class="line">                      doubleToLongBits(value));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="java-lang-Boolean"><a href="#java-lang-Boolean" class="headerlink" title="java.lang.Boolean"></a>java.lang.Boolean</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Boolean</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span>, <span class="title">Comparable</span>&lt;<span class="title">Boolean</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The value of the Boolean.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@serial</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> value;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns a &#123;<span class="doctag">@code</span> Boolean&#125; instance representing the specified</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> boolean&#125; value.  If the specified &#123;<span class="doctag">@code</span> boolean&#125; value</span></span><br><span class="line"><span class="comment">     * is &#123;<span class="doctag">@code</span> true&#125;, this method returns &#123;<span class="doctag">@code</span> Boolean.TRUE&#125;;</span></span><br><span class="line"><span class="comment">     * if it is &#123;<span class="doctag">@code</span> false&#125;, this method returns &#123;<span class="doctag">@code</span> Boolean.FALSE&#125;.</span></span><br><span class="line"><span class="comment">     * If a new &#123;<span class="doctag">@code</span> Boolean&#125; instance is not required, this method</span></span><br><span class="line"><span class="comment">     * should generally be used in preference to the constructor</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> #Boolean(boolean)&#125;, as this method is likely to yield</span></span><br><span class="line"><span class="comment">     * significantly better space and time performance.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  b a boolean value.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> a &#123;<span class="doctag">@code</span> Boolean&#125; instance representing &#123;<span class="doctag">@code</span> b&#125;.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span>  1.4</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Boolean <span class="title">valueOf</span><span class="params">(<span class="keyword">boolean</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (b ? TRUE : FALSE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the value of this &#123;<span class="doctag">@code</span> Boolean&#125; object as a boolean</span></span><br><span class="line"><span class="comment">     * primitive.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  the primitive &#123;<span class="doctag">@code</span> boolean&#125; value of this object.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">booleanValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns &#123;<span class="doctag">@code</span> true&#125; if and only if the argument is not</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> null&#125; and is a &#123;<span class="doctag">@code</span> Boolean&#125; object that</span></span><br><span class="line"><span class="comment">     * represents the same &#123;<span class="doctag">@code</span> boolean&#125; value as this object.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>   obj   the object to compare with.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  &#123;<span class="doctag">@code</span> true&#125; if the Boolean objects represent the</span></span><br><span class="line"><span class="comment">     *          same value; &#123;<span class="doctag">@code</span> false&#125; otherwise.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Boolean) &#123;</span><br><span class="line">            <span class="keyword">return</span> value == ((Boolean)obj).booleanValue();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="java-lang-Character"><a href="#java-lang-Character" class="headerlink" title="java.lang.Character"></a>java.lang.Character</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Character</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span>, <span class="title">Comparable</span>&lt;<span class="title">Character</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The value of the &#123;<span class="doctag">@code</span> Character&#125;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@serial</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">char</span> value;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns a &lt;tt&gt;Character&lt;/tt&gt; instance representing the specified</span></span><br><span class="line"><span class="comment">     * &lt;tt&gt;char&lt;/tt&gt; value.</span></span><br><span class="line"><span class="comment">     * If a new &lt;tt&gt;Character&lt;/tt&gt; instance is not required, this method</span></span><br><span class="line"><span class="comment">     * should generally be used in preference to the constructor</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> #Character(char)&#125;, as this method is likely to yield</span></span><br><span class="line"><span class="comment">     * significantly better space and time performance by caching</span></span><br><span class="line"><span class="comment">     * frequently requested values.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * This method will always cache values in the range &#123;<span class="doctag">@code</span></span></span><br><span class="line"><span class="comment">     * '\u005Cu0000'&#125; to &#123;<span class="doctag">@code</span> '\u005Cu007F'&#125;, inclusive, and may</span></span><br><span class="line"><span class="comment">     * cache other values outside of this range.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  c a char value.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> a &lt;tt&gt;Character&lt;/tt&gt; instance representing &lt;tt&gt;c&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span>  1.5</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Character <span class="title">valueOf</span><span class="params">(<span class="keyword">char</span> c)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (c &lt;= <span class="number">127</span>) &#123; <span class="comment">// must cache</span></span><br><span class="line">            <span class="keyword">return</span> CharacterCache.cache[(<span class="keyword">int</span>)c];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Character(c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the value of this &#123;<span class="doctag">@code</span> Character&#125; object.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  the primitive &#123;<span class="doctag">@code</span> char&#125; value represented by</span></span><br><span class="line"><span class="comment">     *          this object.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">char</span> <span class="title">charValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Compares this object against the specified object.</span></span><br><span class="line"><span class="comment">     * The result is &#123;<span class="doctag">@code</span> true&#125; if and only if the argument is not</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> null&#125; and is a &#123;<span class="doctag">@code</span> Character&#125; object that</span></span><br><span class="line"><span class="comment">     * represents the same &#123;<span class="doctag">@code</span> char&#125; value as this object.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>   obj   the object to compare with.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  &#123;<span class="doctag">@code</span> true&#125; if the objects are the same;</span></span><br><span class="line"><span class="comment">     *          &#123;<span class="doctag">@code</span> false&#125; otherwise.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Character) &#123;</span><br><span class="line">            <span class="keyword">return</span> value == ((Character)obj).charValue();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>《Effective Java 第三版》</p>
<ul>
<li>第 44 条：坚持使用标准的函数接口</li>
<li>第 61 条：基本类型优先于装箱基本类型</li>
</ul>
<p>《Java 8 函数式编程》</p>
<p>《Java 8 实战》</p>
<p><a href="https://docs.oracle.com/javase/tutorial/java/data/autoboxing.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/tutorial/java/data/autoboxing.html</a></p>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzI3NzE0NjcwMg==&mid=2650121987&idx=1&sn=70bba3f7f42a269eeada9cecb34c10a5&chksm=f36bba22c41c3334b92f184e402f2f77e2d5e0a2e0a21ec5a8229773afcab4f026a0b6f47fc4&scene=21" target="_blank" rel="noopener">一文读懂什么是Java中的自动拆装箱</a></p>
</div></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2018/03/27/mybatis-advanced-result-maps/" class="post-title-link">Java 数据持久化系列（七）MyBatis 高级结果映射</a></h2><div class="post-info">2018-03-27<a href="/tags/Java/" title="Java" class="post-demo">Java</a></div><div class="post-content"><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>高级结果映射常用的两种方式：</p>
<ul>
<li>嵌套结果映射，即利用表连接语法进行一次性的嵌套查询；</li>
<li>嵌套查询，即分开多次查询。注意 <code>association</code> 多对一关联存在 N+1 查询的性能问题，禁用。</li>
</ul>
<p>以 <code>collection</code> 一对多关联为例，两种配置区别如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 一对多嵌套结果映射。注意表连接查询字段务必使用 AS 别名，避免手工映射时 column 取错列 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"ExtendResultMap"</span> <span class="attr">extends</span>=<span class="string">"BaseResultMap"</span> <span class="attr">type</span>=<span class="string">"...XxxQO"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"extendList"</span> <span class="attr">columnPrefix</span>=<span class="string">"sub_task_"</span> <span class="attr">resultMap</span>=<span class="string">"...XxxMapper.BaseResultMap"</span> <span class="attr">ofType</span>=<span class="string">"...XxxPO"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 一对多嵌套查询，column 为嵌套查询的参数列，即“一”方的列 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"ExtendResultMap"</span> <span class="attr">extends</span>=<span class="string">"BaseResultMap"</span> <span class="attr">type</span>=<span class="string">"...XxxQO"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"extendList"</span> <span class="attr">column</span>=<span class="string">"task_no"</span> <span class="attr">select</span>=<span class="string">"...XxxMapper.getByTaskNo"</span> <span class="attr">ofType</span>=<span class="string">"...XxxPO"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h1><p>下面提供一个例子，涉及的关联关系如下：学生多对一关联学校、一对多关联书本：</p>
<p><code>StudentMapper.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;StudentQO&gt; <span class="title">listStudents</span><span class="params">(<span class="keyword">int</span> age)</span></span>;</span><br></pre></td></tr></table></figure>

<p><code>StudentQO.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@ToString</span>(callSuper = <span class="keyword">true</span>)</span><br><span class="line"><span class="meta">@EqualsAndHashCode</span>(callSuper = <span class="keyword">true</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentQO</span> <span class="keyword">extends</span> <span class="title">StudentPO</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 多对一关联学校</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> SchoolPO school;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 一对多关联书本</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;BookPO&gt; books;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>StudentMapper.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">"Base_column_list"</span>&gt;</span></span><br><span class="line">    T.id,</span><br><span class="line">    ......</span><br><span class="line">    T.create_time,</span><br><span class="line">    T.update_time,</span><br><span class="line">    T.version</span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">"Extend_column_list"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">"Base_column_list"</span> /&gt;</span></span><br><span class="line">    ,</span><br><span class="line">    <span class="comment">&lt;!-- 见 SchoolMapper.xml --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">"com.test.school.mapper.SchoolMapper.Base_Column_List"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"BaseResultMap"</span> <span class="attr">type</span>=<span class="string">"com.test.student.po.StudentPO"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">jdbcType</span>=<span class="string">"BIGINT"</span>/&gt;</span></span><br><span class="line">    ......</span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"create_time"</span> <span class="attr">property</span>=<span class="string">"createTime"</span> <span class="attr">jdbcType</span>=<span class="string">"TIMESTAMP"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"update_time"</span> <span class="attr">property</span>=<span class="string">"updateTime"</span> <span class="attr">jdbcType</span>=<span class="string">"TIMESTAMP"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"version"</span> <span class="attr">property</span>=<span class="string">"version"</span> <span class="attr">jdbcType</span>=<span class="string">"TINYINT"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"ExtendResultMap"</span> <span class="attr">extends</span>=<span class="string">"BaseResultMap"</span> <span class="attr">type</span>=<span class="string">"com.test.student.qo.StudentQO"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用嵌套结果映射，即利用表连接语法进行一次性的嵌套查询。resultMap 配置见 SchoolMapper.xml --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"school"</span> <span class="attr">columnPrefix</span>=<span class="string">"school_"</span> <span class="attr">resultMap</span>=<span class="string">"com.test.school.mapper.SchoolMapper.BaseResultMap"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用嵌套查询，即分开多次查询。column 为嵌套查询的参数列，select 引用见 BookMapper.xml --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"books"</span> <span class="attr">column</span>=<span class="string">"student_no"</span> <span class="attr">select</span>=<span class="string">"com.test.book.mapper.BookMapper.getByStudentNo"</span> <span class="attr">ofType</span>=<span class="string">"com.test.book.po.BookPO"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 使用表连接嵌套查询学生、学校 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"listStudents"</span> <span class="attr">resultMap</span>=<span class="string">"ExtendResultMap"</span>&gt;</span></span><br><span class="line">    SELECT</span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">"Extend_column_list"</span> /&gt;</span></span><br><span class="line">    FROM t_student T</span><br><span class="line">        INNER JOIN t_school E</span><br><span class="line">        ON T.school_no = E.school_no</span><br><span class="line">    WHERE T.age = #&#123;age&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>SchoolMapper.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">"Base_Column_List"</span>&gt;</span></span><br><span class="line">    E.id AS school_id,</span><br><span class="line">    ......</span><br><span class="line">    E.create_time AS school_create_time,</span><br><span class="line">    E.update_time AS school_update_time</span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"BaseResultMap"</span> <span class="attr">type</span>=<span class="string">"com.test.school.po.SchoolPO"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">jdbcType</span>=<span class="string">"BIGINT"</span>/&gt;</span></span><br><span class="line">    ......</span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"create_time"</span> <span class="attr">property</span>=<span class="string">"createTime"</span> <span class="attr">jdbcType</span>=<span class="string">"TIMESTAMP"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"update_time"</span> <span class="attr">property</span>=<span class="string">"updateTime"</span> <span class="attr">jdbcType</span>=<span class="string">"TIMESTAMP"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure></div></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2018/03/24/mybatis/" class="post-title-link">Java 数据持久化系列（六）MyBatis 框架解析</a></h2><div class="post-info">2018-03-24<a href="/tags/Java/" title="Java" class="post-demo">Java</a></div><div class="post-content"><p>MyBatis 在 Java 业务开发领域可以说是首选的持久化框架，本文主要总结下 MyBatis 的核心配置和源码解析。</p>
<h1 id="MyBatis-产品组成"><a href="#MyBatis-产品组成" class="headerlink" title="MyBatis 产品组成"></a>MyBatis 产品组成</h1><p>MyBatis 常用的产品组成汇总如下：</p>
<p><img src="/img/mybatis/mybatis_products.png" alt="MyBatis Products"></p>
<h1 id="MyBatis-核心总结"><a href="#MyBatis-核心总结" class="headerlink" title="MyBatis 核心总结"></a>MyBatis 核心总结</h1><p><img src="/img/mybatis/mybatis_core.png" alt="MyBatis Core"></p>
<h1 id="MyBatis-核心架构"><a href="#MyBatis-核心架构" class="headerlink" title="MyBatis 核心架构"></a>MyBatis 核心架构</h1><p><img src="/img/mybatis/mybatis_core_architecture.png" alt=""></p>
<p><img src="/img/mybatis/mybatis_core_architecture_2.png" alt=""></p>
<p>MyBatis 语句执行时的层次结构：</p>
<p><img src="/img/mybatis/mybatis_core_architecture_3.jpg" alt=""></p>
<p>涉及的主要 API 如下：</p>
<p><img src="/img/mybatis/mybatis-api.png" alt="mybatis-api"></p>
<h2 id="Executor"><a href="#Executor" class="headerlink" title="Executor"></a>Executor</h2><p><img src="/img/mybatis/mybatis_api_Executor.png" alt="mybatis_api_Executor"></p>
<h2 id="StatementHandler"><a href="#StatementHandler" class="headerlink" title="StatementHandler"></a>StatementHandler</h2><p><img src="/img/mybatis/mybatis_api_StatementHandler.png" alt="mybatis_api_StatementHandler"></p>
<h2 id="ParameterHandler"><a href="#ParameterHandler" class="headerlink" title="ParameterHandler"></a>ParameterHandler</h2><p><img src="/img/mybatis/mybatis_api_ParameterHandler.png" alt="mybatis_api_ParameterHandler"></p>
<h2 id="ResultSetHandler"><a href="#ResultSetHandler" class="headerlink" title="ResultSetHandler"></a>ResultSetHandler</h2><p><img src="/img/mybatis/mybatis_api_ResultSetHandler.png" alt="mybatis_api_ResultSetHandler"></p>
<h2 id="TypeHandler"><a href="#TypeHandler" class="headerlink" title="TypeHandler"></a>TypeHandler</h2><p><img src="/img/mybatis/mybatis_api_TypeHandler.png" alt="mybatis_api_TypeHandler"></p>
<h1 id="Spring-整合"><a href="#Spring-整合" class="headerlink" title="Spring 整合"></a>Spring 整合</h1><h2 id="依赖安装"><a href="#依赖安装" class="headerlink" title="依赖安装"></a>依赖安装</h2><p>基础依赖安装：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- MyBatis --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>x.x.x<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Spring 整合依赖安装：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- MyBatis Spring --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>x.x.x<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- MyBatis Spring Boot Starter --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>x.x.x<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Spring-Bean-配置"><a href="#Spring-Bean-配置" class="headerlink" title="Spring Bean 配置"></a>Spring Bean 配置</h2><p>MyBatis-Spring 中，<code>SqlSessionFactoryBean</code> 用于创建 <code>SqlSessionFactory</code>。可通过 Spring 的 XML 配置文件或 Java Config 配置该工厂 bean：</p>
<h3 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置 MyBatis 的 sqlSessionFactory。MyBatis Plus 使用 com.baomidou.mybatisplus.spring.MybatisSqlSessionFactoryBean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span> <span class="attr">value</span>=<span class="string">"classpath:mybatis-config.xml"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- DAO接口所在包名，Spring 会自动查找其下的类 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"com.example.dao"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlSessionFactoryBeanName"</span> <span class="attr">value</span>=<span class="string">"sqlSessionFactory"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Java-Config"><a href="#Java-Config" class="headerlink" title="Java Config"></a>Java Config</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.SqlSessionFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.mapper.MapperScannerConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@MapperScan</span>(basePackages = &#123;<span class="string">"..."</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用于创建 SqlSessionFactory，以便获取 SqlSession</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SqlSessionFactoryBean <span class="title">sqlSessionFactory</span><span class="params">(DataSource dataSource)</span> </span>&#123;</span><br><span class="line">        SqlSessionFactoryBean factoryBean = <span class="keyword">new</span> SqlSessionFactoryBean();</span><br><span class="line">        factoryBean.setDataSource(dataSource);</span><br><span class="line">        factoryBean.setConfigLocation(configLocation);</span><br><span class="line">        factoryBean.setMapperLocations(resource);</span><br><span class="line">        <span class="keyword">return</span> factoryBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@MapperScan</span> 或 MapperScannerConfigurer 二选一配置</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MapperScannerConfigurer <span class="title">mapperScannerConfigurer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        MapperScannerConfigurer mapperScannerConfigurer = <span class="keyword">new</span> MapperScannerConfigurer();</span><br><span class="line">        mapperScannerConfigurer.setBasePackage(basePackage);</span><br><span class="line">        <span class="keyword">return</span> mapperScannerConfigurer;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Spring-Boot"><a href="#Spring-Boot" class="headerlink" title="Spring Boot"></a>Spring Boot</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>x.x.x<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><a href="http://www.mybatis.org/spring-boot-starter/mybatis-spring-boot-autoconfigure/" target="_blank" rel="noopener">http://www.mybatis.org/spring-boot-starter/mybatis-spring-boot-autoconfigure/</a></p>
<h1 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h1><h2 id="基于-Statement-ID-的传统方式"><a href="#基于-Statement-ID-的传统方式" class="headerlink" title="基于 Statement ID 的传统方式"></a>基于 Statement ID 的传统方式</h2><p><img src="/img/mybatis/mybatis_statement_id.jpg" alt="mybatis_statement_id"></p>
<h2 id="基于-Mapper-接口的推荐方式"><a href="#基于-Mapper-接口的推荐方式" class="headerlink" title="基于 Mapper 接口的推荐方式"></a>基于 Mapper 接口的推荐方式</h2><p><img src="/img/mybatis/mybatis_mapper.jpg" alt="mybatis_mapper"></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="http://www.mybatis.org/" target="_blank" rel="noopener">http://www.mybatis.org/</a></p>
<p><a href="https://github.com/mybatis" target="_blank" rel="noopener">https://github.com/mybatis</a></p>
<p>《MyBatis 从入门到精通》</p>
<p>《MyBatis 技术内幕》</p>
</div></article></li></ul><div class="right-container"><div class="widget"><div class="tagcloud"><h4>标签云</h4><a href="/tags/C-C/" style="font-size: 15px;">C/C++</a> <a href="/tags/DNS/" style="font-size: 12.5px;">DNS</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/GNU-Linux/" style="font-size: 16.67px;">GNU/Linux</a> <a href="/tags/Git/" style="font-size: 17.5px;">Git</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/MySQL/" style="font-size: 19.17px;">MySQL</a> <a href="/tags/Nginx/" style="font-size: 11.67px;">Nginx</a> <a href="/tags/Redis/" style="font-size: 10.83px;">Redis</a> <a href="/tags/Spring/" style="font-size: 15.83px;">Spring</a> <a href="/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" style="font-size: 11.67px;">函数式编程</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 18.33px;">前端</a> <a href="/tags/%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B/" style="font-size: 11.67px;">响应式编程</a> <a href="/tags/%E5%AE%89%E5%85%A8/" style="font-size: 12.5px;">安全</a> <a href="/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" style="font-size: 11.67px;">并发编程</a> <a href="/tags/%E5%BB%BA%E7%AB%99/" style="font-size: 13.33px;">建站</a> <a href="/tags/%E7%AE%A1%E7%90%86/" style="font-size: 12.5px;">管理</a> <a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" style="font-size: 14.17px;">读书笔记</a> <a href="/tags/%E9%87%91%E8%9E%8D/" style="font-size: 12.5px;">金融</a></div></div><div class="widget"><div class="recent"><h4>最近文章</h4><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2021/02/26/cpp-io-library/">C/C++ 语言系列（十一）I/O 库总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/25/cpp-oop-inheritance-and-polymorphism/">C/C++ 语言系列（十）面向对象编程之继承与多态</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/20/cpp-oop-class/">C/C++ 语言系列（九）面向对象编程之类、类模板、类指针</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/18/cpp-type-aliases/">C/C++ 语言系列（八）复合数据类型之类型别名</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/16/cpp-struct/">C/C++ 语言系列（七）复合数据类型之结构体</a></li></ul></div></div></div></section></div><div class="right-menu"></div><div class="modal search-modal"><div class="input-field"><input type="text" id="search_input"><label for="search-input">搜索</label></div><div id="search_result" class="search-result"></div></div><div class="blog-overlay"></div><footer class="row"><div class="footer-con"><div class="paginator"><a href="/page/7/" class="prev">PREV</a><a href="/page/9/" class="next">NEXT</a></div><div class="copyright"><p>© 2014 - 2021 <a href="https://github.com/qidawu" target="_blank">Qida's Blog</a></p><p>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <br> and <a href="https://github.com/Bulandent/hexo-theme-bubuzou" target="_blank">hexo-theme-bubuzou</a></p></div><div class="totop"><i></i></div></div></footer><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src="/scripts/jquery-1.8.2.min.js"></script><script src="https://cdn1.lncld.net/static/js/av-mini-0.6.10.js"></script><script src="/scripts/hit-kounter-lc-0.2.0.js"></script><script src="/scripts/arAnchor.js"></script><script src="/scripts/main.js"></script></body></html>