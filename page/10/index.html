<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content="1EB8XoOl0C"><meta name="google-site-verification" content="K7thEgdLm0UfRWJ5MGdF7sCcjClSzAlxFLPv2Oz5CGM"><title> Qida's Blog</title><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="学习笔记 知识总结 思考感悟"><meta name="keywords"><meta name="author" content="Qida's Blog"><link rel="short icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/bubuzou.css"><link rel="search" type="application/opensearchdescription+xml" href="https://qidawu.github.io/atom.xml" title="Qida's Blog"><meta name="generator" content="Hexo 4.2.1"></head><body><header><div class="header row"> <a href="/" class="logo-link"><img src="/images/logo.png"></a><a href="/" class="title-link">Qida's Blog</a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" data-hover="博文" class="nav-list-link">博文</a></li><li class="nav-list-item"><a href="/archives/" target="_self" data-hover="归档" class="nav-list-link">归档</a></li></ul><div class="search"><a id="search_btn" href="#search"></a></div></div></header><div class="row scroll-con"><section class="container"><!-- for archive page--><ul class="home post-list"><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2017/12/25/apache-commons-lang/" class="post-title-link">Java 开发必备类库 Apache Commons Lang</a></h2><div class="post-info">2017-12-25<a href="/tags/Java/" title="Java" class="post-demo">Java</a></div><div class="post-content"><p>Apache Commons 是一个 Apache 项目，专注于可重用 Java 组件的方方面面。</p>
<p>Apache Commons 项目由三个部分组成：</p>
<p><img src="/img/java/commons/apache-commons.png" alt="Apache Commons">   </p>
<p>其中，Apache Commons Lang 是 Java 开发过程中很常用的一个类库，可以理解为它是对 Java Lang and Util Base  Libraries 的增强。</p>
<p>Commons Lang 安装方法：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.commons/commons-lang3 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>x.x.x<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Commons Lang 总览：</p>
<p><img src="/img/java/commons/commons-lang/commons-lang.png" alt="Commons Lang"></p>
<p>Commons Lang 提供了以下 package：</p>
<ul>
<li><code>org.apache.commons.lang3</code></li>
<li><code>org.apache.commons.lang3.builder</code></li>
<li><code>org.apache.commons.lang3.concurrent</code></li>
<li><code>org.apache.commons.lang3.event</code></li>
<li><code>org.apache.commons.lang3.exception</code></li>
<li><code>org.apache.commons.lang3.math</code></li>
<li><code>org.apache.commons.lang3.mutable</code></li>
<li><code>org.apache.commons.lang3.reflect</code></li>
<li><code>org.apache.commons.lang3.text</code></li>
<li><code>org.apache.commons.lang3.text.translate</code></li>
<li><code>org.apache.commons.lang3.time</code></li>
<li><code>org.apache.commons.lang3.tuple</code></li>
</ul>
<p>下面重点来看下最常用的几个工具：</p>
<p><code>org.apache.commons.lang3</code></p>
<ul>
<li><code>StringUtils</code></li>
<li><code>ArrayUtils</code></li>
<li><code>BooleanUtils</code></li>
</ul>
<h1 id="StringUtils"><a href="#StringUtils" class="headerlink" title="StringUtils"></a>StringUtils</h1><p><img src="/img/java/commons/commons-lang/StringUtils.png" alt="StringUtils"></p>
<h2 id="判空函数"><a href="#判空函数" class="headerlink" title="判空函数"></a>判空函数</h2><p>API：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">StringUtils.isEmpty(String str)</span><br><span class="line">StringUtils.isNotEmpty(String str)</span><br><span class="line">StringUtils.isBlank(String str)</span><br><span class="line">StringUtils.isNotBlank(String str)</span><br><span class="line">StringUtils.isAnyBlank(CharSequence… css)</span><br><span class="line">StringUtils.isAnyEmpty(CharSequence… css)</span><br><span class="line">StringUtils.isNoneBlank(CharSequence… css)</span><br><span class="line">StringUtils.isNoneEmpty(CharSequence… css)</span><br><span class="line">StringUtils.isWhitespace(CharSequence cs)</span><br></pre></td></tr></table></figure>

<p>看下 <code>isBlank</code> 和 <code>isEmpty</code> 的区别：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">StringUtils.isBlank(<span class="keyword">null</span>) <span class="comment">// true</span></span><br><span class="line">StringUtils.isEmpty(<span class="keyword">null</span>) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">StringUtils.isBlank(<span class="string">""</span>) <span class="comment">// true</span></span><br><span class="line">StringUtils.isEmpty(<span class="string">""</span>) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">StringUtils.isBlank(<span class="string">" "</span>) <span class="comment">// true</span></span><br><span class="line">StringUtils.isEmpty(<span class="string">" "</span>) <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">StringUtils.isBlank(<span class="string">"\n\t"</span>) <span class="comment">// true</span></span><br><span class="line">StringUtils.isEmpty(<span class="string">"\n\t"</span>) <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">isNotEmpty = !isEmpty, isBlank同理</span><br></pre></td></tr></table></figure>

<p>使用 <code>isAnyBlank</code> 和 <code>isAnyEmpty</code> 进行多维判空：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">StringUtils.isAnyBlank(<span class="string">""</span>, <span class="string">"bar"</span>, <span class="string">"foo"</span>); <span class="comment">// true</span></span><br><span class="line">StringUtils.isAnyEmpty(<span class="string">" "</span>, <span class="string">"bar"</span>, <span class="string">"foo"</span>); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">isNoneBlank = !isAnyBlank；isNoneEmpty同理</span><br></pre></td></tr></table></figure>

<p>使用 <code>isWhitespace</code> 判断空白：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">StringUtils.isWhitespace(<span class="keyword">null</span>); <span class="comment">// false</span></span><br><span class="line">StringUtils.isWhitespace(<span class="string">""</span>); <span class="comment">// true</span></span><br><span class="line">StringUtils.isWhitespace(<span class="string">" "</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h2 id="判断是否相等函数"><a href="#判断是否相等函数" class="headerlink" title="判断是否相等函数"></a>判断是否相等函数</h2><p>API：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">equals(CharSequence cs1,CharSequence cs2)</span><br><span class="line">equalsIgnoreCase(CharSequence str1, CharSequence str2)</span><br></pre></td></tr></table></figure>

<p>例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">StringUtils.equals(<span class="string">"abc"</span>, <span class="keyword">null</span>)  = <span class="keyword">false</span></span><br><span class="line">StringUtils.equals(<span class="string">"abc"</span>, <span class="string">"abc"</span>) = <span class="keyword">true</span></span><br><span class="line">StringUtils.equals(<span class="string">"abc"</span>, <span class="string">"ABC"</span>) = <span class="keyword">false</span></span><br></pre></td></tr></table></figure>

<p>忽略大小写判断：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">StringUtils.equalsIgnoreCase(<span class="string">"abc"</span>, <span class="keyword">null</span>)  = <span class="keyword">false</span></span><br><span class="line">StringUtils.equalsIgnoreCase(<span class="string">"abc"</span>, <span class="string">"abc"</span>) = <span class="keyword">true</span></span><br><span class="line">StringUtils.equalsIgnoreCase(<span class="string">"abc"</span>, <span class="string">"ABC"</span>) = <span class="keyword">true</span></span><br></pre></td></tr></table></figure>

<h2 id="是否包含函数"><a href="#是否包含函数" class="headerlink" title="是否包含函数"></a>是否包含函数</h2><p>API：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">containsOnly(CharSequence cs,<span class="keyword">char</span>… valid)</span><br><span class="line">containsNone(CharSequence cs,<span class="keyword">char</span>… searchChars)</span><br><span class="line"></span><br><span class="line">startsWith(CharSequence str,CharSequence prefix)</span><br><span class="line">startsWithIgnoreCase(CharSequence str,CharSequence prefix)</span><br><span class="line">startsWithAny(CharSequence string,CharSequence… searchStrings)</span><br></pre></td></tr></table></figure>

<p>例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//判断字符串中所有字符，是否都是出自参数2中</span></span><br><span class="line">StringUtils.containsOnly(<span class="string">"ab"</span>, <span class="string">""</span>)      = <span class="keyword">false</span></span><br><span class="line">StringUtils.containsOnly(<span class="string">"abab"</span>, <span class="string">"abc"</span>) = <span class="keyword">true</span></span><br><span class="line">StringUtils.containsOnly(<span class="string">"ab1"</span>, <span class="string">"abc"</span>)  = <span class="keyword">false</span></span><br><span class="line">StringUtils.containsOnly(<span class="string">"abz"</span>, <span class="string">"abc"</span>)  = <span class="keyword">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//判断字符串中所有字符，都不在参数2中。</span></span><br><span class="line">StringUtils.containsNone(<span class="string">"abab"</span>, <span class="string">'xyz'</span>) = <span class="keyword">true</span></span><br><span class="line">StringUtils.containsNone(<span class="string">"ab1"</span>, <span class="string">'xyz'</span>)  = <span class="keyword">true</span></span><br><span class="line">StringUtils.containsNone(<span class="string">"abz"</span>, <span class="string">'xyz'</span>)  = <span class="keyword">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//判断字符串是否以第二个参数开始</span></span><br><span class="line">StringUtils.startsWith(<span class="string">"abcdef"</span>, <span class="string">"abc"</span>) = <span class="keyword">true</span></span><br><span class="line">StringUtils.startsWith(<span class="string">"ABCDEF"</span>, <span class="string">"abc"</span>) = <span class="keyword">false</span></span><br></pre></td></tr></table></figure>

<h2 id="索引下标函数"><a href="#索引下标函数" class="headerlink" title="索引下标函数"></a>索引下标函数</h2><p>API：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">indexOf(CharSequence seq,CharSequence searchSeq)</span><br><span class="line">indexOf(CharSequence seq,CharSequence searchSeq,<span class="keyword">int</span> startPos)</span><br><span class="line">indexOfIgnoreCase/lastIndexOfIgnoreCase(CharSequence str,CharSequence searchStr)</span><br><span class="line">lastIndexOf(CharSequence seq,<span class="keyword">int</span> searchChar)</span><br></pre></td></tr></table></figure>

<p>例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//返回第二个参数开始出现的索引值</span></span><br><span class="line">StringUtils.indexOf(<span class="string">"aabaabaa"</span>, <span class="string">"a"</span>)  = <span class="number">0</span></span><br><span class="line">StringUtils.indexOf(<span class="string">"aabaabaa"</span>, <span class="string">"b"</span>)  = <span class="number">2</span></span><br><span class="line">StringUtils.indexOf(<span class="string">"aabaabaa"</span>, <span class="string">"ab"</span>) = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//从第三个参数索引开始找起，返回第二个参数开始出现的索引值</span></span><br><span class="line">StringUtils.indexOf(<span class="string">"aabaabaa"</span>, <span class="string">"a"</span>, <span class="number">0</span>)  = <span class="number">0</span></span><br><span class="line">StringUtils.indexOf(<span class="string">"aabaabaa"</span>, <span class="string">"b"</span>, <span class="number">0</span>)  = <span class="number">2</span></span><br><span class="line">StringUtils.indexOf(<span class="string">"aabaabaa"</span>, <span class="string">"ab"</span>, <span class="number">0</span>) = <span class="number">1</span></span><br><span class="line">StringUtils.indexOf(<span class="string">"aabaabaa"</span>, <span class="string">"b"</span>, <span class="number">3</span>)  = <span class="number">5</span></span><br><span class="line">StringUtils.indexOf(<span class="string">"aabaabaa"</span>, <span class="string">"b"</span>, <span class="number">9</span>)  = -<span class="number">1</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment">//返回第二个参数出现的最后一个索引值        </span></span><br><span class="line">StringUtils.lastIndexOf(<span class="string">"aabaabaa"</span>, <span class="string">'a'</span>) = <span class="number">7</span></span><br><span class="line">StringUtils.lastIndexOf(<span class="string">"aabaabaa"</span>, <span class="string">'b'</span>) = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">StringUtils.lastIndexOfIgnoreCase(<span class="string">"aabaabaa"</span>, <span class="string">"A"</span>, <span class="number">8</span>)  = <span class="number">7</span></span><br><span class="line">StringUtils.lastIndexOfIgnoreCase(<span class="string">"aabaabaa"</span>, <span class="string">"B"</span>, <span class="number">8</span>)  = <span class="number">5</span></span><br><span class="line">StringUtils.lastIndexOfIgnoreCase(<span class="string">"aabaabaa"</span>, <span class="string">"AB"</span>, <span class="number">8</span>) = <span class="number">4</span></span><br><span class="line">StringUtils.lastIndexOfIgnoreCase(<span class="string">"aabaabaa"</span>, <span class="string">"B"</span>, <span class="number">9</span>)  = <span class="number">5</span></span><br></pre></td></tr></table></figure>

<h2 id="截取函数"><a href="#截取函数" class="headerlink" title="截取函数"></a>截取函数</h2><p>API：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">substring(String str,<span class="keyword">int</span> start)</span><br><span class="line">substringAfter(String str,String separator)</span><br><span class="line">substringBeforeLast(String str,String separator)</span><br><span class="line">substringAfterLast(String str,String separator)</span><br><span class="line">substringBetween(String str,String tag)</span><br></pre></td></tr></table></figure>

<p>例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//start&gt;0表示从左向右, start&lt;0表示从右向左, start=0则从左第一位开始</span></span><br><span class="line">StringUtils.substring(<span class="string">"abcdefg"</span>, <span class="number">0</span>)  = <span class="string">"abcdefg"</span></span><br><span class="line">StringUtils.substring(<span class="string">"abcdefg"</span>, <span class="number">2</span>)  = <span class="string">"cdefg"</span></span><br><span class="line">StringUtils.substring(<span class="string">"abcdefg"</span>, <span class="number">4</span>)  = <span class="string">"efg"</span></span><br><span class="line">StringUtils.substring(<span class="string">"abcdefg"</span>, -<span class="number">2</span>) = <span class="string">"fg"</span></span><br><span class="line">StringUtils.substring(<span class="string">"abcdefg"</span>, -<span class="number">4</span>) = <span class="string">"defg"</span></span><br></pre></td></tr></table></figure>

<p>// start&gt;0&amp;&amp;end&gt;0从左开始(包括左)到右结束(不包括右),</p>
<p>//start&lt;0&amp;&amp;end&lt;0从右开始(包括右),再向左数到end结束(包括end)</p>
<p><img src="/img/java/commons/commons-lang/substring.png" alt="substring"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//从第二个参数字符串开始截取，排除第二个字符串</span></span><br><span class="line">StringUtils.substringAfter(<span class="string">"abc"</span>, <span class="string">"a"</span>)   = <span class="string">"bc"</span></span><br><span class="line">StringUtils.substringAfter(<span class="string">"abcba"</span>, <span class="string">"b"</span>) = <span class="string">"cba"</span></span><br><span class="line">StringUtils.substringAfter(<span class="string">"abc"</span>, <span class="string">"c"</span>)   = <span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//从最后一个字母出现开始截取</span></span><br><span class="line">StringUtils.substringBeforeLast(<span class="string">"abcba"</span>, <span class="string">"b"</span>) = <span class="string">"abc"</span></span><br><span class="line">StringUtils.substringBeforeLast(<span class="string">"abc"</span>, <span class="string">"c"</span>)   = <span class="string">"ab"</span></span><br><span class="line">StringUtils.substringBeforeLast(<span class="string">"a"</span>, <span class="string">"a"</span>)     = <span class="string">""</span></span><br><span class="line">StringUtils.substringBeforeLast(<span class="string">"a"</span>, <span class="string">"z"</span>)     = <span class="string">"a"</span></span><br><span class="line"></span><br><span class="line">StringUtils.substringAfterLast(<span class="string">"abc"</span>, <span class="string">"a"</span>)   = <span class="string">"bc"</span></span><br><span class="line">StringUtils.substringAfterLast(<span class="string">"abcba"</span>, <span class="string">"b"</span>) = <span class="string">"a"</span></span><br><span class="line">StringUtils.substringAfterLast(<span class="string">"abc"</span>, <span class="string">"c"</span>)   = <span class="string">""</span></span><br><span class="line"></span><br><span class="line">StringUtils.substringBetween(<span class="string">"tagabctag"</span>, <span class="keyword">null</span>)  = <span class="keyword">null</span></span><br><span class="line">StringUtils.substringBetween(<span class="string">"tagabctag"</span>, <span class="string">""</span>)    = <span class="string">""</span></span><br><span class="line">StringUtils.substringBetween(<span class="string">"tagabctag"</span>, <span class="string">"tag"</span>) = <span class="string">"abc"</span></span><br></pre></td></tr></table></figure>

<h2 id="删除函数"><a href="#删除函数" class="headerlink" title="删除函数"></a>删除函数</h2><p>API：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">StringUtils.remove(String str, <span class="keyword">char</span> remove)</span><br><span class="line">StringUtils.remove(String str, String remove)</span><br><span class="line">StringUtils.removeEnd(String str, String remove)</span><br><span class="line">StringUtils.removeEndIgnoreCase(String str, String remove)</span><br><span class="line">StringUtils.removePattern(String source, String regex)</span><br><span class="line">StringUtils.removeStart(String str, String remove)</span><br><span class="line">StringUtils.removeStartIgnoreCase(String str, String remove)</span><br><span class="line">StringUtils.deleteWhitespace(String str)</span><br></pre></td></tr></table></figure>

<p>例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除字符</span></span><br><span class="line">StringUtils.remove(<span class="string">"queued"</span>, <span class="string">'u'</span>) = <span class="string">"qeed"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//删除字符串</span></span><br><span class="line">StringUtils.remove(<span class="string">"queued"</span>, <span class="string">"ue"</span>) = <span class="string">"qd"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//删除结尾匹配的字符串     </span></span><br><span class="line">StringUtils.removeEnd(<span class="string">"www.domain.com"</span>, <span class="string">".com"</span>)   = <span class="string">"www.domain"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//删除结尾匹配的字符串,找都不到返回原字符串</span></span><br><span class="line">StringUtils.removeEnd(<span class="string">"www.domain.com"</span>, <span class="string">"domain"</span>) = <span class="string">"www.domain.com"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//忽略大小写的</span></span><br><span class="line">StringUtils.removeEndIgnoreCase(<span class="string">"www.domain.com"</span>, <span class="string">".COM"</span>) = <span class="string">"www.domain"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//删除所有空白（好用）</span></span><br><span class="line">StringUtils.deleteWhitespace(<span class="string">"abc"</span>)        = <span class="string">"abc"</span></span><br><span class="line">StringUtils.deleteWhitespace(<span class="string">"   ab  c  "</span>) = <span class="string">"abc"</span></span><br></pre></td></tr></table></figure>

<h2 id="删除空白函数"><a href="#删除空白函数" class="headerlink" title="删除空白函数"></a>删除空白函数</h2><p>API：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">trim(String str)</span><br><span class="line">trimToEmpty(String str)</span><br><span class="line">trimToNull(String str)</span><br><span class="line">deleteWhitespace(String str)</span><br></pre></td></tr></table></figure>

<p>例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">StringUtils.trim(<span class="string">"     "</span>)       = <span class="string">""</span></span><br><span class="line">StringUtils.trim(<span class="string">"abc"</span>)         = <span class="string">"abc"</span></span><br><span class="line">StringUtils.trim(<span class="string">"    abc    "</span>) = <span class="string">"abc"</span></span><br><span class="line"></span><br><span class="line">StringUtils.trimToNull(<span class="string">"     "</span>)       = <span class="keyword">null</span></span><br><span class="line">StringUtils.trimToNull(<span class="string">"abc"</span>)         = <span class="string">"abc"</span></span><br><span class="line">StringUtils.trimToNull(<span class="string">"    abc    "</span>) = <span class="string">"abc"</span></span><br><span class="line">StringUtils.trimToEmpty(<span class="string">"     "</span>)       = <span class="string">""</span></span><br><span class="line">StringUtils.trimToEmpty(<span class="string">"abc"</span>)         = <span class="string">"abc"</span></span><br><span class="line">StringUtils.trimToEmpty(<span class="string">"    abc    "</span>) = <span class="string">"abc"</span></span><br><span class="line"></span><br><span class="line">StringUtils.deleteWhitespace(<span class="string">""</span>)           = <span class="string">""</span></span><br><span class="line">StringUtils.deleteWhitespace(<span class="string">"abc"</span>)        = <span class="string">"abc"</span></span><br><span class="line">StringUtils.deleteWhitespace(<span class="string">"   ab  c  "</span>) = <span class="string">"abc"</span></span><br></pre></td></tr></table></figure>

<h2 id="替换函数"><a href="#替换函数" class="headerlink" title="替换函数"></a>替换函数</h2><p>API：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">replace(String text, String searchString, String replacement)</span><br><span class="line">replace(String text, String searchString, String replacement, <span class="keyword">int</span> max)</span><br><span class="line">replaceChars(String str, <span class="keyword">char</span> searchChar, <span class="keyword">char</span> replaceChar)</span><br><span class="line">replaceChars(String str, String searchChars, String replaceChars)</span><br><span class="line">replaceEach(String text, String[] searchList, String[] replacementList)</span><br><span class="line">replaceEachRepeatedly(String text, String[] searchList, String[] replacementList)</span><br><span class="line">replaceOnce(String text, String searchString, String replacement)</span><br><span class="line">replacePattern(String source, String regex, String replacement)</span><br><span class="line">overlay(String str,String overlay,<span class="keyword">int</span> start,<span class="keyword">int</span> end)</span><br></pre></td></tr></table></figure>

<p><code>replace</code> 例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">StringUtils.replace(<span class="string">"aba"</span>, <span class="string">"a"</span>, <span class="string">""</span>)    = <span class="string">"b"</span></span><br><span class="line">StringUtils.replace(<span class="string">"aba"</span>, <span class="string">"a"</span>, <span class="string">"z"</span>)   = <span class="string">"zbz"</span>    </span><br><span class="line"></span><br><span class="line"><span class="comment">//数字就是替换个数，0代表不替换，1代表从开始数起第一个，-1代表全部替换</span></span><br><span class="line">StringUtils.replace(<span class="string">"abaa"</span>, <span class="string">"a"</span>, <span class="string">""</span>, -<span class="number">1</span>)   = <span class="string">"b"</span></span><br><span class="line">StringUtils.replace(<span class="string">"abaa"</span>, <span class="string">"a"</span>, <span class="string">"z"</span>, <span class="number">0</span>)   = <span class="string">"abaa"</span></span><br><span class="line">StringUtils.replace(<span class="string">"abaa"</span>, <span class="string">"a"</span>, <span class="string">"z"</span>, <span class="number">1</span>)   = <span class="string">"zbaa"</span></span><br><span class="line">StringUtils.replace(<span class="string">"abaa"</span>, <span class="string">"a"</span>, <span class="string">"z"</span>, <span class="number">2</span>)   = <span class="string">"zbza"</span></span><br><span class="line">StringUtils.replace(<span class="string">"abaa"</span>, <span class="string">"a"</span>, <span class="string">"z"</span>, -<span class="number">1</span>)  = <span class="string">"zbzz"</span></span><br></pre></td></tr></table></figure>

<p><code>replaceEach</code> 是对 <code>replace</code> 的增强版，用于一次性替换多个字符。搜索列表和替换长度必须一致，否则报 <code>IllegalArgumentException</code> 异常：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">StringUtils.replaceEach(<span class="string">"abcde"</span>, <span class="keyword">new</span> String[]&#123;<span class="string">"ab"</span>, <span class="string">"d"</span>&#125;, <span class="keyword">new</span> String[]&#123;<span class="string">"w"</span>, <span class="string">"t"</span>&#125;)  = <span class="string">"wcte"</span></span><br><span class="line">StringUtils.replaceEach(<span class="string">"abcde"</span>, <span class="keyword">new</span> String[]&#123;<span class="string">"ab"</span>, <span class="string">"d"</span>&#125;, <span class="keyword">new</span> String[]&#123;<span class="string">"d"</span>, <span class="string">"t"</span>&#125;)  = <span class="string">"dcte"</span></span><br></pre></td></tr></table></figure>

<p><code>replaceChars</code> 用于对单个字符逐一替换，其操作如下：</p>
<p><img src="/img/java/commons/commons-lang/replaceChars.png" alt="replaceChars"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">StringUtils.replaceChars(<span class="string">"dabcba"</span>, <span class="string">"bcd"</span>, <span class="string">"yzx"</span>) = <span class="string">"xayzya"</span></span><br><span class="line">StringUtils.replaceChars(<span class="string">"abcba"</span>, <span class="string">"bc"</span>, <span class="string">"y"</span>)   = <span class="string">"ayya"</span></span><br></pre></td></tr></table></figure>

<p><code>replaceOnce</code> 例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">StringUtils.replaceOnce(<span class="string">"aba"</span>, <span class="string">"a"</span>, <span class="string">""</span>)    = <span class="string">"ba"</span></span><br><span class="line">StringUtils.replaceOnce(<span class="string">"aba"</span>, <span class="string">"a"</span>, <span class="string">"z"</span>)   = <span class="string">"zba"</span></span><br></pre></td></tr></table></figure>

<p><code>overlay</code> 例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">StringUtils.overlay(<span class="string">"abcdef"</span>, <span class="string">"zzzz"</span>, <span class="number">2</span>, <span class="number">4</span>)   = <span class="string">"abzzzzef"</span></span><br><span class="line">StringUtils.overlay(<span class="string">"abcdef"</span>, <span class="string">"zzzz"</span>, <span class="number">4</span>, <span class="number">2</span>)   = <span class="string">"abzzzzef"</span></span><br><span class="line">StringUtils.overlay(<span class="string">"abcdef"</span>, <span class="string">"zzzz"</span>, -<span class="number">1</span>, <span class="number">4</span>)  = <span class="string">"zzzzef"</span></span><br><span class="line">StringUtils.overlay(<span class="string">"abcdef"</span>, <span class="string">"zzzz"</span>, <span class="number">2</span>, <span class="number">8</span>)   = <span class="string">"abzzzz"</span></span><br><span class="line">StringUtils.overlay(<span class="string">"abcdef"</span>, <span class="string">"zzzz"</span>, -<span class="number">2</span>, -<span class="number">3</span>) = <span class="string">"zzzzabcdef"</span></span><br><span class="line">StringUtils.overlay(<span class="string">"abcdef"</span>, <span class="string">"zzzz"</span>, <span class="number">8</span>, <span class="number">10</span>)  = <span class="string">"abcdefzzzz"</span></span><br></pre></td></tr></table></figure>

<h2 id="反转函数"><a href="#反转函数" class="headerlink" title="反转函数"></a>反转函数</h2><p>API：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reverse(String str)</span><br><span class="line">reverseDelimited(String str, <span class="keyword">char</span> separatorChar)</span><br></pre></td></tr></table></figure>

<p>例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">StringUtils.reverse(<span class="string">"bat"</span>) = <span class="string">"tab"</span></span><br><span class="line">StringUtils.reverseDelimited(<span class="string">"a.b.c"</span>, <span class="string">'x'</span>) = <span class="string">"a.b.c"</span></span><br><span class="line">StringUtils.reverseDelimited(<span class="string">"a.b.c"</span>, <span class="string">"."</span>) = <span class="string">"c.b.a"</span></span><br></pre></td></tr></table></figure>

<h2 id="分隔函数"><a href="#分隔函数" class="headerlink" title="分隔函数"></a>分隔函数</h2><p>API：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">split(String str)</span><br><span class="line">split(String str, <span class="keyword">char</span> separatorChar)</span><br><span class="line">split(String str, String separatorChars)</span><br><span class="line">split(String str, String separatorChars, <span class="keyword">int</span> max)</span><br><span class="line">splitByCharacterType(String str)</span><br><span class="line">splitByCharacterTypeCamelCase(String str)</span><br><span class="line">splitByWholeSeparator(String str, String separator)</span><br><span class="line">splitByWholeSeparator(String str, String separator, <span class="keyword">int</span> max)</span><br><span class="line">splitByWholeSeparatorPreserveAllTokens(String str, String separator)</span><br><span class="line">splitByWholeSeparatorPreserveAllTokens(String str, String separator, <span class="keyword">int</span> max)</span><br><span class="line">splitPreserveAllTokens(String str)</span><br><span class="line">splitPreserveAllTokens(String str, <span class="keyword">char</span> separatorChar)</span><br><span class="line">splitPreserveAllTokens(String str, String separatorChars)</span><br><span class="line">splitPreserveAllTokens(String str, String separatorChars, <span class="keyword">int</span> max)</span><br></pre></td></tr></table></figure>

<p>例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用空白符做空格</span></span><br><span class="line">StringUtils.split(<span class="string">"abc def"</span>)  = [<span class="string">"abc"</span>, <span class="string">"def"</span>]</span><br><span class="line">StringUtils.split(<span class="string">"abc  def"</span>) = [<span class="string">"abc"</span>, <span class="string">"def"</span>]</span><br><span class="line">StringUtils.split(<span class="string">"a..b.c"</span>, <span class="string">'.'</span>)   = [<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">//用字符分割</span></span><br><span class="line">StringUtils.split(<span class="string">"a:b:c"</span>, <span class="string">'.'</span>)    = [<span class="string">"a:b:c"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">//0 或者负数代表没有限制</span></span><br><span class="line">StringUtils.split(<span class="string">"ab:cd:ef"</span>, <span class="string">":"</span>, <span class="number">0</span>)    = [<span class="string">"ab"</span>, <span class="string">"cd"</span>, <span class="string">"ef"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">//分割字符串 ,可以设定得到数组的长度，限定为2</span></span><br><span class="line">StringUtils.split(<span class="string">"ab:cd:ef"</span>, <span class="string">":"</span>, <span class="number">2</span>)    = [<span class="string">"ab"</span>, <span class="string">"cd:ef"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">//null也可以作为分隔</span></span><br><span class="line">StringUtils.splitByWholeSeparator(<span class="string">"ab de fg"</span>, <span class="keyword">null</span>)      = [<span class="string">"ab"</span>, <span class="string">"de"</span>, <span class="string">"fg"</span>]</span><br><span class="line">StringUtils.splitByWholeSeparator(<span class="string">"ab   de fg"</span>, <span class="keyword">null</span>)    = [<span class="string">"ab"</span>, <span class="string">"de"</span>, <span class="string">"fg"</span>]</span><br><span class="line">StringUtils.splitByWholeSeparator(<span class="string">"ab:cd:ef"</span>, <span class="string">":"</span>)       = [<span class="string">"ab"</span>, <span class="string">"cd"</span>, <span class="string">"ef"</span>]</span><br><span class="line">StringUtils.splitByWholeSeparator(<span class="string">"ab-!-cd-!-ef"</span>, <span class="string">"-!-"</span>) = [<span class="string">"ab"</span>, <span class="string">"cd"</span>, <span class="string">"ef"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">//带有限定长度的分隔</span></span><br><span class="line">StringUtils.splitByWholeSeparator(<span class="string">"ab:cd:ef"</span>, <span class="string">":"</span>, <span class="number">2</span>)       = [<span class="string">"ab"</span>, <span class="string">"cd:ef"</span>]</span><br></pre></td></tr></table></figure>



<h2 id="合并函数"><a href="#合并函数" class="headerlink" title="合并函数"></a>合并函数</h2><p>API：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">join(<span class="keyword">byte</span>[] array,<span class="keyword">char</span> separator)</span><br><span class="line">join(Object[] array,<span class="keyword">char</span> separator)</span><br><span class="line">join(Object[] array,<span class="keyword">char</span> separator,<span class="keyword">int</span> startIndex,<span class="keyword">int</span> endIndex)</span><br></pre></td></tr></table></figure>

<p>例子</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//只有一个参数的join，简单合并在一起</span></span><br><span class="line">StringUtils.join([<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>]) = <span class="string">"abc"</span></span><br><span class="line">StringUtils.join([<span class="keyword">null</span>, <span class="string">""</span>, <span class="string">"a"</span>]) = <span class="string">"a"</span>    </span><br><span class="line"></span><br><span class="line"><span class="comment">//null的话，就是把字符合并在一起</span></span><br><span class="line">StringUtils.join([<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>], <span class="keyword">null</span>) = <span class="string">"abc"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//从index为0到3合并，注意是排除3的</span></span><br><span class="line">StringUtils.join([<span class="keyword">null</span>, <span class="string">""</span>, <span class="string">"a"</span>], <span class="string">','</span>, <span class="number">0</span>, <span class="number">3</span>)   = <span class="string">",,a"</span></span><br><span class="line">StringUtils.join([<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>], <span class="string">"--"</span>, <span class="number">0</span>, <span class="number">3</span>)  = <span class="string">"a--b--c"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//从index为1到3合并，注意是排除3的</span></span><br><span class="line">StringUtils.join([<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>], <span class="string">"--"</span>, <span class="number">1</span>, <span class="number">3</span>)  = <span class="string">"b--c"</span></span><br><span class="line">StringUtils.join([<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>], <span class="string">"--"</span>, <span class="number">2</span>, <span class="number">3</span>)  = <span class="string">"c"</span></span><br></pre></td></tr></table></figure>

<h2 id="大小写转换和判断"><a href="#大小写转换和判断" class="headerlink" title="大小写转换和判断"></a>大小写转换和判断</h2><p>API：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">StringUtils.capitalize(String str)</span><br><span class="line">StringUtils.uncapitalize(String str)</span><br><span class="line">StringUtils.upperCase(String str)</span><br><span class="line">StringUtils.upperCase(String str,Locale locale)</span><br><span class="line">StringUtils.lowerCase(String str)</span><br><span class="line">StringUtils.lowerCase(String str,Locale locale)</span><br><span class="line">StringUtils.swapCase(String str)</span><br><span class="line"></span><br><span class="line">StringUtils.isAllUpperCase(CharSequence cs)</span><br><span class="line">StringUtils.isAllLowerCase(CharSequence cs)</span><br></pre></td></tr></table></figure>

<p>大小写转换：</p>
<ul>
<li><code>capitalize</code> 首字母大写</li>
<li><code>upperCase</code> 全部转化为大写</li>
<li><code>swapCase</code> 大小写互转</li>
</ul>
<p>大小写判断：</p>
<ul>
<li><code>isAllUpperCase</code> 是否全部大写</li>
<li><code>isAllLowerCase</code> 是否全部小写</li>
</ul>
<h2 id="缩短省略函数"><a href="#缩短省略函数" class="headerlink" title="缩短省略函数"></a>缩短省略函数</h2><p>API：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">abbreviate(String str, <span class="keyword">int</span> maxWidth)</span><br><span class="line">abbreviate(String str, <span class="keyword">int</span> offset, <span class="keyword">int</span> maxWidth)</span><br><span class="line">abbreviateMiddle(String str, String middle, <span class="keyword">int</span> length)</span><br></pre></td></tr></table></figure>

<p>例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">StringUtils.abbreviate(<span class="string">"abcdefg"</span>, <span class="number">6</span>) = <span class="string">"abc..."</span></span><br><span class="line">StringUtils.abbreviate(<span class="string">"abcdefg"</span>, <span class="number">7</span>) = <span class="string">"abcdefg"</span></span><br><span class="line">StringUtils.abbreviate(<span class="string">"abcdefg"</span>, <span class="number">8</span>) = <span class="string">"abcdefg"</span></span><br><span class="line">StringUtils.abbreviate(<span class="string">"abcdefg"</span>, <span class="number">4</span>) = <span class="string">"a..."</span></span><br><span class="line">StringUtils.abbreviate(<span class="string">"abcdefg"</span>, <span class="number">3</span>) = IllegalArgumentException</span><br><span class="line"></span><br><span class="line">StringUtils.abbreviate(<span class="string">"abcdefghijklmno"</span>, <span class="number">6</span>, <span class="number">10</span>)  = <span class="string">"...ghij..."</span></span><br><span class="line"></span><br><span class="line">StringUtils.abbreviateMiddle(<span class="string">"abcdef"</span>, <span class="string">"."</span>, <span class="number">4</span>)     = <span class="string">"ab.f"</span></span><br></pre></td></tr></table></figure>

<p>字符串的长度小于或等于最大长度，返回该字符串。</p>
<p>运算规律：<code>(substring(str, 0, max-3) + “…”)</code></p>
<p>如果最大长度小于 4，则抛出异常 <code>IllegalArgumentException</code>。</p>
<h2 id="相似度函数"><a href="#相似度函数" class="headerlink" title="相似度函数"></a>相似度函数</h2><p>API：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">difference(String str1,String str2)</span><br></pre></td></tr></table></figure>

<p>例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在str1中寻找str2中没有的的字符串，并返回     </span></span><br><span class="line">StringUtils.difference(<span class="string">""</span>, <span class="string">"abc"</span>) = <span class="string">"abc"</span></span><br><span class="line">StringUtils.difference(<span class="string">"abc"</span>, <span class="string">""</span>) = <span class="string">""</span></span><br><span class="line">StringUtils.difference(<span class="string">"abc"</span>, <span class="string">"abc"</span>) = <span class="string">""</span></span><br><span class="line">StringUtils.difference(<span class="string">"abc"</span>, <span class="string">"ab"</span>) = <span class="string">""</span></span><br><span class="line">StringUtils.difference(<span class="string">"ab"</span>, <span class="string">"abxyz"</span>) = <span class="string">"xyz"</span></span><br><span class="line">StringUtils.difference(<span class="string">"abcde"</span>, <span class="string">"abxyz"</span>) = <span class="string">"xyz"</span></span><br><span class="line">StringUtils.difference(<span class="string">"abcde"</span>, <span class="string">"xyz"</span>) = <span class="string">"xyz"</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/java/commons/commons-lang/difference.png" alt="difference"></p>
<h1 id="BooleanUtils"><a href="#BooleanUtils" class="headerlink" title="BooleanUtils"></a>BooleanUtils</h1><p><img src="/img/java/commons/commons-lang/BooleanUtils.png" alt="BooleanUtils"></p>
<h1 id="ArrayUtils"><a href="#ArrayUtils" class="headerlink" title="ArrayUtils"></a>ArrayUtils</h1><h2 id="添加方法"><a href="#添加方法" class="headerlink" title="添加方法"></a>添加方法</h2><p>add(boolean[] array,boolean element)<br>add(T[] array,int index,T element)<br>addAll(boolean[] array1,boolean… array2)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//添加元素到数组中        </span></span><br><span class="line">ArrayUtils.add([<span class="keyword">true</span>, <span class="keyword">false</span>], <span class="keyword">true</span>) = [<span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">true</span>]    </span><br><span class="line"></span><br><span class="line"><span class="comment">//将元素插入到指定位置的数组中</span></span><br><span class="line">ArrayUtils.add([<span class="string">"a"</span>], <span class="number">1</span>, <span class="keyword">null</span>)     = [<span class="string">"a"</span>, <span class="keyword">null</span>]</span><br><span class="line">ArrayUtils.add([<span class="string">"a"</span>], <span class="number">1</span>, <span class="string">"b"</span>)      = [<span class="string">"a"</span>, <span class="string">"b"</span>]</span><br><span class="line">ArrayUtils.add([<span class="string">"a"</span>, <span class="string">"b"</span>], <span class="number">3</span>, <span class="string">"c"</span>) = [<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>]</span><br><span class="line">ArrayUtils.add([<span class="string">"a"</span>, <span class="string">"b"</span>], [<span class="string">"c"</span>, <span class="string">"d"</span>]) = [<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>,<span class="string">"d"</span>]</span><br></pre></td></tr></table></figure>

<h2 id="克隆方法"><a href="#克隆方法" class="headerlink" title="克隆方法"></a>克隆方法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ArrayUtils.clone(<span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span> &#125;); = &#123;<span class="number">3</span>,<span class="number">2</span>,<span class="number">4</span>&#125;</span><br></pre></td></tr></table></figure>

<h2 id="包含方法"><a href="#包含方法" class="headerlink" title="包含方法"></a>包含方法</h2><p>contains(boolean[] array,boolean valueToFind)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询某个Object是否在数组中</span></span><br><span class="line">ArrayUtils.contains(<span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span> &#125;, <span class="number">1</span>); =  <span class="keyword">true</span></span><br></pre></td></tr></table></figure>

<h2 id="获取长度方法"><a href="#获取长度方法" class="headerlink" title="获取长度方法"></a>获取长度方法</h2><p>getLength(Object array)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ArrayUtils.getLength([<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>]) = <span class="number">3</span></span><br></pre></td></tr></table></figure>

<h2 id="获取索引方法"><a href="#获取索引方法" class="headerlink" title="获取索引方法"></a>获取索引方法</h2><p>indexOf(boolean[] array,boolean valueToFind)<br>indexOf(boolean[] array,boolean valueToFind,int startIndex)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询某个Object在数组中的位置,可以指定起始搜索位置,找不到返回-1</span></span><br><span class="line"><span class="comment">//从正序开始搜索,搜到就返回当前的index否则返回-1</span></span><br><span class="line">ArrayUtils.indexOf(<span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">1</span>, <span class="number">3</span>, <span class="number">6</span> &#125;, <span class="number">6</span>); =  <span class="number">2</span></span><br><span class="line">ArrayUtils.indexOf(<span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">1</span>, <span class="number">3</span>, <span class="number">6</span> &#125;, <span class="number">2</span>); =  -<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//从逆序开始搜索,搜到就返回当前的index,否则返回-1</span></span><br><span class="line">ArrayUtils.lastIndexOf(<span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">1</span>, <span class="number">3</span>, <span class="number">6</span> &#125;, <span class="number">6</span>); =  <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//从逆序索引为2开始搜索,,搜到就返回当前的index,否则返回-1</span></span><br><span class="line">ArrayUtils.lastIndexOf(<span class="keyword">new</span> Object[]&#123;<span class="string">"33"</span>,<span class="string">"yy"</span>,<span class="string">"uu"</span>&#125;, <span class="string">"33"</span>,<span class="number">2</span> ) = <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h2 id="判空方法"><a href="#判空方法" class="headerlink" title="判空方法"></a>判空方法</h2><p>isEmpty(boolean[] array)等等<br>isNotEmpty(T[] array)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//判断数组是否为空(null和length=0的时候都为空)</span></span><br><span class="line">ArrayUtils.isEmpty(<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">0</span>]); =  <span class="keyword">true</span></span><br><span class="line">ArrayUtils.isEmpty(<span class="keyword">new</span> Object[] &#123; <span class="keyword">null</span> &#125;); = <span class="keyword">false</span></span><br></pre></td></tr></table></figure>

<h2 id="长度相等判断方法"><a href="#长度相等判断方法" class="headerlink" title="长度相等判断方法"></a>长度相等判断方法</h2><p>isSameLength(boolean[] array1,boolean[] array2)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//判断两个数组的长度是否相等</span></span><br><span class="line">ArrayUtils.isSameLength(<span class="keyword">new</span> Integer[] &#123; <span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span> &#125;, <span class="keyword">new</span> Long[] &#123; <span class="string">"1"</span>, <span class="string">"3"</span>, <span class="string">"5"</span>&#125;); = <span class="keyword">true</span></span><br></pre></td></tr></table></figure>

<h2 id="空数组转换"><a href="#空数组转换" class="headerlink" title="空数组转换"></a>空数组转换</h2><p>nullToEmpty(Object[] array)等等</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//讲null转化为相应数组</span></span><br><span class="line"><span class="keyword">int</span> [] arr1 = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">int</span> [] arr2 = ArrayUtils.nullToEmpty(arr1);</span><br></pre></td></tr></table></figure>

<h2 id="删除元素方法"><a href="#删除元素方法" class="headerlink" title="删除元素方法"></a>删除元素方法</h2><p>remove(boolean[] array,int index)等等<br>removeElement(boolean[] array,boolean element)<br>removeAll(T[] array,int… indices)<br>removeElements(T[] array,T… values)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除指定下标的元素        </span></span><br><span class="line">ArrayUtils.remove([<span class="keyword">true</span>, <span class="keyword">false</span>], <span class="number">1</span>)       = [<span class="keyword">true</span>]</span><br><span class="line">ArrayUtils.remove([<span class="keyword">true</span>, <span class="keyword">true</span>, <span class="keyword">false</span>], <span class="number">1</span>) = [<span class="keyword">true</span>, <span class="keyword">false</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">//删除第一次出现的元素</span></span><br><span class="line">ArrayUtils.removeElement([<span class="keyword">true</span>, <span class="keyword">false</span>], <span class="keyword">false</span>)      = [<span class="keyword">true</span>]</span><br><span class="line">ArrayUtils.removeElement([<span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">true</span>], <span class="keyword">true</span>) = [<span class="keyword">false</span>, <span class="keyword">true</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">//删除所有出现的下标的元素</span></span><br><span class="line">ArrayUtils.removeAll([<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>], <span class="number">0</span>, <span class="number">2</span>) = [<span class="string">"b"</span>]</span><br><span class="line">ArrayUtils.removeAll([<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>], <span class="number">1</span>, <span class="number">2</span>) = [<span class="string">"a"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">//删除数组出现的所有元素</span></span><br><span class="line">ArrayUtils.removeElements([<span class="string">"a"</span>, <span class="string">"b"</span>], <span class="string">"a"</span>, <span class="string">"c"</span>)      = [<span class="string">"b"</span>]</span><br><span class="line">ArrayUtils.removeElements([<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"a"</span>], <span class="string">"a"</span>)      = [<span class="string">"b"</span>, <span class="string">"a"</span>]</span><br><span class="line">ArrayUtils.removeElements([<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"a"</span>], <span class="string">"a"</span>, <span class="string">"a"</span>) = [<span class="string">"b"</span>]</span><br></pre></td></tr></table></figure>

<h2 id="反转方法"><a href="#反转方法" class="headerlink" title="反转方法"></a>反转方法</h2><p>reverse(boolean[] array)等等<br>reverse(boolean[] array,int startIndexInclusive,int endIndexExclusive)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//反转数组</span></span><br><span class="line"><span class="keyword">int</span>[] array =<span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span> &#125;;</span><br><span class="line">ArrayUtils.reverse(array);<span class="comment">// &#123;5,2,1&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//指定范围的反转数组，排除endIndexExclusive的</span></span><br><span class="line"><span class="keyword">int</span>[] array =<span class="keyword">new</span> <span class="keyword">int</span>[] &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span> ,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>&#125;;</span><br><span class="line">ArrayUtils.reverse(array,<span class="number">2</span>,<span class="number">5</span>);</span><br><span class="line">System.out.println(ArrayUtils.toString(array)); = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>&#125;</span><br></pre></td></tr></table></figure>

<h2 id="截取数组"><a href="#截取数组" class="headerlink" title="截取数组"></a>截取数组</h2><p>subarray(boolean[] array,int startIndexInclusive,int endIndexExclusive)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//起始index为2(即第三个数据)结束index为4的数组</span></span><br><span class="line">ArrayUtils.subarray(newint[] &#123; <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">6</span> &#125;, <span class="number">2</span>, <span class="number">4</span>); =  &#123;<span class="number">1</span>,<span class="number">5</span>&#125;</span><br><span class="line"><span class="comment">//如果endIndex大于数组的长度,则取beginIndex之后的所有数据</span></span><br><span class="line">ArrayUtils.subarray(newint[] &#123; <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">6</span> &#125;, <span class="number">2</span>, <span class="number">10</span>); =  &#123;<span class="number">1</span>,<span class="number">5</span>,<span class="number">6</span>&#125;</span><br></pre></td></tr></table></figure>

<h2 id="打印数组方法"><a href="#打印数组方法" class="headerlink" title="打印数组方法"></a>打印数组方法</h2><p>toString(Object array)<br>toString(Object array,String stringIfNull)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//打印数组</span></span><br><span class="line">ArrayUtils.toString(newint[] &#123; <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">3</span> &#125;); =  &#123;<span class="number">1</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">3</span>&#125;</span><br><span class="line">ArrayUtils.toString(<span class="keyword">new</span> Integer[] &#123; <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">3</span> &#125;); =  &#123;<span class="number">1</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">3</span>&#125;</span><br><span class="line"><span class="comment">//如果为空，返回默认信息</span></span><br><span class="line">ArrayUtils.toString(<span class="keyword">null</span>, <span class="string">"I'm nothing!"</span>); =  I<span class="string">'m nothing!</span></span><br></pre></td></tr></table></figure>

<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://commons.apache.org/" target="_blank" rel="noopener">https://commons.apache.org/</a></p>
<p><a href="https://www.tutorialspoint.com/commons_collections/index.htm" target="_blank" rel="noopener">https://www.tutorialspoint.com/commons_collections/index.htm</a></p>
<p><a href="https://www.tutorialspoint.com/commons_io/index.htm" target="_blank" rel="noopener">https://www.tutorialspoint.com/commons_io/index.htm</a></p>
</div></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2017/11/24/dubbo-protocol/" class="post-title-link">Dubbo 协议小结</a></h2><div class="post-info">2017-11-24<a href="/tags/Java/" title="Java" class="post-demo">Java</a></div><div class="post-content"><h1 id="RPC-框架对比"><a href="#RPC-框架对比" class="headerlink" title="RPC 框架对比"></a>RPC 框架对比</h1><p>市面上的 RPC 框架功能比较：</p>
<p><img src="/img/dubbo/rpc_framework_compare.png" alt="RPC框架功能比较"></p>
<h1 id="协议对比"><a href="#协议对比" class="headerlink" title="协议对比"></a>协议对比</h1><table>
<thead>
<tr>
<th></th>
<th>连接个数</th>
<th>连接方式</th>
<th>传输协议</th>
<th>传输方式</th>
<th>序列化</th>
<th>适用范围</th>
<th>适用场景</th>
<th>参考</th>
</tr>
</thead>
<tbody><tr>
<td><code>dubbo://</code></td>
<td>单连接</td>
<td>长连接</td>
<td>TCP</td>
<td>NIO 异步传输</td>
<td>Hessian 二进制序列化</td>
<td>传入传出参数数据包较小（建议小于100K），消费者比提供者个数多，单一消费者无法压满提供者，尽量不要用 dubbo 协议传输大文件或超大字符串。</td>
<td>常规远程服务方法调用</td>
<td><a href="http://dubbo.apache.org/zh-cn/docs/user/references/protocol/dubbo.html" target="_blank" rel="noopener">dubbo</a></td>
</tr>
<tr>
<td><code>rmi://</code></td>
<td>多连接</td>
<td>短连接</td>
<td>TCP</td>
<td>同步传输</td>
<td>Java 标准二进制序列化</td>
<td>传入传出参数数据包大小混合，消费者与提供者个数差不多，可传文件。</td>
<td>常规远程服务方法调用，与原生RMI服务互操作</td>
<td></td>
</tr>
<tr>
<td><code>hessian://</code></td>
<td>多连接</td>
<td>短连接</td>
<td>HTTP</td>
<td>同步传输</td>
<td>Hessian二进制序列化</td>
<td>传入传出参数数据包较大，提供者比消费者个数多，提供者压力较大，可传文件。</td>
<td>页面传输，文件传输，或与原生hessian服务互操作</td>
<td><a href="http://hessian.caucho.com/" target="_blank" rel="noopener">hession</a></td>
</tr>
<tr>
<td><code>http://</code></td>
<td>多连接</td>
<td>短连接</td>
<td>HTTP</td>
<td>同步传输</td>
<td>表单序列化</td>
<td>传入传出参数数据包大小混合，提供者比消费者个数多，可用浏览器查看，可用表单或URL传入参数，暂不支持传文件。</td>
<td>需同时给应用程序和浏览器 JS 使用的服务。</td>
<td></td>
</tr>
<tr>
<td><code>webservice://</code></td>
<td>多连接</td>
<td>短连接</td>
<td>HTTP</td>
<td>同步传输</td>
<td>SOAP 文本序列化</td>
<td></td>
<td>系统集成，跨语言调用</td>
<td><a href="http://cxf.apache.org/" target="_blank" rel="noopener">Apache CXF</a></td>
</tr>
<tr>
<td><code>thrift://</code></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><a href="http://thrift.apache.org/" target="_blank" rel="noopener">Thrift</a></td>
</tr>
<tr>
<td><code>memcached://</code></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>redis://</code></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>rest://</code></td>
<td>多连接</td>
<td>可长可短</td>
<td>HTTP</td>
<td>同步传输</td>
<td>JSON/XML</td>
<td></td>
<td></td>
<td><a href="https://github.com/jax-rs" target="_blank" rel="noopener">JAX-RS</a></td>
</tr>
</tbody></table>
<h1 id="REST-协议小结"><a href="#REST-协议小结" class="headerlink" title="REST 协议小结"></a>REST 协议小结</h1><p>根据 dubbox、dubbo REST 官方文档，摘录了使用上的一些注意点：</p>
<h2 id="配置总览"><a href="#配置总览" class="headerlink" title="配置总览"></a>配置总览</h2><h3 id="服务提供端"><a href="#服务提供端" class="headerlink" title="服务提供端"></a>服务提供端</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">"rest"</span> <span class="attr">server</span>=<span class="string">""</span> <span class="attr">port</span>=<span class="string">""</span> <span class="attr">contextpath</span>=<span class="string">""</span> <span class="attr">threads</span>=<span class="string">""</span> <span class="attr">iothreads</span>=<span class="string">""</span> <span class="attr">keepalive</span>=<span class="string">""</span> <span class="attr">accepts</span>=<span class="string">""</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>配置项</th>
<th>描述</th>
<th>生效范围</th>
</tr>
</thead>
<tbody><tr>
<td><code>name</code></td>
<td>启用 REST 协议</td>
<td>all</td>
</tr>
<tr>
<td><code>server</code></td>
<td>REST Server 的实现</td>
<td>all</td>
</tr>
<tr>
<td><code>port</code></td>
<td>端口号</td>
<td>all</td>
</tr>
<tr>
<td><code>contextpath</code></td>
<td>应用上下文路径</td>
<td>all</td>
</tr>
<tr>
<td><code>threads</code></td>
<td>线程池大小</td>
<td>jetty、netty、tomcat</td>
</tr>
<tr>
<td><code>iothreads</code></td>
<td>IO worker线程数</td>
<td>netty</td>
</tr>
<tr>
<td><code>keepalive</code></td>
<td>是否长连接，默认为 <code>true</code> 长连接</td>
<td>netty、tomcat</td>
</tr>
<tr>
<td><code>accepts</code></td>
<td>最大的HTTP连接数</td>
<td>tomcat</td>
</tr>
</tbody></table>
<p>目前在dubbo中支持5种嵌入式rest server的实现：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- rest协议默认选用jetty。jetty是非常成熟的java servlet容器，并和dubbo已经有较好的集成（目前5种嵌入式server中只有jetty、tomcat、tjws，与dubbo监控系统等完成了无缝的集成）。 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">"rest"</span> <span class="attr">server</span>=<span class="string">"jetty"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 在嵌入式tomcat上，REST的性能比jetty上要好得多（参见官网的基准测试），建议在需要高性能的场景下采用tomcat。 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">"rest"</span> <span class="attr">server</span>=<span class="string">"tomcat"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">"rest"</span> <span class="attr">server</span>=<span class="string">"netty"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 轻量级嵌入式server，非常方便在集成测试中快速启动使用，当然也可以在负荷不高的生产环境中使用。注意，tjws is now deprecated --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">"rest"</span> <span class="attr">server</span>=<span class="string">"tjws"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">"rest"</span> <span class="attr">server</span>=<span class="string">"sunhttp"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>同时也支持采用外部应用服务器来做rest server的实现：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- web.xml 参考官网 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">"rest"</span> <span class="attr">server</span>=<span class="string">"servlet"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="服务消费端"><a href="#服务消费端" class="headerlink" title="服务消费端"></a>服务消费端</h3><p>如果REST服务的消费端也是dubbo系统，可以配置每个消费端的超时时间和HTTP连接数，详情参考官方文档。</p>
<h2 id="REST-服务提供端"><a href="#REST-服务提供端" class="headerlink" title="REST 服务提供端"></a>REST 服务提供端</h2><h3 id="标准-Java-REST-API：JAX-RS"><a href="#标准-Java-REST-API：JAX-RS" class="headerlink" title="标准 Java REST API：JAX-RS"></a>标准 Java REST API：JAX-RS</h3><ul>
<li>Dubbox 基于标准的 Java REST API——JAX-RS 2.0（Java API for RESTful Web Services 的简写），提供了接近透明的REST调用支持。由于完全兼容Java标准API，所以为dubbo开发的所有REST服务，未来脱离dubbo或者任何特定的REST底层实现一般也可以正常运行。</li>
<li>Dubbo的REST调用和dubbo中其它某些RPC不同的是，需要在服务代码中添加JAX-RS的annotation（以及JAXB、Jackson的annotation），如果你觉得这些annotation一定程度“污染”了你的服务代码，你可以考虑编写额外的Facade和DTO类，在Facade和DTO上添加annotation，而Facade将调用转发给真正的服务实现类。当然事实上，直接在服务代码中添加annotation基本没有任何负面作用，而且这本身是Java EE的标准用法，另外JAX-RS和JAXB的annotation是属于java标准，比我们经常使用的spring、dubbo等等annotation更没有vendor lock-in的问题，所以一般没有必要因此而引入额外对象。</li>
<li>JAX-RS与Spring MVC的对比：<ul>
<li>JAX-RS 相对更适合纯粹的服务化应用，也就是传统Java EE中所说的中间层服务。</li>
<li>在dubbo应用中，我想很多人都比较喜欢直接将一个本地的spring service bean（或者叫manager之类的）完全透明的发布成远程服务，则这里用JAX-RS是更自然更直接的，不必额外的引入MVC概念。</li>
</ul>
</li>
<li>就学习 JAX-RS 来说，一般主要掌握其各种 annotation 的用法即可。参考：<ul>
<li><a href="http://docs.oracle.com/javaee/7/tutorial/doc/jaxrs.htm" target="_blank" rel="noopener">http://docs.oracle.com/javaee/7/tutorial/doc/jaxrs.htm</a></li>
<li><a href="http://www.ibm.com/developerworks/cn/java/j-lo-jaxrs/" target="_blank" rel="noopener">http://www.ibm.com/developerworks/cn/java/j-lo-jaxrs/</a></li>
</ul>
</li>
</ul>
<h3 id="HTTP-POST-GET-的实现"><a href="#HTTP-POST-GET-的实现" class="headerlink" title="HTTP POST/GET 的实现"></a>HTTP POST/GET 的实现</h3><ul>
<li>REST服务中虽然建议使用HTTP协议中四种标准方法POST、DELETE、PUT、GET来分别实现常见的“增删改查”，但实际中，我们一般情况直接用POST来实现“增改”，GET来实现“删查”即可（DELETE和PUT甚至会被一些防火墙阻挡）。</li>
</ul>
<h3 id="JSON、XML-等多数据格式的支持"><a href="#JSON、XML-等多数据格式的支持" class="headerlink" title="JSON、XML 等多数据格式的支持"></a>JSON、XML 等多数据格式的支持</h3><ul>
<li>在一个REST服务同时对多种数据格式支持的情况下，根据JAX-RS标准，一般是通过HTTP中的MIME header（content-type和accept）来指定当前想用的是哪种格式的数据。</li>
<li>目前业界普遍使用的方式，是使用一个URL后缀（.json和.xml）来指定想用的数据格式。比用HTTP Header更简单直观。Twitter、微博等的REST API都是采用这种方式。</li>
</ul>
<h3 id="定制序列化"><a href="#定制序列化" class="headerlink" title="定制序列化"></a>定制序列化</h3><ul>
<li>Dubbo中的REST实现是用JAXB做XML序列化，用Jackson做JSON序列化，所以在对象上添加JAXB或Jackson的annotation即可以定制映射。更多资料请参考JAXB和Jackson的官方文档。</li>
<li>由于JAX-RS的实现一般都用标准的JAXB（Java API for XML Binding）来序列化和反序列化XML格式数据，所以我们需要为每一个要用XML传输的对象添加一个类级别的JAXB annotation <code>@XmlRootElement</code>，否则序列化将报错。</li>
</ul>
<h3 id="添加自定义的-Filter、Interceptor-等"><a href="#添加自定义的-Filter、Interceptor-等" class="headerlink" title="添加自定义的 Filter、Interceptor 等"></a>添加自定义的 Filter、Interceptor 等</h3><ul>
<li>JAX-RS标准的 <code>Filter</code> 和 <code>Interceptor</code> 可以对请求与响应过程做定制化的拦截处理。</li>
</ul>
<h3 id="添加自定义的-Exception-处理"><a href="#添加自定义的-Exception-处理" class="headerlink" title="添加自定义的 Exception 处理"></a>添加自定义的 Exception 处理</h3><ul>
<li>JAX-RS标准的 <code>ExceptionMapper</code>，可以用来定制特定exception发生后应该返回的HTTP响应。</li>
</ul>
<h2 id="REST-服务消费端"><a href="#REST-服务消费端" class="headerlink" title="REST 服务消费端"></a>REST 服务消费端</h2><h3 id="场景1：非-dubbo-的消费端调用-dubbo-的-REST-服务（non-dubbo-gt-dubbo）"><a href="#场景1：非-dubbo-的消费端调用-dubbo-的-REST-服务（non-dubbo-gt-dubbo）" class="headerlink" title="场景1：非 dubbo 的消费端调用 dubbo 的 REST 服务（non-dubbo &gt; dubbo）"></a>场景1：非 dubbo 的消费端调用 dubbo 的 REST 服务（non-dubbo &gt; dubbo）</h3><ul>
<li>使用标准的JAX-RS Client API或者特定REST实现的Client API来调用REST服务。当然，在java中也可以直接用自己熟悉的比如HttpClient，FastJson，XStream等等各种不同技术来实现REST客户端。</li>
</ul>
<h3 id="场景2：dubbo-消费端调用-dubbo-的-REST-服务（dubbo-gt-dubbo）"><a href="#场景2：dubbo-消费端调用-dubbo-的-REST-服务（dubbo-gt-dubbo）" class="headerlink" title="场景2：dubbo 消费端调用 dubbo 的 REST 服务（dubbo &gt; dubbo）"></a>场景2：dubbo 消费端调用 dubbo 的 REST 服务（dubbo &gt; dubbo）</h3><ul>
<li>dubbo消费端调用dubbo的REST服务，这种场景下必须把JAX-RS的annotation添加到服务接口上，这样在dubbo在消费端才能共享相应的REST配置信息，并据之做远程调用。</li>
<li>dubbo的REST支持采用Java标准的<a href="http://beanvalidation.org/" target="_blank" rel="noopener">bean validation annotation（JSR 303)</a>来做输入校验。为了和其他dubbo远程调用协议保持一致，在rest中作校验的annotation必须放在服务的接口上，这样至少有一个好处是，dubbo的消费端可以共享这个接口的信息，dubbo消费端甚至不需要做远程调用，在本地就可以完成输入校验。</li>
</ul>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="http://dubbo.apache.org/zh-cn/docs/user/references/protocol/rest.html" target="_blank" rel="noopener">http://dubbo.apache.org/zh-cn/docs/user/references/protocol/rest.html</a></p>
<p><a href="https://github.com/dangdangdotcom/dubbox" target="_blank" rel="noopener">https://github.com/dangdangdotcom/dubbox</a></p>
<p><a href="https://dangdangdotcom.github.io/dubbox/rest.html" target="_blank" rel="noopener">https://dangdangdotcom.github.io/dubbox/rest.html</a></p>
<p><a href="https://mvnrepository.com/artifact/com.gaosi/dubbox" target="_blank" rel="noopener">https://mvnrepository.com/artifact/com.gaosi/dubbox</a></p>
<p>Dubbox fork from Dubbo，目前只发布了一个版本：2.8.4</p>
</div></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2017/11/15/dubbo-config/" class="post-title-link">Dubbo 配置小结</a></h2><div class="post-info">2017-11-15<a href="/tags/Java/" title="Java" class="post-demo">Java</a></div><div class="post-content"><p>本文主要总结 Dubbo 日常使用时的一些常用配置。</p>
<h1 id="配置之间的关系"><a href="#配置之间的关系" class="headerlink" title="配置之间的关系"></a>配置之间的关系</h1><p><img src="/img/dubbo/dubbo-config.jpg" alt="配置之间的关系"></p>
<table>
<thead>
<tr>
<th>XML 配置</th>
<th>Java Config 配置</th>
<th>配置</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td><code>&lt;dubbo:application/&gt;</code></td>
<td><code>com.alibaba.dubbo.config.ApplicationConfig</code></td>
<td>应用配置</td>
<td>用于配置当前应用信息，不管该应用是提供者还是消费者</td>
</tr>
<tr>
<td><code>&lt;dubbo:registry/&gt;</code></td>
<td><code>com.alibaba.dubbo.config.RegistryConfig</code></td>
<td>注册中心配置</td>
<td>用于配置连接注册中心相关信息</td>
</tr>
<tr>
<td><code>&lt;dubbo:monitor/&gt;</code></td>
<td><code>com.alibaba.dubbo.config.MonitorConfig</code></td>
<td>监控中心配置</td>
<td>用于配置连接监控中心相关信息，可选</td>
</tr>
<tr>
<td><code>&lt;dubbo:protocol/&gt;</code></td>
<td><code>com.alibaba.dubbo.config.ProtocolConfig</code></td>
<td>协议配置</td>
<td>用于配置提供服务的协议信息，协议由提供方指定，消费方<strong>被动接受</strong></td>
</tr>
<tr>
<td><code>&lt;dubbo:provider/&gt;</code></td>
<td><code>com.alibaba.dubbo.config.ProviderConfig</code></td>
<td>提供方配置</td>
<td>当 <code>ProtocolConfig</code> 和 <code>ServiceConfig</code> 某属性没有配置时，采用此缺省值，可选</td>
</tr>
<tr>
<td><code>&lt;dubbo:service/&gt;</code></td>
<td><code>com.alibaba.dubbo.config.ServiceConfig</code></td>
<td>服务配置</td>
<td>用于暴露一个服务，定义服务的元信息，一个服务可以用多个协议暴露，一个服务也可以注册到多个注册中心。对应注解：<code>@Service</code></td>
</tr>
<tr>
<td><code>&lt;dubbo:consumer/&gt;</code></td>
<td><code>com.alibaba.dubbo.config.ConsumerConfig</code></td>
<td>消费方配置</td>
<td>当 <code>ReferenceConfig</code> 某属性没有配置时，采用此缺省值，可选</td>
</tr>
<tr>
<td><code>&lt;dubbo:reference/&gt;</code></td>
<td><code>com.alibaba.dubbo.config.ReferenceConfig</code></td>
<td>引用配置</td>
<td>用于创建一个远程服务代理，一个引用可以指向多个注册中心。对应注解：<code>@Reference</code></td>
</tr>
<tr>
<td><code>&lt;dubbo:method/&gt;</code></td>
<td><code>com.alibaba.dubbo.config.MethodConfig</code></td>
<td>方法配置</td>
<td>用于 <code>ServiceConfig</code> 和 <code>ReferenceConfig</code> 指定方法级的配置信息</td>
</tr>
<tr>
<td><code>&lt;dubbo:argument/&gt;</code></td>
<td><code>com.alibaba.dubbo.config.ArgumentConfig</code></td>
<td>参数配置</td>
<td>用于指定方法参数配置</td>
</tr>
<tr>
<td><code>&lt;dubbo:module/&gt;</code></td>
<td><code>com.alibaba.dubbo.config.ModuleConfig</code></td>
<td>模块配置</td>
<td>用于配置当前模块信息，可选</td>
</tr>
</tbody></table>
<p>下面是一些 dubbo 配置的总结：</p>
<h2 id="协议"><a href="#协议" class="headerlink" title="协议"></a>协议</h2><p><img src="/img/dubbo/dubbo_protocol.png" alt=""></p>
<h2 id="服务提供者"><a href="#服务提供者" class="headerlink" title="服务提供者"></a>服务提供者</h2><p><img src="/img/dubbo/provider.png" alt=""></p>
<h2 id="服务消费者"><a href="#服务消费者" class="headerlink" title="服务消费者"></a>服务消费者</h2><p><img src="/img/dubbo/consumer.png" alt=""></p>
<h1 id="配置覆盖关系"><a href="#配置覆盖关系" class="headerlink" title="配置覆盖关系"></a>配置覆盖关系</h1><p>配置覆盖关系：</p>
<ul>
<li>方法级优先，接口级次之，全局配置再次之。</li>
<li>如果级别一样，则消费方优先，提供方次之。</li>
</ul>
<p>规则二是指，所有配置最终都将转换为 URL 表示，并由服务提供方生成，经注册中心传递给消费方。其 URL 格式如下：<code>protocol://username:password@host:port/path?key=value&amp;key=value</code></p>
<p><img src="/img/dubbo/dubbo-config-override.jpg" alt="dubbo 配置覆盖关系"></p>
<p>参考：<a href="http://dubbo.apache.org/zh-cn/docs/user/configuration/xml.html" target="_blank" rel="noopener">XML 配置</a>。</p>
<h1 id="属性配置关系"><a href="#属性配置关系" class="headerlink" title="属性配置关系"></a>属性配置关系</h1><p><img src="/img/dubbo/dubbo-properties-override.jpg" alt="dubbo 属性覆盖关系"></p>
<p>参考：<a href="http://dubbo.apache.org/zh-cn/docs/user/configuration/properties.html" target="_blank" rel="noopener">属性配置</a></p>
<h1 id="注解配置实践"><a href="#注解配置实践" class="headerlink" title="注解配置实践"></a>注解配置实践</h1><p>如果想用现代的 Java Config 替代传统的 XML 配置方式，配置如下：</p>
<h2 id="声明组件"><a href="#声明组件" class="headerlink" title="声明组件"></a>声明组件</h2><ul>
<li><p>服务提供方使用 <code>@Service</code> 注解暴露服务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Service;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span>(timeout = <span class="number">5000</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnnotateServiceImpl</span> <span class="keyword">implements</span> <span class="title">AnnotateService</span> </span>&#123; </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>服务消费方使用 <code>@Reference</code> 注解引用服务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Reference;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnnotationConsumeService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Reference</span></span><br><span class="line">    <span class="keyword">public</span> AnnotateService annotateService;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="开启组件扫描"><a href="#开启组件扫描" class="headerlink" title="开启组件扫描"></a>开启组件扫描</h2><ul>
<li>2.5.7 (Nov, 2017) 以上版本，使用 <code>@DubboComponentScan</code> 指定 dubbo 组件扫描路径</li>
<li>老版本或 Dubbox，使用：<code>&lt;dubbo:annotation package=&quot;com.alibaba.dubbo.test.service&quot; /&gt;</code></li>
</ul>
<h2 id="Java-Config-配置"><a href="#Java-Config-配置" class="headerlink" title="Java Config 配置"></a>Java Config 配置</h2><ul>
<li>使用 <code>@Configuration</code> 注解开启 Java Config 并使用 <code>@Bean</code> 进行公共模块的 bean 配置，参考：<a href="http://dubbo.apache.org/zh-cn/docs/user/configuration/api.html" target="_blank" rel="noopener">API配置</a>。</li>
</ul>
<h2 id="自动化配置"><a href="#自动化配置" class="headerlink" title="自动化配置"></a>自动化配置</h2><ul>
<li>最后开启 <code>@EnableDubboConfig</code></li>
</ul>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>《<a href="http://dubbo.apache.org/zh-cn/blog/dubbo-annotation.html" target="_blank" rel="noopener">在 Dubbo 中使用注解</a>》</p>
<p><a href="https://www.oschina.net/news/92687/dubbo-spring-boot-starter-1-0-0" target="_blank" rel="noopener">https://www.oschina.net/news/92687/dubbo-spring-boot-starter-1-0-0</a></p>
<p><a href="https://mvnrepository.com/artifact/com.alibaba.boot/dubbo-spring-boot-starter" target="_blank" rel="noopener">https://mvnrepository.com/artifact/com.alibaba.boot/dubbo-spring-boot-starter</a></p>
<p><a href="https://mvnrepository.com/artifact/com.alibaba/dubbo" target="_blank" rel="noopener">https://mvnrepository.com/artifact/com.alibaba/dubbo</a></p>
<p><a href="https://github.com/apache/incubator-dubbo" target="_blank" rel="noopener">https://github.com/apache/incubator-dubbo</a></p>
</div></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2017/10/16/security/" class="post-title-link">安全专题分享</a></h2><div class="post-info">2017-10-16<a href="/tags/读书笔记/" title="读书笔记" class="post-demo">读书笔记</a><a href="/tags/安全/" title="安全" class="post-demo">安全</a></div><div class="post-content"><p>本文总结的一些学习笔记，用于建立安全观。</p>
<h1 id="信任域与信任边界"><a href="#信任域与信任边界" class="headerlink" title="信任域与信任边界"></a>信任域与信任边界</h1><ul>
<li>首先，安全问题的本质，是<strong>信任</strong>。一旦我们作为决策依据的条件被打破、被绕过，那么就会导致安全假设的前提条件不再可靠，变成一个伪命题。因此，把握住信任条件的度，使其恰到好处，正是设计安全方案的难点所在，也是安全这门学问的艺术魅力所在。</li>
<li>通过一个安全检查（过滤、净化）的过程，可以梳理未知的人或物，使其变得可信任。被划分出来的具有不同信任级别的区域，我们称为<strong>信任域</strong>，划分两个不同信任域之间的边界，我们称为<strong>信任边界</strong>。</li>
<li>因为信任关系被破坏，从而产生了安全问题。我们可以通过信任域的划分、信任边界的确定，来发现问题是在何处产生的。</li>
<li>数据从高等级的信任域流向低等级的信任域，是不需要经过安全检查的；数据从低等级的信任域流向高等级的信任域，则需要经过信任边界的安全检查。</li>
</ul>
<h1 id="安全基本三要素（CIA）"><a href="#安全基本三要素（CIA）" class="headerlink" title="安全基本三要素（CIA）"></a>安全基本三要素（CIA）</h1><ul>
<li>机密性（Confidentiality）：要求保护数据内容不能泄露，常见手段是加密。</li>
<li>完整性（Integrity）：要求保护数据内容是完整、没有被篡改的。常见手段是数字签名。</li>
<li>可用性（Availability）：要求保护资源是“随需而得”。如拒绝服务攻击 （简称DoS，Denial of Service） 破坏的是安全的可用性。</li>
<li>不可抵赖性（Non-repudiation），防抵赖。常见手段是数字签名。</li>
<li>认证（Authentication）</li>
<li>授权（Authorization）</li>
</ul>
<h1 id="安全评估的四阶段"><a href="#安全评估的四阶段" class="headerlink" title="安全评估的四阶段"></a>安全评估的四阶段</h1><ol>
<li><p>资产等级划分：对资产进行等级划分，就是对数据做<strong>等级划分</strong>。当完成划分后，对要保护的目标数据已经有了一个大概的了解，接下来就是要划分信任域和信任边界了。</p>
</li>
<li><p>威胁分析：威胁（Threat）是指可能造成危害的来源。威胁分析即把所有的威胁都找出来。可以采用头脑风暴法。或采用 <strong>STRIDE</strong> 等模型。</p>
<p><img src="/img/security/STRIDE.png" alt="STRIDE"></p>
</li>
<li><p>风险分析：风险（Risk）是指可能会出现的损失。风险公式：<code>Risk = Probability * Damage Potential</code>，即影响风险高低的因素，除了造成损失的大小外，还需要考虑到发生的可能性。可以采用 <strong>DREAD</strong> 等模型。</p>
<p><img src="/img/security/DREAD.png" alt="DREAD"></p>
</li>
<li><p>确认解决方案</p>
</li>
</ol>
<h1 id="安全方案设计的四原则"><a href="#安全方案设计的四原则" class="headerlink" title="安全方案设计的四原则"></a>安全方案设计的四原则</h1><ul>
<li><strong>默认安全性原则（Secure by Default）</strong>，最基本也是最重要的原则。即：<ul>
<li>黑、白名单。随着防火墙、ACL 技术的兴起，使得直接暴露在互联网上的系统得到了保护。比如一个网站的数据库，在没有保护的情况下，数据库服务端口是允许任何人随意连接的；在有了防火墙的保护后，通过ACL可以控制只允许信任来源的访问。这些措施在很大程度上保证了系统软件处于信任边界之内，从而杜绝了大部分的攻击来源。因此如果更多地使用白名单（如防火墙、ACL），系统就会变得更安全。</li>
<li>最小权限原则。安全设计的基本原则之一。最小权限原则要求系统只授予主体必要的权限，而不要过度授权，这样能有效地减少系统、网络、应用、数据库出错的机会。</li>
</ul>
</li>
<li><strong>纵深防御原则 （Defense in Depth）</strong>，其包含两层含义：<ul>
<li>首先，在各个不同层面、不同方面实施安全方案，避免出现疏漏，不同安全方案之间需要相互配合，构成一个整体；</li>
<li>其次，在正确的地方做正确的事情，即：在解决根本问题的地方实施针对性的安全方案。</li>
</ul>
</li>
<li><strong>数据与代码分离原则</strong><ul>
<li>适用于各种由于“注入”而引发的安全问题，如 XSS、SQL 注入、CRLF 注入、X-Path 注入。</li>
</ul>
</li>
<li><strong>不可预测性原则（Unpredictable）</strong><ul>
<li>能有效地对抗基于篡改、伪造（如 CSRF）的攻击，其实现往往需用到加密算法、随机数算法、哈希算法等。</li>
</ul>
</li>
</ul>
<p>总结这几条原则：</p>
<ul>
<li>Secure By Default：是时刻要牢记的原则；</li>
<li>纵深防御：是要更全面、更正确地看待问题；</li>
<li>数据与代码分离：是从漏洞成因上看问题；</li>
<li>不可预测性：则是从克服攻击方法的角度看问题。</li>
</ul>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>互联网安全的核心问题，是<strong>数据安全</strong>的问题。</p>
<p>《白帽子讲 Web 安全》</p>
</div></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2017/09/11/how-to-run-a-meeting/" class="post-title-link">如何开好会？</a></h2><div class="post-info">2017-09-11<a href="/tags/管理/" title="管理" class="post-demo">管理</a></div><div class="post-content"><p>开会是一门学问，也是管理的必经之路。这里总结一点开会的小心得，目的是提升工作效率。</p>
<p><img src="/img/management/how_to_run_a_meeting.png" alt="如何开好会？"></p>
</div></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2017/09/05/spring-conditional-bean/" class="post-title-link">Spring Boot 条件化注解总结</a></h2><div class="post-info">2017-09-05<a href="/tags/Java/" title="Java" class="post-demo">Java</a><a href="/tags/Spring/" title="Spring" class="post-demo">Spring</a></div><div class="post-content"><h1 id="Spring-4-0-引入的条件化注解"><a href="#Spring-4-0-引入的条件化注解" class="headerlink" title="Spring 4.0 引入的条件化注解"></a>Spring 4.0 引入的条件化注解</h1><blockquote>
<p>假设你希望一个或多个 bean 只有在应用的类路径下包含特定的库时才创建。或者我们希望某个 bean 只有当另外某个特定的 bean 也声明了之后才会创建。我们还可能要求只有某个特定的环境变量设置之后，才会创建某个 bean。<br>在 Spring 4 之前，很难实现这种级别的条件化配置，但是 Spring 4 引入了一个新的 <code>@Conditional</code> 注解，它可以用到带有 <code>@Bean</code> 注解的方法上。如果给定的条件计算结果为 <code>true</code>，就会创建这个 bean，否则的话，这个 bean 会被忽略。</p>
</blockquote>
<p><a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Conditional.html" target="_blank" rel="noopener">@Conditional 注解</a>的源码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(&#123;ElementType.TYPE, ElementType.METHOD&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Conditional &#123;</span><br><span class="line">    Class&lt;? extends Condition&gt;[] value();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Condition.html" target="_blank" rel="noopener">Condition 接口</a>的源码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Condition</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(ConditionContext var1, AnnotatedTypeMetadata var2)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中，通过 <code>Condition</code> 接口的入参 <code>ConditionContext</code>，我们可以做到如下几点：</p>
<ul>
<li>借助 <code>getRegistry()</code> 返回的 <code>BeanDefinitionRegistry</code> 检查 bean 定义；</li>
<li>借助 <code>getBeanFactory()</code> 返回的 <code>ConfigurableListableBeanFactory</code> 检查 bean 是否存在，甚至探查 bean 的属性；</li>
<li>借助 <code>getEnvironment()</code> 返回的 <code>Environment</code> 检查环境变量是否存在以及它的值是什么；</li>
<li>读取并探查 <code>getResourceLoader()</code> 返回的 <code>ResourceLoader</code> 所加载的资源；</li>
<li>借助 <code>getClassLoader()</code> 返回的 <code>ClassLoader</code> 加载并检查类是否存在。</li>
</ul>
<h2 id="环境与-profile"><a href="#环境与-profile" class="headerlink" title="环境与 profile"></a>环境与 profile</h2><p>在开发软件的时候，有一个很大的挑战就是将应用程序从一个环境迁移到另外一个环境。开发阶段中，某些环境相关做法可能并不适合迁移到生产环境中，甚至即便迁移过去也无法正常工作。跨环境部署时会发生变化的几个典型例子：</p>
<ul>
<li>数据库配置</li>
<li>加密算法</li>
<li>与外部系统的集成</li>
</ul>
<p>解决办法：</p>
<ul>
<li>在单独的 Java Config（或 XML）中配置每个 bean，然后在<strong>构建时</strong>根据不同的环境分别打包，典型方法是采用 Maven profile。这种方式的问题在于要为每种环境重新构建应用。</li>
<li><strong>运行时</strong>指定不同的环境变量，典型方法是采用 Spring profile bean。这种方式的好处在于无需为每种环境重新构建应用。</li>
</ul>
<p>Spring profile bean 的使用方式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Profile</span>(<span class="string">"dev"</span>) <span class="comment">// 类级别（Spring 3.1 引入）</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> class <span class="title">DevProfileConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> class <span class="title">GlobalConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Profile</span>(<span class="string">"dev"</span>) <span class="comment">// 方法级别（Spring 3.2 引入）</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">embeddedDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Profile</span>(<span class="string">"prod"</span>) <span class="comment">// 方法级别（Spring 3.2 引入）</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">jndiDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>激活方式，使用属性：<code>spring.profiles.active</code> 和 <code>spring.profiles.default</code>。有多种方式来设置这两个属性：</p>
<ul>
<li>作为 <code>DispatcherServlet</code> 的初始化参数；</li>
<li>作为 Web 应用的上下文参数；</li>
<li>作为 JNDI 条目；</li>
<li>作为环境变量；</li>
<li>作为 JVM 的系统属性；</li>
<li>在集成测试类上，使用 <code>@ActiveProfiles</code> 注解设置。</li>
</ul>
<p>注意，Spring profile bean 注解 <code>@Profile</code> 底层其实也是基于 <code>@Conditional</code> 和 <code>Condition</code> 实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(&#123;ElementType.TYPE, ElementType.METHOD&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Conditional</span>(&#123;ProfileCondition<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class"><span class="title">public</span> @<span class="title">interface</span> <span class="title">Profile</span> </span>&#123;</span><br><span class="line">    String[] value();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Spring-Boot-的条件化注解"><a href="#Spring-Boot-的条件化注解" class="headerlink" title="Spring Boot 的条件化注解"></a>Spring Boot 的条件化注解</h1><p>Spring Boot 没有引入任何形式的代码生成，而是利用了 Spring 4 的条件化 bean 配置特性，以及 Maven 和 Gradle 提供的传递依赖解析，以此实现 Spring 应用上下文里的<strong>自动配置</strong>。Spring Boot 实现的条件化注解如下：</p>
<p><img src="/img/spring/conditional_annotation.png" alt="Spring Boot 实现的条件化注解"></p>
<p>Spring Boot 的 <code>@Conditional</code> 注解实现及相关支持类，详见文档：<a href="https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/autoconfigure/condition/package-summary.html" target="_blank" rel="noopener">Package org.springframework.boot.autoconfigure.condition</a></p>
<p>依赖配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-autoconfigure<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>通过运行 <code>DEBUG=true mvn spring-boot:run</code>，可以看到 DEBUG 级别的日志输出，从而观察自动配置的详情（AUTO-CONFIGURATION REPORT）：</p>
<ul>
<li>Positive matches</li>
<li>Negative matches</li>
<li>Exclusions</li>
<li>Unconditional classes</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">CONDITIONS EVALUATION REPORT</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">Positive matches:</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">   GenericCacheConfiguration matched:</span><br><span class="line">      - Cache org.springframework.boot.autoconfigure.cache.GenericCacheConfiguration automatic cache type (CacheCondition)</span><br><span class="line"></span><br><span class="line">   JmxAutoConfiguration matched:</span><br><span class="line">      - @ConditionalOnClass found required class &#39;org.springframework.jmx.export.MBeanExporter&#39; (OnClassCondition)</span><br><span class="line">      - @ConditionalOnProperty (spring.jmx.enabled&#x3D;true) matched (OnPropertyCondition)</span><br><span class="line"></span><br><span class="line">   PropertyPlaceholderAutoConfiguration#propertySourcesPlaceholderConfigurer matched:</span><br><span class="line">      - @ConditionalOnMissingBean (types: org.springframework.context.support.PropertySourcesPlaceholderConfigurer; SearchStrategy: current) did not find any beans (OnBeanCondition)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Negative matches:</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">   ActiveMQAutoConfiguration:</span><br><span class="line">      Did not match:</span><br><span class="line">         - @ConditionalOnClass did not find required class &#39;javax.jms.ConnectionFactory&#39; (OnClassCondition)</span><br><span class="line"></span><br><span class="line">   AopAutoConfiguration:</span><br><span class="line">      Did not match:</span><br><span class="line">         - @ConditionalOnClass did not find required class &#39;org.aspectj.lang.annotation.Aspect&#39; (OnClassCondition)</span><br><span class="line"></span><br><span class="line">Exclusions:</span><br><span class="line">-----------</span><br><span class="line"></span><br><span class="line">    None</span><br><span class="line"></span><br><span class="line">Unconditional classes:</span><br><span class="line">----------------------</span><br><span class="line"></span><br><span class="line">    org.springframework.boot.autoconfigure.context.ConfigurationPropertiesAutoConfiguration</span><br><span class="line"></span><br><span class="line">    org.springframework.boot.autoconfigure.context.PropertyPlaceholderAutoConfiguration</span><br><span class="line"></span><br><span class="line">    org.springframework.boot.autoconfigure.info.ProjectInfoAutoConfiguration</span><br></pre></td></tr></table></figure>

<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>《<a href="https://www.manning.com/books/spring-in-action-fourth-edition" target="_blank" rel="noopener">Spring in Action, 4th</a>》</p>
<p>《<a href="https://www.jianshu.com/p/c4df7be75d6e" target="_blank" rel="noopener">SpringBoot源码分析之条件注解的底层实现</a>》</p>
</div></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2017/08/29/npm/" class="post-title-link">npm 常用命令及配置总结</a></h2><div class="post-info">2017-08-29<a href="/tags/前端/" title="前端" class="post-demo">前端</a></div><div class="post-content"><p>工作中由于前端项目打包、各类工具使用（如本博客就是基于 Node.js）经常要用到 npm，下面总结一下。</p>
<p>npm 是随 Node.js 自动安装的，由三个独立的部分组成：</p>
<ul>
<li><a href="https://npmjs.com/" target="_blank" rel="noopener">网址</a>：开发者查找包（package）、设置参数以及管理 npm 使用体验的主要途径。</li>
<li><a href="https://docs.npmjs.com/misc/registry" target="_blank" rel="noopener">注册表（Registry）</a>：一个巨大的数据库，保存了每个包（package）的信息。</li>
<li><a href="https://docs.npmjs.com/cli/npm" target="_blank" rel="noopener">命令行工具（CLI）</a>：命令行或终端运行。开发者通过 CLI 与 npm 打交道。</li>
</ul>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>OS X 推荐使用 HomeBrew 安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install node --with-npm</span><br></pre></td></tr></table></figure>

<p>其它：</p>
<p><a href="https://nodejs.org/zh-cn/download/" target="_blank" rel="noopener">https://nodejs.org/zh-cn/download/</a></p>
<h1 id="npm-命令"><a href="#npm-命令" class="headerlink" title="npm 命令"></a>npm 命令</h1><p><img src="/img/javascript/npm_cli_commands.png" alt="NPM CLI Commands"></p>
<p><code>npm install -g &lt;package&gt;</code> 全局安装：</p>
<ul>
<li><p>Windows：</p>
<ul>
<li>安装目录 <code>C:\Users\Admin\AppData\Roaming\npm\node_modules\&lt;package&gt;</code></li>
<li>生成可执行脚本：<code>C:\Users\Admin\AppData\Roaming\npm\&lt;package&gt;</code></li>
<li>由于目录 <code>C:\Users\Admin\AppData\Roaming\npm</code> 已加入 <code>PATH</code> 环境变量，因为可以直接执行对应命令。</li>
</ul>
</li>
<li><p>OS X：</p>
<ul>
<li>安装目录 <code>/usr/local/lib/node_modules/&lt;package&gt;</code></li>
<li>生成软链，例如：<code>/usr/local/bin/npm -&gt; /usr/local/lib/node_modules/npm/bin/npm-cli.js</code></li>
</ul>
</li>
</ul>
<p><code>npm list -g -depth=0</code> 验证是否安装到位。</p>
<h1 id="npm-配置"><a href="#npm-配置" class="headerlink" title="npm 配置"></a>npm 配置</h1><p>npm 配置主要有两份：</p>
<ul>
<li><a href="https://www.npmjs.com.cn/files/npmrc/" target="_blank" rel="noopener">npmrc</a>：npm 从命令行、环境变量、<code>npmrc</code> 文件中读取配置。</li>
<li><a href="https://www.npmjs.com.cn/files/package.json/" target="_blank" rel="noopener">package.json</a>：包（package）配置文件。</li>
</ul>
<p>重点了解下 package.json，重点属性有 <code>name</code>、<code>version</code>、<code>dependencies</code>、<code>main</code>：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>name</code></td>
<td>包名</td>
</tr>
<tr>
<td><code>version</code></td>
<td>包的语义版本号：X.Y.Z：如果有大变动，向下不兼容，需要更新主版本号X；如果是新增了功能，但是向下兼容，需要更新次版本号 Y；如果只是修复bug，需要更新补丁版本号 Z</td>
</tr>
<tr>
<td><code>description</code></td>
<td>包的描述</td>
</tr>
<tr>
<td><code>homepage</code></td>
<td>包的官网 url</td>
</tr>
<tr>
<td><code>author</code></td>
<td>包的作者姓名</td>
</tr>
<tr>
<td><code>contributors</code></td>
<td>包的其他贡献者姓名</td>
</tr>
<tr>
<td><code>dependencies</code></td>
<td>依赖包列表。如果依赖包没有安装，npm 会自动将依赖包安装在 node_module 目录下</td>
</tr>
<tr>
<td><code>repository</code></td>
<td>包代码存放的地方的类型，可以是 git 或 svn，git 可在 Github 上</td>
</tr>
<tr>
<td><code>main</code></td>
<td><code>main</code> 字段是一个模块ID，它是一个指向你程序的主要项目。就是说，如果你包的名字叫 express，然后用户安装它，然后<code>require(&quot;express&quot;)</code></td>
</tr>
<tr>
<td><code>keywords</code></td>
<td>关键字</td>
</tr>
</tbody></table>
<h1 id="淘宝-npm-镜像"><a href="#淘宝-npm-镜像" class="headerlink" title="淘宝 npm 镜像"></a>淘宝 npm 镜像</h1><p>为了解决慢的问题，推荐使用淘宝 npm 镜像。三种使用方式：</p>
<ul>
<li><p>使用淘宝定制的 <a href="https://github.com/cnpm/cnpm" target="_blank" rel="noopener">cnpm</a> 命令行工具代替默认的 <code>npm</code>，安装方法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>
</li>
<li><p>永久配置 <code>npm</code> 命令行工具：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ npm config <span class="built_in">set</span> registry https://registry.npm.taobao.org</span><br><span class="line">--配置后验证是否成功</span><br><span class="line">$ npm config get registry</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>npm</code> 安装包时，临时使用淘宝 npm 镜像：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install vue-cli --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://www.npmjs.com/" target="_blank" rel="noopener">https://www.npmjs.com/</a></p>
<p><a href="https://www.npmjs.com.cn/" target="_blank" rel="noopener">https://www.npmjs.com.cn/</a></p>
<p><a href="https://npm.taobao.org/" target="_blank" rel="noopener">https://npm.taobao.org/</a></p>
<p><a href="http://www.runoob.com/nodejs/nodejs-tutorial.html" target="_blank" rel="noopener">http://www.runoob.com/nodejs/nodejs-tutorial.html</a></p>
</div></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2017/08/20/spring-factories/" class="post-title-link">Spring Boot 自动配置及 Factories 机制总结</a></h2><div class="post-info">2017-08-20<a href="/tags/Java/" title="Java" class="post-demo">Java</a><a href="/tags/Spring/" title="Spring" class="post-demo">Spring</a></div><div class="post-content"><p>Spring Boot 应用中的”自动配置”是通过 <code>@EnableAutoConfiguration</code> 注解进行开启的。<code>@EnableAutoConfiguration</code> 可以帮助 Spring Boot 应用将所有符合条件的 <code>@Configuration</code> 配置类的 bean 都加载到 Spring IoC 容器中。本文解析了实现这个效果的原理。</p>
<h1 id="自动配置的原理"><a href="#自动配置的原理" class="headerlink" title="自动配置的原理"></a>自动配置的原理</h1><p>Spring Boot 应用的自动配置流程如下：</p>
<p><img src="/img/spring/enable-auto-configuration.png" alt="Spring SPI"></p>
<h2 id="Spring-Factories-机制"><a href="#Spring-Factories-机制" class="headerlink" title="Spring Factories 机制"></a>Spring Factories 机制</h2><p>首先，注解的实现类使用了 spring-core 中的加载类 <code>SpringFactoriesLoader</code> 加载指定配置，详见<a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/core/io/support/SpringFactoriesLoader.html" target="_blank" rel="noopener">文档</a>：</p>
<blockquote>
<p>SpringFactoriesLoader loads and instantiates factories of a given type from “META-INF/spring.factories” files which may be present in multiple JAR files in the classpath. The spring.factories file must be in Properties format, where the key is the fully qualified name of the interface or abstract class, and the value is a comma-separated list of implementation class names. </p>
</blockquote>
<p>该类会通过类加载器从 classpath 中搜索所有 <code>META-INF/spring.factories</code> 配置文件，然后获取 key 为 <code>org.springframework.boot.autoconfigure.EnableAutoConfiguration</code> 部分。</p>
<p>例如 <code>spring-boot-autoconfigure.jar/META-INF/spring.factories</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Auto Configure</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration&#x3D;\</span><br><span class="line">org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration,\</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>加载结果如图：</p>
<p><img src="/img/spring/SpringFactoriesLoader.png" alt="SpringFactoriesLoader 解析结果"></p>
<p>继续加载 key 为 <code>org.springframework.boot.autoconfigure.AutoConfigurationImportFilter</code> 部分：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Auto Configuration Import Filters</span><br><span class="line">org.springframework.boot.autoconfigure.AutoConfigurationImportFilter&#x3D;\</span><br><span class="line">org.springframework.boot.autoconfigure.condition.OnBeanCondition,\</span><br><span class="line">org.springframework.boot.autoconfigure.condition.OnClassCondition,\</span><br><span class="line">org.springframework.boot.autoconfigure.condition.OnWebApplicationCondition</span><br></pre></td></tr></table></figure>

<h2 id="执行条件注解"><a href="#执行条件注解" class="headerlink" title="执行条件注解"></a>执行条件注解</h2><p>针对这 118 个候选的 Auto Configure，执行 Import Filters 对应的条件注解：</p>
<ul>
<li><p><code>OnClassCondition</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 底层实现，加载成功则返回 true；加载失败则抛出 java.lang.ClassNotFoundException，捕获异常后返回 false</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Class&lt;?&gt; forName(String className, ClassLoader classLoader)</span><br><span class="line">    <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">    <span class="keyword">if</span> (classLoader != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> classLoader.loadClass(className);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Class.forName(className);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>OnBeanCondition</code></p>
<p>判断指定的 bean 类或名称是否已存在于 <code>BeanFactory</code>。</p>
</li>
</ul>
<p>过滤结果如下：</p>
<p><img src="/img/spring/condition.png" alt=""></p>
<p><code>TRACE</code> 日志如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Filtered 30 auto configuration class in 1000 ms</span><br></pre></td></tr></table></figure>

<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>在日常工作中，我们可能需要实现一些 Spring Boot Starter 给被人使用，这个时候我们就可以使用这个 Factories 机制，将自己的 Starter 注册到 <code>org.springframework.boot.autoconfigure.EnableAutoConfiguration</code> 命名空间下。这样用户只需要在服务中引入我们的 jar 包即可完成自动加载及配置。Factories 机制可以让 Starter 的使用只需要很少甚至不需要进行配置。</p>
<p>本质上，Spring Factories 机制与 Java SPI 机制原理都差不多：都是通过指定的规则，在规则定义的文件中配置接口的各种实现，通过 key-value 的方式读取，并以反射的方式实例化指定的类型。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/core/io/support/SpringFactoriesLoader.html" target="_blank" rel="noopener">https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/core/io/support/SpringFactoriesLoader.html</a></p>
<p><a href="https://github.com/spring-projects/spring-framework/blob/master/spring-core/src/main/java/org/springframework/core/io/support/SpringFactoriesLoader.java" target="_blank" rel="noopener">https://github.com/spring-projects/spring-framework/blob/master/spring-core/src/main/java/org/springframework/core/io/support/SpringFactoriesLoader.java</a></p>
<p>《<a href="https://stackoverflow.com/questions/42819558/spring-boot-spring-factories-vs-enable-annotations" target="_blank" rel="noopener">Spring Boot spring.factories vs @Enable annotations</a>》</p>
<p><a href="https://www.cnblogs.com/zheting/p/6707035.html" target="_blank" rel="noopener">https://www.cnblogs.com/zheting/p/6707035.html</a></p>
<p><a href="http://www.cnblogs.com/whx7762/p/7832985.html" target="_blank" rel="noopener">http://www.cnblogs.com/whx7762/p/7832985.html</a></p>
</div></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2017/08/01/spring-boot-getting-started/" class="post-title-link">Spring Boot 入门总结</a></h2><div class="post-info">2017-08-01<a href="/tags/Java/" title="Java" class="post-demo">Java</a><a href="/tags/Spring/" title="Spring" class="post-demo">Spring</a></div><div class="post-content"><h1 id="搭建项目"><a href="#搭建项目" class="headerlink" title="搭建项目"></a>搭建项目</h1><p>有几种方式可以搭建基于 Spring Boot 的项目：</p>
<ol>
<li><p><a href="https://start.spring.io/" target="_blank" rel="noopener">Spring Initializr</a> 在线生成项目</p>
<blockquote>
<p>Spring Initializr 从本质上来说就是一个Web应用程序，它能为你生成 Spring Boot 项目结构。虽然不能生成应用程序代码，但它能为你提供一个基本的项目结构，以及一个用于构建代码的 Maven 或 Gradle 构建说明文件。你只需要写应用程序的代码就好了。</p>
</blockquote>
</li>
<li><p><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/cli.html" target="_blank" rel="noopener">Spring Boot CLI</a> 命令行工具，下载地址<a href="http://repo.spring.io/release/org/springframework/boot/spring-boot-cli/" target="_blank" rel="noopener">点我</a>，命令如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ spring init -dweb,data-jpa,h2,thymeleaf --build gradle readingList</span><br></pre></td></tr></table></figure>
</li>
<li><p><a href="https://spring.io/tools/sts" target="_blank" rel="noopener">Spring Tool Suite</a>，一个官方基于 Eclipse 定制的 IDE，用法参考：《<a href="http://blog.csdn.net/linabc123000/article/details/68954236" target="_blank" rel="noopener">STS 创建第一个 Spring Boot 项目</a>》</p>
</li>
<li><p>IntelliJ IDEA</p>
<ol>
<li>社区版：离线安装 <a href="http://plugins.jetbrains.com/plugin/10229-spring-assistant" target="_blank" rel="noopener">Spring Assistant</a> 插件（在线安装方式被墙）</li>
<li>收费版：直接使用 Spring Initializr 插件</li>
</ol>
</li>
</ol>
<h1 id="项目组成"><a href="#项目组成" class="headerlink" title="项目组成"></a>项目组成</h1><p>Spring Boot 的<a href="https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project" target="_blank" rel="noopener">各个子项目</a>组成及结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">spring-boot-dependencies (Parent pom)</span><br><span class="line">  spring-boot-parent (Parent pom)</span><br><span class="line">    spring-boot</span><br><span class="line">    spring-boot-autoconfigure</span><br><span class="line">    spring-boot-starters (Parent module)</span><br><span class="line">      spring-boot-starter (Core starter, including auto-configuration support, logging and YAML)</span><br><span class="line">      spring-boot-starter-parent (Parent pom providing dependency and plugin management for applications</span><br><span class="line">		built with Maven)</span><br><span class="line">      spring-boot-starter-web</span><br><span class="line">      ...</span><br><span class="line">    spring-boot-test</span><br><span class="line">    spring-boot-test-autoconfigure</span><br><span class="line">    spring-boot-actuator</span><br><span class="line">    spring-boot-actuator-autoconfigure</span><br><span class="line">    spring-boot-devtools</span><br><span class="line">    spring-boot-cli</span><br><span class="line">    spring-boot-docs</span><br><span class="line">    spring-boot-tools (Parent module)</span><br><span class="line">      spring-boot-autoconfigure-processor</span><br><span class="line">      spring-boot-configuration-processor</span><br><span class="line">      spring-boot-maven-plugin</span><br><span class="line">      spring-boot-gradle-plugin</span><br><span class="line">      ...</span><br></pre></td></tr></table></figure>

<h2 id="项目管理"><a href="#项目管理" class="headerlink" title="项目管理"></a>项目管理</h2><ul>
<li><code>spring-boot-dependencies</code><ul>
<li>用于定义和统一管理 Sprint Boot 的各个依赖版本号，继承自 <code>spring-boot-build</code>。可通过 <code>dependencyManagement</code> 引入该依赖可以解决<strong>单继承问题</strong>。</li>
</ul>
</li>
<li><code>spring-boot-parent</code><ul>
<li>Spring Boot 各个依赖的父 POM，用于构建配置。继承自 <code>spring-boot-dependencies</code>。</li>
</ul>
</li>
</ul>
<h2 id="核心依赖"><a href="#核心依赖" class="headerlink" title="核心依赖"></a>核心依赖</h2><ul>
<li><code>spring-boot</code> Spring Boot 的核心工程。</li>
<li><code>spring-boot-autoconfigure</code> 实现 Spring Boot 自动配置的关键，常用的包含：<ul>
<li>自动配置总开关 <code>@EnableAutoConfiguration</code></li>
<li>各种自动配置类 <code>*AutoConfiguration</code></li>
<li>各种外部化配置属性类 <code>*Properties</code></li>
<li>各种条件化注解类 <code>@ConditionOn*</code></li>
</ul>
</li>
<li><code>spring-boot-starters</code> 起步依赖的父 POM<ul>
<li>Spring Boot 提供的众多起步依赖，用于降低项目依赖的复杂度，清单详见：<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#using-boot-starter" target="_blank" rel="noopener">Starters</a>，例如：<ul>
<li><code>spring-boot-starter</code> 核心起步依赖，包括自动配置支持、日志、YAML 依赖</li>
<li><code>spring-boot-starter-parent</code> 业务项目的<strong>父 POM</strong>，继承自 <code>spring-boot-dependencies</code></li>
<li><code>spring-boot-starter-web</code> WEB 开发相关起步依赖</li>
<li><code>spring-boot-starter-test</code> 测试相关起步依赖</li>
<li>…</li>
</ul>
</li>
<li>起步依赖本质上就是特殊的 Maven 依赖和 Gradle 依赖，利用了<strong>传递依赖</strong>解析，把常用库聚合在一起，组成了几个为特定功能而定制的依赖。</li>
<li>比起减少依赖数量，起步依赖还引入了一些微妙的变化。向项目中添加了某个起步依赖，实际上指定了应用程序所需的<strong>一类功能</strong>。</li>
<li>起步依赖引入的库的版本兼容性都是<strong>经过测试</strong>的，可以放心使用。</li>
</ul>
</li>
</ul>
<h2 id="工具或插件"><a href="#工具或插件" class="headerlink" title="工具或插件"></a>工具或插件</h2><ul>
<li><code>spring-boot-test</code>、<code>spring-boot-test-autoconfigure</code><ul>
<li>提供一系列测试支持，常用的如：<code>@SpringBootTest</code>、mock、web 支持。</li>
</ul>
</li>
<li><code>spring-boot-actuator</code>、<code>spring-boot-actuator-autoconfigure</code><ul>
<li>包含许多额外的特性，以帮助你通过 HTTP 或 JMX 端点来监控和管理生产环境的应用程序。包括以下特性（详见<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#production-ready" target="_blank" rel="noopener">用户手册</a>）：<ul>
<li><strong>Endpoints</strong> Actuator endpoints allow you to monitor and interact with your application. Spring Boot includes a number of built-in endpoints and you can also add your own. For example the <code>health</code> endpoint provides basic application health information. Run up a basic application and look at <code>/actuator/health</code>.</li>
<li><strong>Metrics</strong> Spring Boot Actuator provides dimensional metrics by integrating with <a href="https://micrometer.io/" target="_blank" rel="noopener">Micrometer</a>.</li>
<li><strong>Audit</strong> Spring Boot Actuator has a flexible audit framework that will publish events to an <code>AuditEventRepository</code>. Once Spring Security is in play it automatically publishes authentication events by default. This can be very useful for reporting, and also to implement a lock-out policy based on authentication failures.</li>
</ul>
</li>
</ul>
</li>
<li><code>spring-boot-devtools</code><ul>
<li>热部署、静态资源 livereload 等等。</li>
</ul>
</li>
<li><code>spring-boot-tools</code> 工具集的父 POM。为 Spring Boot 开发者提供的常用工具集。例如：<ul>
<li><code>spring-boot-maven-plugin</code> 插件</li>
<li><code>spring-boot-gradle-plugin</code> 插件</li>
</ul>
</li>
<li><code>spring-boot-cli</code><ul>
<li>命令行工具。</li>
</ul>
</li>
</ul>
<h1 id="POM-配置"><a href="#POM-配置" class="headerlink" title="POM 配置"></a>POM 配置</h1><ul>
<li>方式一：继承 <code>spring-boot-starter-parent</code></li>
<li>方式二：如果已经有父项目，组合 <code>spring-boot-dependencies</code></li>
</ul>
<p>参考：<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using-boot-build-systems.html#using-boot-maven" target="_blank" rel="noopener">Build Systems - Maven</a></p>
<h2 id="继承方式"><a href="#继承方式" class="headerlink" title="继承方式"></a>继承方式</h2><p>Maven 用户可以继承 <code>spring-boot-starter-parent</code> POM 项目以获得合理的默认配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Inherit defaults from Spring Boot --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>你只需要指定 parent 的 <code>&lt;version&gt;</code> 版本号。之后如果你需要引入其它起步依赖，你可以安全的省略起步依赖的 <code>&lt;version&gt;</code> 版本号，parent 会统一管理。</p>
<p>父项目还提供了以下功能：</p>
<ul>
<li>Java 1.8 作为默认的编译器级别</li>
<li>UTF-8 源码编码</li>
<li>提供统一的依赖版本管理（继承自 Maven POM <code>spring-boot-dependencies</code>），可以让你在自己的 pom 中引入依赖时省略版本号定义，保障依赖间的兼容性</li>
<li>An execution of the <a href="https://docs.spring.io/spring-boot/docs/2.1.0.RELEASE/maven-plugin/repackage-mojo.html" target="_blank" rel="noopener"><code>repackage</code> goal</a> with a <code>repackage</code> execution id.</li>
<li>合理的 <a href="https://maven.apache.org/plugins/maven-resources-plugin/examples/filter.html" target="_blank" rel="noopener">resource filtering</a> 配置（<code>application.properties</code> and <code>application.yml</code> including profile-specific files）</li>
<li>合理的 plugin configuration 配置</li>
</ul>
<h2 id="组合方式"><a href="#组合方式" class="headerlink" title="组合方式"></a>组合方式</h2><p>不是每个人都喜欢继承 <code>spring-boot-starter-parent</code> POM 项目。每个公司可能都拥有自己的标准父项目，或者你更愿意明确声明所有 Maven 配置。</p>
<p>即使如此，你仍然可以通过以组合方式使用 <code>scope=import</code>  的 <code>spring-boot-dependencies</code> 依赖来享受依赖管理的好处，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- Import dependency management from Spring Boot --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这种组合方式能解决 Maven 单继承问题。</p>
<h1 id="Maven-插件"><a href="#Maven-插件" class="headerlink" title="Maven 插件"></a>Maven 插件</h1><p><code>spring-boot-maven-plugin</code> 插件内置<a href="https://docs.spring.io/spring-boot/docs/current/maven-plugin/reference/htmlsingle/#goals" target="_blank" rel="noopener">几个 goal</a>，如下：</p>
<table>
<thead>
<tr>
<th align="left">Goal</th>
<th align="left">Description</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><a href="https://docs.spring.io/spring-boot/docs/current/maven-plugin/reference/htmlsingle/#goals-build-image" target="_blank" rel="noopener">spring-boot:build-image</a></td>
<td align="left">Package an application into a OCI image using a buildpack.</td>
<td></td>
</tr>
<tr>
<td align="left"><a href="https://docs.spring.io/spring-boot/docs/current/maven-plugin/reference/htmlsingle/#goals-build-info" target="_blank" rel="noopener">spring-boot:build-info</a></td>
<td align="left">Generate a <code>build-info.properties</code> file based on the content of the current <code>MavenProject</code>.</td>
<td></td>
</tr>
<tr>
<td align="left"><a href="https://docs.spring.io/spring-boot/docs/current/maven-plugin/reference/htmlsingle/#goals-help" target="_blank" rel="noopener">spring-boot:help</a></td>
<td align="left">Display help information on spring-boot-maven-plugin. Call <code>mvn spring-boot:help -Ddetail=true -Dgoal=&lt;goal-name&gt;</code> to display parameter details.</td>
<td></td>
</tr>
<tr>
<td align="left"><a href="https://docs.spring.io/spring-boot/docs/current/maven-plugin/reference/htmlsingle/#goals-repackage" target="_blank" rel="noopener">spring-boot:repackage</a></td>
<td align="left">Repackage existing JAR and WAR archives so that they can be executed from the command line using <code>java -jar</code>. With <code>layout=NONE</code> can also be used simply to package a JAR with nested dependencies (and no main class, so not executable).</td>
<td>常用</td>
</tr>
<tr>
<td align="left"><a href="https://docs.spring.io/spring-boot/docs/current/maven-plugin/reference/htmlsingle/#goals-run" target="_blank" rel="noopener">spring-boot:run</a></td>
<td align="left">Run an application in place.</td>
<td>常用</td>
</tr>
<tr>
<td align="left"><a href="https://docs.spring.io/spring-boot/docs/current/maven-plugin/reference/htmlsingle/#goals-start" target="_blank" rel="noopener">spring-boot:start</a></td>
<td align="left">Start a spring application. Contrary to the <code>run</code> goal, this does not block and allows other goals to operate on the application. This goal is typically used in integration test scenario where the application is started before a test suite and stopped after.</td>
<td></td>
</tr>
<tr>
<td align="left"><a href="https://docs.spring.io/spring-boot/docs/current/maven-plugin/reference/htmlsingle/#goals-stop" target="_blank" rel="noopener">spring-boot:stop</a></td>
<td align="left">Stop an application that has been started by the “start” goal. Typically invoked once a test suite has completed.</td>
<td></td>
</tr>
</tbody></table>
<p>参考：</p>
<ul>
<li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/build-tool-plugins-maven-plugin.html" target="_blank" rel="noopener">Spring Boot Maven Plugin</a></li>
<li><a href="https://docs.spring.io/spring-boot/docs/current/maven-plugin/" target="_blank" rel="noopener">https://docs.spring.io/spring-boot/docs/current/maven-plugin/</a></li>
</ul>
<h2 id="项目运行方式一"><a href="#项目运行方式一" class="headerlink" title="项目运行方式一"></a>项目运行方式一</h2><p>使用 <code>spring-boot-maven-plugin</code> 插件自带的命令 <code>mvn spring-boot:run</code>，快速编译并运行。</p>
<h2 id="项目运行方式二"><a href="#项目运行方式二" class="headerlink" title="项目运行方式二"></a>项目运行方式二</h2><p>先将项目打包成一个可执行的 jar/war 包，使用命令：<code>mvn package spring-boot:repackage</code>。</p>
<p>使用插件打包好的 jar 包内会内嵌一个容器，你可以像运行任何其它应用程序一样运行它：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar target/myapplication-0.0.1-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>

<p>也可以指定运行参数，例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar -spring.profiles.active=prod target/myapplication-0.0.1-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>

<h2 id="项目运行方式三"><a href="#项目运行方式三" class="headerlink" title="项目运行方式三"></a>项目运行方式三</h2><blockquote>
<p>In addition to running Spring Boot applications by using <code>java -jar</code>, it is also possible to make <strong>fully executable</strong> applications for Unix systems. A fully executable jar can be executed like any other executable binary or it can be <a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#deployment.installing.nix-services" target="_blank" rel="noopener">registered with <code>init.d</code> or <code>systemd</code></a>. This helps when installing and managing Spring Boot applications in common production environments.</p>
<p>Fully executable jars work by embedding an extra script at the front of the file. It is recommended that you make your jar or war fully executable only if you intend to execute it directly, rather than running it with <code>java -jar</code> or deploying it to a servlet container.</p>
<p>To create a ‘fully executable’ jar with Maven, use the following plugin configuration:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">executable</span>&gt;</span>true<span class="tag">&lt;/<span class="name">executable</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>You can then run your application by typing <code>./my-application.jar</code> (where <code>my-application</code> is the name of your artifact). The directory containing the jar is used as your application’s working directory.</p>
</blockquote>
<p>更多信息参考：<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#deployment.installing" target="_blank" rel="noopener">7.3 Installing Spring Boot Applications</a></p>
<ul>
<li>Unix/Linux Services<ul>
<li>Installation as an <code>init.d</code> Service (System V)</li>
<li>Installation as a <code>systemd</code> Service (<code>systemd</code> is the successor of the System V init system and is now being used by many modern Linux distributions.)</li>
<li>Customizing the Startup Script</li>
</ul>
</li>
</ul>
<h3 id="在运行时自定义脚本项"><a href="#在运行时自定义脚本项" class="headerlink" title="在运行时自定义脚本项"></a>在运行时自定义脚本项</h3><blockquote>
<p>For items of the script that need to be customized <em>after</em> the jar has been written, you can use environment variables or a <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/deployment.html#deployment.installing.nix-services.script-customization.when-running.conf-file" target="_blank" rel="noopener">config file</a>.</p>
<p>The <a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#deployment.installing.nix-services.script-customization.when-running" target="_blank" rel="noopener">following environment properties</a> are supported with the default script.</p>
</blockquote>
<p>更多信息参考：<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#deployment.installing.nix-services.script-customization.when-running" target="_blank" rel="noopener">7.3.2 Unix/Linux Services - Customizing a Script When It Runs</a></p>
<h1 id="外部配置"><a href="#外部配置" class="headerlink" title="外部配置"></a>外部配置</h1><p>更多信息参考：<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#features.external-config" target="_blank" rel="noopener">5.2. Externalized Configuration</a></p>
<p>Spring Boot 能从多种属性源获得属性，包括如下几处：</p>
<ol>
<li>命令行参数</li>
<li><code>java:comp/env</code> 里的 JNDI 属性</li>
<li>JVM 系统属性</li>
<li>操作系统环境变量</li>
<li>随机生成的带 <code>random.*</code> 前缀的属性（在设置其他属性时，可以引用它们，比如 <code>${random.long}</code>）</li>
<li>应用程序以外的 <code>application.properties</code> 或者 <code>appliaction.yml</code> 文件</li>
<li>打包在应用程序内的 <code>application.properties</code> 或者 <code>appliaction.yml</code> 文件</li>
<li>通过 <code>@PropertySource</code> 标注的属性源</li>
<li>默认属性</li>
</ol>
<p>这个列表按照优先级排序，也就是说，任何在高优先级属性源里设置的属性都会覆盖低优先级的相同属性。例如，命令行参数会覆盖其他属性源里的属性。</p>
<p><code>application.properties</code> 和 <code>application.yml</code> 文件能放在以下四个位置：</p>
<ol>
<li>外置，在相对于应用程序运行目录的 <code>/config</code> 子目录里。</li>
<li>外置，在应用程序运行的目录里。</li>
<li>内置，在 <code>config</code> 包内。</li>
<li>内置，在 <code>Classpath</code> 根目录。</li>
</ol>
<p>同样，这个列表按照优先级排序。也就是说，<code>/config</code> 子目录里的 <code>application.properties</code> 会覆盖应用程序 <code>Classpath</code> 里的 <code>application.properties</code> 中的相同属性。</p>
<p>此外，如果你在同一优先级位置同时有 <code>application.properties</code> 和 <code>application.yml</code>，那么 <code>application.yml</code> 里的属性会覆盖 <code>application.properties</code> 里的属性。</p>
<p>如果需要为自己的 Bean 加上外部配置注入，可以使用注解 <code>@ConfigurationProperties</code>。</p>
<h2 id="配置嵌入式服务器"><a href="#配置嵌入式服务器" class="headerlink" title="配置嵌入式服务器"></a>配置嵌入式服务器</h2><p>Spring Boot 集成了 Tomcat、Jetty 和 Undertow，极大便利了项目部署。下面介绍一些常用配置：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8080 # Server HTTP port.</span></span><br><span class="line"><span class="meta">server.context-path</span>= <span class="string"># Context path</span></span><br></pre></td></tr></table></figure>

<h3 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h3><p>URI 编码配置：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.tomcat.uri-encoding</span>=<span class="string">UTF-8 # Character encoding to use to decode the URI.</span></span><br></pre></td></tr></table></figure>

<p>代理配置：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.tomcat.remote-ip-header</span>= <span class="string"># Name of the http header from which the remote ip is extracted. For instance `X-FORWARDED-FOR`</span></span><br><span class="line"><span class="meta">server.tomcat.protocol-header</span>= <span class="string"># Header that holds the incoming protocol, usually named "X-Forwarded-Proto".</span></span><br><span class="line"><span class="meta">server.tomcat.port-header</span>=<span class="string">X-Forwarded-Port # Name of the HTTP header used to override the original port value.</span></span><br></pre></td></tr></table></figure>

<p>Socket 连接限制及等待超时时间：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.tomcat.max-connections</span>= <span class="string"># Maximum number of connections that the server will accept and process at any given time.</span></span><br><span class="line"><span class="meta">server.connection-timeout</span>= <span class="string"># Time in milliseconds that connectors will wait for another HTTP request before closing the connection. When not set, the connector's container-specific default will be used. Use a value of -1 to indicate no (i.e. infinite) timeout.</span></span><br></pre></td></tr></table></figure>

<p>业务线程池调优：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.tomcat.max-threads</span>=<span class="string">0 # Maximum amount of worker threads. Default 200.</span></span><br><span class="line"><span class="meta">server.tomcat.min-spare-threads</span>=<span class="string">0 # Minimum amount of worker threads.</span></span><br><span class="line"><span class="meta">server.tomcat.accept-count</span>= <span class="string"># Maximum queue length for incoming connection requests when all possible request processing threads are in use.</span></span><br></pre></td></tr></table></figure>

<h3 id="Undertow"><a href="#Undertow" class="headerlink" title="Undertow"></a>Undertow</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置IO线程数, 它主要执行非阻塞的任务,它们会负责多个连接, 默认设置每个CPU核心一个线程</span></span><br><span class="line"><span class="comment"># 不要设置过大，如果过大，启动项目会报错：打开文件数过多</span></span><br><span class="line"><span class="meta">server.undertow.io-threads</span>=<span class="string">16</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 阻塞任务线程池, 当执行类似servlet请求阻塞IO操作, undertow会从这个线程池中取得线程</span></span><br><span class="line"><span class="comment"># 它的值设置取决于系统线程执行任务的阻塞系数，默认值是IO线程数*8</span></span><br><span class="line"><span class="meta">server.undertow.worker-threads</span>=<span class="string">256</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 以下的配置会影响buffer,这些buffer会用于服务器连接的IO操作,有点类似netty的池化内存管理</span></span><br><span class="line"><span class="comment"># 每块buffer的空间大小,越小的空间被利用越充分，不要设置太大，以免影响其他应用，合适即可</span></span><br><span class="line"><span class="meta">server.undertow.buffer-size</span>=<span class="string">1024</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 每个区分配的buffer数量 , 所以pool的大小是buffer-size * buffers-per-region</span></span><br><span class="line"><span class="meta">server.undertow.buffers-per-region</span>=<span class="string">1024</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否分配的直接内存(NIO直接分配的堆外内存)</span></span><br><span class="line"><span class="meta">server.undertow.direct-buffers</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>

<p><a href="https://www.cnblogs.com/duanxz/p/9337022.html" target="_blank" rel="noopener">https://www.cnblogs.com/duanxz/p/9337022.html</a></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>《Spring Boot in Action》</p>
<p><a href="https://github.com/spring-projects/spring-boot" target="_blank" rel="noopener">https://github.com/spring-projects/spring-boot</a></p>
<p><a href="https://docs.spring.io/spring-boot/docs/current/" target="_blank" rel="noopener">https://docs.spring.io/spring-boot/docs/current/</a></p>
<ul>
<li><a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#using-boot-starter" target="_blank" rel="noopener">4.1.5. Using Spring Boot Starters</a></li>
<li><a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#features.external-config" target="_blank" rel="noopener">5.2. Externalized Configuration</a></li>
<li><a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#deployment.installing" target="_blank" rel="noopener">7.3 Installing Spring Boot Applications</a><ul>
<li><a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#deployment.installing.nix-services.script-customization" target="_blank" rel="noopener">7.3.2 Unix/Linux Services - Customizing the Startup Script</a></li>
</ul>
</li>
</ul>
<p><a href="https://yq.aliyun.com/articles/619390" target="_blank" rel="noopener">Spring Boot Tomcat配置</a></p>
</div></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2017/07/10/spring-aop/" class="post-title-link">Spring AOP 面向切面编程总结</a></h2><div class="post-info">2017-07-10<a href="/tags/Java/" title="Java" class="post-demo">Java</a><a href="/tags/Spring/" title="Spring" class="post-demo">Spring</a></div><div class="post-content"><h1 id="AOP-概念"><a href="#AOP-概念" class="headerlink" title="AOP 概念"></a>AOP 概念</h1><p>前面我们重点关注了如何使用依赖注入（DI）管理和配置我们的应用对象，从而实现应用对象之间的解耦，而 AOP 主要实现“横切关注点（cross-cutting concern）”与它们所影响的对象之间的解耦。</p>
<p>在软件开发中，散布于应用中多处的功能被称为“横切关注点（cross-cutting concern）”。通常来讲，这些横切关注点从概念上是与应用的业务逻辑相分离的（但是往往会直接嵌入到应用的业务逻辑之中）。把这些横切关注点与业务逻辑相分离正是面向切面编程（AOP）所要解决的问题。</p>
<p>AOP 补充了 OOP 编程，通过提供另一种思考软件结构的方法。OOP 编程中的模块单元是“类（Class）”，而 AOP 编程中的模块单元是“切面（Aspect）”。</p>
<p>切面提供了取代继承和委托的另一种可选方案，而且在很多场景下更清晰简洁。在使用面向切面编程时，我们仍然在一个地方定义通用功能，但是可以通过<strong>声明的方式</strong>定义这个功能要以何种方式在何处应用，而无需修改受影响的类。横切关注点可以被模块化为特殊的类，这些类被称为切面（aspect）。这样做有两个好处：</p>
<ul>
<li>首先，现在每个关注点都集中于一个地方，而不是分散到多处代码中；</li>
<li>其次，服务模块更简洁，因为它们只包含主要关注点（或核心功能）的代码，而次要关注点的代码被转移到切面中了。</li>
</ul>
<p>AOP 的一些场景如下：</p>
<ul>
<li>日志</li>
<li>事务，如 Spring Transactional</li>
<li>安全，如 Spring Security</li>
<li>缓存，如 Spring Cache</li>
</ul>
<p>AOP 的知识点总结：</p>
<p><img src="/img/spring/aop/AOP.png" alt="AOP 总览"></p>
<h1 id="AOP-术语"><a href="#AOP-术语" class="headerlink" title="AOP 术语"></a>AOP 术语</h1><p>与大多数技术一样，AOP 已经形成了自己的术语。下图展示了这些概念是如何关联在一起的：</p>
<p><img src="/img/spring/aop/aop_terminology.png" alt="An aspect&#39;s functionality (advice) is woven into a program&#39;s execution at one or more join points."></p>
<h2 id="切面（Aspect）"><a href="#切面（Aspect）" class="headerlink" title="切面（Aspect）"></a>切面（Aspect）</h2><p>什么是切面？通俗来说就是“何时何地发生何事”，其组成如下：</p>
<blockquote>
<p>Aspect = Advice (what &amp; when) + Pointcut (where)</p>
</blockquote>
<h2 id="通知（Advice）"><a href="#通知（Advice）" class="headerlink" title="通知（Advice）"></a>通知（Advice）</h2><p>通知（Advice）定义了<strong>何时（when）</strong>发生<strong>何事（what）</strong>。</p>
<p>Spring AOP 的切面（Aspect）可以搭配下面五种通知（Advice）注解使用：</p>
<table>
<thead>
<tr>
<th>通知</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>@Before</code></td>
<td>The advice functionality takes place before the advised method is invoked.</td>
</tr>
<tr>
<td><code>@After</code></td>
<td>The advice functionality takes place after the advised method completes, regardless of the outcome.</td>
</tr>
<tr>
<td><code>@AfterReturning</code></td>
<td>The advice functionality takes place after the advised method successfully completes.</td>
</tr>
<tr>
<td><code>@AfterThrowing</code></td>
<td>The advice functionality takes place after the advised method throws an exception.</td>
</tr>
<tr>
<td><code>@Around</code></td>
<td>The advice wraps the advised method, providing some functionality before and after the advised method is invoked.</td>
</tr>
</tbody></table>
<h2 id="切点（Pointcut）"><a href="#切点（Pointcut）" class="headerlink" title="切点（Pointcut）"></a>切点（Pointcut）</h2><p>切点（Pointcut）定义了切面在<strong>何处（where）</strong>执行。</p>
<p>Spring AOP 的切点（Pointcut）使用 AspectJ 的“<strong>切点表达式语言（Pointcut Expression Language）</strong>”进行定义。但要注意的是，Spring 仅支持其中一个子集：</p>
<p><img src="/img/spring/aop/aop_aspectj_designator.png" alt="切面指示器（Aspectj Designator）"></p>
<p>切点表达式的语法如下：</p>
<p><img src="/img/spring/aop/aop_pointcut_expression.png" alt="切点表达式（Pointcut Expression）"></p>
<h2 id="连接点（Join-point）"><a href="#连接点（Join-point）" class="headerlink" title="连接点（Join point）"></a>连接点（Join point）</h2><p>连接点是在应用执行过程中能够插入切面的一个点。这个点可以是调用方法时、抛出异常时、甚至修改一个字段时。切面代码可以利用这些点插入到应用的正常流程之中，并添加新的行为。</p>
<h2 id="织入（Weaving）"><a href="#织入（Weaving）" class="headerlink" title="织入（Weaving）"></a>织入（Weaving）</h2><p>织入是把切面应用到目标对象并创建<strong>新的代理对象</strong>的过程。切面（aspect）在指定的连接点（join point）被织入（weaving）到目标对象中。在目标对象的生命周期里有多个点可以进行织入：</p>
<table>
<thead>
<tr>
<th>生命周期</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>编译期</td>
<td>切面在目标类编译时被织入。这种方式需要<strong>特殊的编译器</strong>。AspectJ Compiler 就是以这种方式织入切面的。</td>
</tr>
<tr>
<td>类加载期</td>
<td>切面在目标类加载到 JVM 时被织入。这种方式需要<strong>特殊的类加载器</strong>，它可以在目标类被引入应用之前增强该目标类的字节码。AspectJ 5 的<a href="http://www.eclipse.org/aspectj/doc/next/devguide/ltw.html" target="_blank" rel="noopener">加载时织入（load-time weaving, LTW）</a>就支持以这种方式织入切面。</td>
</tr>
<tr>
<td>运行期</td>
<td>切面在应用运行的某个时刻被织入。一般情况下，在织入切面时，AOP 容器会为目标对象动态地创建一个代理对象。Spring AOP 就是以这种方式织入切面的。Spring AOP 构建在动态代理基础之上，因此，Spring 对 AOP 的支持局限于方法拦截。如果你的 AOP 需求超过了简单的方法调用（如构造器或属性拦截），那么你需要考虑使用 AspectJ 来实现切面。</td>
</tr>
</tbody></table>
<h1 id="Spring-AOP-与-AspectJ-AOP-对比"><a href="#Spring-AOP-与-AspectJ-AOP-对比" class="headerlink" title="Spring AOP 与 AspectJ AOP 对比"></a>Spring AOP 与 AspectJ AOP 对比</h1><p>这里总结下 Spring AOP 和 AspectJ AOP 两种织入方式的优缺点：</p>
<h2 id="Spring-AOP-优点"><a href="#Spring-AOP-优点" class="headerlink" title="Spring AOP 优点"></a>Spring AOP 优点</h2><ul>
<li><p>使用方式比 AspectJ 简单，无需特殊的 LTW 或 AspectJ Compiler，仅在运行时通知对象</p>
<blockquote>
<p>通过在代理类中包裹切面，Spring 在运行期把切面织入到 Spring 管理的 bean 中。如下图所示，代理类封装了目标类，并拦截被通知方法的调用，再把调用转发给真正的目标 bean。当代理拦截到方法调用时，在调用目标 bean 方法之前，会执行切面逻辑。</p>
</blockquote>
<p><img src="/img/java/proxy/Proxy.png" alt="Spring 的切面由包裹了目标对象的代理类实现。代理类处理方法的调用，执行额外的切面逻辑，并调用目标方法"></p>
<blockquote>
<p>直到应用需要被代理的 bean 时，Spring 才创建代理对象。如果使用的是 <code>ApplicationContext</code> 的话，在 <code>ApplicationContext</code> 从 <code>BeanFactory</code> 中<strong>加载所有 bean 的时候</strong>，Spring 才会创建被代理的对象。因为 Spring 运行时才创建代理对象，所以我们不需要特殊的编译器来织入 Spring AOP 的切面。</p>
</blockquote>
</li>
<li><p>Advice 使用 Java 编写，使用成本低</p>
<blockquote>
<p>Spring 所创建的通知（Advice）都是用标准的 Java 类编写的。这样的话，我们就可以使用与普通 Java 开发一样的集成开发环境（IDE）来开发切面。而且，定义通知所应用的切点通常会使用注解或在 Spring 配置文件里采用 XML 来编写，这两种语法对于Java开发者来说都是相当熟悉的。</p>
<p>AspectJ 与之相反。虽然 AspectJ 现在支持基于注解的切面，但 AspectJ 最初是以 Java 语言扩展的方式实现的。这种方式有优点也有缺点。通过特有的 AOP 语言，我们可以获得更强大和细粒度的控制，以及更丰富的 AOP 工具集，但是我们需要额外学习新的工具和语法。</p>
</blockquote>
</li>
</ul>
<h2 id="Spring-AOP-缺点"><a href="#Spring-AOP-缺点" class="headerlink" title="Spring AOP 缺点"></a>Spring AOP 缺点</h2><ul>
<li><p>只支持方法级别的 join points，局限于 public 方法拦截。</p>
<blockquote>
<p>正如前面所探讨过的，通过使用各种 AOP 方案可以支持多种连接点模型。因为 Spring 基于<strong>动态代理</strong>，所以 Spring 只支持<strong>方法连接点</strong>。这与一些其他的 AOP 框架是不同的，例如 AspectJ 和 JBoss，除了方法切点，它们还提供了字段和构造器接入点。Spring 缺少对字段连接点的支持，无法让我们创建细粒度的通知，例如拦截对象字段的修改。而且它不支持构造器连接点，我们就无法在 bean 创建时应用通知。</p>
<p>但是方法拦截可以满足绝大部分的需求。如果需要方法拦截之外的连接点拦截功能，那么我们可以利用 Aspect 来补充 Spring AOP 的功能。</p>
</blockquote>
</li>
<li><p>受限于 JDK Proxy 以及 CGLib Proxy<strong>（Spring 风格）</strong>的特点，不支持方法自调用（self-invocation），即同一个类中的方法调用无法应用切面。</p>
</li>
<li><p>无法将切面应用到非 Spring 工厂创建的 bean。</p>
</li>
<li><p>有一定的运行时开销。</p>
</li>
</ul>
<h2 id="AspectJ-AOP-优点"><a href="#AspectJ-AOP-优点" class="headerlink" title="AspectJ AOP 优点"></a>AspectJ AOP 优点</h2><ul>
<li>支持所有类型的 join points（构造器、字段、方法），可以做细粒度的控制。</li>
<li>支持任意访问修饰符（如 protected、private）、支持方法自调用（self-invocation）。</li>
</ul>
<h2 id="AspectJ-AOP-缺点"><a href="#AspectJ-AOP-缺点" class="headerlink" title="AspectJ AOP 缺点"></a>AspectJ AOP 缺点</h2><ul>
<li>使用上要小心，确保切面只织入到需要被织入的地方。</li>
<li>需要额外的 LTW 或 AspectJ Compiler。</li>
</ul>
<h1 id="Spring-对-AOP-的支持"><a href="#Spring-对-AOP-的支持" class="headerlink" title="Spring 对 AOP 的支持"></a>Spring 对 AOP 的支持</h1><p>Spring AOP 的设计理念和大多数其它 AOP 框架不同。目标并不是为了提供一个最完整的 AOP 实现，而是为了提供一个 AOP 实现与 Spring IoC 的紧密集成，以帮助解决企业级应用的常见问题。</p>
<h2 id="Spring-AOP-的两种实现方式"><a href="#Spring-AOP-的两种实现方式" class="headerlink" title="Spring AOP 的两种实现方式"></a>Spring AOP 的两种实现方式</h2><p>字节码操作库有很多，常用的例如：</p>
<ul>
<li>官方库：<a href="http://cr.openjdk.java.net/~jjg/199-269/199.api/java.compiler-summary.html" target="_blank" rel="noopener">JDK 9 - JEP 199 - Java Compiler API</a>。用于 JSP 引擎、等等。</li>
<li>三方库：ASM、Javassist</li>
</ul>
<p><img src="/img/spring/aop/aop_lib.png" alt="aop_lib"></p>
<h3 id="JDK-Proxy"><a href="#JDK-Proxy" class="headerlink" title="JDK Proxy"></a>JDK Proxy</h3><p>参考：《<a href="/2018/12/01/java-jdk-proxy/">Java 反射篇（四）JDK 动态代理总结</a>》</p>
<h3 id="CGLib"><a href="#CGLib" class="headerlink" title="CGLib"></a>CGLib</h3><p>基于 ASM 库。</p>
<p>参考：<a href="https://github.com/cglib/cglib/wiki" target="_blank" rel="noopener">https://github.com/cglib/cglib/wiki</a></p>
<p><img src="/img/spring/aop/cglib.png" alt="cglib"></p>
<h3 id="两种实现方式对比"><a href="#两种实现方式对比" class="headerlink" title="两种实现方式对比"></a>两种实现方式对比</h3><p>Spring AOP 支持两种模式的动态代理，JDK Proxy 或者 CGLib：</p>
<p><img src="/img/spring/aop/springaop-process.png" alt="Spring AOP process"></p>
<p>两种模式的优势如下：</p>
<ul>
<li><p>JDK Proxy</p>
<ul>
<li>最小化依赖关系，减少依赖意味着简化开发和维护，JDK 本身的支持，可能比 CGLib 更加可靠。</li>
<li>平滑进行 JDK 版本升级，而第三方字节码类库通常需要进行更新以保证在新版 Java 上能够使用。</li>
<li>代码实现简单，主要利用 JDK 反射机制。</li>
</ul>
</li>
<li><p>CGLib Proxy</p>
<ul>
<li>有的时候调用目标可能不便实现额外接口，从某种角度看，限定调用者实现接口是有些侵入性的实践，类似 CGLib 动态代理就没有这种限制。CGLib 动态代理采取的是创建目标类的子类的方式，因为是子类化，我们可以达到近似使用被调用者本身的效果。</li>
<li>只操作我们关心的类，而不必为其它相关类增加工作量。</li>
<li>性能更好，相对于低版本的 JDK Proxy。</li>
</ul>
</li>
</ul>
<h3 id="核心源码解析"><a href="#核心源码解析" class="headerlink" title="核心源码解析"></a>核心源码解析</h3><p><img src="/img/spring/aop/AopProxy.png" alt="AopProxy 实现结构"></p>
<p><code>org.springframework.aop.framework.DefaultAopProxyFactory</code> 工厂类负责判断创建哪个 <code>AopProxy</code> 实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultAopProxyFactory</span> <span class="keyword">implements</span> <span class="title">AopProxyFactory</span>, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AopProxy <span class="title">createAopProxy</span><span class="params">(AdvisedSupport config)</span> <span class="keyword">throws</span> AopConfigException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (config.isOptimize() || config.isProxyTargetClass() || hasNoUserSuppliedProxyInterfaces(config)) &#123;</span><br><span class="line">            Class&lt;?&gt; targetClass = config.getTargetClass();</span><br><span class="line">            <span class="keyword">if</span> (targetClass == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> AopConfigException(<span class="string">"TargetSource cannot determine target class: "</span> +</span><br><span class="line">                        <span class="string">"Either an interface or a target is required for proxy creation."</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (targetClass.isInterface() || Proxy.isProxyClass(targetClass)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> JdkDynamicAopProxy(config);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ObjenesisCglibAopProxy(config);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> JdkDynamicAopProxy(config);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Determine whether the supplied &#123;<span class="doctag">@link</span> AdvisedSupport&#125; has only the</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> org.springframework.aop.SpringProxy&#125; interface specified</span></span><br><span class="line"><span class="comment">     * (or no proxy interfaces specified at all).</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">hasNoUserSuppliedProxyInterfaces</span><span class="params">(AdvisedSupport config)</span> </span>&#123;</span><br><span class="line">        Class&lt;?&gt;[] ifcs = config.getProxiedInterfaces();</span><br><span class="line">        return (ifcs.length == 0 || (ifcs.length == 1 &amp;&amp; SpringProxy.class.isAssignableFrom(ifcs[0])));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>org.springframework.aop.framework.CglibAopProxy</code></p>
<p><code>org.springframework.aop.framework.JdkDynamicAopProxy</code>，两个关键方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">JdkDynamicAopProxy</span> <span class="keyword">implements</span> <span class="title">AopProxy</span>, <span class="title">InvocationHandler</span>, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建基于接口的 JDK 动态代理</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getProxy</span><span class="params">(ClassLoader classLoader)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">            logger.debug(<span class="string">"Creating JDK dynamic proxy: target source is "</span> + <span class="keyword">this</span>.advised.getTargetSource());</span><br><span class="line">        &#125;</span><br><span class="line">        Class&lt;?&gt;[] proxiedInterfaces = AopProxyUtils.completeProxiedInterfaces(<span class="keyword">this</span>.advised, <span class="keyword">true</span>);</span><br><span class="line">        findDefinedEqualsAndHashCodeMethods(proxiedInterfaces);</span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(classLoader, proxiedInterfaces, <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Implementation of &#123;<span class="doctag">@code</span> InvocationHandler.invoke&#125;.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="comment">// Get the interception chain for this method.</span></span><br><span class="line">        List&lt;Object&gt; chain = <span class="keyword">this</span>.advised.getInterceptorsAndDynamicInterceptionAdvice(method, targetClass);</span><br><span class="line">        </span><br><span class="line">        ...</span><br><span class="line">        <span class="comment">// We need to create a method invocation...</span></span><br><span class="line">        invocation = <span class="keyword">new</span> ReflectiveMethodInvocation(proxy, target, method, args, targetClass, chain);</span><br><span class="line">        <span class="comment">// Proceed to the joinpoint through the interceptor chain.</span></span><br><span class="line">        retVal = invocation.proceed();</span><br><span class="line">        </span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>官方文档的一些关键摘录：</p>
<h4 id="AOP-Proxies"><a href="#AOP-Proxies" class="headerlink" title="AOP Proxies"></a>AOP Proxies</h4><p>Spring AOP defaults to using standard JDK dynamic proxies for AOP proxies. This enables any interface (or set of interfaces) to be proxied.</p>
<p>Spring AOP can also use CGLIB proxies. This is necessary to proxy classes rather than interfaces. By default, CGLIB is used if a business object does not implement an interface. As it is good practice to program to interfaces rather than classes, business classes normally implement one or more business interfaces. It is possible to <a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#aop-proxying" target="_blank" rel="noopener">force the use of CGLIB</a>, in those (hopefully rare) cases where you need to advise a method that is not declared on an interface or where you need to pass a proxied object to a method as a concrete type.</p>
<p>It is important to grasp the fact that Spring AOP is proxy-based. See <a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#aop-understanding-aop-proxies" target="_blank" rel="noopener">Understanding AOP Proxies</a> for a thorough examination of exactly what this implementation detail actually means.</p>
<h4 id="Proxying-Mechanisms"><a href="#Proxying-Mechanisms" class="headerlink" title="Proxying Mechanisms"></a>Proxying Mechanisms</h4><p>Spring AOP uses either JDK dynamic proxies or CGLIB to create the proxy for a given target object. (JDK dynamic proxies are preferred whenever you have a choice).</p>
<p>If the target object to be proxied implements at least one interface, a JDK dynamic proxy is used. All of the interfaces implemented by the target type are proxied. If the target object does not implement any interfaces, a CGLIB proxy is created.</p>
<p>If you want to force the use of CGLIB proxying (for example, to proxy every method defined for the target object, not only those implemented by its interfaces), you can do so. However, you should consider the following issues:</p>
<ul>
<li><code>final</code> methods cannot be advised, as they cannot be overridden.</li>
<li>As of Spring 3.2, it is no longer necessary to add CGLIB to your project classpath, as CGLIB classes are repackaged under <code>org.springframework</code> and included directly in the spring-core JAR. This means that CGLIB-based proxy support “just works”, in the same way that JDK dynamic proxies always have.</li>
<li>As of Spring 4.0, the constructor of your proxied object is NOT called twice any more, since the CGLIB proxy instance is created through Objenesis. Only if your JVM does not allow for constructor bypassing, you might see double invocations and corresponding debug log entries from Spring’s AOP support.</li>
</ul>
<p>To force the use of CGLIB proxies, set the value of the <code>proxy-target-class</code> attribute of the <code>&lt;aop:config&gt;</code> element to true, as follows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span> <span class="attr">proxy-target-class</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- other beans defined here... --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>To force CGLIB proxying when you use the @AspectJ auto-proxy support, set the <code>proxy-target-class</code> attribute of the <code>&lt;aop:aspectj-autoproxy&gt;</code> element to <code>true</code>, as follows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> <span class="attr">proxy-target-class</span>=<span class="string">"true"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Spring-AOP-切面声明的两种方式"><a href="#Spring-AOP-切面声明的两种方式" class="headerlink" title="Spring AOP 切面声明的两种方式"></a>Spring AOP 切面声明的两种方式</h2><p>Spring 2.0 之后提供了以下两种方式，为编写自定义切面引入了一种更简单和更强大的方式：</p>
<h3 id="schema-based-approach"><a href="#schema-based-approach" class="headerlink" title="schema-based approach"></a>schema-based approach</h3><p><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#aop-schema" target="_blank" rel="noopener">schema-based approach</a>，手工声明切面方式。下面是一个完整的例子：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- this is the object that will be proxied by Spring's AOP infrastructure --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"personService"</span> <span class="attr">class</span>=<span class="string">"x.y.service.DefaultPersonService"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- this is the actual advice itself --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myAspect"</span> <span class="attr">class</span>=<span class="string">"x.y.MyAspect"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- cglib 代理方式配置：proxy-target-class="true" --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"myAspect"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"theExecutionOfSomePersonServiceMethod"</span> <span class="attr">expression</span>=<span class="string">"execution(* x.y.service.PersonService.getPerson(String,int)) and args(name, age)"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">pointcut-ref</span>=<span class="string">"theExecutionOfSomePersonServiceMethod"</span> <span class="attr">method</span>=<span class="string">"process"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="AspectJ-annotation-style"><a href="#AspectJ-annotation-style" class="headerlink" title="@AspectJ annotation style"></a>@AspectJ annotation style</h3><p><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#aop-ataspectj" target="_blank" rel="noopener">@AspectJ annotation style</a></p>
<ul>
<li><code>@AspectJ</code> 注解风格作为 AspectJ 5 发行版的一部分被引入。Spring 利用了这个注解，使用了 AspectJ 提供的类库进行切点解析和匹配。然而，AOP 运行时仍然是纯 Spring AOP，并且不依赖于 AspectJ 编译器和织入器。</li>
<li>The <code>@AspectJ</code> support can be enabled with XML- or Java-style configuration. In either case, you also need to ensure that AspectJ’s <code>aspectjweaver.jar</code> library is on the classpath of your application (version 1.8 or later).</li>
</ul>
<p>配置如下：</p>
<ul>
<li><p>Java Config 方式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 声明 Java Config</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">// 开启组件扫描，将 MethodCacheInterceptor 作为 bean 注册到 Spring 容器</span></span><br><span class="line"><span class="meta">@ComponentScan</span></span><br><span class="line"><span class="comment">// 开启自动代理</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConertConfig</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>注解 <code>@EnableAspectJAutoProxy</code> 用于开启 AspectJ 自动代理，为使用 <code>@Aspect</code> 注解的 bean 创建一个代理。其中 <code>proxyTargetClass</code> 属性用于控制代理方式：</p>
<ul>
<li>true 表示开启 CGLIB 风格的子类继承代理（CGLIB-style ‘subclass’ proxy）</li>
<li>默认为 false 表示开启基于接口的 JDK 动态代理（interface-based JDK proxy）</li>
</ul>
</li>
<li><p>XML 配置方式：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"your.package"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> /&gt;</span>  <span class="comment">&lt;!-- 代理方式配置：proxy-target-class="true" --&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h1><p>由于项目中散落着各种使用缓存的代码，这些缓存代码与业务逻辑代码交织耦合在一起既编写重复又难以维护，因此打算将这部分缓存代码抽取出来形成一个注解以便使用。</p>
<p>这样的需求最适合通过 AOP 来解决了，来看看如何在 Spring 框架下通过 AOP 和注解实现方法缓存：</p>
<h2 id="自定义注解"><a href="#自定义注解" class="headerlink" title="自定义注解"></a>自定义注解</h2><p>首先，自定义一个方法注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> your.<span class="keyword">package</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 方法级缓存</span></span><br><span class="line"><span class="comment"> * 标注了这个注解的方法返回值将会被缓存</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Target</span>(ElementType.METHOD)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MethodCache &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 缓存过期时间，单位是秒</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">expire</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="编写切面"><a href="#编写切面" class="headerlink" title="编写切面"></a>编写切面</h2><p>使用注解来创建切面，是 AspectJ 5 所引入的关键特性。在 AspectJ 5 之前，编写 AspectJ 切面需要学习一种 Java 语言的扩展，很不友好。在此我们使用注解来实现我们的切面：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> your.<span class="keyword">package</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Annotation;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.reflect.MethodSignature;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.kingdee.finance.cache.service.centralize.CentralizeCacheService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 方法级缓存拦截器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MethodCacheInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String CACHE_NAME = <span class="string">"Your unique cache name"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CentralizeCacheService centralizeCacheService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 搭配 AspectJ 指示器“<span class="doctag">@annotation</span>()”可以使本切面成为某个注解的代理实现</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Around</span>(<span class="string">"@annotation(your.package.MethodCache)"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">around</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        String cacheKey = getCacheKey(joinPoint);</span><br><span class="line">        Serializable serializable = centralizeCacheService.get(CACHE_NAME, cacheKey);</span><br><span class="line">        <span class="keyword">if</span> (serializable != <span class="keyword">null</span>) &#123;</span><br><span class="line">            log.info(<span class="string">"cache hit，key [&#123;&#125;]"</span>, cacheKey);</span><br><span class="line">            <span class="keyword">return</span> serializable;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            log.info(<span class="string">"cache miss，key [&#123;&#125;]"</span>, cacheKey);</span><br><span class="line">            Object result = joinPoint.proceed(joinPoint.getArgs());</span><br><span class="line">            <span class="keyword">if</span> (result == <span class="keyword">null</span>) &#123;</span><br><span class="line">                log.error(<span class="string">"fail to get data from source，key [&#123;&#125;]"</span>, cacheKey);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                MethodCache methodCache = getAnnotation(joinPoint, MethodCache<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">                centralizeCacheService.put(CACHE_NAME, methodCache.expire(), cacheKey, (Serializable) result);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据类名、方法名和参数值获取唯一的缓存键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 格式为 "包名.类名.方法名.参数类型.参数值"，类似 "your.package.SomeService.getById(int).123"</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getCacheKey</span><span class="params">(ProceedingJoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">"%s.%s"</span>, </span><br><span class="line">                 joinPoint.getSignature().toString().split(<span class="string">"\\s"</span>)[<span class="number">1</span>], StringUtils.join(joinPoint.getArgs(), <span class="string">","</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> &lt;T extends Annotation&gt; <span class="function">T <span class="title">getAnnotation</span><span class="params">(ProceedingJoinPoint jp, Class&lt;T&gt; clazz)</span> </span>&#123;</span><br><span class="line">        MethodSignature sign = (MethodSignature) jp.getSignature();</span><br><span class="line">        Method method = sign.getMethod();</span><br><span class="line">        <span class="keyword">return</span> method.getAnnotation(clazz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要注意的是，目前该实现存在两个限制：</p>
<ol>
<li>方法入参必须为基本数据类型或者字符串类型，使用其它引用类型的参数会导致缓存键构造有误；</li>
<li>方法返回值必须实现  <code>Serializable</code> 接口；</li>
</ol>
<h2 id="开启动态代理"><a href="#开启动态代理" class="headerlink" title="开启动态代理"></a>开启动态代理</h2><p>最后，开启 Spring 的组件扫描、自动代理功能：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 声明 Java Config</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">// 开启组件扫描，将 MethodCacheInterceptor 作为 bean 注册到 Spring 容器</span></span><br><span class="line"><span class="meta">@ComponentScan</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConertConfig</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="投入使用"><a href="#投入使用" class="headerlink" title="投入使用"></a>投入使用</h2><p>例如，使用本注解为一个“按 ID 查询列表”的方法加上五分钟的缓存：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MethodCache</span>(expire = <span class="number">300</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">listById</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// return a string list.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>使用 AOP 技术，你可以在一个地方定义所有的通用逻辑，并通过<strong>声明式（declaratively）</strong>的方式进行使用，而不必修改各个业务类的实现。这种代码解耦技术使得我们的业务代码更纯粹、仅包含所需的业务逻辑。相比继承（inheritance）和委托（delegation），AOP 实现相同的功能，代码会更整洁。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>《<a href="https://www.manning.com/books/spring-in-action-fourth-edition" target="_blank" rel="noopener">Spring in Action, 4th</a>》</p>
<p><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#aop" target="_blank" rel="noopener">https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#aop</a></p>
<p>AspectJ</p>
<ul>
<li><p><a href="https://livebook.manning.com/book/aspectj-in-action-second-edition/chapter-8/" target="_blank" rel="noopener">https://livebook.manning.com/book/aspectj-in-action-second-edition/chapter-8/</a></p>
</li>
<li><p>《<a href="https://www.eclipse.org/aspectj/docs.php" target="_blank" rel="noopener">AspectJ Docs</a>》</p>
</li>
<li><p>《<a href="http://www.eclipse.org/aspectj/doc/released/devguide/ajc-ref.html" target="_blank" rel="noopener">AspectJ Compiler (ajc)</a>》</p>
</li>
</ul>
<p><a href="http://openjdk.java.net/jeps/199" target="_blank" rel="noopener">http://openjdk.java.net/jeps/199</a></p>
<p><a href="https://github.com/cglib/cglib/wiki" target="_blank" rel="noopener">https://github.com/cglib/cglib/wiki</a></p>
<p><a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/context/annotation/EnableAspectJAutoProxy.html" target="_blank" rel="noopener">@EnableAspectJAutoProxy</a></p>
<p><a href="https://www.cnblogs.com/xrq730/p/6661692.html" target="_blank" rel="noopener">https://www.cnblogs.com/xrq730/p/6661692.html</a></p>
</div></article></li></ul><div class="right-container"><div class="widget"><div class="tagcloud"><h4>标签云</h4><a href="/tags/C-C/" style="font-size: 15px;">C/C++</a> <a href="/tags/DNS/" style="font-size: 12.5px;">DNS</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/GNU-Linux/" style="font-size: 16.67px;">GNU/Linux</a> <a href="/tags/Git/" style="font-size: 17.5px;">Git</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/MySQL/" style="font-size: 19.17px;">MySQL</a> <a href="/tags/Nginx/" style="font-size: 11.67px;">Nginx</a> <a href="/tags/Redis/" style="font-size: 10.83px;">Redis</a> <a href="/tags/Spring/" style="font-size: 15.83px;">Spring</a> <a href="/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" style="font-size: 11.67px;">函数式编程</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 18.33px;">前端</a> <a href="/tags/%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B/" style="font-size: 11.67px;">响应式编程</a> <a href="/tags/%E5%AE%89%E5%85%A8/" style="font-size: 12.5px;">安全</a> <a href="/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" style="font-size: 11.67px;">并发编程</a> <a href="/tags/%E5%BB%BA%E7%AB%99/" style="font-size: 13.33px;">建站</a> <a href="/tags/%E7%AE%A1%E7%90%86/" style="font-size: 12.5px;">管理</a> <a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" style="font-size: 14.17px;">读书笔记</a> <a href="/tags/%E9%87%91%E8%9E%8D/" style="font-size: 12.5px;">金融</a></div></div><div class="widget"><div class="recent"><h4>最近文章</h4><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2021/02/26/cpp-io-library/">C/C++ 语言系列（十一）I/O 库总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/25/cpp-oop-inheritance-and-polymorphism/">C/C++ 语言系列（十）面向对象编程之继承与多态</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/20/cpp-oop-class/">C/C++ 语言系列（九）面向对象编程之类、类模板、类指针</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/18/cpp-type-aliases/">C/C++ 语言系列（八）复合数据类型之类型别名</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/16/cpp-struct/">C/C++ 语言系列（七）复合数据类型之结构体</a></li></ul></div></div></div></section></div><div class="right-menu"></div><div class="modal search-modal"><div class="input-field"><input type="text" id="search_input"><label for="search-input">搜索</label></div><div id="search_result" class="search-result"></div></div><div class="blog-overlay"></div><footer class="row"><div class="footer-con"><div class="paginator"><a href="/page/9/" class="prev">PREV</a><a href="/page/11/" class="next">NEXT</a></div><div class="copyright"><p>© 2014 - 2021 <a href="https://github.com/qidawu" target="_blank">Qida's Blog</a></p><p>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <br> and <a href="https://github.com/Bulandent/hexo-theme-bubuzou" target="_blank">hexo-theme-bubuzou</a></p></div><div class="totop"><i></i></div></div></footer><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src="/scripts/jquery-1.8.2.min.js"></script><script src="https://cdn1.lncld.net/static/js/av-mini-0.6.10.js"></script><script src="/scripts/hit-kounter-lc-0.2.0.js"></script><script src="/scripts/arAnchor.js"></script><script src="/scripts/main.js"></script></body></html>