<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content="1EB8XoOl0C"><meta name="google-site-verification" content="K7thEgdLm0UfRWJ5MGdF7sCcjClSzAlxFLPv2Oz5CGM"><title> Qida's Blog</title><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="学习笔记 知识总结 思考感悟"><meta name="keywords"><meta name="author" content="Qida's Blog"><link rel="short icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/bubuzou.css"><link rel="search" type="application/opensearchdescription+xml" href="https://qidawu.github.io/atom.xml" title="Qida's Blog"><meta name="generator" content="Hexo 4.2.1"></head><body><header><div class="header row"> <a href="/" class="logo-link"><img src="/images/logo.png"></a><a href="/" class="title-link">Qida's Blog</a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" data-hover="博文" class="nav-list-link">博文</a></li><li class="nav-list-item"><a href="/archives/" target="_self" data-hover="归档" class="nav-list-link">归档</a></li></ul><div class="search"><a id="search_btn" href="#search"></a></div></div></header><div class="row scroll-con"><section class="container"><!-- for archive page--><ul class="home post-list"><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2017/02/07/fiddler/" class="post-title-link">使用 Fiddler 代理调试 APP 页面</a></h2><div class="post-info">2017-02-07<a href="/tags/前端/" title="前端" class="post-demo">前端</a></div><div class="post-content"><p>我们知道如何在电脑上通过 Chrome、Firefox 调试页面请求，但在手机端呢？我们可以使用 fiddler 来调试webapp。fiddler 是一个很好的调试、抓包工具。</p>
<p>问题：在客户端打开页面有问题，但浏览器正常；（由于客户端特定的环境，我们无法在电脑端浏览器调试定位一些问题，线上环境，更不能修改代码来调试。怎么办？ 用Fiddler 代理本地文件来调试）</p>
<p>解决办法： 使用Fiddler 代理调试APP页面；</p>
<h1 id="PC-端设置"><a href="#PC-端设置" class="headerlink" title="PC 端设置"></a>PC 端设置</h1><h2 id="Fiddler-安装"><a href="#Fiddler-安装" class="headerlink" title="Fiddler 安装"></a>Fiddler 安装</h2><p><a href="https://www.telerik.com/download/fiddler" target="_blank" rel="noopener">https://www.telerik.com/download/fiddler</a></p>
<h2 id="Fiddler-设置"><a href="#Fiddler-设置" class="headerlink" title="Fiddler 设置"></a>Fiddler 设置</h2><p>首先打开Fiddler-&gt;Tools-&gt;Fiddler Options 进行配置，配置完成后重启 Fiddler，如下图：</p>
<p><img src="/img/fiddler/fiddler_setting.png" alt="Fiddler 设置"></p>
<h2 id="关闭防火墙"><a href="#关闭防火墙" class="headerlink" title="关闭防火墙"></a>关闭防火墙</h2><p>关闭本机防火墙，避免手机无法 ping 通。</p>
<h1 id="iPhone-手机端调试"><a href="#iPhone-手机端调试" class="headerlink" title="iPhone 手机端调试"></a>iPhone 手机端调试</h1><p>参考：<a href="http://blog.csdn.net/asmcvc/article/details/51566569" target="_blank" rel="noopener">http://blog.csdn.net/asmcvc/article/details/51566569</a></p>
<h2 id="安装-Fiddler-证书"><a href="#安装-Fiddler-证书" class="headerlink" title="安装 Fiddler 证书"></a>安装 Fiddler 证书</h2><p>手机浏览器访问 172.22.31.43:8888 ，点击安装证书：</p>
<p><img src="/img/fiddler/fiddler_certificate_install_1.png" alt="安装 Fiddler 证书"></p>
<p>提示警告，继续安装：</p>
<p><img src="/img/fiddler/fiddler_certificate_install_2.png" alt="安装 Fiddler 证书"></p>
<p>安装完毕：</p>
<p><img src="/img/fiddler/fiddler_certificate_install_3.png" alt="安装 Fiddler 证书"></p>
<h2 id="证书信任设置"><a href="#证书信任设置" class="headerlink" title="证书信任设置"></a>证书信任设置</h2><p>iOS 10 需要设置：通用 - 关于本机 - 证书信任设置 - 针对根证书启用完全信任：</p>
<p><img src="/img/fiddler/fiddler_certificate_install_4.png" alt="证书信任设置"></p>
<h2 id="WIFI-代理设置"><a href="#WIFI-代理设置" class="headerlink" title="WIFI 代理设置"></a>WIFI 代理设置</h2><p><img src="/img/fiddler/fiddler_wifi_setting.png" alt="WIFI 代理设置"></p>
<h1 id="开始抓包调试"><a href="#开始抓包调试" class="headerlink" title="开始抓包调试"></a>开始抓包调试</h1><h2 id="嗅探所有请求、响应"><a href="#嗅探所有请求、响应" class="headerlink" title="嗅探所有请求、响应"></a>嗅探所有请求、响应</h2><p>打开APP页面，可以嗅探被过滤的请求：</p>
<p><img src="/img/fiddler/fiddler_inspect.png" alt="嗅探器"></p>
<h2 id="解码-URL-请求参数"><a href="#解码-URL-请求参数" class="headerlink" title="解码 URL 请求参数"></a>解码 URL 请求参数</h2><p>普通表单的显示如下：</p>
<p><img src="/img/fiddler/fiddler_inspect_webforms.png" alt="解码 URL 请求参数"></p>
<p>可以使用 Send to TextWizard 进一步解码：</p>
<p><img src="/img/fiddler/fiddler_inspect_webforms_2.png" alt="解码 URL 请求参数"></p>
<h2 id="设置断点，修改请求、响应"><a href="#设置断点，修改请求、响应" class="headerlink" title="设置断点，修改请求、响应"></a>设置断点，修改请求、响应</h2><p>Fiddler 最强大的功能莫过于设置断点了，设置好断点后，你可以修改请求头（如 cookie）、请求体、响应头、响应体。</p>
<p><img src="/img/fiddler/break_request.png" alt="断点原理"></p>
<p>设置断点有两种方法：</p>
<p>第一种：设置全局断点</p>
<p>打开 Fiddler 点击 Rules-&gt; Automatic Breakpoint -&gt; Before Requests，可修改请求；After Responses，可修改响应。</p>
<p>如何消除全局断点呢？ 点击Rules-&gt; Automatic Breakpoint -&gt;Disabled</p>
<p><img src="/img/fiddler/break_request_1.png" alt="设置全局断点"></p>
<p>第二种：设置指定断点</p>
<p>在命令行中输入命令: bpu <a href="http://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a> (这种方法只会中断 <a href="http://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a>)</p>
<p>如何消除命令呢？ 在命令行中输入命令 bpu</p>
<p>断点效果如下：</p>
<p><img src="/img/fiddler/break_request_2.png" alt="设置指定断点"></p>
<p><img src="/img/fiddler/break_request_3.png" alt="设置指定断点"></p>
<h2 id="自动响应"><a href="#自动响应" class="headerlink" title="自动响应"></a>自动响应</h2><p>有时候，线上客户端环境下打开的页面有bug无法用浏览器调试，则可以用fiddler代理本地文件来进行调试，非常方便。例如：</p>
<p><img src="/img/fiddler/auto_response.png" alt="设置自动响应"></p>
<p>我们将线上JS文件代理为本地文件，我们可以修改本地文件，就能用客户端打开看到修改结果，非常方便，当然我们可以同时代理 引入 vconsole  来在手机端打印错误日志。</p>
<p>也可以将一个接口代理下来，然后新建一个json文件，和代理js文件是同样的方法，就可以修改接口的请求了。</p>
<p>PS：代理接口时可能会出现跨域问题，解决方法<a href="http://www.choujindeputao.com/fiddler-cross-origin/" target="_blank" rel="noopener">点这里</a>。</p>
<h2 id="显示-IP"><a href="#显示-IP" class="headerlink" title="显示 IP"></a>显示 IP</h2><p>如何显示 IP？只需配置一行代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FiddlerObject.UI.lvSessions.AddBoundColumn(&quot;IP&quot;, 120, &quot;X-HostIP&quot;);</span><br></pre></td></tr></table></figure>

<p><img src="/img/fiddler/show_ip.png" alt="显示 IP"></p>
<h1 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h1><ol>
<li>多级代理相互影响（数据库连接vpn_ssl、蓝灯、xx-net等）</li>
<li>代理缓存</li>
<li>左下角的“Captuing”仅用于控制电脑端抓包，不影响手机端，可以关掉，避免影响电脑端的正常上网（例如网易云音乐听歌，印象笔记同步）。</li>
<li>开启代理后，响应体不会被 gzip，也没有响应头：Content-Encoding: gzip。可以自行用 Chrome 和 IE 对比测试。</li>
</ol>
</div></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2017/01/14/webapp-development/" class="post-title-link">移动 Web 开发要点总结</a></h2><div class="post-info">2017-01-14<a href="/tags/前端/" title="前端" class="post-demo">前端</a></div><div class="post-content"><p><img src="/img/javascript/key_of_webapp_dev.png" alt="移动 Web 开发要点总结"></p>
<p>总结下其中几个要点：</p>
<h1 id="iOS-300ms-点击延时问题"><a href="#iOS-300ms-点击延时问题" class="headerlink" title="iOS 300ms 点击延时问题"></a>iOS 300ms 点击延时问题</h1><p>为什么存在这个问题？</p>
<blockquote>
<p>这要追溯至 2007 年初。苹果公司在发布首款 iPhone 前夕，遇到一个问题 —— 当时的网站都是为大屏幕设备所设计的。于是苹果的工程师们做了一些约定，应对 iPhone 这种小屏幕浏览 PC 端站点的问题。这当中最出名的，当属双击缩放(double tap to zoom)。</p>
<p>双击缩放，顾名思义，即用手指在屏幕上快速点击两次，iOS 自带的 Safari 浏览器会将网页缩放至原始比例。</p>
<p>那么问题来了，假设用户在 iOS Safari 里边点击了一个链接，当用户一次点击屏幕之后，浏览器并不能立刻判断用户是确实要打开这个链接，还是想要进行双击操作。</p>
<p>因此，iOS Safari 就等待 300 毫秒，以判断用户是否再次点击了屏幕。如果没有，就触发 click 点击事件。</p>
</blockquote>
<p>According to Google:</p>
<blockquote>
<p>… mobile browsers will wait approximately 300ms from the time that you tap the button to fire the click event. The reason for this is that the browser is waiting to see if you are actually performing a double tap.</p>
</blockquote>
<h2 id="验证问题"><a href="#验证问题" class="headerlink" title="验证问题"></a>验证问题</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span>&gt;</span>Click Me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> button = <span class="built_in">document</span>.querySelector(<span class="string">"button"</span>),</span></span><br><span class="line">                record;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">            button.addEventListener(<span class="string">"touchstart"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="javascript">                record = <span class="built_in">Date</span>.now();</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"button touchstart"</span>);</span></span><br><span class="line">            &#125;);</span><br><span class="line"><span class="actionscript">            button.addEventListener(<span class="string">"touchend"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> delay = <span class="built_in">Date</span>.now() - record;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"button touchend delay: "</span> + delay + <span class="string">"ms"</span>);</span></span><br><span class="line">            &#125;);</span><br><span class="line"><span class="actionscript">            button.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> delay = <span class="built_in">Date</span>.now() - record;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"button click delay: "</span> + delay + <span class="string">"ms"</span>);</span></span><br><span class="line">            &#125;);</span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> delay = <span class="built_in">Date</span>.now() - record;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"document click delay: "</span> + delay + <span class="string">"ms"</span>);</span></span><br><span class="line">            &#125;);</span><br><span class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>iOS Safari 上点击后，显示结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">button touchstart</span><br><span class="line">button touchend delay: 59ms</span><br><span class="line">button click delay: 310ms</span><br><span class="line">document click delay: 312ms</span><br></pre></td></tr></table></figure>

<p>可见，<code>click</code> 事件延迟了 300ms 左右。</p>
<h2 id="找出原因"><a href="#找出原因" class="headerlink" title="找出原因"></a>找出原因</h2><p>当一个用户点击屏幕的时候，会产生两个事件：<code>touch</code> 和 <code>click</code> 。<code>touch</code> 事件会首先触发，完成捕获、冒泡的事件流。同时在点击的 300ms 延时后，触发 <code>click</code> 事件。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>如今移动端 webapp 性能都追求与原生应用匹配，上述 iOS 单击事件 300ms 延迟，显然是不可接受的。有三个解决方案：</p>
<h3 id="方案一"><a href="#方案一" class="headerlink" title="方案一"></a>方案一</h3><p>只使用 <code>touch</code> 事件，然后使用 <code>e.preventDefault()</code> 来阻止默认行为 <code>click</code>：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span>&gt;</span>Click Me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> button = <span class="built_in">document</span>.querySelector(<span class="string">"button"</span>),</span></span><br><span class="line">                record;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">            button.addEventListener(<span class="string">"touchstart"</span>, <span class="function"><span class="keyword">function</span><span class="params">(e)</span></span>&#123;</span></span><br><span class="line"><span class="javascript">                record = <span class="built_in">Date</span>.now();</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"button touchstart"</span>);</span></span><br><span class="line">                e.preventDefault();</span><br><span class="line">            &#125;);</span><br><span class="line"><span class="actionscript">            button.addEventListener(<span class="string">"touchend"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> delay = <span class="built_in">Date</span>.now() - record;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"button touchend delay: "</span> + delay + <span class="string">"ms"</span>);</span></span><br><span class="line">            &#125;);</span><br><span class="line"><span class="actionscript">            button.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> delay = <span class="built_in">Date</span>.now() - record;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"button click delay: "</span> + delay + <span class="string">"ms"</span>);</span></span><br><span class="line">            &#125;);</span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> delay = <span class="built_in">Date</span>.now() - record;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"document click delay: "</span> + delay + <span class="string">"ms"</span>);</span></span><br><span class="line">            &#125;);</span><br><span class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">button touchstart</span><br><span class="line">button touchend delay: 60ms</span><br></pre></td></tr></table></figure>

<p>这种方案看起来简单易行，然而功能复杂的时候容易出问题。比如滑动加选择，会因为滑动触发 <code>touchend</code>，从而触发选择行为。所以如果本该绑定在 <code>click</code> 上的事件全部绑定到 <code>touchend</code> 事件上，就会出现问题。请看下例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span>&gt;</span>Click Me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> button = <span class="built_in">document</span>.querySelector(<span class="string">"button"</span>),</span></span><br><span class="line">                record;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">            button.addEventListener(<span class="string">"touchstart"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="javascript">                record = <span class="built_in">Date</span>.now();</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"button touchstart"</span>);</span></span><br><span class="line">            &#125;);</span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.addEventListener(<span class="string">"touchmove"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"document move"</span>);</span></span><br><span class="line">            &#125;);</span><br><span class="line"><span class="actionscript">            button.addEventListener(<span class="string">"touchend"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> delay = <span class="built_in">Date</span>.now() - record;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"button touchend delay: "</span> + delay + <span class="string">"ms"</span>);</span></span><br><span class="line">            &#125;);</span><br><span class="line"><span class="actionscript">            button.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> delay = <span class="built_in">Date</span>.now() - record;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"button click delay: "</span> + delay + <span class="string">"ms"</span>);</span></span><br><span class="line">            &#125;);</span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> delay = <span class="built_in">Date</span>.now() - record;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"document click delay: "</span> + delay + <span class="string">"ms"</span>);</span></span><br><span class="line">            &#125;);</span><br><span class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当点击按钮并拖动时，显示结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">button touchstart</span><br><span class="line">document move</span><br><span class="line">document move</span><br><span class="line">document move</span><br><span class="line">document move</span><br><span class="line">document move</span><br><span class="line">button touchend delay: 943ms</span><br></pre></td></tr></table></figure>

<p>可见：</p>
<ul>
<li><p>该例中用户可能只想拖动页面，但却被迫触发了 <code>touchend</code> 事件。所以如果本该绑定在 <code>click</code> 上的事件全部绑定到 <code>touchend</code> 事件上，就会出现问题，违背用户意图。</p>
</li>
<li><p>拖动行为会导致 <code>click</code> 事件不会执行，可以理解为  <code>touchmove</code> 和 <code>click</code> 是相斥的。</p>
</li>
</ul>
<p>因此，建议用回 <code>click</code>。</p>
<h3 id="方案二"><a href="#方案二" class="headerlink" title="方案二"></a>方案二</h3><p>使用 zepto.js 的 <code>tap</code> 事件，底层是 <code>click</code> 事件并去掉 300ms 延时，然而会有点击穿透的问题。</p>
<h3 id="方案三"><a href="#方案三" class="headerlink" title="方案三"></a>方案三</h3><p>使用 <a href="https://github.com/ftlabs/fastclick" target="_blank" rel="noopener">fastclick</a>，兼容性好，用法简单，没有点透问题，如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span>&gt;</span>Click Me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"fastclick.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> button = <span class="built_in">document</span>.querySelector(<span class="string">"button"</span>),</span></span><br><span class="line">                record;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">            button.addEventListener(<span class="string">"touchstart"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="javascript">                record = <span class="built_in">Date</span>.now();</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"button touchstart"</span>);</span></span><br><span class="line">            &#125;);</span><br><span class="line"><span class="actionscript">            button.addEventListener(<span class="string">"touchend"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> delay = <span class="built_in">Date</span>.now() - record;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"button touchend delay: "</span> + delay + <span class="string">"ms"</span>);</span></span><br><span class="line">            &#125;);</span><br><span class="line"><span class="actionscript">            button.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> delay = <span class="built_in">Date</span>.now() - record;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"button click delay: "</span> + delay + <span class="string">"ms"</span>);</span></span><br><span class="line">            &#125;);</span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> delay = <span class="built_in">Date</span>.now() - record;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"document click delay: "</span> + delay + <span class="string">"ms"</span>);</span></span><br><span class="line">            &#125;);</span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.addEventListener(<span class="string">'DOMContentLoaded'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                FastClick.attach(<span class="built_in">document</span>.body);</span></span><br><span class="line"><span class="actionscript">                &#125;, <span class="literal">false</span>);</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">button touchstart</span><br><span class="line">button touchend delay: 60ms</span><br><span class="line">button click delay: 60ms</span><br><span class="line">document click delay: 60ms</span><br></pre></td></tr></table></figure>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://developer.telerik.com/featured/300-ms-click-delay-ios-8/" target="_blank" rel="noopener">http://developer.telerik.com/featured/300-ms-click-delay-ios-8/</a></p>
<p><a href="https://www.sitepoint.com/5-ways-prevent-300ms-click-delay-mobile-devices/" target="_blank" rel="noopener">https://www.sitepoint.com/5-ways-prevent-300ms-click-delay-mobile-devices/</a></p>
<p><a href="http://www.linovo.me/front/webapp-300ms.html" target="_blank" rel="noopener">http://www.linovo.me/front/webapp-300ms.html</a></p>
<p><a href="https://github.com/ftlabs/fastclick" target="_blank" rel="noopener">https://github.com/ftlabs/fastclick</a></p>
<p><a href="https://github.com/filamentgroup/tappy/" target="_blank" rel="noopener">https://github.com/filamentgroup/tappy/</a></p>
<p><a href="http://labs.ft.com/2011/08/fastclick-native-like-tapping-for-touch-apps/" target="_blank" rel="noopener">http://labs.ft.com/2011/08/fastclick-native-like-tapping-for-touch-apps/</a></p>
<p><a href="http://www.mamicode.com/info-detail-666685.html" target="_blank" rel="noopener">http://www.mamicode.com/info-detail-666685.html</a></p>
<p><a href="https://www.jianshu.com/p/dc3bceb10dbb" target="_blank" rel="noopener">https://www.jianshu.com/p/dc3bceb10dbb</a></p>
</div></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2017/01/07/h5-storage/" class="post-title-link">H5 存储的四种方案介绍</a></h2><div class="post-info">2017-01-07<a href="/tags/前端/" title="前端" class="post-demo">前端</a></div><div class="post-content"><p><img src="/img/javascript/h5_storage.png" alt="h5 存储"></p>
<p>Cookie 指令在 HTTP 头的形式如下：</p>
<ul>
<li><p>HTTP 请求头 <code>Cookie</code> 指令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie: code&#x3D;23365f1409b; __auth&#x3D;eda2ebe49a4a91d3546435c3</span><br></pre></td></tr></table></figure>
</li>
<li><p>HTTP 响应头 <code>Set-Cookie</code> 指令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: code&#x3D;23365f1409b; Expires&#x3D;Thu, 31-Dec-2016 07:23:59 GMT; Domain&#x3D;x.y.z.com; Path&#x3D;&#x2F;ws; Secure; HttpOnly</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>其中 Cookie 的 <code>domain</code> 属性比较特殊，存在一些读写限制：可读写本身或上一级 <code>domain</code> 的 cookie，但无法读写同级或下一级 <code>domain</code> 的 cookie。</p>
<table>
<thead>
<tr>
<th></th>
<th>z.com</th>
<th>y.z.com</th>
</tr>
</thead>
<tbody><tr>
<td>z.com</td>
<td>√</td>
<td>√</td>
</tr>
<tr>
<td>y.z.com</td>
<td>×</td>
<td>√</td>
</tr>
<tr>
<td>x.z.com</td>
<td>×</td>
<td>×</td>
</tr>
<tr>
<td>x.y.z.com</td>
<td>×</td>
<td>×</td>
</tr>
</tbody></table>
<p>如果不设置 Cookie 的 <code>Expires</code> 或者 <code>Max-Age</code> 属性，其默认值是 Session，也就是关闭浏览器后该 Cookie 就消失了。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://www.ibm.com/developerworks/cn/java/books/javaweb_xlb/10/index.html" target="_blank" rel="noopener">https://www.ibm.com/developerworks/cn/java/books/javaweb_xlb/10/index.html</a></p>
<p><a href="http://www.cnblogs.com/xiaowei0705/archive/2011/04/19/2021372.html" target="_blank" rel="noopener">http://www.cnblogs.com/xiaowei0705/archive/2011/04/19/2021372.html</a></p>
</div></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2016/12/05/javascript-gulpjs/" class="post-title-link">自动化构建工具 Gulp.js</a></h2><div class="post-info">2016-12-05<a href="/tags/前端/" title="前端" class="post-demo">前端</a></div><div class="post-content"><p>某段时期前端技术选型上使用过 <a href="https://www.gulpjs.com.cn/" target="_blank" rel="noopener">Gulp.js</a> 解决前端工程化及自动化构建问题，下表整理了其在实践项目中常用的插件：</p>
<table>
<thead>
<tr>
<th>插件</th>
<th>功能</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td><a href="https://www.npmjs.com/package/gulp-jshint" target="_blank" rel="noopener">gulp-jshint</a></td>
<td>检查 JavaScript 语法</td>
<td><a href="http://jshint.com/docs/options/" target="_blank" rel="noopener">http://jshint.com/docs/options/</a></td>
</tr>
<tr>
<td><a href="https://www.npmjs.com/package/gulp-uglify" target="_blank" rel="noopener">gulp-uglify</a></td>
<td>压缩 JavaScript</td>
<td></td>
</tr>
<tr>
<td><a href="https://www.npmjs.com/package/gulp-sourcemaps" target="_blank" rel="noopener">gulp-sourcemaps</a></td>
<td>输出 sourcemaps</td>
<td>部署前端之前，开发者通常会对代码进行打包压缩，这样可以减少代码大小，从而有效提高访问速度。然而，压缩代码的报错信息是很难Debug的，因为它的行号和列号已经失真。这时就需要Source Map来还原真实的出错位置了。</td>
</tr>
<tr>
<td><a href="https://www.npmjs.com/package/gulp-imagemin" target="_blank" rel="noopener">gulp-imagemin</a></td>
<td>压缩图片</td>
<td><code>progressive</code> JPEG 图像渐进式扫描；<code>interlaced</code> GIF 图像隔行扫描</td>
</tr>
<tr>
<td><a href="https://www.npmjs.com/package/gulp-rev" target="_blank" rel="noopener">gulp-rev</a></td>
<td>静态资源 hash</td>
<td>在实际生产环境中，我们页面引用的静态资源的文件名都是带版本号的（非覆盖式升级），这样方便版本管理（如更新与回滚）和防止缓存。通常我们使用文件的md5编码作为版本号，生成文件指纹。</td>
</tr>
<tr>
<td><a href="https://www.npmjs.com/package/gulp-less" target="_blank" rel="noopener">gulp-less</a></td>
<td>Less 文件编译</td>
<td>用于引入 Less 扩展 CSS 语言，提升前端样式的开发效率。</td>
</tr>
<tr>
<td><a href="https://www.npmjs.com/package/gulp-autoprefixer" target="_blank" rel="noopener">gulp-autoprefixer</a></td>
<td>根据所需兼容的浏览器版本，自动补全厂商前缀</td>
<td></td>
</tr>
<tr>
<td><a href="https://www.npmjs.com/package/gulp-css-base64/" target="_blank" rel="noopener">gulp-css-base64</a></td>
<td>将CSS 样式表中引用的图片和字体通过 base64 编码压缩合并到一起，减少文件请求数</td>
<td><code>maxWeightResource</code> 资源最大阈值，默认为 32K</td>
</tr>
<tr>
<td><a href="https://www.npmjs.com/package/gulp-ejs" target="_blank" rel="noopener">gulp-ejs</a></td>
<td>编译 HTML 中的 ejs 模板，可用于页面布局拆分，提升代码复用性</td>
<td><a href="http://ejs.co/" target="_blank" rel="noopener">http://ejs.co/</a></td>
</tr>
<tr>
<td><a href="https://www.npmjs.com/package/gulp-htmlmin" target="_blank" rel="noopener">gulp-htmlmin</a></td>
<td>压缩 HTML</td>
<td></td>
</tr>
<tr>
<td><a href="https://www.npmjs.com/package/gulp-inline-source" target="_blank" rel="noopener">gulp-inline-source</a></td>
<td>将 HTML 外部引用的样式和脚本以内联的方式嵌到 HTML 文件中，减少文件请求数</td>
<td></td>
</tr>
<tr>
<td><a href="https://www.npmjs.com/search?q=gulp-if" target="_blank" rel="noopener">gulp-if</a></td>
<td>编译时动态判断</td>
<td></td>
</tr>
<tr>
<td><a href="https://www.npmjs.com/package/gulp-replace" target="_blank" rel="noopener">gulp-replace</a></td>
<td>编译时动态替换字符串</td>
<td>可用于根据不同环境构建代码，解决各环境间的差异。例如正则匹配并全局替换 HTML 中的 <code>${web}</code> 变量。</td>
</tr>
<tr>
<td><a href="https://www.npmjs.com/package/gulp-tar" target="_blank" rel="noopener">gulp-tar</a></td>
<td>打包静态资源</td>
<td><a href="https://github.com/mafintosh/tar-stream" target="_blank" rel="noopener">tar-stream</a></td>
</tr>
<tr>
<td><a href="https://github.com/sanyueyu/gulp-mock-server" target="_blank" rel="noopener">gulp-mock-server</a></td>
<td>API Mock Server，前后端分离后的 API 模拟利器</td>
<td></td>
</tr>
<tr>
<td><a href="https://www.npmjs.com/package/browser-sync" target="_blank" rel="noopener">browser-sync</a></td>
<td>监听本地文件变化并同步刷新浏览器，提升开发效率的利器</td>
<td><a href="https://www.browsersync.io/" target="_blank" rel="noopener">https://www.browsersync.io/</a></td>
</tr>
</tbody></table>
</div></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2016/10/06/ssh/" class="post-title-link">SSH 协议及其实现总结</a></h2><div class="post-info">2016-10-06<a href="/tags/安全/" title="安全" class="post-demo">安全</a></div><div class="post-content"><h1 id="连接协议对比"><a href="#连接协议对比" class="headerlink" title="连接协议对比"></a>连接协议对比</h1><p>常见的几种连接协议：</p>
<ul>
<li>SSH2（默认，相对于SSH1进行了加密算法的改进，使用最广泛）</li>
<li>SSH1</li>
<li>Telnet</li>
<li>Telnet/SSL</li>
<li>Rlogin</li>
<li>Serial</li>
<li>TAPI</li>
</ul>
<p>在出现 SSH 之前，系统管理员需要登入远程服务器执行系统管理任务时，都是用 <code>telnet</code> 来实现的，telnet 协议采用明文密码传送，在传送过程中对数据也不加密，很容易被不怀好意的人在网络上监听到密码。</p>
<p>同样，在 SSH 工具出现之前 R 系列命令也很流行（由于这些命令都以字母 r 开头，故把这些命令合称为 R 系列命令，R 是 remote 的意思），比如 <code>rexec</code> 是用来执行远程服务器上的命令的，和 <code>telnet</code> 的区别是 <code>telnet</code> 需要先登录远程服务器再实行相关的命令，而 R 系列命令可以把登录和执行命令并登出系统的操作整合在一起。这样就不需要为在远程服务器上执行一个命令而特地登录服务器了。</p>
<p>SSH 全称 Secure SHell，顾名思义就是非常安全的 shell 的意思，SSH 协议是 IETF（Internet Engineering Task Force） 的 Network Working Group 所制定的一种协议。SSH 的主要目的是用来<strong>取代传统的 telnet 和 R 系列命令</strong>（<code>rlogin</code>、<code>rsh</code>、<code>rexec</code> 等）远程登录和远程执行命令的工具，实现对远程登录和远程执行命令加密。防止由于网络监听而出现的密码泄漏，对系统构成威胁。</p>
<p>SSH 是一种加密协议，不仅在登录过程中对密码进行加密传送，而且对登录后执行的命令的数据也进行加密，这样即使别人在网络上监听并截获了你的数据包，他也看不到其中的内容。SSH 协议底层使用 TCP 协议，端口号 22。</p>
<h1 id="鉴权方式对比"><a href="#鉴权方式对比" class="headerlink" title="鉴权方式对比"></a>鉴权方式对比</h1><p>不同于 <code>telnet</code> 只支持 Password 密码鉴权，SSH 同时支持以下几种鉴权方式（Authentication）：</p>
<ul>
<li>Password（密码）</li>
<li><strong>Public Key</strong>（公钥）</li>
<li>Keyboard Interactive（键盘交互）</li>
<li>GSSAPI </li>
</ul>
<p>目前 SSH 最常用的鉴权方式有 Password 和 Public key 。Public Key 非对称（asymmetric）鉴权认证使用一对相关联的 Key Pair（一个公钥 Public Key，一个私钥 Private Key）来代替传统的密码（Password）。顾名思义，Public Key 是用来公开的，可以将其放到 SSH 服务器自己的帐号中，而 Private Key 只能由自己保管，用来证明自己身份。</p>
<p>使用 Public Key 加密过的数据只有用与之相对应的 Private Key 才能解密。这样在鉴权的过程中，Public Key 拥有者便可以通过 Public Key 加密一些东西发送给对应的 Private Key 拥有者，如果在通信的双方都拥有对方的 Public Key（自己的 Private Key 只由自己保管），那么就可以通过这对 Key Pair 来安全地交换信息，从而实现相互鉴权。</p>
<h1 id="OpenSSH"><a href="#OpenSSH" class="headerlink" title="OpenSSH"></a>OpenSSH</h1><p><a href="http://www.openssh.com/" target="_blank" rel="noopener">OpenSSH</a> 是 SSH 协议的<strong>免费开源实现</strong>。OpenSSH 套件由以下工具集组成：</p>
<p>远程操作工具：</p>
<ul>
<li><code>ssh</code>（替代 <code>telnet</code> 和 <code>rlogin</code>）</li>
<li><code>scp</code>（替代 <code>rcp</code>）</li>
<li><code>sftp</code>（替代 <code>ftp</code>）</li>
</ul>
<p>公私钥管理工具：</p>
<ul>
<li><code>ssh-add</code> Tool which adds private keys to the authentication agent.</li>
<li><code>ssh-keygen</code> Key generation tool.</li>
<li><code>ssh-keysign</code> Helper program for host-based authentication.</li>
<li><code>ssh-keyscan</code> Utility for gathering public host keys from a number of hosts.</li>
</ul>
<p>客户端工具：</p>
<ul>
<li><code>ssh-agent</code> An authentication agent that can store private keys.</li>
</ul>
<p>服务端工具：</p>
<ul>
<li><code>sshd</code> 一个运行于服务端的独立守护进程（standalone daemon）</li>
<li><code>sftp-server</code> SFTP 服务器</li>
</ul>
<h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><p>当管理的服务器较多时，ssh 远程需要频繁的输入用户名、密码、服务器 IP，操作非常繁琐，下面介绍一些命令结合配置以简化操作。</p>
<h3 id="ssh"><a href="#ssh" class="headerlink" title="ssh"></a>ssh</h3><p><code>ssh</code> 命令用法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh [-p port] [user@]hostname [<span class="built_in">command</span>]</span><br></pre></td></tr></table></figure>

<p>有时候输入 <code>ssh</code> 的参数繁琐，一旦服务器较多，要一个个记住并且敲入时非常低效。因此 <code>ssh</code> 提供了配置文件的方式简化命令行选项。<code>ssh</code> 依序从下列来源中获取配置，最先获取的值将优先使用：</p>
<ol>
<li>命令行选项（command-line options）</li>
<li>用户配置文件 <code>~/.ssh/config</code></li>
<li>系统配置文件 <code>/etc/ssh/ssh_config</code></li>
</ol>
<p>常用配置项如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Host    别名</span><br><span class="line">    HostName        主机名</span><br><span class="line">    Port            端口</span><br><span class="line">    User            用户名</span><br><span class="line">    IdentityFile    密钥文件的路径</span><br></pre></td></tr></table></figure>

<p>通过配置，<code>ssh</code> 远程命令简化如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh 别名</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh pc2 /sbin/ifconfig</span><br></pre></td></tr></table></figure>

<p><code>pc2</code> 是从 <code>~/.ssh/config</code> 中获取的 hostname 别名。</p>
<h3 id="ssh-keygen"><a href="#ssh-keygen" class="headerlink" title="ssh-keygen"></a>ssh-keygen</h3><p>在使用 <code>ssh</code> 进行远程登录时，由于默认使用的是 Password 鉴权方式，因此每次登录都需要输入密码，操作麻烦。下面介绍使用 Public Key  鉴权方式实现<strong>免密登录</strong>。</p>
<p>一、创建一对公私钥：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -t rsa -C who@<span class="built_in">where</span></span><br><span class="line">询问密码时，保持为空并回车</span><br></pre></td></tr></table></figure>

<p>二、启动 SSH 认证代理程序：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">eval</span> `ssh-agent`</span><br><span class="line">Agent pid 1760</span><br></pre></td></tr></table></figure>

<p>三、添加私钥：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-add ~/.ssh/id_rsa</span><br><span class="line">Identity added: ~/.ssh/id_rsa</span><br><span class="line">$ ssh-add -l</span><br><span class="line">2048 8a:63:12:ae:b1:4c:be:03:e7:7f:92:3e:e5:44:56:bb ~/.ssh/id_rsa (RSA)</span><br></pre></td></tr></table></figure>

<p>四、将公钥上传到服务端，添加到<strong>被登录帐户</strong>的<strong>可信列表文件</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ scp ~/.ssh/id_rsa.pub who@<span class="built_in">where</span>:~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>

<p>五、修改服务端文件权限：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ chmod 700 ~/.ssh</span><br><span class="line">$ chmod 600 ~/.ssh/*</span><br></pre></td></tr></table></figure>

<p>之后再使用 <code>ssh</code> 登录时，客户端的 <code>ssh-agent</code> 会发送私钥去和服务端上的公钥做匹配，如果匹配成功就可以免密登录了。</p>
<h3 id="ssh-add"><a href="#ssh-add" class="headerlink" title="ssh-add"></a>ssh-add</h3><p><code>ssh-add</code> 命令常见用法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">usage: ssh-add [options] [file ...]</span><br><span class="line">Options:</span><br><span class="line">  -l          List fingerprints of all identities.</span><br><span class="line">  -E <span class="built_in">hash</span>     Specify <span class="built_in">hash</span> algorithm used <span class="keyword">for</span> fingerprints.</span><br><span class="line">  -L          List public key parameters of all identities.</span><br><span class="line">  -k          Load only keys and not certificates.</span><br><span class="line">  -c          Require confirmation to sign using identities</span><br><span class="line">  -t life     Set lifetime (<span class="keyword">in</span> seconds) when adding identities.</span><br><span class="line">  -d          Delete identity.</span><br><span class="line">  -D          Delete all identities.</span><br><span class="line">  -x          Lock agent.</span><br><span class="line">  -X          Unlock agent.</span><br><span class="line">  -s pkcs11   Add keys from PKCS<span class="comment">#11 provider.</span></span><br><span class="line">  -e pkcs11   Remove keys provided by PKCS<span class="comment">#11 provider.</span></span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-add -D</span><br><span class="line">All identities removed.</span><br><span class="line"></span><br><span class="line">$ ssh-add -l</span><br><span class="line">The agent has no identities.</span><br></pre></td></tr></table></figure>

<p>参考：<a href="http://linux.101hacks.com/unix/ssh-add/" target="_blank" rel="noopener">http://linux.101hacks.com/unix/ssh-add/</a></p>
<h3 id="scp"><a href="#scp" class="headerlink" title="scp"></a>scp</h3><p><code>scp</code> 命令常用参数：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-r 递归复制（用以传输文件夹）</span><br><span class="line">-p 传输时保留文件权限及时间戳</span><br><span class="line">-C 传输时进行数据压缩</span><br></pre></td></tr></table></figure>

<p>可以结合 bash 的 <code>for</code> 循环实现批量 <code>scp</code> 目录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">HOST_IP=(<span class="string">'192.168.0.1'</span> <span class="string">'192.168.0.2'</span> <span class="string">'192.168.0.3'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ip <span class="keyword">in</span> <span class="variable">$&#123;HOST_IP[@]&#125;</span>  </span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">    scp -rp /some/files <span class="variable">$&#123;ip&#125;</span>:/some/</span><br><span class="line">  <span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h2 id="相关文件"><a href="#相关文件" class="headerlink" title="相关文件"></a>相关文件</h2><p>SSH 相关文件和配置：</p>
<table>
<thead>
<tr>
<th>文件</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>~/.ssh/id_rsa.pub</td>
<td>公钥（Public Key）</td>
</tr>
<tr>
<td>~/.ssh/id_rsa</td>
<td>私钥（Private Key）</td>
</tr>
<tr>
<td>~/.ssh/known_hosts</td>
<td>位于客户端的公钥列表文件，首次与目标主机建立 SSH 连接时，需要添加对方的公钥到这个文件以便后续通信</td>
</tr>
<tr>
<td>~/.ssh/authorized_keys</td>
<td>位于服务端的公钥列表文件，列出了所有被允许登录进来的可信公钥信息（Lists the public keys that are permitted for logging in）</td>
</tr>
<tr>
<td>~/.ssh/config</td>
<td>用户配置文件，可以通过 <code>man ssh_config</code> 命令查看帮助。</td>
</tr>
<tr>
<td>/etc/ssh/ssh_config</td>
<td>系统配置文件</td>
</tr>
</tbody></table>
<h1 id="rsync"><a href="#rsync" class="headerlink" title="rsync"></a>rsync</h1><p>批量 <code>scp</code> 的缺点是会全量同步，且删除行为无法同步，可以用 <code>rsync</code> 命令优化：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">拉取：</span><br><span class="line">$ rsync [option...] [user@]host:src... [dest]</span><br><span class="line"></span><br><span class="line">推送：</span><br><span class="line">$ rsync [option...] src... [user@]host:dest</span><br></pre></td></tr></table></figure>

<p>如果双方都修改了同一文件的同一个地方，<code>rsync</code> 不管源和目标的修改时间谁先谁后，而是以源作为基准去覆盖目标文件。</p>
<p>常用参数：</p>
<ul>
<li><code>-a</code>：归档模式，等价于 <code>-rlptgoD</code>（不包括 <code>-H</code>, <code>-A</code>, <code>-X</code>）<ul>
<li><code>-r</code>, <code>--recursive</code>：递归遍历目录</li>
<li><code>-l</code>, <code>--links</code>：复制软链接（symbolic link, symlinks）</li>
<li><code>-p</code>, <code>--perms</code>：保留权限</li>
<li><code>-t</code>, <code>--times</code>：保留修改时间</li>
<li><code>-g</code>, <code>--group</code>：保留属组</li>
<li><code>-o</code>, <code>--owner</code>：保留属主</li>
<li><code>-D</code>：等价于：<ul>
<li><code>--devices</code>：保留设备文件</li>
<li><code>--specials</code>：保留特殊文件</li>
</ul>
</li>
</ul>
</li>
<li><code>-v</code>, <code>--verbose</code>：详细输出信息</li>
<li><code>-H</code>, <code>--hard-links</code>：保留硬链接（hard links）</li>
</ul>
<h2 id="批量-rsync"><a href="#批量-rsync" class="headerlink" title="批量 rsync"></a>批量 rsync</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">HOST_IP=(<span class="string">'192.168.0.1'</span> <span class="string">'192.168.0.2'</span> <span class="string">'192.168.0.3'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ip <span class="keyword">in</span> <span class="variable">$&#123;HOST_IP[@]&#125;</span></span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">    rsync -avH --delete /some/* <span class="variable">$&#123;ip&#125;</span>:/some/</span><br><span class="line">  <span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>进行如下文件操作测试：</p>
<ul>
<li>新增文件：web-banner-20170717.jpg</li>
<li>删除文件：web-banner-20170716.jpg</li>
</ul>
<p>从输出可见，只会增量同步并删除指定的文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sending incremental file list</span><br><span class="line">resmarket&#x2F;static&#x2F;site&#x2F;v1&#x2F;img&#x2F;banner&#x2F;</span><br><span class="line">resmarket&#x2F;static&#x2F;site&#x2F;v1&#x2F;img&#x2F;banner&#x2F;web-banner-20170717.jpg</span><br><span class="line">deleting resmarket&#x2F;static&#x2F;site&#x2F;v1&#x2F;img&#x2F;banner&#x2F;web-banner-20170716.jpg</span><br></pre></td></tr></table></figure>

<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>《<a href="http://linux.101hacks.com/unix/ssh-add/" target="_blank" rel="noopener">5 Unix / Linux ssh-add Command Examples to Add SSH Key to Agent</a>》</p>
<p><a href="http://roclinux.cn/?p=2643" target="_blank" rel="noopener">《rsync同步的艺术》–linux命令五分钟系列之四十二</a></p>
<p>《<a href="https://www.jianshu.com/p/c6a7ffe01ac3" target="_blank" rel="noopener">ssh keygen 中生成的 randomart image 是什么</a>》</p>
</div></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2016/07/05/javascript-requirejs/" class="post-title-link">前端模块化框架 Require.js</a></h2><div class="post-info">2016-07-05<a href="/tags/前端/" title="前端" class="post-demo">前端</a></div><div class="post-content"><p>某段时期前端技术选型上使用过 Require.js 解决前端模块化的问题，下面整理了一些简单实践：</p>
<h1 id="Require-js-使用"><a href="#Require-js-使用" class="headerlink" title="Require.js 使用"></a>Require.js 使用</h1><p>第一步，按功能将 JS 分门别类：</p>
<ul>
<li>dist/</li>
<li>app/<ul>
<li>js/<ul>
<li>require_config.js</li>
<li>entry/<ul>
<li>main.js</li>
</ul>
</li>
<li>module/<ul>
<li>sub.js</li>
</ul>
</li>
<li>lib/<ul>
<li>require.js</li>
<li>zepto.js</li>
</ul>
</li>
<li>util/</li>
</ul>
</li>
<li>css/</li>
<li>img/</li>
<li>……</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>本地路径</th>
<th>功能描述</th>
</tr>
</thead>
<tbody><tr>
<td>js/entry</td>
<td>各功能主模块（主入口）</td>
</tr>
<tr>
<td>js/module</td>
<td>各功能子模块</td>
</tr>
<tr>
<td>js/lib</td>
<td>第三方库</td>
</tr>
<tr>
<td>js/util</td>
<td>自定义库</td>
</tr>
</tbody></table>
<p>第二步，参考《<a href="https://github.com/requirejs/requirejs/wiki/Patterns-for-separating-config-from-the-main-module" target="_blank" rel="noopener">Patterns for separating config from the main module</a>》将 RequireJS 配置项从各功能主模块中剥离出来，放到 <code>js/require_config.js</code> 统一管理：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定义 RequireJS 全局配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> <span class="built_in">require</span> = &#123;</span><br><span class="line">    paths: &#123;</span><br><span class="line">        mod: <span class="string">'/contextpath/js/module'</span>,</span><br><span class="line">        wgt: <span class="string">'/contextpath/js/widget'</span></span><br><span class="line">        lib: <span class="string">'/contextpath/js/lib'</span>,</span><br><span class="line">        util: <span class="string">'/contextpath/js/util'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>第三步，在页面中引入配置文件及入口文件，注意先后顺序：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 先注册配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/require_config.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 然后引入 require.js ，并载入主模块 main.js --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/lib/require.js"</span> <span class="attr">data-main</span>=<span class="string">"js/entry/main.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第四步，使用 <code>define()</code> 函数编写子模块 <code>js/module/sub.js</code>。引入所需的模块，如 zepto：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 子模块依赖 zepto</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">define([<span class="string">'lib/zepto'</span>], <span class="function"><span class="keyword">function</span>(<span class="params">$</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>第五步，使用 <code>require()</code> 函数编写主模块 <code>js/entry/main.js</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 主模块依赖 sub.js</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">require</span>([<span class="string">'mod/sub'</span>], <span class="function"><span class="keyword">function</span>(<span class="params">sub</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>通过 AMD 规范定义的两个关键函数 <code>define()</code> 和 <code>require()</code> ，我们可以很轻松的在老版本 ES5 上实现模块化功能，解决依赖关系混乱和全局变量的问题。</p>
<h1 id="Require-js-构建"><a href="#Require-js-构建" class="headerlink" title="Require.js 构建"></a>Require.js 构建</h1><p>需要注意的是，模块拆分之后脚本文件数量会变多，HTTP 请求也会相应增多。使用 RequireJS 的<a href="http://www.requirejs.org/docs/optimization.html" target="_blank" rel="noopener">优化工具</a> <code>r.js</code> 合并压缩相关联的脚本文件，可以解决这个问题。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>JavaScript 模块化技术的起源：《<a href="http://yuiblog.com/blog/2007/06/12/module-pattern/" target="_blank" rel="noopener">A JavaScript Module Pattern</a>》</p>
<p>JavaScript 模块化技术的一些高级特性：《<a href="http://www.adequatelygood.com/JavaScript-Module-Pattern-In-Depth.html" target="_blank" rel="noopener">JavaScript Module Pattern: In-Depth</a>》（<a href="http://blog.csdn.net/flybywind/article/details/8095724" target="_blank" rel="noopener">中文版</a>）</p>
<p>RequireJS 的一些入门用法参考：</p>
<ul>
<li>《<a href="http://www.ruanyifeng.com/blog/2012/10/javascript_module.html" target="_blank" rel="noopener">Javascript模块化编程（一）：模块的写法</a>》</li>
<li>《<a href="http://www.ruanyifeng.com/blog/2012/10/asynchronous_module_definition.html" target="_blank" rel="noopener">Javascript模块化编程（二）：AMD规范</a>》</li>
<li>《<a href="http://www.ruanyifeng.com/blog/2012/11/require_js.html" target="_blank" rel="noopener">Javascript模块化编程（三）：require.js的用法</a>》</li>
</ul>
</div></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2016/06/25/spring-mvc/" class="post-title-link">Spring MVC 入门教程</a></h2><div class="post-info">2016-06-25<a href="/tags/Java/" title="Java" class="post-demo">Java</a><a href="/tags/Spring/" title="Spring" class="post-demo">Spring</a></div><div class="post-content"><p>一张图简要描述 Spring MVC 的处理流程：</p>
<p><img src="/img/spring/spring-mvc.png" alt="Spring MVC"></p>
<ul>
<li>Spring MVC 的核心前端控制器 <code>DispatcherServlet</code> 接收 HTTP 请求并询问 <code>Handler mapping</code> 该请求应该转发到哪个 <code>Controller</code> 方法。</li>
<li><code>Controller</code> 业务处理完毕，返回 <em>逻辑视图名(通常是一个字符串)</em> 。</li>
<li>最后 <code>viewResolver</code> 解析逻辑视图名并返回相应的 <code>View</code>，如 JSP、FreeMarker。</li>
</ul>
<h1 id="实现一个-Controller"><a href="#实现一个-Controller" class="headerlink" title="实现一个 Controller"></a>实现一个 Controller</h1><p>下面介绍编写控制器过程中常用的注解：</p>
<h2 id="定义一个控制器"><a href="#定义一个控制器" class="headerlink" title="定义一个控制器"></a>定义一个控制器</h2><h3 id="Controller"><a href="#Controller" class="headerlink" title="@Controller"></a>@Controller</h3><p>Traditional MVC controller relying on a <a href="https://spring.io/understanding/view-templates" target="_blank" rel="noopener">view technology</a> to perform server-side rendering.</p>
<h3 id="RestController"><a href="#RestController" class="headerlink" title="@RestController"></a>@RestController</h3><p>RESTful web service controller simply populates and returns a object that will be written directly to the HTTP response as JSON. Thanks to Spring’s HTTP message converter support, you don’t need to do this conversion manually. Because <a href="http://wiki.fasterxml.com/JacksonHome" target="_blank" rel="noopener">Jackson 2</a> is on the classpath, Spring’s <a href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/http/converter/json/MappingJackson2HttpMessageConverter.html" target="_blank" rel="noopener"><code>MappingJackson2HttpMessageConverter</code></a> is automatically chosen to convert the object to JSON.</p>
<p>It’s shorthand for <code>@Controller</code> and <code>@ResponseBody</code> rolled together. </p>
<h2 id="映射请求"><a href="#映射请求" class="headerlink" title="映射请求"></a>映射请求</h2><h3 id="RequestMapping"><a href="#RequestMapping" class="headerlink" title="@RequestMapping"></a>@RequestMapping</h3><p><a href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/bind/annotation/RequestMapping.html" target="_blank" rel="noopener"><code>@RequestMapping</code></a> 用于将 HTTP 请求映射到指定的 <code>Controller</code> 类或方法。</p>
<p>一、可匹配的请求属性如下：</p>
<ul>
<li><code>value</code> 用于匹配指定的请求路径，例如：<code>value = &quot;/index&quot;</code>。</li>
<li><code>method</code> 用于匹配指定的请求方法，例如：<code>method = RequestMethod.POST</code>。</li>
<li><code>consumes</code> 用于匹配指定的请求头 <code>Content-Type</code>，例如：<code>consumes = MediaType.APPLICATION_JSON_UTF8_VALUE</code>。</li>
<li><code>produces</code> 用于匹配指定的请求头 <code>Accept</code>，例如：<code>produces = MediaType.APPLICATION_JSON_UTF8_VALUE</code>。</li>
<li><code>params</code> 用于匹配指定的请求参数，例如：<ul>
<li>匹配存在：<code>params = &quot;myParam&quot;</code></li>
<li>匹配不存在：<code>params = &quot;!myParam&quot;</code></li>
<li>匹配指定参数值：<code>params = &quot;myParam=myValue&quot;</code> </li>
</ul>
</li>
<li><code>headers</code> 用于匹配指定的请求头，例如：<ul>
<li>匹配存在：<code>headers = &quot;myHeader&quot;</code></li>
<li>匹配不存在：<code>headers = &quot;!myHeader&quot;</code></li>
<li>匹配指定值：<code>headers = &quot;myHeader=myValue&quot;</code></li>
</ul>
</li>
</ul>
<p>尽管你可以使用媒体类型通配符（例如：<code>content-type=text/*</code> 或 <code>accept=xxx</code>）去匹配 <code>Content-Type</code> 或 <code>Accept</code> 请求头，但还是更推荐使用 <code>consumes</code> 或 <code>produces</code> 属性。因为它们专门用于此目的。</p>
<p>二、Spring Framework 4.3 还引入了五个等价的变体注解，相当于 <code>@RequestMapping</code> 注解与 <code>method</code> 属性的组合使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping</span><br><span class="line">@PostMapping</span><br><span class="line">@PutMapping</span><br><span class="line">@DeleteMapping</span><br><span class="line">@PatchMapping</span><br></pre></td></tr></table></figure>

<p>三、标注了 <code>@RequestMapping</code> 注解的方法可以拥有非常灵活的方法签名。支持以下参数类型/注解、返回类型/注解：</p>
<h2 id="方法参数类型"><a href="#方法参数类型" class="headerlink" title="方法参数类型"></a>方法参数类型</h2><p><code>@RequestMapping</code> 注解的方法，参数可以是下列任一类型：</p>
<h3 id="Request-Response"><a href="#Request-Response" class="headerlink" title="Request / Response"></a>Request / Response</h3><p>用于访问当前 <code>javax.servlet.http.HttpServletRequest</code> / <code>javax.servlet.http.HttpServletResponse</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/index"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">go</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">    request.getHeader(<span class="string">"host"</span>); <span class="comment">// 读取指定 HTTP 请求头</span></span><br><span class="line">    response.getWriter().write(<span class="string">"hello world"</span>); <span class="comment">// 浏览器将会显示：hello world</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用这类方法参数有点类似于传统的 Servlet 编程。</p>
<h3 id="InputStream-Reader"><a href="#InputStream-Reader" class="headerlink" title="InputStream / Reader"></a>InputStream / Reader</h3><p>用于访问当前请求内容的 <code>java.io.InputStream</code> / <code>java.io.Reader</code></p>
<h3 id="OutputStream-Writer"><a href="#OutputStream-Writer" class="headerlink" title="OutputStream / Writer"></a>OutputStream / Writer</h3><p>用于生成当前响应内容的 <code>java.io.OutputStream</code> / <code>java.io.Writer</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/index"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">go</span><span class="params">(Writer writer)</span> </span>&#123;</span><br><span class="line">    writer.write(<span class="string">"hello world"</span>); <span class="comment">// 浏览器将会显示：hello world</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h3><p>用于访问当前 <code>javax.servlet.http.HttpSession</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/index"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">go</span><span class="params">(HttpSession session)</span> </span>&#123;</span><br><span class="line">    session.getAttribute(<span class="string">"xxx"</span>); <span class="comment">// 读取指定 Session 值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="HttpEntity-lt-gt"><a href="#HttpEntity-lt-gt" class="headerlink" title="HttpEntity&lt;?&gt;"></a>HttpEntity&lt;?&gt;</h3><p><a href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/http/HttpEntity.html" target="_blank" rel="noopener"><code>HttpEntity&lt;?&gt;</code></a> 用于同时访问 <em>HTTP 请求头和请求体（HTTP request headers and contents）</em> 。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/index"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">go</span><span class="params">(HttpEntity&lt;String&gt; httpEntity)</span> </span>&#123;</span><br><span class="line">    String body = httpEntity.getBody();</span><br><span class="line">    HttpHeaders headers = httpEntity.getHeaders();</span><br><span class="line">    String host = headers.getFirst(<span class="string">"host"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Map-Model-ModelMap"><a href="#Map-Model-ModelMap" class="headerlink" title="Map / Model / ModelMap"></a>Map / Model / ModelMap</h3><p><code>Map</code> / <a href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/ui/Model.html" target="_blank" rel="noopener"><code>Model</code></a> / <a href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/ui/ModelMap.html" target="_blank" rel="noopener"><code>ModelMap</code></a> 用于在 <code>Controller</code> 层填充将会暴露给 <code>View</code> 层的 <code>Model</code> 对象。</p>
<h2 id="方法参数注解"><a href="#方法参数注解" class="headerlink" title="方法参数注解"></a>方法参数注解</h2><p>尽管使用常规类型的方法参数更接近于人们所熟悉的传统 Servlet 编程，但在 Spring 编程中却不建议这么做。因为这样会导致 JavaBean 与 Servlet 容器耦合，侵入性强，难以进行单元测试（如 Mock 测试）。最佳实践应当是传入注解后被解析好的数据类型，下面介绍这些常用的注解：</p>
<h3 id="PathVariable"><a href="#PathVariable" class="headerlink" title="@PathVariable"></a>@PathVariable</h3><p><a href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/bind/annotation/PathVariable.html" target="_blank" rel="noopener"><code>@PathVariable</code></a> 用于标注某个方法参数与某个 <em>URI 模板变量（URI template variable）</em> 的绑定关系，常用于 <em>RESTful URL</em>，例如 <code>/hotels/{hotel}</code>。</p>
<h3 id="RequestParam"><a href="#RequestParam" class="headerlink" title="@RequestParam"></a>@RequestParam</h3><p><a href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/bind/annotation/RequestParam.html" target="_blank" rel="noopener"><code>@RequestParam</code></a> 用于标注某个方法参数与某个 <em>HTTP 请求参数（HTTP request parameter）</em> 的绑定关系。</p>
<p>使用时需要注意 <code>required</code> 这个属性：</p>
<ul>
<li>方法参数不写 <code>@RequestParam</code>，默认的 <code>required</code> 为 <code>false</code></li>
<li>方法参数写了 <code>@RequestParam</code>，默认的 <code>required</code> 为 <code>true</code></li>
<li>方法参数同时写了 <code>@RequestParam</code> + <code>defaultValue</code>，默认的 <code>required</code> 为 <code>false</code></li>
</ul>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;test HTTP&#x2F;1.1</span><br><span class="line">Host: localhost:8080</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">data&#x3D;123,234</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;test?data&#x3D;123,234 HTTP&#x2F;1.1</span><br><span class="line">Host: localhost:8080</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/test"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(@RequestParam(<span class="string">"data"</span>)</span> String data) </span>&#123;</span><br><span class="line">    log.info(data);  <span class="comment">// 123, 234</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Type conversion is applied automatically if the target method parameter type is not String. See the section called “<a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-typeconversion" target="_blank" rel="noopener">Method Parameters And Type Conversion</a>”.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/test"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(@RequestParam(<span class="string">"data"</span>)</span> ArrayList&lt;String&gt; data) </span>&#123;</span><br><span class="line">    log.info(data.toString());  <span class="comment">// 123, 234</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>When an <code>@RequestParam</code> annotation is used on a <code>Map&lt;String, String&gt;</code> or <code>MultiValueMap&lt;String, String&gt;</code> argument, the map is populated with all request parameters.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/test"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(@RequestParam(<span class="string">"data"</span>)</span> Map&lt;String, String&gt; data) </span>&#123;</span><br><span class="line">    log.info(data.get(<span class="string">"data"</span>));  <span class="comment">// 123, 234</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="RequestBody"><a href="#RequestBody" class="headerlink" title="@RequestBody"></a>@RequestBody</h3><p><a href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/bind/annotation/RequestBody.html" target="_blank" rel="noopener"><code>@RequestBody</code></a> 用于标注某个方法参数与某个 <em>HTTP 请求体（HTTP request body）</em> 的绑定关系。 <code>@RequestBody</code> 会调用合适的 <a href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/http/converter/HttpMessageConverter.html" target="_blank" rel="noopener">message converters</a> 将 <em>HTTP 请求体（HTTP request body）</em> 写入指定对象，默认的 `HttpMessageConverter 如下：</p>
<ul>
<li><code>ByteArrayHttpMessageConverter</code> converts byte arrays.</li>
<li><code>StringHttpMessageConverter</code> converts strings.</li>
<li><code>FormHttpMessageConverter</code> converts form data to/from a MultiValueMap&lt;String, String&gt;.</li>
<li><code>SourceHttpMessageConverter</code> converts to/from a javax.xml.transform.Source.</li>
</ul>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;test HTTP&#x2F;1.1</span><br><span class="line">Host: localhost:8080</span><br><span class="line">Content-Type: application&#x2F;json</span><br><span class="line"></span><br><span class="line">[&quot;123&quot;, &quot;234&quot;]</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/test"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(@RequestBody List&lt;String&gt; data)</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>An <code>@RequestBody</code> method parameter can be annotated with <code>@Valid</code>, in which case it will be validated using the configured <code>Validator</code> instance. When using the MVC namespace or the MVC Java config, a JSR-303 validator is configured automatically assuming a JSR-303 implementation is available on the classpath.</p>
<h3 id="RequestHeader"><a href="#RequestHeader" class="headerlink" title="@RequestHeader"></a>@RequestHeader</h3><p><a href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/bind/annotation/RequestHeader.html" target="_blank" rel="noopener"><code>@RequestHeader</code></a> 用于标注某个方法参数与某个 <em>HTTP 请求头（HTTP request header）</em> 的绑定关系。</p>
<h3 id="CookieValue"><a href="#CookieValue" class="headerlink" title="@CookieValue"></a>@CookieValue</h3><p><a href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/bind/annotation/CookieValue.html" target="_blank" rel="noopener"><code>@CookieValue</code></a> 用于标注某个方法参数与某个 <em>HTTP cookie</em> 的绑定关系。方法参数可以是 <code>javax.servlet.http.Cookie</code>，也可以是具体的 Cookie 值（如字符串、数字类型等）。</p>
<p>举个例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/index"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Employee <span class="title">getEmployeeBy</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    @RequestParam(<span class="string">"name"</span>)</span> String name, </span></span><br><span class="line"><span class="function">    @<span class="title">RequestHeader</span><span class="params">(<span class="string">"host"</span>)</span> String host, </span></span><br><span class="line"><span class="function">    @RequestBody String body) </span>&#123;...&#125;</span><br></pre></td></tr></table></figure>

<h2 id="方法参数验证"><a href="#方法参数验证" class="headerlink" title="方法参数验证"></a>方法参数验证</h2><p>Spring MVC 可以快速整合 JSR 303 - Bean Validation 实现方法参数校验，用法如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/test"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(@Validated RequestVO request, BindingResult bindingResult)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (bindingResult.hasErrors()) &#123;</span><br><span class="line">        String errMsg = bindingResult.getAllErrors().stream()</span><br><span class="line">                .map(DefaultMessageSourceResolvable::getDefaultMessage)</span><br><span class="line">                .collect(Collectors.joining(<span class="string">", "</span>));</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用到：</p>
<p><code>org.springframework.validation.annotation.Validated</code> 注解</p>
<p><code>org.springframework.validation.BindingResult</code> 接口</p>
<p>参考：</p>
<p>《<a href="https://blog.csdn.net/VagueCoder/article/details/48398517" target="_blank" rel="noopener">Spring4新特性——集成Bean Validation 1.1(JSR-349)到SpringMVC</a>》</p>
<h2 id="方法返回类型"><a href="#方法返回类型" class="headerlink" title="方法返回类型"></a>方法返回类型</h2><p><code>@RequestMapping</code> 注解的方法，返回类型可以是下列任一常规类型：</p>
<h3 id="HttpEntity-lt-gt-1"><a href="#HttpEntity-lt-gt-1" class="headerlink" title="HttpEntity&lt;?&gt;"></a>HttpEntity&lt;?&gt;</h3><p><code>org.springframework.http.HttpEntity</code></p>
<p>Represents an HTTP request or response entity, consisting of headers and body.</p>
<p>Typically used in combination with the <code>RestTemplate</code>, like so:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HttpHeaders headers = <span class="keyword">new</span> HttpHeaders();</span><br><span class="line">headers.setContentType(MediaType.TEXT_PLAIN);</span><br><span class="line">HttpEntity&lt;String&gt; entity = <span class="keyword">new</span> HttpEntity&lt;String&gt;(helloWorld, headers);</span><br><span class="line">URI location = template.postForLocation(<span class="string">"http://example.com"</span>, entity);</span><br></pre></td></tr></table></figure>

<p>or</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HttpEntity&lt;String&gt; entity = template.getForEntity(<span class="string">"http://example.com"</span>, String<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">String body = entity.getBody();</span><br><span class="line">MediaType contentType = entity.getHeaders().getContentType();</span><br></pre></td></tr></table></figure>

<p>Can also be used in Spring MVC, as a return value from a <code>@Controller</code> method:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/handle"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> HttpEntity&lt;String&gt; <span class="title">handle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  HttpHeaders responseHeaders = <span class="keyword">new</span> HttpHeaders();</span><br><span class="line">  responseHeaders.set(<span class="string">"MyResponseHeader"</span>, <span class="string">"MyValue"</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> HttpEntity&lt;String&gt;(<span class="string">"Hello World"</span>, responseHeaders);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ResponseEntity-lt-gt"><a href="#ResponseEntity-lt-gt" class="headerlink" title="ResponseEntity&lt;?&gt;"></a>ResponseEntity&lt;?&gt;</h3><p><code>org.springframework.http.ResponseEntity</code></p>
<p>Extension of <code>HttpEntity</code> that adds a <code>HttpStatus</code> status code. Used in <code>RestTemplate</code> as well <code>@Controller</code> methods.</p>
<p>In <code>RestTemplate</code>, this class is returned by <code>getForEntity()</code> and <code>exchange()</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ResponseEntity&lt;String&gt; entity = template.getForEntity(<span class="string">"http://example.com"</span>, String<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">String body = entity.getBody();</span><br><span class="line">MediaType contentType = entity.getHeaders().getContentType();</span><br><span class="line">HttpStatus statusCode = entity.getStatusCode();</span><br></pre></td></tr></table></figure>

<p>Can also be used in Spring MVC, as the return value from a <code>@Controller</code> method:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/handle"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title">handle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  URI location = ...;</span><br><span class="line">  HttpHeaders responseHeaders = <span class="keyword">new</span> HttpHeaders();</span><br><span class="line">  responseHeaders.setLocation(location);</span><br><span class="line">  responseHeaders.set(<span class="string">"MyResponseHeader"</span>, <span class="string">"MyValue"</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;String&gt;(<span class="string">"Hello World"</span>, responseHeaders, HttpStatus.CREATED);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Or, by using a builder accessible via static methods:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/handle"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title">handle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  URI location = ...;</span><br><span class="line">  <span class="keyword">return</span> ResponseEntity.created(location).header(<span class="string">"MyResponseHeader"</span>, <span class="string">"MyValue"</span>).body(<span class="string">"Hello World"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ModelAndView"><a href="#ModelAndView" class="headerlink" title="ModelAndView"></a>ModelAndView</h3><p><code>org.springframework.web.servlet.ModelAndView</code></p>
<p>Holder for both Model and View in the web MVC framework.</p>
<h3 id="String"><a href="#String" class="headerlink" title="String"></a>String</h3><p>表示直接返回视图名。</p>
<h2 id="方法返回注解"><a href="#方法返回注解" class="headerlink" title="方法返回注解"></a>方法返回注解</h2><h3 id="ResponseBody"><a href="#ResponseBody" class="headerlink" title="@ResponseBody"></a>@ResponseBody</h3><p>用于标注某个方法返回值与 <em>WEB 响应体（response body）</em> 的绑定关系。 <code>@ResponseBody</code> 会跳过 <code>ViewResolver</code> 部分，调用合适的 <a href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/http/converter/HttpMessageConverter.html" target="_blank" rel="noopener">message converters</a>，将方法返回值作为 <em>WEB 响应体（response body）</em> 写入输出流。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/index"</span>)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Date <span class="title">go</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Date();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ResponseStatus"><a href="#ResponseStatus" class="headerlink" title="@ResponseStatus"></a>@ResponseStatus</h3><p><a href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/bind/annotation/ResponseStatus.html" target="_blank" rel="noopener"><code>@ResponseStatus</code></a> 用于返回 HTTP 响应码，例如返回 404：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/index"</span>)</span><br><span class="line"><span class="meta">@ResponseStatus</span>(value = HttpStatus.NOT_FOUND, reason = <span class="string">"找不到网页"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">go</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="视图处理"><a href="#视图处理" class="headerlink" title="视图处理"></a>视图处理</h1><h1 id="统一异常处理"><a href="#统一异常处理" class="headerlink" title="统一异常处理"></a>统一异常处理</h1><p>Classes annotated with <code>@ControllerAdvice</code> can contain <code>@ExceptionHandler</code>, <code>@InitBinder</code>, and <code>@ModelAttribute</code> annotated methods, and these methods will apply to <code>@RequestMapping</code> methods across all controller hierarchies as opposed to the controller hierarchy within which they are declared.</p>
<p><code>@RestControllerAdvice</code> is an alternative where <code>@ExceptionHandler</code> methods assume <code>@ResponseBody</code> semantics by default.</p>
<p>Both <code>@ControllerAdvice</code> and <code>@RestControllerAdvice</code> can target a subset of controllers:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Target all Controllers annotated with @RestController</span><br><span class="line">@ControllerAdvice(annotations &#x3D; RestController.class)</span><br><span class="line">public class AnnotationAdvice &#123;&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Target all Controllers within specific packages</span><br><span class="line">@ControllerAdvice(&quot;org.example.controllers&quot;)</span><br><span class="line">public class BasePackageAdvice &#123;&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Target all Controllers assignable to specific classes</span><br><span class="line">@ControllerAdvice(assignableTypes &#x3D; &#123;ControllerInterface.class, AbstractController.class&#125;)</span><br><span class="line">public class AssignableTypesAdvice &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(Throwable<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">ResponseEntity</span>&lt;<span class="title">String</span>&gt; <span class="title">handleException</span>(<span class="title">Throwable</span> <span class="title">e</span>)</span>&#123;</span><br><span class="line">        log.error(e.getMessage(), e);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(e.getMessage(), HttpStatus.valueOf(<span class="number">500</span>));</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="CORS-支持"><a href="#CORS-支持" class="headerlink" title="CORS 支持"></a>CORS 支持</h1><h1 id="核心配置"><a href="#核心配置" class="headerlink" title="核心配置"></a>核心配置</h1><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>《<a href="https://spring.io/guides/gs/serving-web-content/" target="_blank" rel="noopener">Serving Web Content with Spring MVC</a>》</p>
<p>《<a href="https://spring.io/guides/gs/rest-service/" target="_blank" rel="noopener">Building a RESTful Web Service</a>》</p>
<p>《<a href="https://spring.io/guides/gs/rest-service-cors/" target="_blank" rel="noopener">Enabling Cross Origin Requests for a RESTful Web Service</a>》</p>
</div></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2016/05/22/javascript-event-delegation/" class="post-title-link">Javascript 事件委托机制</a></h2><div class="post-info">2016-05-22<a href="/tags/前端/" title="前端" class="post-demo">前端</a></div><div class="post-content"><p>本文目的：</p>
<ul>
<li>能够理解事件绑定和事件委托两种机制的区别</li>
<li>能够使用原生 API 和 jQuery API 两种方式进行事件委托</li>
</ul>
<h1 id="Native-API"><a href="#Native-API" class="headerlink" title="Native API"></a>Native API</h1><p>项目开发时遇到一个需求：修改页面中所有 <code>A</code> 链接的默认行为。</p>
<h2 id="事件绑定"><a href="#事件绑定" class="headerlink" title="事件绑定"></a>事件绑定</h2><p>最开始想到了用“事件绑定”机制进行实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> showMessage = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 阻止 A 链接的默认行为（不进行跳转）</span></span><br><span class="line">        event.preventDefault();</span><br><span class="line">        <span class="comment">// 仅弹窗显示链接的 href 属性</span></span><br><span class="line">        alert(event.currentTarget.href);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> links = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'a'</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; links.length; i++) &#123;</span><br><span class="line">    links[i].addEventListener(<span class="string">'click'</span>, showMessage, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这种做法的问题是：如果页面中绑定了大量的事件处理程序，将直接影响页面的整体运行性能，因为：</p>
<ol>
<li>函数即对象，对象越多，越占用内存，性能就越差。</li>
<li>事件绑定前，必须先找到指定的 DOM 元素。而 DOM 元素查找次数越多，页面的交互就绪时间就越长。</li>
</ol>
<p>更麻烦的是，如果页面加载完后再次插入新元素，需要再次绑定事件处理程序，灵活性差：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> newLink = <span class="built_in">document</span>.createElement(<span class="string">"a"</span>);</span><br><span class="line">newLink.innerHTML = <span class="string">'Click Me'</span>;</span><br><span class="line">newLink.href = <span class="string">'http://localhost'</span>;</span><br><span class="line">newLink.addEventListener(<span class="string">'click'</span>, showMessage, <span class="literal">false</span>);</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(newLink);</span><br></pre></td></tr></table></figure>

<h2 id="事件委托"><a href="#事件委托" class="headerlink" title="事件委托"></a>事件委托</h2><p>利用事件委托机制可以同时解决上述两个问题。只需在 DOM 树中尽量最高的层次上添加一个事件处理程序，代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> showMessage = <span class="function"><span class="keyword">function</span>(<span class="params">event, target</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 阻止 A 链接的默认行为（不进行跳转）</span></span><br><span class="line">        event.preventDefault();</span><br><span class="line">        <span class="comment">// 仅弹窗显示链接的 href 属性</span></span><br><span class="line">        alert(target.href);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 递归查询指定父元素</span></span><br><span class="line">    findTarget = <span class="function"><span class="keyword">function</span>(<span class="params">target, tagName</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (target.tagName &amp;&amp; target.tagName !== tagName.toUpperCase()) &#123;</span><br><span class="line">            target = target.parentNode;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (target.tagName &amp;&amp; target.tagName === tagName.toUpperCase()) ? target : <span class="literal">null</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.body.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 间接判断 A 链接是否被点击</span></span><br><span class="line">    <span class="keyword">var</span> target = findTarget(event.target, <span class="string">'a'</span>);</span><br><span class="line">    <span class="keyword">if</span> (target) &#123;</span><br><span class="line">        showMessage(event, target);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<p>由于所有 <code>A</code> 链接都是 <code>body</code> 元素的子节点，并且它们的事件都会冒泡，因此点击事件最终会被 <code>body</code> 上添加的事件处理程序所处理。代码重构后在以下方面提升了页面性能：</p>
<ul>
<li>由于 <code>document</code> 对象很快就可以访问，而且可以在页面生命周期的任何时点上为它添加事件处理程序（无需等待 <code>DOMContentLoaded</code> 或 <code>load</code> 事件），因此只要可点击的元素呈现在页面上，就可以立即具备适当的功能。</li>
<li>由于只添加一个事件处理程序，因此所需的 DOM 引用更少，整个页面占用的内存空间也更少。</li>
</ul>
<p>此外，事件会关联到当前以及以后添加的子元素上面，可以避免反复为新元素绑定事件处理程序，可谓一劳永逸。</p>
<h1 id="jQuery-API"><a href="#jQuery-API" class="headerlink" title="jQuery API"></a>jQuery API</h1><p>理解了两种机制的区别后，看看如何使用 jQuery 进行最快的实现：</p>
<h2 id="on"><a href="#on" class="headerlink" title="on()"></a>on()</h2><p>jQuery 1.7+ 推出了 <code>on()</code> 方法，其目的有两个：</p>
<ol>
<li><p>统一接口</p>
</li>
<li><p>提高性能</p>
</li>
</ol>
<p>用法如下：</p>
<ul>
<li>事件绑定：<code>on(events,[data],fn)</code> ，用于替换 <code>bind()</code></li>
<li>事件委托：<code>on(events,[selector],[data],fn)</code>  ，用于替换 <code>live()</code> 、 <code>delegate()</code> 。这里的 <code>[selector]</code> 参数很关键，起到了一个过滤器的效果，只有被选中元素的 <strong>子元素</strong> 才会触发事件。</li>
</ul>
<p>用 <code>on()</code> 方法重构后的代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'body'</span>).on(<span class="string">'click'</span>, <span class="string">'a'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">    event.preventDefault();</span><br><span class="line">    alert(event.currentTarget.href);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>可见，代码重构后非常简洁，推荐使用。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li>《<a href="http://www.jb51.net/article/36064.htm" target="_blank" rel="noopener">关于jQuery新的事件绑定机制on()的使用技巧</a>》</li>
<li>《<a href="http://www.diguage.com/archives/71.html" target="_blank" rel="noopener">实例分析JavaScript中的事件委托和事件绑定</a>》</li>
</ul>
</div></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2016/05/08/javascript-event-binding/" class="post-title-link">JavaScript 事件绑定机制</a></h2><div class="post-info">2016-05-08<a href="/tags/前端/" title="前端" class="post-demo">前端</a></div><div class="post-content"><p>本文目的：</p>
<ul>
<li>理解并能按需使用各种事件绑定 API</li>
<li>理解事件对象</li>
<li>理解事件流</li>
</ul>
<h1 id="事件绑定"><a href="#事件绑定" class="headerlink" title="事件绑定"></a>事件绑定</h1><p>事件是用户或浏览器自身执行的某种动作，例如 <code>onclick</code> 、 <code>onload</code> ，都是事件的名字。而响应某个事件的函数就叫做 <strong>事件处理程序（Event Handlers）</strong>。为事件绑定处理程序的方式有以下几种：</p>
<h2 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h2><p>做法：在 HTML 元素中直接编写事件处理程序：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 输出“Clicked” —— 事件处理程序中，可以直接编写 JavaScript 代码 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"Click Me"</span> <span class="attr">onclick</span>=<span class="string">"alert('Clicked')"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 输出“click” —— 事件处理程序中，可以直接访问事件对象 event --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"Click Me"</span> <span class="attr">onclick</span>=<span class="string">"alert('event.type')"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 输出“Click Me” —— 事件处理程序中，this 指向事件的目标元素 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"Click Me"</span> <span class="attr">onclick</span>=<span class="string">"alert('this.value')"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中除了可以编写 JavaScript 代码，还可以调用外部脚本：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 事件处理程序中的代码在执行时，有权访问全局作用域中的任何代码 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"Click Me"</span> <span class="attr">onclick</span>=<span class="string">"showMessage()"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">showMessage</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        alert(<span class="string">"Hello world!"</span>);</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>特点：上述 <code>onclick</code> 事件将自动产生一个事件处理程序（函数），例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onclick</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">    alert(<span class="string">'Clicked'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>优点：简单、粗暴，浏览器兼容性好。</p>
<p>缺点：</p>
<ul>
<li>存在时差问题。用户可能会在 HTML 元素一出现在页面上时，就触发相应事件，但当时的事件处理程序有可能还未具备执行条件（例如事件处理程序所在的外部脚本文件还未加载或解析完毕），此时会引发 <code>undefined</code> 错误。</li>
</ul>
<ul>
<li>HTML 与 JavaScript 代码紧密耦合。如果要重命名事件处理程序，就要改动两个地方，容易改漏、改错。</li>
</ul>
<h2 id="DOM-Level-0"><a href="#DOM-Level-0" class="headerlink" title="DOM Level 0"></a>DOM Level 0</h2><p>做法：首先获取目标 HTML 元素的引用，然后将一个事件处理程序赋值给其指定的事件属性：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">'btn'</span> <span class="attr">value</span>=<span class="string">"Click Me"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'btn'</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// 绑定事件处理程序</span></span></span><br><span class="line"><span class="actionscript">    btn.onclick = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        alert(<span class="string">'Clicked'</span>);</span></span><br><span class="line"><span class="actionscript">        alert(<span class="keyword">this</span>.id);    <span class="comment">// 输出“myDiv” —— this 指向事件的目标元素</span></span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// 删除事件处理程序</span></span></span><br><span class="line"><span class="actionscript">    btn.onclick = <span class="literal">null</span>;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>特点：本质上，DOM 0级事件处理程序 <strong>等于</strong> HTML 事件处理程序，例如：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">'btn'</span> <span class="attr">value</span>=<span class="string">"Click Me"</span> <span class="attr">onclick</span>=<span class="string">"alert('Clicked')"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="actionscript">    setTimeout(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'btn'</span>);</span></span><br><span class="line"><span class="actionscript">        alert(<span class="keyword">typeof</span> btn.onclick);    <span class="comment">// 通过 HTML 的事件属性，访问其 HTML 事件处理程序，并输出其类型“function”</span></span></span><br><span class="line"><span class="actionscript">        btn.onclick = <span class="literal">null</span>;    <span class="comment">// 几秒后，将会删除该按钮的事件处理程序</span></span></span><br><span class="line">    &#125;, 3000);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>优点：</p>
<ul>
<li>传统、常用、浏览器兼容性好。</li>
<li>解决了 HTML 事件处理程序的两个缺点。</li>
</ul>
<p>缺点：一个事件只能绑定唯一一个事件处理程序。</p>
<h2 id="DOM-Level-2"><a href="#DOM-Level-2" class="headerlink" title="DOM Level 2"></a>DOM Level 2</h2><p>做法：目前最主流的写法，可以支持事件冒泡或捕获：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">"button"</span> id=<span class="string">'btn'</span> value=<span class="string">"Click Me"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">    <span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'btn'</span>),</span><br><span class="line">        showMessage = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            alert(<span class="string">'Clicked'</span>);</span><br><span class="line">            alert(<span class="keyword">this</span>.id);    <span class="comment">// 输出“myDiv” —— this 指向事件的目标元素</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 绑定事件处理程序。false 表示在“冒泡阶段”和“目标阶段”触发</span></span><br><span class="line">    btn.addEventListener(<span class="string">'click'</span>, showMessage, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除事件处理程序。注意，匿名函数无法移除</span></span><br><span class="line">    btn.removeEventListener(<span class="string">'click'</span>, showMessage, <span class="literal">false</span>);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<p>优点：一个事件可以绑定多个事件处理程序，以绑定的顺序执行。</p>
<p>缺点：浏览器兼容性差，IE8 及以下版本不支持。</p>
<p>API：<code>element.addEventListener(event, function, useCapture)</code> 。其中 <code>useCapture</code> 可选，布尔值，指定事件是否在捕获或冒泡阶段执行：</p>
<ul>
<li><code>true</code> 捕获阶段执行</li>
<li><code>false</code> 冒泡阶段执行（默认值）</li>
</ul>
<h2 id="IE"><a href="#IE" class="headerlink" title="IE"></a>IE</h2><p>IE 实现了与 DOM 2 级类似的两个方法，只支持事件冒泡：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">"button"</span> id=<span class="string">'btn'</span> value=<span class="string">"Click Me"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">    <span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'btn'</span>),</span><br><span class="line">        showMessage = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            alert(<span class="string">'Clicked'</span>);</span><br><span class="line">            alert(<span class="keyword">this</span> === <span class="built_in">window</span>);    <span class="comment">// 输出“true” —— 注意 this 指向 window</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 绑定事件处理程序。仅在“冒泡阶段”和“目标阶段”触发</span></span><br><span class="line">    btn.attachEvent(<span class="string">'onclick'</span>, showMessage);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除事件处理程序。注意，匿名函数无法移除</span></span><br><span class="line">    btn.detachEvent(<span class="string">'onclick'</span>, showMessage);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<p>优点：一个事件可以绑定多个事件处理程序，以绑定的顺序 <strong>逆序</strong> 执行。</p>
<p>缺点：浏览器兼容性差，仅支持 IE 及 Opera。</p>
<h2 id="Cross-Browser"><a href="#Cross-Browser" class="headerlink" title="Cross-Browser"></a>Cross-Browser</h2><p>鉴于上述几种方式的各有优劣，为了以跨浏览器的方式处理事件，可以定义自己的  <code>EventUtil</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> EventUtil = &#123;</span><br><span class="line"></span><br><span class="line">    addHandler: <span class="function"><span class="keyword">function</span>(<span class="params">element, type, handler</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (element.addEventListener)&#123;</span><br><span class="line">            element.addEventListener(type, handler, <span class="literal">false</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (element.attachEvent)&#123;</span><br><span class="line">            element.attachEvent(“on” + type, handler);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            element[“on” + type] = handler;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    removeHandler: <span class="function"><span class="keyword">function</span>(<span class="params">element, type, handler</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (element.removeEventListener)&#123;</span><br><span class="line">            element.removeEventListener(type, handler, <span class="literal">false</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (element.detachEvent)&#123;</span><br><span class="line">            element.detachEvent(“on” + type, handler);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            element[“on” + type] = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="事件对象"><a href="#事件对象" class="headerlink" title="事件对象"></a>事件对象</h1><p>在触发 DOM 上的某个事件时，会产生一个事件对象 <code>event</code> ，这个对象中包含着所有与事件有关的信息。尽管触发的事件类型不同，可用属性和方法也会不同，但是所有事件都会包含下列常用成员：</p>
<table>
<thead>
<tr>
<th>DOM Level 2</th>
<th>Type</th>
<th>IE</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>type</code></td>
<td>String</td>
<td><code>type</code></td>
<td>String</td>
<td>被触发的事件类型</td>
</tr>
<tr>
<td><code>eventPhase</code></td>
<td>Integer</td>
<td>-</td>
<td>-</td>
<td>调用事件处理程序的所处阶段：<code>1</code> 表示捕获阶段，<code>2</code> 表示“处于目标”，<code>3</code> 表示冒泡阶段</td>
</tr>
<tr>
<td><code>target</code></td>
<td>Element</td>
<td><code>srcElement</code></td>
<td>Element</td>
<td>事件的目标元素</td>
</tr>
<tr>
<td><code>currentTarget</code></td>
<td>Element</td>
<td>-</td>
<td>-</td>
<td>当前正在处理事件的元素。如果事件处于目标元素，则 <code>this === currentTarget === target</code></td>
</tr>
<tr>
<td><code>stopPropagation()</code></td>
<td>Function</td>
<td><code>cancelBubble</code></td>
<td>Boolean</td>
<td>取消事件的进一步捕获或冒泡</td>
</tr>
<tr>
<td><code>preventDefault()</code></td>
<td>Function</td>
<td><code>returnValue</code></td>
<td>Boolean</td>
<td>取消事件的默认行为。该方法将通知 Web 浏览器不要执行与事件关联的默认动作（如果存在这样的动作）。例如，如果 <code>type</code> 属性是 “submit”，可以阻止提交表单。</td>
</tr>
</tbody></table>
<h1 id="事件流"><a href="#事件流" class="headerlink" title="事件流"></a>事件流</h1><p>最后总结下与事件处理程序息息相关的“事件流”。事件流是指从页面中接收事件的顺序。但有意思的是，历史上 IE 和 Netscape 开发团队居然提出了 <strong>完全相反</strong> 的事件流概念 —— IE 使用“<strong>事件冒泡（Event Bubbling）</strong>”、Netscape 使用“<strong>事件捕获（Event Capturing）</strong>”。下图演示了这两种事件流的区别：</p>
<p><img src="/img/javascript/event-flow.png" alt="事件流（Event Flow）"></p>
<p>下表列出了四种事件绑定所使用的事件流模型：</p>
<table>
<thead>
<tr>
<th></th>
<th>事件冒泡 or 事件捕获？</th>
</tr>
</thead>
<tbody><tr>
<td>HTML</td>
<td>取决于 IE or Netscape</td>
</tr>
<tr>
<td>DOM Level 0</td>
<td>取决于 IE or Netscape</td>
</tr>
<tr>
<td>DOM Level 2</td>
<td>事件冒泡 + 事件捕获</td>
</tr>
<tr>
<td>IE</td>
<td>事件冒泡</td>
</tr>
</tbody></table>
<p>下面重点讲解 DOM Level 2 事件处理程序所规定的事件流，其共包含三个阶段（其运行效果如上图从 1 到 10）：</p>
<ol>
<li>事件捕获阶段，可用于事件截获</li>
<li>处于目标阶段</li>
<li>事件冒泡阶段，可用于<a href="/2016/05/22/javascript-event-delegation">事件委托（Event Delegation）</a></li>
</ol>
<p>下面这段代码演示了 DOM Level 2 的整个事件流：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">'btn'</span> <span class="attr">value</span>=<span class="string">"Click Me"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// 仅在“事件捕获阶段”和“处于目标阶段”触发</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.body.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span></span><br><span class="line"><span class="actionscript">        alert(event.eventPhase + <span class="string">' body'</span>);</span></span><br><span class="line"><span class="actionscript">    &#125;, <span class="literal">true</span>);</span></span><br><span class="line">  </span><br><span class="line"><span class="actionscript">    <span class="comment">// 仅在“事件冒泡阶段”和“处于目标阶段”触发</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.getElementById(<span class="string">'btn'</span>).addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span></span><br><span class="line"><span class="actionscript">        alert(event.eventPhase + <span class="string">' input'</span>);</span></span><br><span class="line"><span class="actionscript">    &#125;, <span class="literal">false</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// 仅在“事件冒泡阶段”和“处于目标阶段”触发</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span></span><br><span class="line"><span class="actionscript">        alert(event.eventPhase + <span class="string">' document'</span>);</span></span><br><span class="line"><span class="actionscript">    &#125;, <span class="literal">false</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>点击 <code>input</code> 按钮，将依次输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 body</span><br><span class="line">2 input</span><br><span class="line">3 document</span><br></pre></td></tr></table></figure>

<p>可见，DOM Level 2 是同时支持事件冒泡 + 事件捕获的。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li>《JavaScript 高级程序设计》</li>
</ul>
</div></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2016/05/08/optimizing-hexo-speed-with-coding-pages/" class="post-title-link">无缝迁移 Pages 服务</a></h2><div class="post-info">2016-05-08<a href="/tags/建站/" title="建站" class="post-demo">建站</a></div><div class="post-content"><p>一年前，为了优化这个博客的访问速度，我将 <a href="/2015/05/17/optimizing-hexo-speed/">Pages 服务迁移</a> 到了 GitCafe，没想到一年后 GitCafe 竟被 codeing.net 收购了，其服务将在五月底全面停止，真是令人叹息。</p>
<p>幸好 <a href="https://coding.net/help/doc/pages/" target="_blank" rel="noopener">Coding Pages</a> 支持免费绑定自定义域名，其配置也非常简单。在完成配置之后，只需要到 DNSPod 切换下 cname ，等待 DNS 解析生效即可。整个过程对网站用户透明。</p>
<p>最后，<a href="http://www.figotan.org/2016/04/06/how-to-choose-vcs-as-your-static-website-pages/" target="_blank" rel="noopener">这里</a> 列举了不少知名的 Pages 服务可供选择。不过对于国内用户来说，还是使用国内服务最快、最稳定。</p>
</div></article></li></ul><div class="right-container"><div class="widget"><div class="tagcloud"><h4>标签云</h4><a href="/tags/C-C/" style="font-size: 15px;">C/C++</a> <a href="/tags/DNS/" style="font-size: 12.5px;">DNS</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/GNU-Linux/" style="font-size: 16.67px;">GNU/Linux</a> <a href="/tags/Git/" style="font-size: 17.5px;">Git</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/MySQL/" style="font-size: 19.17px;">MySQL</a> <a href="/tags/Nginx/" style="font-size: 11.67px;">Nginx</a> <a href="/tags/Redis/" style="font-size: 10.83px;">Redis</a> <a href="/tags/Spring/" style="font-size: 15.83px;">Spring</a> <a href="/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" style="font-size: 11.67px;">函数式编程</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 18.33px;">前端</a> <a href="/tags/%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B/" style="font-size: 11.67px;">响应式编程</a> <a href="/tags/%E5%AE%89%E5%85%A8/" style="font-size: 12.5px;">安全</a> <a href="/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" style="font-size: 11.67px;">并发编程</a> <a href="/tags/%E5%BB%BA%E7%AB%99/" style="font-size: 13.33px;">建站</a> <a href="/tags/%E7%AE%A1%E7%90%86/" style="font-size: 12.5px;">管理</a> <a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" style="font-size: 14.17px;">读书笔记</a> <a href="/tags/%E9%87%91%E8%9E%8D/" style="font-size: 12.5px;">金融</a></div></div><div class="widget"><div class="recent"><h4>最近文章</h4><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2021/02/26/cpp-io-library/">C/C++ 语言系列（十一）I/O 库总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/25/cpp-oop-inheritance-and-polymorphism/">C/C++ 语言系列（十）面向对象编程之继承与多态</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/20/cpp-oop-class/">C/C++ 语言系列（九）面向对象编程之类、类模板、类指针</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/18/cpp-type-aliases/">C/C++ 语言系列（八）复合数据类型之类型别名</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/16/cpp-struct/">C/C++ 语言系列（七）复合数据类型之结构体</a></li></ul></div></div></div></section></div><div class="right-menu"></div><div class="modal search-modal"><div class="input-field"><input type="text" id="search_input"><label for="search-input">搜索</label></div><div id="search_result" class="search-result"></div></div><div class="blog-overlay"></div><footer class="row"><div class="footer-con"><div class="paginator"><a href="/page/12/" class="prev">PREV</a><a href="/page/14/" class="next">NEXT</a></div><div class="copyright"><p>© 2014 - 2021 <a href="https://github.com/qidawu" target="_blank">Qida's Blog</a></p><p>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <br> and <a href="https://github.com/Bulandent/hexo-theme-bubuzou" target="_blank">hexo-theme-bubuzou</a></p></div><div class="totop"><i></i></div></div></footer><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src="/scripts/jquery-1.8.2.min.js"></script><script src="https://cdn1.lncld.net/static/js/av-mini-0.6.10.js"></script><script src="/scripts/hit-kounter-lc-0.2.0.js"></script><script src="/scripts/arAnchor.js"></script><script src="/scripts/main.js"></script></body></html>