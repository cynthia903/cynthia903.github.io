<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content="1EB8XoOl0C"><meta name="google-site-verification" content="K7thEgdLm0UfRWJ5MGdF7sCcjClSzAlxFLPv2Oz5CGM"><title> Java 数据持久化系列（二）JDBC API 规范总结 · Qida's Blog</title><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="Java 数据持久化系列（二）JDBC API 规范总结 - Qida's Blog"><meta name="keywords"><meta name="author" content="Qida's Blog"><link rel="short icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/bubuzou.css"><link rel="search" type="application/opensearchdescription+xml" href="https://qidawu.github.io/atom.xml" title="Qida's Blog"><meta name="generator" content="Hexo 4.2.1"></head><body><header><div class="header row"> <a href="/" class="logo-link"><img src="/images/logo.png"></a><a href="/" class="title-link">Qida's Blog</a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" data-hover="博文" class="nav-list-link">博文</a></li><li class="nav-list-item"><a href="/archives/" target="_self" data-hover="归档" class="nav-list-link">归档</a></li></ul><div class="search"><a id="search_btn" href="#search"></a></div></div></header><div class="row scroll-con"><section class="container"><!-- for archive page--><div id="postAr" class="post"><article class="post-block"><h1 class="post-title">Java 数据持久化系列（二）JDBC API 规范总结</h1><div class="post-info">2018-02-06<a href="/tags/Java/" title="Java" class="post-demo">Java</a></div><div class="post-content"><h1 id="总览"><a href="#总览" class="headerlink" title="总览"></a>总览</h1><p>首先，来总览下 JDBC API：</p>
<p><img src="/img/java/jdbc/jdbc-api.png" alt="JDBC"></p>
<h1 id="JDBC-API-规范"><a href="#JDBC-API-规范" class="headerlink" title="JDBC API 规范"></a>JDBC API 规范</h1><p>JDBC API 作为 Java SE™（Java 标准版）的一部分，由以下部分组成：</p>
<ul>
<li><p>JDBC 核心 API —— <code>java.sql</code> package。</p>
</li>
<li><p>JDBC 可选 API —— <code>javax.sql</code> package，是 Java EE™（Java 企业版）的重要组成部分。</p>
</li>
</ul>
<p>其中，<code>java.sql</code> package 包含下列 API：</p>
<ul>
<li><p>通过 <code>java.sql.DriverManager</code> 与数据库建立连接</p>
<ul>
<li><code>java.sql.DriverManager</code> 类 - 用于与驱动程序建立连接</li>
<li><code>java.sql.SQLPermission</code> 类</li>
<li><code>java.sql.Driver</code> 接口 - 提供用于注册和连接驱动程序的 API。</li>
<li><code>java.sql.DriverPropertyInfo</code> 类 - 提供 JDBC 驱动程序的属性。</li>
</ul>
</li>
<li><p>发送 SQL 语句到数据库</p>
<ul>
<li><code>java.sql.Connection</code> 接口 - 提供创建语句、管理连接及其属性的方法</li>
<li><code>java.sql.Statement</code> 接口 - 用于发送基本的 SQL 语句</li>
<li><code>java.sql.PreparedStatement</code> 接口 - 用于发送预编译语句或基本 SQL 语句（继承自<code>Statement</code>）</li>
<li><code>java.sql.CallableStatement</code> 接口 - 用于调用数据库存储过程（继承自<code>PreparedStatement</code>）</li>
<li><code>java.sql.Savepoint</code> 接口 - 在事务中提供保存点</li>
</ul>
</li>
<li><p>检索和更新查询结果</p>
<ul>
<li><code>java.sql.ResultSet</code> 接口</li>
</ul>
</li>
<li><p>标准映射（SQL 数据类型到 Java 类或接口）</p>
</li>
<li><p>自定义映射（SQL user-defined type (UDT) 到 Java 类）</p>
</li>
<li><p>元数据</p>
<ul>
<li><code>java.sql.DatabaseMetaData</code> 接口 - 提供有关数据库的信息</li>
<li><code>java.sql.ResultSetMetaData</code> 接口 - 提供有关 <code>ResultSet</code> 对象的列信息</li>
<li><code>java.sql.ParameterMetaData</code> 接口 - 提供有关 <code>PreparedStatement</code> 命令的参数信息</li>
</ul>
</li>
<li><p>异常</p>
<ul>
<li><code>java.sql.SQLException</code> 类 - 被大多数方法抛出，当数据访问出现问题或出于其它原因</li>
<li><code>java.sql.SQLWarning</code> 类 - 抛出表示警告</li>
<li><code>java.sql.DataTruncation</code> 类 - 抛出表示数据可能已被截断</li>
<li><code>java.sql.BatchUpdateException</code> 类 - 抛出表示批量更新中的部分命令未执行成功</li>
</ul>
</li>
</ul>
<p>下面重点看下常用的接口和类。</p>
<h2 id="DriverManager-类"><a href="#DriverManager-类" class="headerlink" title="DriverManager 类"></a>DriverManager 类</h2><p><code>java.sql.DriverManager</code> 类充当用户和驱动程序之间的接口。它跟踪可用的驱动程序并处理数据库与相应驱动程序之间的连接。<code>DriverManager</code> 类维护了一个通过调用 <code>DriverManager.registerDriver()</code> 方法来注册自己的 <code>java.sql.Driver</code> 类列表。</p>
<p>常用方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">registerDriver</span><span class="params">(Driver driver)</span> <span class="comment">// 用于通过 `DriverManager` 注册给定的驱动程序。</span></span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">deregisterDriver</span><span class="params">(Driver driver)</span>  <span class="comment">// 用于从 `DriverManager` 取消注册给定的驱动程序（从列表中删除驱动程序）。</span></span></span><br><span class="line"><span class="function"><span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">(String url)</span>  <span class="comment">// 用于与指定的 URL 建立连接。</span></span></span><br><span class="line"><span class="function"><span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">(String url, String userName, String password)</span>  <span class="comment">// 用于与指定的 URL 建立连接，通过用户名和密码。</span></span></span><br></pre></td></tr></table></figure>

<p>关于 Driver 驱动程序注册，详见《<a href="/2019/01/23/java-jdbc-driver/">注册驱动程序</a>》。</p>
<h2 id="Connection-接口"><a href="#Connection-接口" class="headerlink" title="Connection 接口"></a>Connection 接口</h2><p><code>java.sql.Connection</code> 接口表示 Java 应用程序和数据库之间的会话（Session），它提供了许多事务管理方法如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setAutoCommit</span><span class="params">(<span class="keyword">boolean</span> status)</span>  <span class="comment">// 修改当前 `Connection` 对象的事务自动提交模式。默认为 `true`。</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setReadOnly</span><span class="params">(<span class="keyword">boolean</span> readOnly)</span>  <span class="comment">// 修改当前 `Connection` 对象的只读状态以提示驱动程序开启数据库优化。</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setTransactionIsolation</span><span class="params">(<span class="keyword">int</span> level)</span>  <span class="comment">// 修改当前 `Connection` 对象的事务隔离级别。</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">commit</span><span class="params">()</span>  <span class="comment">// 保存自上次提交/回滚以来所做的所有更改。</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rollback</span><span class="params">()</span>  <span class="comment">// 丢弃自上次提交/回滚以来所做的所有更改。</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 在当前事务中设置或移除保存点。</span></span></span><br><span class="line"><span class="function">Savepoint <span class="title">setSavepoint</span><span class="params">()</span></span></span><br><span class="line"><span class="function">Savepoint <span class="title">setSavepoint</span><span class="params">(String name)</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">releaseSavepoint</span><span class="params">(Savepoint savepoint)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">close</span><span class="params">()</span>  <span class="comment">// 关闭连接并立即释放 JDBC 资源。</span></span></span><br></pre></td></tr></table></figure>

<p><code>Connection</code> 接口同时也是一个工厂类，用于获取 <code>Statement</code>、<code>PreparedStatement</code> 和 <code>DatabaseMetaData</code> 对象：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Statement <span class="title">createStatement</span><span class="params">(...)</span>  <span class="comment">// 创建一个可用于执行 SQL 查询或更新的语句对象。</span></span></span><br><span class="line"><span class="function">PreparedStatement <span class="title">prepareStatement</span><span class="params">(...)</span>  <span class="comment">// 创建一个可用于执行 SQL 参数化查询或更新的语句对象。</span></span></span><br><span class="line"><span class="function">CallableStatement <span class="title">prepareCall</span><span class="params">(...)</span>  <span class="comment">// 用于调用存储过程和函数。</span></span></span><br><span class="line"><span class="function">DatabaseMetaData <span class="title">getMetaData</span><span class="params">()</span>  <span class="comment">// 用于获取数据库的元数据，例如数据库产品名称，数据库产品版本，驱动程序名称，表总数名称，总视图名称等。</span></span></span><br></pre></td></tr></table></figure>

<h2 id="Statement-接口"><a href="#Statement-接口" class="headerlink" title="Statement 接口"></a>Statement 接口</h2><p><code>java.sql.Statement</code> 接口提供用于执行数据库查询与更新的方法。<code>Statement</code>  接口是 <code>ResultSet</code> 的工厂，即它提供工厂方法来获取 <code>ResultSet</code> 的对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ResultSet <span class="title">executeQuery</span><span class="params">(String sql)</span>  <span class="comment">// 用于执行 `SELECT` 查询并返回 `ResultSet` 的对象。</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">executeUpdate</span><span class="params">(String sql)</span>  <span class="comment">// 用于执行指定的更新，如 `create`，`drop`，`insert`，`update`，`delete` 等。</span></span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">execute</span><span class="params">(String sql)</span>  <span class="comment">// 用于执行可能返回多种结果的查询。</span></span></span><br></pre></td></tr></table></figure>

<p>除了通过上述方法来执行单个查询或更新，还可以通过下列方法执行批量命令：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addBatch</span><span class="params">(String sql)</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">clearBatch</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span>[] <span class="title">executeBatch</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>

<p>使用批量命令前，记得先使用 <code>setAutoCommit()</code> 将事务的自动提交模式设置为 <code>false</code> 。</p>
<p>批处理允许您将相关的 SQL 语句分组到批处理中，并通过一次调用数据库来提交它们。当您一次性向数据库发送多个 SQL 语句时，可以减少通信开销，从而提高性能。参考：<a href="https://www.tutorialspoint.com/jdbc/jdbc-batch-processing.htm" target="_blank" rel="noopener">JDBC - Batch Processing</a>。</p>
<h2 id="PreparedStatement-接口"><a href="#PreparedStatement-接口" class="headerlink" title="PreparedStatement 接口"></a>PreparedStatement 接口</h2><p><code>java.sql.PreparedStatement</code> 接口是 <code>java.sql.Statement</code> 的子接口。它用于执行参数化查询（parameterized query），例如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PreparedStatement stmt = connection.prepareStatement("<span class="keyword">insert</span> <span class="keyword">into</span> emp <span class="keyword">values</span>(?, ?, ?)<span class="string">");</span></span><br></pre></td></tr></table></figure>

<p>为什么要使用 <code>PreparedStatement</code>？</p>
<ul>
<li><strong>提升性能</strong>：应用程序的性能会更快，因为 SQL 语句只会编译一次。</li>
<li><strong>提升安全</strong></li>
</ul>
<p>创建预编译的参数化查询语句后，需要通过 <code>setXxx</code> 方法设置对应参数。参数设置完毕后，就可以通过下列方法执行 SQL 语句：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ResultSet <span class="title">executeQuery</span><span class="params">()</span>  <span class="comment">// 用于执行 `SELECT` 查询并返回 `ResultSet` 的对象。</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">executeUpdate</span><span class="params">()</span>  <span class="comment">// 用于执行指定的更新，如 `create`，`drop`，`insert`，`update`，`delete` 等。</span></span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">execute</span><span class="params">()</span>  <span class="comment">// 用于执行可能返回多种结果的查询。</span></span></span><br></pre></td></tr></table></figure>

<p><code>PreparedStatement</code> 还提供了批处理方式，减少网络请求，提升性能，API 如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Adds a set of parameters to this &lt;code&gt;PreparedStatement&lt;/code&gt;</span></span><br><span class="line"><span class="comment"> * object's batch of commands.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@exception</span> SQLException if a database access error occurs or</span></span><br><span class="line"><span class="comment"> * this method is called on a closed &lt;code&gt;PreparedStatement&lt;/code&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> Statement#addBatch</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addBatch</span><span class="params">()</span> <span class="keyword">throws</span> SQLException</span>;</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PreparedStatement ps = conn.prepareStatement(<span class="string">"INSERT into employees values (?, ?, ?)"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (n = <span class="number">0</span>; n &lt; <span class="number">100</span>; n++) &#123;</span><br><span class="line">    ps.setString(name[n]);</span><br><span class="line">    ps.setLong(id[n]);</span><br><span class="line">    ps.setInt(salary[n]);</span><br><span class="line">    <span class="comment">// 多次执行PreparedStatement，多次数据库请求（网络请求）</span></span><br><span class="line">    ps.executeUpdate();  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用批处理方法，一次性执行多条 SQL：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PreparedStatement ps = conn.prepareStatement(<span class="string">"INSERT into employees values (?, ?, ?)"</span>);</span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span> (n = <span class="number">0</span>; n &lt; <span class="number">100</span>; n++) &#123;</span><br><span class="line">    ps.setString(name[n]);</span><br><span class="line">    ps.setLong(id[n]);</span><br><span class="line">    ps.setInt(salary[n]);</span><br><span class="line">    <span class="comment">// 添加批次</span></span><br><span class="line">    ps.addBatch();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 调用父接口 Statement#executeBatch() 执行批次</span></span><br><span class="line">ps.executeBatch();</span><br></pre></td></tr></table></figure>

<h2 id="ResultSet-接口"><a href="#ResultSet-接口" class="headerlink" title="ResultSet 接口"></a>ResultSet 接口</h2><p><code>java.sql.ResultSet</code> 对象维护了一个指向 table 行的游标。游标初始值指向第 0 行。默认情况下，<code>ResultSet</code> 对象只能向前移动，并且不可更新。可以通过在 <code>createStatement(int, int)</code> 方法中传递指定参数修改该默认行为。</p>
<p>可以通过以下方法操作游标：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">next</span><span class="params">()</span>  <span class="comment">// 将游标移动到当前位置的下一行。</span></span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">previous</span><span class="params">()</span>  <span class="comment">// 将游标移动到当前位置之前的一行。</span></span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">first</span><span class="params">()</span>  <span class="comment">// 将游标移动到结果集的第一行。</span></span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">last</span><span class="params">()</span>  <span class="comment">// 将游标移动到结果集的最后一行。</span></span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">absolute</span><span class="params">(<span class="keyword">int</span> row)</span>  <span class="comment">// 将游标移动到结果集的指定行号。</span></span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">relative</span><span class="params">(<span class="keyword">int</span> row)</span>  <span class="comment">// 将游标移动到结果集的相对行号，它可以是正数或负数。</span></span></span><br></pre></td></tr></table></figure>

<p>将游标移动到指定行之后，可以通过 <code>getXxx</code> 方法获取当前行的指定列的数据。</p>
<p>此外，还可以直接获取 table 的元数据，例如列的总数，列名，列类型等：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ResultSetMetaData <span class="title">getMetaData</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>

<h2 id="ResultSetMetaData-接口"><a href="#ResultSetMetaData-接口" class="headerlink" title="ResultSetMetaData 接口"></a>ResultSetMetaData 接口</h2><p><code>java.sql.ResultSetMetaData</code> 用于获取 table 的元数据，例如列的总数，列名，列类型等。</p>
<h2 id="DatabaseMetaData-接口"><a href="#DatabaseMetaData-接口" class="headerlink" title="DatabaseMetaData 接口"></a>DatabaseMetaData 接口</h2><p><code>java.sql.DatabaseMetaData</code> 用于获取数据库的元数据，例如数据库产品名称，数据库产品版本，驱动程序名称，表总数名称，总视图名称等。</p>
<h2 id="RowSet-接口"><a href="#RowSet-接口" class="headerlink" title="RowSet 接口"></a>RowSet 接口</h2><p><code>javax.sql.RowSet</code> 继承自 <code>java.sql.ResultSet</code>，是其包装器类。它包含类似 <code>ResultSet</code> 的表格数据，但使用起来非常简单灵活。其实现类如下：</p>
<p><img src="/img/java/jdbc/rowset.jpg" alt="RowSet"></p>
<p>下面是一个不含事件处理代码的 <code>JdbcRowSet</code> 的简单示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (JdbcRowSet rowSet = RowSetProvider.newFactory().createJdbcRowSet()) &#123;</span><br><span class="line">    rowSet.setUrl(url);</span><br><span class="line">    rowSet.setCommand(<span class="string">"SELECT * FROM test"</span>);</span><br><span class="line">    rowSet.execute();</span><br><span class="line">    <span class="keyword">while</span> (rowSet.next()) &#123;</span><br><span class="line">        <span class="keyword">int</span> id = rowSet.getInt(<span class="string">"id"</span>);</span><br><span class="line">        String name = rowSet.getString(<span class="string">"name"</span>);</span><br><span class="line">        log.info(<span class="string">"Result is &#123;&#125; &#123;&#125;"</span>, id, name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对比下面传统的 JDBC API，代码更加直观，需要直接管理的资源也更少：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (Connection conn = DriverManager.getConnection(url)) &#123;</span><br><span class="line">    <span class="keyword">try</span> (Statement stmt = conn.createStatement()) &#123;</span><br><span class="line">        <span class="keyword">try</span> (ResultSet rs = stmt.executeQuery(<span class="string">"SELECT * FROM test"</span>)) &#123;</span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                <span class="keyword">int</span> id = rs.getInt(<span class="string">"id"</span>);</span><br><span class="line">                String name = rs.getString(<span class="string">"name"</span>);</span><br><span class="line">                log.info(<span class="string">"Result is &#123;&#125;, &#123;&#125;"</span>, id, name);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要使用 <code>JdbcRowSet</code> 执行事件处理，需要在 <code>JdbcRowSet</code> 的 <code>addRowSetListener</code> 方法中添加 <code>RowSetListener</code> 的实例。<code>RowSetListener</code> 接口提供了必须实现的三个方法，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cursorMoved</span><span class="params">(RowSetEvent event)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rowChanged</span><span class="params">(RowSetEvent event)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rowSetChanged</span><span class="params">(RowSetEvent event)</span></span>;</span><br></pre></td></tr></table></figure>

<h2 id="DataSource-接口"><a href="#DataSource-接口" class="headerlink" title="DataSource 接口"></a>DataSource 接口</h2><h1 id="JDBC-API-示例"><a href="#JDBC-API-示例" class="headerlink" title="JDBC API 示例"></a>JDBC API 示例</h1><p>JDBC API 的使用步骤如下：</p>
<p><img src="/img/java/jdbc/steps-to-connect-to-the-database-in-java.jpg" alt="JDBC 使用步骤"></p>
<p>其中：</p>
<ol>
<li>步骤一：JDBC API 从 4.0 开始利用 Java SPI 机制自动加载驱动程序，可以省略该步骤。</li>
<li>步骤二、三：如果使用如 Spring <code>JdbcTempate</code>、MyBatis 等框架，可以省略该步骤。</li>
<li>步骤五：使用 <code>try-with-resources</code> 语句，可以省略该步骤。</li>
</ol>
<p>下面来两个示例：</p>
<h2 id="存储图片"><a href="#存储图片" class="headerlink" title="存储图片"></a>存储图片</h2><p>下例通过 <code>PreparedStatement</code> 接口的 <code>setBinaryStream()</code> 方法将图片（二进制信息）存储到数据库中。为了将图片存储到数据库中，需要在表中使用 <code>BLOB</code>（Binary Large Object）数据类型。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (Connection conn = DriverManager.getConnection(url)) &#123;</span><br><span class="line">    <span class="keyword">try</span> (PreparedStatement stmt = conn.prepareStatement(<span class="string">"INSERT INTO test(title, photo) VALUES(?, ?)"</span>)) &#123;</span><br><span class="line">        FileInputStream fileInputStream = <span class="keyword">new</span> FileInputStream(<span class="string">"F:\\test.jpg"</span>);</span><br><span class="line">        stmt.setString(<span class="number">1</span>, <span class="string">"pic1"</span>);</span><br><span class="line">        stmt.setBinaryStream(<span class="number">2</span>, fileInputStream);</span><br><span class="line">        assertTrue(<span class="number">1</span> == stmt.executeUpdate());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：这只是一个例子，生产环境中是不会将这类二进制信息存储到数据库中的，而是存储到专门的文件系统，以提升性能，并节省宝贵的数据库资源 :)</p>
<h2 id="检索图片"><a href="#检索图片" class="headerlink" title="检索图片"></a>检索图片</h2><p>Using <code>try-with-resources</code> Statements to Automatically Close JDBC Resources: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (Connection conn = DriverManager.getConnection(url)) &#123;</span><br><span class="line">    <span class="keyword">try</span> (PreparedStatement stmt = conn.prepareStatement(<span class="string">"SELECT title, photo FROM test"</span>)) &#123;</span><br><span class="line">        <span class="keyword">try</span> (ResultSet rs = stmt.executeQuery()) &#123;</span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                String title = rs.getString(<span class="number">1</span>);</span><br><span class="line">                log.info(<span class="string">"title is &#123;&#125;"</span>, title);</span><br><span class="line"></span><br><span class="line">                Blob photo = rs.getBlob(<span class="number">2</span>);</span><br><span class="line">                <span class="keyword">byte</span>[] bytes = photo.getBytes(<span class="number">1</span>, (<span class="keyword">int</span>) photo.length());</span><br><span class="line">                String fileName = String.format(<span class="string">"F:\\%s.png"</span>, title);</span><br><span class="line">                <span class="keyword">try</span> (FileOutputStream fileOutputStream = <span class="keyword">new</span> FileOutputStream(fileName)) &#123;</span><br><span class="line">                    fileOutputStream.write(bytes);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>JDBC 4.1 (Java SE 7) introduces the ability to use a <code>try-with-resources</code> statement to automatically close <code>java.sql.Connection</code>, <code>java.sql.Statement</code>, and <code>java.sql.ResultSet</code> objects, regardless of whether a <code>SQLException</code> or any other exception has been thrown. See <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/language/try-with-resources.html" target="_blank" rel="noopener">The try-with-resources Statement</a> for more information.</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>《<a href="https://docs.oracle.com/javase/6/docs/technotes/guides/jdbc/getstart/GettingStartedTOC.fm.html" target="_blank" rel="noopener">Getting Started with the JDBC API</a>》</p>
<p><a href="https://docs.oracle.com/javase/8/docs/technotes/guides/jdbc/jdbc_41.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/technotes/guides/jdbc/jdbc_41.html</a></p>
<p><a href="https://docs.oracle.com/javase/8/docs/technotes/guides/jdbc/jdbc_42.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/technotes/guides/jdbc/jdbc_42.html</a></p>
<p><a href="https://docs.oracle.com/javase/9/docs/api/java/sql/package-summary.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/9/docs/api/java/sql/package-summary.html</a></p>
<p><a href="https://www.javatpoint.com/java-jdbc" target="_blank" rel="noopener">https://www.javatpoint.com/java-jdbc</a></p>
<p><a href="https://www.tutorialspoint.com/jdbc/index.htm" target="_blank" rel="noopener">https://www.tutorialspoint.com/jdbc/index.htm</a></p>
<p><a href="https://www.tutorialspoint.com/dbutils/index.htm" target="_blank" rel="noopener">https://www.tutorialspoint.com/dbutils/index.htm</a></p>
</div></article></div><div class="right-container"><div class="widget"><div class="tagcloud"><h4>标签云</h4><a href="/tags/C-C/" style="font-size: 15px;">C/C++</a> <a href="/tags/DNS/" style="font-size: 12.5px;">DNS</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/GNU-Linux/" style="font-size: 16.67px;">GNU/Linux</a> <a href="/tags/Git/" style="font-size: 17.5px;">Git</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/MySQL/" style="font-size: 19.17px;">MySQL</a> <a href="/tags/Nginx/" style="font-size: 11.67px;">Nginx</a> <a href="/tags/Redis/" style="font-size: 10.83px;">Redis</a> <a href="/tags/Spring/" style="font-size: 15.83px;">Spring</a> <a href="/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" style="font-size: 11.67px;">函数式编程</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 18.33px;">前端</a> <a href="/tags/%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B/" style="font-size: 11.67px;">响应式编程</a> <a href="/tags/%E5%AE%89%E5%85%A8/" style="font-size: 12.5px;">安全</a> <a href="/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" style="font-size: 11.67px;">并发编程</a> <a href="/tags/%E5%BB%BA%E7%AB%99/" style="font-size: 13.33px;">建站</a> <a href="/tags/%E7%AE%A1%E7%90%86/" style="font-size: 12.5px;">管理</a> <a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" style="font-size: 14.17px;">读书笔记</a> <a href="/tags/%E9%87%91%E8%9E%8D/" style="font-size: 12.5px;">金融</a></div></div><div class="widget"><div id="arAnchorBar"></div></div></div></section></div><div class="right-menu"></div><div class="modal search-modal"><div class="input-field"><input type="text" id="search_input"><label for="search-input">搜索</label></div><div id="search_result" class="search-result"></div></div><div class="blog-overlay"></div><footer class="row"><div class="footer-con"><div class="paginator"><a href="/2018/02/08/java-jdbc-mapping-sql-and-java-types/" class="prev">PREV</a><a href="/2018/02/03/java-jdbc-driver/" class="next">NEXT</a></div><div class="copyright"><p>© 2014 - 2021 <a href="https://github.com/qidawu" target="_blank">Qida's Blog</a></p><p>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <br> and <a href="https://github.com/Bulandent/hexo-theme-bubuzou" target="_blank">hexo-theme-bubuzou</a></p></div><div class="totop"><i></i></div></div></footer><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src="/scripts/jquery-1.8.2.min.js"></script><script src="https://cdn1.lncld.net/static/js/av-mini-0.6.10.js"></script><script src="/scripts/hit-kounter-lc-0.2.0.js"></script><script src="/scripts/arAnchor.js"></script><script src="/scripts/main.js"></script></body></html>