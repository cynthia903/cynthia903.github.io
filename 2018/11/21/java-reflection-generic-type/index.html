<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content="1EB8XoOl0C"><meta name="google-site-verification" content="K7thEgdLm0UfRWJ5MGdF7sCcjClSzAlxFLPv2Oz5CGM"><title> Java 反射篇（三）泛型 API 总结 · Qida's Blog</title><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="Java 反射篇（三）泛型 API 总结 - Qida's Blog"><meta name="keywords"><meta name="author" content="Qida's Blog"><link rel="short icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/bubuzou.css"><link rel="search" type="application/opensearchdescription+xml" href="https://qidawu.github.io/atom.xml" title="Qida's Blog"><meta name="generator" content="Hexo 4.2.1"></head><body><header><div class="header row"> <a href="/" class="logo-link"><img src="/images/logo.png"></a><a href="/" class="title-link">Qida's Blog</a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" data-hover="博文" class="nav-list-link">博文</a></li><li class="nav-list-item"><a href="/archives/" target="_self" data-hover="归档" class="nav-list-link">归档</a></li></ul><div class="search"><a id="search_btn" href="#search"></a></div></div></header><div class="row scroll-con"><section class="container"><!-- for archive page--><div id="postAr" class="post"><article class="post-block"><h1 class="post-title">Java 反射篇（三）泛型 API 总结</h1><div class="post-info">2018-11-21<a href="/tags/Java/" title="Java" class="post-demo">Java</a></div><div class="post-content"><h1 id="泛型-API"><a href="#泛型-API" class="headerlink" title="泛型 API"></a>泛型 API</h1><p>JDK 1.5 引入了泛型特性，一同引入的还有 Java <code>Type</code> 类型体系。其中 <code>Type</code> 接口作为核心，是 Java 编程语言中所有类型的通用超级接口（common superinterface），这些类型包括：</p>
<ul>
<li>原始类型（raw types）</li>
<li>参数化类型（parameterized types）</li>
<li>数组类型（array types）</li>
<li>类型变量（type variables）</li>
<li>八大原始类型（primitive types）</li>
</ul>
<p>调整后新引入的五个接口如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java.lang.reflect.Type</span><br><span class="line">  java.lang.reflect.ParameterizedType &#x2F;&#x2F; 最最常用</span><br><span class="line">  java.lang.reflect.TypeVariable</span><br><span class="line">  java.lang.reflect.WildcardType</span><br><span class="line">  java.lang.reflect.GenericArrayType</span><br></pre></td></tr></table></figure>

<p><img src="/img/java/reflection/Type.png" alt="Type"></p>
<p>它们的核心方法如下：</p>
<p><img src="/img/java/reflection/Type_methods.png" alt="Type_methods"></p>
<p>同时新增的接口还有 <code>GenericDeclaration</code>。从源码中看，只有三个类实现了该接口（见下图）。因此我们只能在<strong>类型</strong>（例如 <code>class</code>，<code>interface</code>）、<strong>方法</strong>（<code>Method</code>）和<strong>构造方法</strong>（<code>Constructor</code>）这三个地方声明泛型参数（type variables），而其它地方只能使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java.lang.reflect.Method</span><br><span class="line">java.lang.reflect.Constructor</span><br><span class="line">java.lang.Class</span><br></pre></td></tr></table></figure>

<p><img src="/img/java/reflection/GenericDeclaration.png" alt="GenericDeclaration"></p>
<p><code>GenericDeclaration</code> 接口只定义了一个方法，用于获取 <code>TypeVariable</code>：</p>
<p><img src="/img/java/reflection/GenericDeclaration_method.png" alt="GenericDeclaration_method"></p>
<p>类、字段、方法、构造方法也相应增加了一组方法用于获取 <code>Type</code>、<code>TypeVariable</code>：</p>
<ul>
<li><p><code>Class</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取普通 Class</span></span><br><span class="line">Class&lt;? <span class="keyword">super</span> T&gt; getSuperclass()</span><br><span class="line">Class&lt;?&gt;[] getInterfaces()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 Type</span></span><br><span class="line"><span class="function">Type <span class="title">getGenericSuperclass</span><span class="params">()</span></span></span><br><span class="line"><span class="function">Type[] <span class="title">getGenericInterfaces</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 获取 TypeVariable</span></span></span><br><span class="line"><span class="function">TypeVariable&lt;?&gt;[] <span class="title">getTypeParameters</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>Field</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取普通 Class</span></span><br><span class="line">Class&lt;?&gt; getType()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 Type</span></span><br><span class="line"><span class="function">Type <span class="title">getGenericType</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>Method</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取普通 Class</span></span><br><span class="line">Class&lt;?&gt; getReturnType()</span><br><span class="line">Class&lt;?&gt;[] getParameterTypes()</span><br><span class="line">Class&lt;?&gt;[] getExceptionTypes()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 Type</span></span><br><span class="line"><span class="function">Type <span class="title">getGenericReturnType</span><span class="params">()</span></span></span><br><span class="line"><span class="function">Type[] <span class="title">getGenericParameterTypes</span><span class="params">()</span></span></span><br><span class="line"><span class="function">Type[] <span class="title">getGenericExceptionTypes</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 获取 TypeVariable</span></span></span><br><span class="line"><span class="function">TypeVariable&lt;?&gt;[] <span class="title">getTypeParameters</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>Constructor</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取普通 Class</span></span><br><span class="line">Class&lt;?&gt;[] getParameterTypes()</span><br><span class="line">Class&lt;?&gt;[] getExceptionTypes()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 Type</span></span><br><span class="line">Type[] getGenericParameterTypes()</span><br><span class="line">Type[] getGenericExceptionTypes()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 TypeVariable</span></span><br><span class="line">TypeVariable&lt;?&gt;[] getTypeParameters()</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="泛型术语"><a href="#泛型术语" class="headerlink" title="泛型术语"></a>泛型术语</h1><p>泛型涉及的术语比较多，其与反射接口的对应关系如下：</p>
<table>
<thead>
<tr>
<th>术语</th>
<th>中文含义</th>
<th>举例</th>
<th>反射接口</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>Generic type</td>
<td>泛型</td>
<td><code>List&lt;E&gt;</code></td>
<td><code>ParameterizedType</code></td>
<td></td>
</tr>
<tr>
<td>Parameterized type</td>
<td>参数化类型</td>
<td><code>List&lt;String&gt;</code></td>
<td><code>ParameterizedType</code></td>
<td></td>
</tr>
<tr>
<td>Raw type</td>
<td>原始类型</td>
<td><code>List</code></td>
<td><code>ParameterizedType#getRawType</code></td>
<td>该方法虽然返回  <code>Type</code> 类型，但实际类型是 <code>Class</code>，可以强转使用：<code>(Class&lt;?&gt;) type</code>。</td>
</tr>
<tr>
<td>Unbounded wildcard type</td>
<td>无限制通配符类型</td>
<td><code>List&lt;?&gt;</code></td>
<td><code>ParameterizedType</code></td>
<td></td>
</tr>
<tr>
<td>Bounded wildcard type</td>
<td>有限制通配符类型（上限）</td>
<td><code>List&lt;? extends Number&gt;</code></td>
<td><code>ParameterizedType</code></td>
<td></td>
</tr>
<tr>
<td>Bounded wildcard type</td>
<td>有限制通配符类型（下限）</td>
<td><code>List&lt;? super Number&gt;</code></td>
<td><code>ParameterizedType</code></td>
<td></td>
</tr>
<tr>
<td>wildcard type</td>
<td>通配符类型</td>
<td><code>?</code></td>
<td><code>WildcardType</code></td>
<td></td>
</tr>
<tr>
<td>Formal type parameter</td>
<td>形式类型参数</td>
<td><code>E</code></td>
<td><code>TypeVarialbe</code></td>
<td></td>
</tr>
<tr>
<td>Actual type parameter</td>
<td>实际类型参数</td>
<td><code>String</code></td>
<td><code>ParameterizedType#getActualTypeArguments</code></td>
<td>该方法虽然返回  <code>Type[]</code> 类型，但各元素实际类型是 <code>Class</code>，可以强转使用：<code>(Class&lt;?&gt;) type</code>。</td>
</tr>
<tr>
<td>Bounded type parameter</td>
<td>有限制类型参数</td>
<td><code>&lt;E extends Number&gt;</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Recursive type bound</td>
<td>递归类型限制</td>
<td><code>&lt;T extends Comparable&lt;T&gt;&gt;</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Generic method</td>
<td>泛型方法</td>
<td><code>static &lt;E&gt; List&lt;E&gt; asList(E[] a)</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Type token</td>
<td>类型令牌</td>
<td><code>String.class</code></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h1 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h1><p>下面是几个获取 <code>Type</code> 的例子，先创建三个类：<code>BaseMapper</code>、<code>PersonMapper</code>、<code>Person</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BaseMapper</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Serializable</span> &amp; <span class="title">Comparable</span>&lt;<span class="title">T</span>&gt;, <span class="title">K</span> <span class="keyword">extends</span> <span class="title">Serializable</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">T <span class="title">getById</span><span class="params">(K id)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonMapper</span> <span class="keyword">implements</span> <span class="title">BaseMapper</span>&lt;<span class="title">Person</span>, <span class="title">Long</span>&gt;, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Person <span class="title">getById</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">(List&lt;?&gt; list)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;T extends Number&gt; <span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">(List&lt;T&gt; list1, List&lt;? extends Comparable&lt;T&gt;&gt; list2, T[] array, T item)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">implements</span> <span class="title">Serializable</span>, <span class="title">Comparable</span>&lt;<span class="title">Person</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String personName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Person o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.personName.compareTo(o.getPersonName());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="例子一"><a href="#例子一" class="headerlink" title="例子一"></a>例子一</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Method method = PersonMapper.class.getMethod("test", List.class, List.class, Number[].class, Number.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// [0] ParameterizedType</span></span><br><span class="line">    <span class="comment">// [1] ParameterizedType</span></span><br><span class="line">    <span class="comment">// [2] GenericArrayType</span></span><br><span class="line">    <span class="comment">// [3] TypeVariable</span></span><br><span class="line">    Type[] genericParameterTypes = method.getGenericParameterTypes();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Class</span></span><br><span class="line">    Type genericReturnType = method.getGenericReturnType();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Class[0]</span></span><br><span class="line">    Type[] genericExceptionTypes = method.getGenericExceptionTypes();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>三个 <code>Type</code> 变量的内容如下：</p>
<p><img src="/img/java/reflection/generic_type_example.png" alt="generic_type_examples"></p>
<h2 id="例子二"><a href="#例子二" class="headerlink" title="例子二"></a>例子二</h2><p>接下来看下 <code>ParameterizedType</code> 的使用，可以用于获取泛型的原始类型（Raw type）、实际类型参数（Actual type parameter）列表：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// com.github.reflection.BaseMapper&lt;com.github.reflection.Person, java.lang.Long&gt;</span></span><br><span class="line">    Type genericInterface = PersonMapper.class.getGenericInterfaces()[0];</span><br><span class="line">    assertTrue(genericInterface <span class="keyword">instanceof</span> ParameterizedType);</span><br><span class="line">    ParameterizedType parameterizedType = (ParameterizedType) genericInterface;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取原始类型：BaseMapper.class</span></span><br><span class="line">    assertEquals(BaseMapper<span class="class">.<span class="keyword">class</span>, <span class="title">parameterizedType</span>.<span class="title">getRawType</span>())</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取实际类型参数列表：Person.class、Long.class</span></span><br><span class="line">    Type[] actualTypeArguments = parameterizedType.getActualTypeArguments();</span><br><span class="line">    assertEquals(<span class="string">"There are two actual type arguments"</span>, <span class="number">2</span>, actualTypeArguments.length);</span><br><span class="line">    <span class="comment">// class com.github.reflection.Person</span></span><br><span class="line">    assertClass(<span class="string">"One is Person"</span>, actualTypeArguments[<span class="number">0</span>], Person<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    <span class="comment">// class java.lang.Long</span></span><br><span class="line">    assertClass(<span class="string">"Another is Long"</span>, actualTypeArguments[<span class="number">1</span>], Long<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">assertClass</span><span class="params">(Type type, Class expectedClass)</span> </span>&#123;</span><br><span class="line">    assertTrue(type <span class="keyword">instanceof</span> Class);</span><br><span class="line">    Class clazz = (Class) type;</span><br><span class="line">    assertEquals(expectedClass, clazz);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>genericInterface</code> 变量的内容如下，接口返回类型虽然为 <code>Type</code>，实际类型为 <code>ParameterizedType</code>，因此可以强转。该泛型变量的原始类型、实际类型参数列表如下，实际都为 <code>Class</code> 类型，因此可以强转 <code>(Class&lt;?&gt;) type</code>：</p>
<p><img src="/img/java/reflection/ParameterizedType_example.png" alt="ParameterizedType_example"></p>
<h2 id="例子三"><a href="#例子三" class="headerlink" title="例子三"></a>例子三</h2><p><code>WildcardType</code> 的使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// java.util.List&lt;?&gt;</span></span><br><span class="line">    Method method = PersonMapper.class.getMethod("log", List.class);</span><br><span class="line">    Type genericParameterType = method.getGenericParameterTypes()[<span class="number">0</span>];</span><br><span class="line">    assertTrue(<span class="string">"The first parameter type of log method is instance of ParameterizedType"</span>, </span><br><span class="line">               genericParameterType <span class="keyword">instanceof</span> ParameterizedType);</span><br><span class="line">    ParameterizedType parameterType = (ParameterizedType) genericParameterType;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// WildcardType</span></span><br><span class="line">    Type type = parameterType.getActualTypeArguments()[<span class="number">0</span>];</span><br><span class="line">    assertTrue(<span class="string">"The actual type argument of ParameterizedType is instance of WildcardType"</span>, </span><br><span class="line">               type <span class="keyword">instanceof</span> WildcardType);</span><br><span class="line">    WildcardType wildcardType = (WildcardType) type;</span><br><span class="line">    assertEquals(<span class="string">"No lower bounds exist"</span>, <span class="number">0</span>, wildcardType.getLowerBounds().length);</span><br><span class="line">    assertEquals(<span class="string">"Only one upper bound exist"</span>, <span class="number">1</span>, wildcardType.getUpperBounds().length);</span><br><span class="line">    <span class="comment">// 通配符默认上限类型为 Object</span></span><br><span class="line">    assertEquals("The upper bound is Object", Object.class, wildcardType.getUpperBounds()[0]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Type</code> 类型变量 <code>genericParameterType</code> 的内容如下，实际类型是 <code>ParameterizedType</code>，其 <code>?</code> 通配符是 <code>WildcardType</code>：</p>
<p><img src="/img/java/reflection/WildcardType_example.png" alt="WildcardType_example"></p>
<h2 id="例子四"><a href="#例子四" class="headerlink" title="例子四"></a>例子四</h2><p><code>TypeVariable</code> 的使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Method method = BaseMapper.class.getMethod("getById", Serializable.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// TypeVariable</span></span><br><span class="line">    Type genericReturnType = method.getGenericReturnType();</span><br><span class="line">    assertTrue(<span class="string">"Return type of method is instance of TypeVariable"</span>, genericReturnType <span class="keyword">instanceof</span> TypeVariable);</span><br><span class="line">    TypeVariable typeVariable = (TypeVariable) genericReturnType;</span><br><span class="line">    assertEquals("First upper bound is Serializable", Serializable.class, typeVariable.getBounds()[0]);</span><br><span class="line">    ParameterizedType parameterizedType = (ParameterizedType) typeVariable.getBounds()[<span class="number">1</span>];</span><br><span class="line">    assertEquals(<span class="string">"Second upper bound is Comparable"</span>, Comparable<span class="class">.<span class="keyword">class</span>, <span class="title">parameterizedType</span>.<span class="title">getRawType</span>())</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Type</code> 类型变量 <code>genericReturnType</code> 的内容如下，实际类型是 <code>TypeVariable</code>，</p>
<p><img src="/img/java/reflection/TypeVariable_example.png" alt="TypeVariable_example"></p>
<h2 id="例子五"><a href="#例子五" class="headerlink" title="例子五"></a>例子五</h2><p>定义一个泛型工具类，用于获取 <code>T.class</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.ParameterizedType;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Type;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericsUtils</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过反射获得定义 Class 时声明的父类的泛型参数的类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回第一个类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Class <span class="title">getSuperClassGenricType</span><span class="params">(Class clazz)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getSuperClassGenricType(clazz, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过反射获得定义 Class 时声明的父类的泛型参数的类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> 返回某个下标的类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Class <span class="title">getSuperClassGenricType</span><span class="params">(Class clazz, <span class="keyword">int</span> index)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> IndexOutOfBoundsException </span>&#123;</span><br><span class="line">        Type genType = clazz.getGenericSuperclass();</span><br><span class="line">        <span class="keyword">if</span> (!(genType <span class="keyword">instanceof</span> ParameterizedType)) &#123;</span><br><span class="line">            <span class="keyword">return</span> Object<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Type[] params = ((ParameterizedType) genType).getActualTypeArguments();</span><br><span class="line">        <span class="keyword">if</span> (index &gt;= params.length || index &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Object<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!(params[index] <span class="keyword">instanceof</span> Class)) &#123;</span><br><span class="line">            <span class="keyword">return</span> Object<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (Class) params[index];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://www.jianshu.com/p/faed45dbfa0c" target="_blank" rel="noopener">https://www.jianshu.com/p/faed45dbfa0c</a></p>
<p><a href="https://blog.csdn.net/ShuSheng0007/article/details/89520530" target="_blank" rel="noopener">https://blog.csdn.net/ShuSheng0007/article/details/89520530</a></p>
<p>API：</p>
<ul>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Type.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Type.html</a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/ParameterizedType.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/ParameterizedType.html</a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/TypeVariable.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/TypeVariable.html</a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/WildcardType.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/WildcardType.html</a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/GenericArrayType.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/GenericArrayType.html</a></li>
</ul>
</div></article></div><div class="right-container"><div class="widget"><div class="tagcloud"><h4>标签云</h4><a href="/tags/C-C/" style="font-size: 15px;">C/C++</a> <a href="/tags/DNS/" style="font-size: 12.5px;">DNS</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/GNU-Linux/" style="font-size: 16.67px;">GNU/Linux</a> <a href="/tags/Git/" style="font-size: 17.5px;">Git</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/MySQL/" style="font-size: 19.17px;">MySQL</a> <a href="/tags/Nginx/" style="font-size: 11.67px;">Nginx</a> <a href="/tags/Redis/" style="font-size: 10.83px;">Redis</a> <a href="/tags/Spring/" style="font-size: 15.83px;">Spring</a> <a href="/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" style="font-size: 11.67px;">函数式编程</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 18.33px;">前端</a> <a href="/tags/%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B/" style="font-size: 11.67px;">响应式编程</a> <a href="/tags/%E5%AE%89%E5%85%A8/" style="font-size: 12.5px;">安全</a> <a href="/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" style="font-size: 11.67px;">并发编程</a> <a href="/tags/%E5%BB%BA%E7%AB%99/" style="font-size: 13.33px;">建站</a> <a href="/tags/%E7%AE%A1%E7%90%86/" style="font-size: 12.5px;">管理</a> <a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" style="font-size: 14.17px;">读书笔记</a> <a href="/tags/%E9%87%91%E8%9E%8D/" style="font-size: 12.5px;">金融</a></div></div><div class="widget"><div id="arAnchorBar"></div></div></div></section></div><div class="right-menu"></div><div class="modal search-modal"><div class="input-field"><input type="text" id="search_input"><label for="search-input">搜索</label></div><div id="search_result" class="search-result"></div></div><div class="blog-overlay"></div><footer class="row"><div class="footer-con"><div class="paginator"><a href="/2018/12/01/java-jdk-proxy/" class="prev">PREV</a><a href="/2018/11/14/java-reflection-annotation/" class="next">NEXT</a></div><div class="copyright"><p>© 2014 - 2021 <a href="https://github.com/qidawu" target="_blank">Qida's Blog</a></p><p>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <br> and <a href="https://github.com/Bulandent/hexo-theme-bubuzou" target="_blank">hexo-theme-bubuzou</a></p></div><div class="totop"><i></i></div></div></footer><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src="/scripts/jquery-1.8.2.min.js"></script><script src="https://cdn1.lncld.net/static/js/av-mini-0.6.10.js"></script><script src="/scripts/hit-kounter-lc-0.2.0.js"></script><script src="/scripts/arAnchor.js"></script><script src="/scripts/main.js"></script></body></html>