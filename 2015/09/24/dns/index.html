<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content="1EB8XoOl0C"><meta name="google-site-verification" content="K7thEgdLm0UfRWJ5MGdF7sCcjClSzAlxFLPv2Oz5CGM"><title> DNS 知识总结 · Qida's Blog</title><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="DNS 知识总结 - Qida's Blog"><meta name="keywords"><meta name="author" content="Qida's Blog"><link rel="short icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/bubuzou.css"><link rel="search" type="application/opensearchdescription+xml" href="https://qidawu.github.io/atom.xml" title="Qida's Blog"><meta name="generator" content="Hexo 4.2.1"></head><body><header><div class="header row"> <a href="/" class="logo-link"><img src="/images/logo.png"></a><a href="/" class="title-link">Qida's Blog</a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" data-hover="博文" class="nav-list-link">博文</a></li><li class="nav-list-item"><a href="/archives/" target="_self" data-hover="归档" class="nav-list-link">归档</a></li></ul><div class="search"><a id="search_btn" href="#search"></a></div></div></header><div class="row scroll-con"><section class="container"><!-- for archive page--><div id="postAr" class="post"><article class="post-block"><h1 class="post-title">DNS 知识总结</h1><div class="post-info">2015-09-24<a href="/tags/DNS/" title="DNS" class="post-demo">DNS</a></div><div class="post-content"><p>工作、生活中常与域名打交道，尤其是近期需要为公司的系统上 CDN 服务，因此对 CDN 的核心 DNS 做了一番重温、总结。</p>
<h1 id="DNS-是什么？"><a href="#DNS-是什么？" class="headerlink" title="DNS 是什么？"></a>DNS 是什么？</h1><p>DNS 是互联网的一项基础服务，它将人类易记的<a href="https://en.wikipedia.org/wiki/Domain_name" target="_blank" rel="noopener">域名</a>解析为不易记的 IP 地址，使人更方便的访问互联网。</p>
<h1 id="DNS-的结构？"><a href="#DNS-的结构？" class="headerlink" title="DNS 的结构？"></a>DNS 的结构？</h1><p><a href="https://en.wikipedia.org/wiki/Domain_Name_System" target="_blank" rel="noopener">域名系统（DNS）</a>是一个多层级、分布式的系统，就如同一个树状结构：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">                    +---+                                 </span><br><span class="line">                    | . |   Root nameserver               </span><br><span class="line">                    +-+-+                                 </span><br><span class="line">                      |                                   </span><br><span class="line">  +-------+-------+---+---+-------+-------+               </span><br><span class="line">  |       |       |       |       |       |               </span><br><span class="line">+-+-+   +-+-+   +-+-+   +-+-+   +-+-+   +-+-+    </span><br><span class="line">|com|   |net|   |org|   |gov|   |cn |   |...|   Top-level domain</span><br><span class="line">+---+   +---+   +-+-+   +---+   +---+   +---+             </span><br><span class="line">                  |                                       </span><br><span class="line">             +----+----+                     </span><br><span class="line">             |wikipedia|   First-level domain                     </span><br><span class="line">             +----+----+                                  </span><br><span class="line">                  |                                       </span><br><span class="line">          +---------------+                               </span><br><span class="line">          |       |       |                               </span><br><span class="line">        +-+-+   +-+-+   +-+--+                            </span><br><span class="line">        |www|   |ftp|   |mail|   Resource record          </span><br><span class="line">        +---+   +---+   +----+</span><br></pre></td></tr></table></figure>

<p>域名系统（DNS）的每一级只知道直接下级的位置，而无法获得跨级的位置，因此在域名解析的时候，需要自上而下、逐级查询。这种机制虽然看似低效，却能够提供分布式、高容错的服务，避免让域名系统（DNS）成为一个集中式的单点系统。</p>
<h1 id="DNS-如何解析域名？"><a href="#DNS-如何解析域名？" class="headerlink" title="DNS 如何解析域名？"></a>DNS 如何解析域名？</h1><p>对某个域名发起第一次解析请求时，负责处理递归查询的<strong>本地 DNS 服务器</strong>要发送好几次查询：</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/77/An_example_of_theoretical_DNS_recursion.svg/1024px-An_example_of_theoretical_DNS_recursion.svg.png" alt="A DNS recursor consults three name servers to resolve the address www.wikipedia.org."></p>
<p>域名解析的时候，需要自上而下、逐级查询：先查根域，再查顶级域，再查一级域名，最终定位到 IP 地址。<code>dig</code> 命令加 <code>+trace</code> 参数可以<strong>追踪</strong>整个域名解析过程，从中了解经过的每一级 nameserver，其结果简化如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$ dig +trace www.wikipedia.org</span><br><span class="line"></span><br><span class="line">;; global options: +cmd</span><br><span class="line">.                    NS      a.root-servers.net.</span><br><span class="line">.                    NS      b.root-servers.net.</span><br><span class="line">.                    NS      c.root-servers.net.</span><br><span class="line">.                    NS      d.root-servers.net.</span><br><span class="line">.                    NS      e.root-servers.net.</span><br><span class="line">.                    NS      f.root-servers.net.</span><br><span class="line">.                    NS      g.root-servers.net.</span><br><span class="line">.                    NS      h.root-servers.net.</span><br><span class="line">.                    NS      i.root-servers.net.</span><br><span class="line">.                    NS      j.root-servers.net.</span><br><span class="line">.                    NS      k.root-servers.net.</span><br><span class="line">.                    NS      l.root-servers.net.</span><br><span class="line">.                    NS      m.root-servers.net.</span><br><span class="line">;; Received 315 bytes from 202.96.128.166#53(202.96.128.166) in 642 ms</span><br><span class="line"></span><br><span class="line">org.                 NS      a0.org.afilias-nst.info.</span><br><span class="line">org.                 NS      a2.org.afilias-nst.info.</span><br><span class="line">org.                 NS      b0.org.afilias-nst.org.</span><br><span class="line">org.                 NS      b2.org.afilias-nst.org.</span><br><span class="line">org.                 NS      c0.org.afilias-nst.info.</span><br><span class="line">org.                 NS      d0.org.afilias-nst.org.</span><br><span class="line">;; Received 691 bytes from 199.7.83.42#53(l.root-servers.net) in 408 ms</span><br><span class="line"></span><br><span class="line">wikipedia.org.       NS      ns0.wikimedia.org.</span><br><span class="line">wikipedia.org.       NS      ns1.wikimedia.org.</span><br><span class="line">wikipedia.org.       NS      ns2.wikimedia.org.</span><br><span class="line">;; Received 651 bytes from 199.19.53.1#53(c0.org.afilias-nst.info) in 1155 ms</span><br><span class="line"></span><br><span class="line">www.wikipedia.org.   A       198.35.26.96</span><br><span class="line">;; Received 90 bytes from 91.198.174.239#53(ns2.wikimedia.org) in 365 ms</span><br></pre></td></tr></table></figure>

<p>下面分别介绍每一级 nameserver：</p>
<h2 id="根域名（Root-nameserver）"><a href="#根域名（Root-nameserver）" class="headerlink" title="根域名（Root nameserver）"></a>根域名（Root nameserver）</h2><p><code>.</code> 代表的<a href="https://en.wikipedia.org/wiki/Root_name_server" target="_blank" rel="noopener">根域名服务器（Root nameserver）</a>，是 DNS 中最高级别的<a href="https://en.wikipedia.org/wiki/Name_server" target="_blank" rel="noopener">域名服务器（nameserver）</a>，负责返回顶级域名的<a href="https://en.wikipedia.org/wiki/Authoritative_name_server" target="_blank" rel="noopener">权威域名服务器（authoritative nameserver）</a>的地址。</p>
<p>早期的域名必须以英文句号“<code>.</code>”结尾，当用户访问 <code>www.wikipedia.org</code> 的 HTTP 服务时必须在地址栏中输入：<code>http://www.wikipedia.org.</code>，这样 DNS 才能够进行域名解析。如今 DNS 服务器已经可以自动补上结尾的句号。</p>
<p>目前全球共有 13 组根域名服务器，以英文字母 A 到 M 依序编号，域名格式为“<code>字母.root-servers.net</code>”。编号相同的根域名服务器使用同一个 IP，数百台根域名服务器总共只使用 13 个 IP，因此可以抵抗针对其所进行的分布式拒绝服务攻击（DDoS）。这些根域名服务器的运行软件皆为 <a href="https://en.wikipedia.org/wiki/BIND" target="_blank" rel="noopener">BIND</a>、<a href="https://en.wikipedia.org/wiki/NSD" target="_blank" rel="noopener">NSD</a>。</p>
<h2 id="顶级域名（Top-level-domain）"><a href="#顶级域名（Top-level-domain）" class="headerlink" title="顶级域名（Top-level domain）"></a>顶级域名（Top-level domain）</h2><p><a href="https://en.wikipedia.org/wiki/Top-level_domain" target="_blank" rel="noopener">顶级域名（Top-level domain, TLD）</a>主要分为两类：</p>
<ul>
<li><a href="http://zh.wikipedia.org/wiki/GTLD" target="_blank" rel="noopener">通用顶级域名（Generic top-level domain，gTLD）</a>，如常见的：<code>.com</code>、<code>.net</code>、<code>.org</code>、<code>.gov</code>、… 本站 <code>.me</code> 是一个新开放的通用顶级域名。</li>
<li><a href="http://zh.wikipedia.org/wiki/CcTLD" target="_blank" rel="noopener">国家和地区顶级域名（Country code top-level domain，ccTLD）</a>，一般用两个字母的国家或地区名缩写代称，如：<code>.cn</code>、<code>.jp</code>、…</li>
</ul>
<p>顶级域名的数量仍在不断增长中，除了英文字母的域名，还不断新增各种语系的域名，如中文域名。</p>
<h2 id="一级域名（First-level-domain）"><a href="#一级域名（First-level-domain）" class="headerlink" title="一级域名（First-level domain）"></a>一级域名（First-level domain）</h2><p>组织或个人通过域名代理服务商（如 GoDaddy、万网）进行注册的域名。根据需要还可以自行在一级域名下新增二级、三级等子域名。</p>
<h2 id="资源记录（Resource-record）"><a href="#资源记录（Resource-record）" class="headerlink" title="资源记录（Resource record）"></a>资源记录（Resource record）</h2><p>域名系统中，一般一个<a href="https://en.wikipedia.org/wiki/DNS_zone" target="_blank" rel="noopener">域（DNS zone）</a>通过一个 <a href="https://en.wikipedia.org/wiki/Zone_file" target="_blank" rel="noopener">zone 文件</a>保存该域的相关配置信息。zone 文件包含了域名和 IP 地址等资源之间的映射，以<a href="https://en.wikipedia.org/wiki/Domain_Name_System#DNS_resource_records" target="_blank" rel="noopener">资源记录（Resource recerd, RR）</a>的文本形式进行组织。<a href="https://en.wikipedia.org/wiki/List_of_DNS_record_types" target="_blank" rel="noopener">这里</a>列举了所有的资源记录类型。</p>
<p>以域名 <code>example.com</code> 为例，其 zone 文件简化如下：</p>
<table>
<thead>
<tr>
<th>name</th>
<th>ttl</th>
<th>record class</th>
<th>record type</th>
<th>record data</th>
<th>comment</th>
</tr>
</thead>
<tbody><tr>
<td>example.com.</td>
<td>1h</td>
<td>IN</td>
<td>NS</td>
<td>ns</td>
<td>ns.example.com is a nameserver for example.com</td>
</tr>
<tr>
<td>ns</td>
<td>1h</td>
<td>IN</td>
<td>A</td>
<td>192.0.2.2</td>
<td>IPv4 address for ns.example.com</td>
</tr>
<tr>
<td>example.com.</td>
<td>1h</td>
<td>IN</td>
<td>A</td>
<td>192.0.2.1</td>
<td>IPv4 address for example.com</td>
</tr>
<tr>
<td>www</td>
<td>1h</td>
<td>IN</td>
<td>CNAME</td>
<td>example.com.</td>
<td><a href="http://www.example.com" target="_blank" rel="noopener">www.example.com</a> is an alias for example.com</td>
</tr>
</tbody></table>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>综上，注册域名、管理资源记录都是站长最常见的操作。至于域名解析就交给本地 DNS 服务器代为处理，一般用户都无需操心。</p>
</div></article></div><div class="right-container"><div class="widget"><div class="tagcloud"><h4>标签云</h4><a href="/tags/C-C/" style="font-size: 15px;">C/C++</a> <a href="/tags/DNS/" style="font-size: 12.5px;">DNS</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/GNU-Linux/" style="font-size: 16.67px;">GNU/Linux</a> <a href="/tags/Git/" style="font-size: 17.5px;">Git</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/MySQL/" style="font-size: 19.17px;">MySQL</a> <a href="/tags/Nginx/" style="font-size: 11.67px;">Nginx</a> <a href="/tags/Redis/" style="font-size: 10.83px;">Redis</a> <a href="/tags/Spring/" style="font-size: 15.83px;">Spring</a> <a href="/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" style="font-size: 11.67px;">函数式编程</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 18.33px;">前端</a> <a href="/tags/%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B/" style="font-size: 11.67px;">响应式编程</a> <a href="/tags/%E5%AE%89%E5%85%A8/" style="font-size: 12.5px;">安全</a> <a href="/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" style="font-size: 11.67px;">并发编程</a> <a href="/tags/%E5%BB%BA%E7%AB%99/" style="font-size: 13.33px;">建站</a> <a href="/tags/%E7%AE%A1%E7%90%86/" style="font-size: 12.5px;">管理</a> <a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" style="font-size: 14.17px;">读书笔记</a> <a href="/tags/%E9%87%91%E8%9E%8D/" style="font-size: 12.5px;">金融</a></div></div><div class="widget"><div id="arAnchorBar"></div></div></div></section></div><div class="right-menu"></div><div class="modal search-modal"><div class="input-field"><input type="text" id="search_input"><label for="search-input">搜索</label></div><div id="search_result" class="search-result"></div></div><div class="blog-overlay"></div><footer class="row"><div class="footer-con"><div class="paginator"><a href="/2015/09/30/cdn-gslb-dns/" class="prev">PREV</a><a href="/2015/09/17/vim/" class="next">NEXT</a></div><div class="copyright"><p>© 2014 - 2021 <a href="https://github.com/qidawu" target="_blank">Qida's Blog</a></p><p>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <br> and <a href="https://github.com/Bulandent/hexo-theme-bubuzou" target="_blank">hexo-theme-bubuzou</a></p></div><div class="totop"><i></i></div></div></footer><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src="/scripts/jquery-1.8.2.min.js"></script><script src="https://cdn1.lncld.net/static/js/av-mini-0.6.10.js"></script><script src="/scripts/hit-kounter-lc-0.2.0.js"></script><script src="/scripts/arAnchor.js"></script><script src="/scripts/main.js"></script></body></html>